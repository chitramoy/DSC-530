/*! For license information please see Gc2HostPpt.js.LICENSE.txt */
var Gc2HostPpt;(()=>{"use strict";var e,t,r={2082:(e,t,r)=>{var i;r.d(t,{O:()=>i}),function(e){e[e.SmartArt=0]="SmartArt",e[e.Chart=1]="Chart",e[e.Video=2]="Video",e[e.Picture=3]="Picture"}(i||(i={}))},4016:(e,t,r)=>{var i;r.d(t,{r:()=>i}),function(e){e[e.General=0]="General",e[e.GraphicHost=1]="GraphicHost",e[e.Operation=2]="Operation"}(i||(i={}))},3331:(e,t,r)=>{var i;r.d(t,{G:()=>i}),function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Spam=4]="Spam",e[e.ShiftFactor=5]="ShiftFactor"}(i||(i={}))},3977:(e,t)=>{var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.Result=t.ACSBackgroundRemovalErrorType=void 0,(i=t.ACSBackgroundRemovalErrorType||(t.ACSBackgroundRemovalErrorType={})).InputImageUndefined="INPUT_IMAGE_UNDEFINED",i.ComputerVisionResourceUndefined="CV_RESOURCE_UNDEFINED",i.ACSBackendError="ACS_BACKEND_ERROR",i.UnknownError="UNKNOWN_ERROR",(r=t.Result||(t.Result={})).Success="Success",r.Failure="Failure"},835:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ACSBackgroundRemovalAnnotation=t.BaseAnnotation=void 0;const i=r(2170);class n{constructor(e){i.SchemaObject.assign(n,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_AcsImageTransform_BaseAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}static typeGuard(e){return i.SchemaObject.matchesTypesFor(e,[n.getTypeName()])}}t.BaseAnnotation=n,n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class s{constructor(e){i.SchemaObject.assign(s,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_AcsImageTransform_ACSBackgroundRemovalAnnotation"}static getBaseTypes(){return["AugLoop_AcsImageTransform_BaseAnnotation","AugLoop_Core_Annotation"]}static typeGuard(e){return i.SchemaObject.matchesTypesFor(e,[s.getTypeName()])}}t.ACSBackgroundRemovalAnnotation=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()}},5365:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ACSBackgroundRemovalSignal=t.BaseSignal=void 0;const i=r(2170);class n{constructor(e){i.SchemaObject.assign(n,this,e)}static getTypeName(){return"AugLoop_AcsImageTransform_BaseSignal"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}static typeGuard(e){return i.SchemaObject.matchesTypesFor(e,[n.getTypeName()])}}t.BaseSignal=n,n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class s{constructor(e){i.SchemaObject.assign(s,this,e)}static getTypeName(){return"AugLoop_AcsImageTransform_ACSBackgroundRemovalSignal"}static getBaseTypes(){return["AugLoop_AcsImageTransform_BaseSignal","AugLoop_Signals_Signal"]}static typeGuard(e){return i.SchemaObject.matchesTypesFor(e,[s.getTypeName()])}}t.ACSBackgroundRemovalSignal=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()}},6334:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(3977),t),n(r(835),t),n(r(7316),t),n(r(5365),t)},7316:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ModeOptions=void 0,(r=t.ModeOptions||(t.ModeOptions={})).BackgroundRemoval="backgroundRemoval",r.ForegroundMatting="foregroundMatting"},478:(e,t)=>{var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.Result=t.CsSmartCropErrorType=void 0,(i=t.CsSmartCropErrorType||(t.CsSmartCropErrorType={})).InputImageUndefined="INPUT_IMAGE_UNDEFINED",i.ComputerVisionResourceUndefined="CV_RESOURCE_UNDEFINED",i.CSBackendError="CS_BACKEND_ERROR",i.UnknownError="UNKNOWN_ERROR",(r=t.Result||(t.Result={})).Success="Success",r.Failure="Failure"},8103:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CsSmartCropAnnotation=t.CsImageAnalysisAnnotation=void 0;const i=r(2170);class n{constructor(e){i.SchemaObject.assign(n,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_CsImageAnalysis_CsImageAnalysisAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}static typeGuard(e){return i.SchemaObject.matchesTypesFor(e,[n.getTypeName()])}}t.CsImageAnalysisAnnotation=n,n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class s{constructor(e){i.SchemaObject.assign(s,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_CsImageAnalysis_CsSmartCropAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}static typeGuard(e){return i.SchemaObject.matchesTypesFor(e,[s.getTypeName()])}}t.CsSmartCropAnnotation=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()}},4952:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(478),t),n(r(8103),t)},6571:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ImageTransformScenario=void 0,(r=t.ImageTransformScenario||(t.ImageTransformScenario={}))[r.SuperResolution=0]="SuperResolution",r[r.ImageStylizer=1]="ImageStylizer",r[r.BackgroundRemover=2]="BackgroundRemover",r[r.OneClickEnhancer=3]="OneClickEnhancer",r[r.AutoFocus=4]="AutoFocus",r[r.StyleReference=5]="StyleReference"},8440:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImageTransformAnnotation=void 0;const i=r(2170);class n{constructor(e){i.SchemaObject.assign(n,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_ImageTransform_ImageTransformAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}static typeGuard(e){return i.SchemaObject.matchesTypesFor(e,[n.getTypeName()])}}t.ImageTransformAnnotation=n,n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()}},4840:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImageTransformSignal=void 0;const i=r(2170);class n{constructor(e){i.SchemaObject.assign(n,this,e)}static getTypeName(){return"AugLoop_ImageTransform_ImageTransformSignal"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}static typeGuard(e){return i.SchemaObject.matchesTypesFor(e,[n.getTypeName()])}}t.ImageTransformSignal=n,n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()}},1161:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(6571),t),n(r(8440),t),n(r(4840),t),n(r(3348),t)},3348:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5670:(e,t,r)=>{r.d(t,{_:()=>i});class i{constructor(e){i.assign(i,this,e)}static getTypeName(){return"AugLoop_Core_SchemaObject"}static getBaseTypes(){return[]}static getTypeNameFor(e){return e&&e.H_?e.H_.T_:void 0}static getBaseTypesFor(e){return e&&e.H_&&e.H_.B_?e.H_.B_:[]}static getAllTypesFor(e){const t=i.getTypeNameFor(e);return t?[t,...i.getBaseTypesFor(e)]:[]}static matchesTypesFor(e,t){if(!Array.isArray(t)||0===t.length)return!0;const r=i.getTypeNameFor(e),n=i.getBaseTypesFor(e);for(const e of t){if(e===r)return!0;if(n.indexOf(e)>=0)return!0}return!1}static assign(e,t,r){if(r)for(const e of Object.keys(r))t[e]=r[e];return t.H_=e.H_,t}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()}},2170:(e,t,r)=>{var i,n,s,o,a;r.r(t),r.d(t,{AddOperation:()=>_,Annotation:()=>h,AnnotationState:()=>i,Binary:()=>B,BinaryClassificationAnnotation:()=>u,Blob:()=>A,BlobRefType:()=>o,ContextHolder:()=>V,DeleteOperation:()=>T,DeltaUpdateOperation:()=>P,Document:()=>D,DynamicContext:()=>N,Event:()=>d,EventsHolder:()=>H,FocusOperation:()=>C,GridCell:()=>k,GridConstants:()=>l,GridNeighborhoodContext:()=>O,ItemChanges:()=>s,ItemChangesDelta:()=>g,ItemDelta:()=>f,ItemFilter:()=>U,ItemOperation:()=>n,MicroSyncOperation:()=>E,MoveOperation:()=>v,OpenType:()=>a,Operation:()=>m,OperationWithSiblingContext:()=>y,PurgeOperation:()=>x,SchemaObject:()=>c._,Session:()=>F,Signal:()=>R,SignalOperation:()=>M,SubDocument:()=>L,TenantContextHolder:()=>z,TileGroup:()=>I,UpdateAnnotationMetaDataOperation:()=>b,UpdateOperation:()=>w,UserCommand:()=>p,UserCommandsHolder:()=>W,UserContextHolder:()=>G,VisibilityOperation:()=>S}),function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(i||(i={})),function(e){e[e.None=0]="None",e[e.Added=1]="Added",e[e.Updated=2]="Updated",e[e.Deleted=3]="Deleted"}(n||(n={})),function(e){e[e.ContentChanged=0]="ContentChanged",e[e.ContentWasEmpty=1]="ContentWasEmpty",e[e.FormattingChanged=2]="FormattingChanged",e[e.ContentWasInsideOfTheTable=3]="ContentWasInsideOfTheTable"}(s||(s={})),function(e){e[e.None=0]="None",e[e.HttpsGetDownloadUrl=1]="HttpsGetDownloadUrl",e[e.AlCodedLocation=2]="AlCodedLocation"}(o||(o={})),function(e){e[e.NewDocument=0]="NewDocument",e[e.EditDocument=1]="EditDocument",e[e.ViewOnlyDocument=2]="ViewOnlyDocument"}(a||(a={}));class l{}l.lowerIndexBound=1,l.maxNumberOfRows=1048576,l.maxNumberOfColumns=16384,l.firstColumnName="A",l.lastColumnName="XFD";var c=r(5670);class h{constructor(e){c._.assign(h,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_Core_Annotation"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[h.getTypeName()])}}h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};class u{constructor(e){c._.assign(u,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_Core_BinaryClassificationAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}static typeGuard(e){return c._.matchesTypesFor(e,[u.getTypeName()])}}u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};class d{constructor(e){c._.assign(d,this,e)}static getTypeName(){return"AugLoop_Core_Event"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[d.getTypeName()])}}d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};class p{constructor(e){c._.assign(p,this,e)}static getTypeName(){return"AugLoop_Core_UserCommand"}static getBaseTypes(){return["AugLoop_Core_Event"]}static typeGuard(e){return c._.matchesTypesFor(e,[p.getTypeName()])}}p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};class f{constructor(e){c._.assign(f,this,e)}static getTypeName(){return"AugLoop_Core_ItemDelta"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[f.getTypeName()])}}f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};class g{constructor(e){c._.assign(g,this,e)}static getTypeName(){return"AugLoop_Core_ItemChangesDelta"}static getBaseTypes(){return["AugLoop_Core_ItemDelta"]}static typeGuard(e){return c._.matchesTypesFor(e,[g.getTypeName()])}}g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};class m{constructor(e){c._.assign(m,this,e)}static getTypeName(){return"AugLoop_Core_Operation"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[m.getTypeName()])}}m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};class y{constructor(e){c._.assign(y,this,e)}static getTypeName(){return"AugLoop_Core_OperationWithSiblingContext"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[y.getTypeName()])}}y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};class _{constructor(e){c._.assign(_,this,e)}static getTypeName(){return"AugLoop_Core_AddOperation"}static getBaseTypes(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[_.getTypeName()])}}_.H_={T_:_.getTypeName(),B_:_.getBaseTypes()};class v{constructor(e){c._.assign(v,this,e)}static getTypeName(){return"AugLoop_Core_MoveOperation"}static getBaseTypes(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[v.getTypeName()])}}v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};class b{constructor(e){c._.assign(b,this,e)}static getTypeName(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[b.getTypeName()])}}b.H_={T_:b.getTypeName(),B_:b.getBaseTypes()};class w{constructor(e){c._.assign(w,this,e)}static getTypeName(){return"AugLoop_Core_UpdateOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[w.getTypeName()])}}w.H_={T_:w.getTypeName(),B_:w.getBaseTypes()};class T{constructor(e){c._.assign(T,this,e)}static getTypeName(){return"AugLoop_Core_DeleteOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[T.getTypeName()])}}T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};class x{constructor(e){c._.assign(x,this,e)}static getTypeName(){return"AugLoop_Core_PurgeOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[x.getTypeName()])}}x.H_={T_:x.getTypeName(),B_:x.getBaseTypes()};class C{constructor(e){c._.assign(C,this,e)}static getTypeName(){return"AugLoop_Core_FocusOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[C.getTypeName()])}}C.H_={T_:C.getTypeName(),B_:C.getBaseTypes()};class S{constructor(e){c._.assign(S,this,e)}static getTypeName(){return"AugLoop_Core_VisibilityOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[S.getTypeName()])}}S.H_={T_:S.getTypeName(),B_:S.getBaseTypes()};class P{constructor(e){c._.assign(P,this,e)}static getTypeName(){return"AugLoop_Core_DeltaUpdateOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[P.getTypeName()])}}P.H_={T_:P.getTypeName(),B_:P.getBaseTypes()};class E{constructor(e){c._.assign(E,this,e)}static getTypeName(){return"AugLoop_Core_MicroSyncOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[E.getTypeName()])}}E.H_={T_:E.getTypeName(),B_:E.getBaseTypes()};class M{constructor(e){c._.assign(M,this,e)}static getTypeName(){return"AugLoop_Signals_SignalOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return c._.matchesTypesFor(e,[M.getTypeName()])}}M.H_={T_:M.getTypeName(),B_:M.getBaseTypes()};class R{constructor(e){c._.assign(R,this,e)}static getTypeName(){return"AugLoop_Signals_Signal"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[R.getTypeName()])}}R.H_={T_:R.getTypeName(),B_:R.getBaseTypes()};class A{constructor(e){c._.assign(A,this,e)}static getTypeName(){return"AugLoop_Core_Blob"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[A.getTypeName()])}}A.H_={T_:A.getTypeName(),B_:A.getBaseTypes()};class B{constructor(e){c._.assign(B,this,e)}static getTypeName(){return"AugLoop_Core_Binary"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[B.getTypeName()])}}B.H_={T_:B.getTypeName(),B_:B.getBaseTypes()};class I{constructor(e){c._.assign(I,this,e)}static getTypeName(){return"AugLoop_Core_TileGroup"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[I.getTypeName()])}}I.H_={T_:I.getTypeName(),B_:I.getBaseTypes()};class F{constructor(e){c._.assign(F,this,e)}static getTypeName(){return"AugLoop_Core_Session"}static getBaseTypes(){return["AugLoop_Core_TileGroup"]}static typeGuard(e){return c._.matchesTypesFor(e,[F.getTypeName()])}}F.H_={T_:F.getTypeName(),B_:F.getBaseTypes()};class D{constructor(e){c._.assign(D,this,e)}static getTypeName(){return"AugLoop_Core_Document"}static getBaseTypes(){return["AugLoop_Core_TileGroup"]}static typeGuard(e){return c._.matchesTypesFor(e,[D.getTypeName()])}}D.H_={T_:D.getTypeName(),B_:D.getBaseTypes()};class L{constructor(e){c._.assign(L,this,e)}static getTypeName(){return"AugLoop_Core_SubDocument"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[L.getTypeName()])}}L.H_={T_:L.getTypeName(),B_:L.getBaseTypes()};class k{constructor(e){c._.assign(k,this,e)}static getTypeName(){return"AugLoop_Core_GridCell"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[k.getTypeName()])}}k.H_={T_:k.getTypeName(),B_:k.getBaseTypes()};class O{constructor(e){c._.assign(O,this,e)}static getTypeName(){return"AugLoop_Core_GridNeighborhoodContext"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[O.getTypeName()])}}O.H_={T_:O.getTypeName(),B_:O.getBaseTypes()};class U{constructor(e){c._.assign(U,this,e)}static getTypeName(){return"AugLoop_Core_ItemFilter"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[U.getTypeName()])}}U.H_={T_:U.getTypeName(),B_:U.getBaseTypes()};class N{constructor(e){c._.assign(N,this,e)}static getTypeName(){return"AugLoop_Core_DynamicContext"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[N.getTypeName()])}}N.H_={T_:N.getTypeName(),B_:N.getBaseTypes()};class V{constructor(e){c._.assign(V,this,e)}static getTypeName(){return"AugLoop_Core_ContextHolder"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[V.getTypeName()])}}V.H_={T_:V.getTypeName(),B_:V.getBaseTypes()};class G{constructor(e){c._.assign(G,this,e)}static getTypeName(){return"AugLoop_Core_UserContextHolder"}static getBaseTypes(){return["AugLoop_Core_ContextHolder"]}static typeGuard(e){return c._.matchesTypesFor(e,[G.getTypeName()])}}G.H_={T_:G.getTypeName(),B_:G.getBaseTypes()};class z{constructor(e){c._.assign(z,this,e)}static getTypeName(){return"AugLoop_Core_TenantContextHolder"}static getBaseTypes(){return["AugLoop_Core_ContextHolder"]}static typeGuard(e){return c._.matchesTypesFor(e,[z.getTypeName()])}}z.H_={T_:z.getTypeName(),B_:z.getBaseTypes()};class H{constructor(e){c._.assign(H,this,e)}static getTypeName(){return"AugLoop_Core_EventsHolder"}static getBaseTypes(){return[]}static typeGuard(e){return c._.matchesTypesFor(e,[H.getTypeName()])}}H.H_={T_:H.getTypeName(),B_:H.getBaseTypes()};class W{constructor(e){c._.assign(W,this,e)}static getTypeName(){return"AugLoop_Core_UserCommandsHolder"}static getBaseTypes(){return["AugLoop_Core_EventsHolder"]}static typeGuard(e){return c._.matchesTypesFor(e,[W.getTypeName()])}}W.H_={T_:W.getTypeName(),B_:W.getBaseTypes()}},6840:(e,t)=>{var r,i,n,s,o,a;Object.defineProperty(t,"__esModule",{value:!0}),(a=t.Edge||(t.Edge={}))[a.Left=0]="Left",a[a.Top=1]="Top",a[a.Right=2]="Right",a[a.Bottom=3]="Bottom",a[a.Count=4]="Count",(o=t.EdgePosition||(t.EdgePosition={}))[o.Minimum=0]="Minimum",o[o.Middle=1]="Middle",o[o.Maximum=2]="Maximum",o[o.Count=3]="Count",(s=t.ChartChildPositionOptions||(t.ChartChildPositionOptions={}))[s.None=0]="None",s[s.DoNotReserveSpace=1]="DoNotReserveSpace",s[s.RelativeToPlotArea=2]="RelativeToPlotArea",s[s.DoNotShareEdge=4]="DoNotShareEdge",(n=t.TickLabelsPosition||(t.TickLabelsPosition={}))[n.High=0]="High",n[n.Low=1]="Low",n[n.NextToAxis=2]="NextToAxis",n[n.Count=3]="Count",(i=t.TickMarksLayoutType||(t.TickMarksLayoutType={}))[i.Cross=0]="Cross",i[i.Inside=1]="Inside",i[i.Outside=2]="Outside",i[i.None=3]="None",i[i.Count=4]="Count",(r=t.TrendlineType||(t.TrendlineType={}))[r.Linear=0]="Linear",r[r.Polynomial=1]="Polynomial",r[r.Exponential=2]="Exponential",r[r.Logarithmic=3]="Logarithmic",r[r.Power=4]="Power",r[r.MovingAverage=5]="MovingAverage",r[r.Count=6]="Count"},7900:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3245:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isExperimentalText=function(e){return Array.isArray(e.lines)}},7279:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BubbleSeriesLayout={Canonical:"Bubble",Id:"Bubble|6646C07F-EE69-4C50-8884-14E2C12A8A9C"},t.BulletHorizontalLayout={Canonical:"Bullet Horizontal",Id:"Bullet Horizontal|9A25A13C-AB3E-4EF8-A1D9-39D9CCC37B8B"},t.BoxWhiskerSeriesLayout={Canonical:"Box-and-Whisker",Id:"Box-and-Whisker|14CC8215-BA99-43D8-9BE9-B8DBA7AD0F38"},t.BarClusteredSeriesLayout={Canonical:"Bar Clustered",Id:"Bar Clustered|E3705380-245A-4853-B6AA-83835693455E"},t.BarStackedSeriesLayout={Canonical:"Bar Stacked",Id:"Bar Stacked|EC5331C8-5FF9-4616-9FFA-6C75564A2351"},t.BarStacked100SeriesLayout={Canonical:"Bar Stacked (100%)",Id:"Bar Stacked (100%)|97A63078-E257-49FA-A446-87127409FDE1"},t.WordCloudSeriesLayout={Canonical:"Word Cloud",Id:"Word Cloud|C430CFE8-79A1-4D29-9CC9-E3684ADC40A9"},t.MapSeriesLayout={Canonical:"Map",Id:"Map|7C2B0DE5-DA0B-4699-9363-55B47CE0D858"},t.DoughnutSeriesLayout={Canonical:"Doughnut",Id:"Doughnut|2370A541-66E7-41A5-9C91-F652C321ECB4"},t.PieSeriesLayout={Canonical:"Pie",Id:"Pie|0ACFABC7-B08C-4B76-B4F0-CE04A553FE7B"},t.PieSubsliceSeriesLayout={Canonical:"Pie Subslice",Id:"Pie Subslice|87B522EA-8314-474F-A4A5-C496B913EB4A"},t.RoseSeriesLayout={Canonical:"Rose",Id:"Rose|7FB5902D-B5B1-4F68-9C44-019E0737EFE0"},t.TreemapSeriesLayout={Canonical:"Treemap",Id:"Treemap|46C6B32F-E068-4797-B132-46134DDE3841"},t.SunburstSeriesLayout={Canonical:"Sunburst",Id:"Sunburst|EB06F640-38E2-40E2-B7D7-B2CAA15A9888"},t.ScatterSeriesLayout={Canonical:"Scatter",Id:"Scatter|E5E0729E-3F80-40FE-BAD9-B2C1FC0C48DF"},t.StreamgraphLayout={Canonical:"Streamgraph",Id:"Streamgraph|C1BBDE14-A890-4AE1-BAE5-9E712511FB49"},t.AreaSeriesLayout={Canonical:"Area",Id:"Area|89C5F39D-8367-4002-B161-7317E84B765A"},t.AreaStackedSeriesLayout={Canonical:"Area Stacked",Id:"Area Stacked|559EE575-F359-4C18-A578-95DDF77451D4"},t.AreaStacked100SeriesLayout={Canonical:"Area Stacked (100%)",Id:"Area Stacked (100%)|310E5127-9664-483E-B00D-43661237ED58"},t.RadarSeriesLayout={Canonical:"Radar",Id:"Radar|807D8333-019F-4585-803D-D3E7B910A21F"},t.RadarFilledSeriesLayout={Canonical:"Radar Filled",Id:"Radar Filled|EA4BD985-602D-4D31-A381-5D03785A72D3"},t.LineSeriesLayout={Canonical:"Line",Id:"Line|0835421C-BB45-4049-B5A1-01A910FA5786"},t.LineStackedSeriesLayout={Canonical:"Line Stacked",Id:"Line Stacked|D6EC4F15-AA43-4EB2-AC1E-7598CB3C730B"},t.LineStacked100SeriesLayout={Canonical:"Line Stacked (100%)",Id:"Line Stacked (100%)|74199267-AFC6-47FE-8360-CBDE0AD03D92"},t.ColumnClusteredSeriesLayout={Canonical:"Column Clustered",Id:"Column Clustered|66CD2202-3E02-411B-B0C8-80F648956105"},t.ColumnStackedSeriesLayout={Canonical:"Column Stacked",Id:"Column Stacked|AFB97C4F-15E7-4492-B85F-F07F1CDCE9E9"},t.ColumnStacked100SeriesLayout={Canonical:"Column Stacked (100%)",Id:"Column Stacked (100%)|D4F12861-68F0-418A-A140-486C9B328FC0"},t.FunnelSeriesLayout={Canonical:"Funnel",Id:"Funnel|73edc3b8-0194-4fb7-b180-9745cfa4b3ed"},t.WaterfallSeriesLayout={Canonical:"Waterfall",Id:"Waterfall|EB06F640-38E2-40E2-B7D7-B2CAA15A9888"}},1428:(e,t,r)=>{function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(7900)),i(r(6840));var n=r(7279);t.Extensions=n;var s=r(4579);t.Utils=s;var o=r(3245);t.Experimental=o,i(r(675))},675:(e,t)=>{var r,i,n,s,o,a,l,c;Object.defineProperty(t,"__esModule",{value:!0}),t.isLinearGradientShade=function(e){return"number"==typeof e.angle},t.isRadialGradientShade=function(e){return"object"==typeof e.center},t.isSolidFillFormat=function(e){var t;return"string"==typeof(null===(t=e)||void 0===t?void 0:t.color)},t.isGradientFillFormat=function(e){var t;return Array.isArray(null===(t=e)||void 0===t?void 0:t.stops)},t.isPatternFillFormat=function(e){return"number"==typeof e.pattern},(c=t.LineDashStyle||(t.LineDashStyle={}))[c.Solid=0]="Solid",c[c.Dash=1]="Dash",c[c.Dot=2]="Dot",c[c.DashDot=3]="DashDot",c[c.DashDotDot=4]="DashDotDot",c[c.Count=5]="Count",(l=t.LineDashType||(t.LineDashType={}))[l.Solid=0]="Solid",l[l.Dash=1]="Dash",l[l.Dot=2]="Dot",l[l.DashDot=3]="DashDot",l[l.DashDotDot=4]="DashDotDot",l[l.RoundDot=5]="RoundDot",l[l.SquareDot=6]="SquareDot",l[l.LongDash=7]="LongDash",l[l.LongDashDot=8]="LongDashDot",l[l.LongDashDotDot=9]="LongDashDotDot",l[l.Count=10]="Count",(a=t.LineCapType||(t.LineCapType={}))[a.Flat=0]="Flat",a[a.Square=1]="Square",a[a.Round=2]="Round",a[a.Count=3]="Count",(o=t.LineJoinType||(t.LineJoinType={}))[o.Round=0]="Round",o[o.Bevel=1]="Bevel",o[o.Miter=2]="Miter",o[o.Count=3]="Count",(s=t.LineEndType||(t.LineEndType={}))[s.None=0]="None",s[s.Triangle=1]="Triangle",s[s.Stealth=2]="Stealth",s[s.Diamond=3]="Diamond",s[s.Oval=4]="Oval",s[s.Arrow=5]="Arrow",s[s.Count=6]="Count",(n=t.LineEndSize||(t.LineEndSize={}))[n.Small=0]="Small",n[n.Medium=1]="Medium",n[n.Large=2]="Large",n[n.Count=3]="Count",(i=t.SelectionHandleOption||(t.SelectionHandleOption={}))[i.All=0]="All",i[i.EndPoints=1]="EndPoints",i[i.Maximum=2]="Maximum",i[i.Count=3]="Count",(r=t.PatternType||(t.PatternType={}))[r.Horizontal=0]="Horizontal",r[r.Vertical=1]="Vertical",r[r.ForwardDiagonal=2]="ForwardDiagonal",r[r.BackwardDiagonal=3]="BackwardDiagonal",r[r.Cross=4]="Cross",r[r.DiagonalCross=5]="DiagonalCross",r[r.Pattern05Percent=6]="Pattern05Percent",r[r.Pattern10Percent=7]="Pattern10Percent",r[r.Pattern20Percent=8]="Pattern20Percent",r[r.Pattern25Percent=9]="Pattern25Percent",r[r.Pattern30Percent=10]="Pattern30Percent",r[r.Pattern40Percent=11]="Pattern40Percent",r[r.Pattern50Percent=12]="Pattern50Percent",r[r.Pattern60Percent=13]="Pattern60Percent",r[r.Pattern70Percent=14]="Pattern70Percent",r[r.Pattern75Percent=15]="Pattern75Percent",r[r.Pattern80Percent=16]="Pattern80Percent",r[r.Pattern90Percent=17]="Pattern90Percent",r[r.LightDownwardDiagonal=18]="LightDownwardDiagonal",r[r.LightUpwardDiagonal=19]="LightUpwardDiagonal",r[r.DarkDownwardDiagonal=20]="DarkDownwardDiagonal",r[r.DarkUpwardDiagonal=21]="DarkUpwardDiagonal",r[r.WideDownwardDiagonal=22]="WideDownwardDiagonal",r[r.WideUpwardDiagonal=23]="WideUpwardDiagonal",r[r.LightVertical=24]="LightVertical",r[r.LightHorizontal=25]="LightHorizontal",r[r.NarrowVertical=26]="NarrowVertical",r[r.NarrowHorizontal=27]="NarrowHorizontal",r[r.DarkVertical=28]="DarkVertical",r[r.DarkHorizontal=29]="DarkHorizontal",r[r.DashedDownwardDiagonal=30]="DashedDownwardDiagonal",r[r.DashedUpwardDiagonal=31]="DashedUpwardDiagonal",r[r.DashedHorizontal=32]="DashedHorizontal",r[r.DashedVertical=33]="DashedVertical",r[r.SmallConfetti=34]="SmallConfetti",r[r.LargeConfetti=35]="LargeConfetti",r[r.ZigZag=36]="ZigZag",r[r.Wave=37]="Wave",r[r.DiagonalBrick=38]="DiagonalBrick",r[r.HorizontalBrick=39]="HorizontalBrick",r[r.Weave=40]="Weave",r[r.Plaid=41]="Plaid",r[r.Divot=42]="Divot",r[r.DottedGrid=43]="DottedGrid",r[r.DottedDiamond=44]="DottedDiamond",r[r.Shingle=45]="Shingle",r[r.Trellis=46]="Trellis",r[r.Sphere=47]="Sphere",r[r.SmallGrid=48]="SmallGrid",r[r.SmallCheckerBoard=49]="SmallCheckerBoard",r[r.LargeCheckerBoard=50]="LargeCheckerBoard",r[r.OutlinedDiamond=51]="OutlinedDiamond",r[r.SolidDiamond=52]="SolidDiamond",r[r.Count=53]="Count"},4579:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(675),s=((i={})[0]="none",i[1]="categoryNames",i[2]="values",i[3]="xValues",i[4]="yValues",i[5]="sizeValues",i[6]="openValues",i[7]="closeValues",i[8]="highValues",i[9]="lowValues",i[10]="rValues",i[11]="thetaValues",i[12]="errorBarsPosValues",i[13]="errorBarsNegValues",i[14]="canvasXValues",i[15]="canvasYValues",i[16]="parentIndices",i[17]="stringRenderingData",i[18]="discreteRenderingData",i[19]="continuousRenderingData",i[20]="customValues",i[21]="customStrings",i[22]="dataIndex",i[23]="partialValues",i[24]="controlValues",i[25]="categoryValues",i[26]="categoryWidths",i[27]="regionIds",i[28]="count",i);function o(e){var t=e.toString(16).toUpperCase();return 1===t.length?"0"+t:t}function a(e){switch(e){case n.LineDashStyle.Dash:return[4,3];case n.LineDashStyle.Dot:return[1,3];case n.LineDashStyle.DashDot:return[4,3,1,3];case n.LineDashStyle.DashDotDot:return[4,3,1,3,1,3];default:return[0]}}t.getSeriesFieldFromDimension=function(e){return s[e]},t.getDataTypeFromDimension=function(e){switch(e){case 1:case 21:case 17:case 27:return 1;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 18:case 20:case 22:case 23:case 24:case 25:case 26:return 0;default:return 2}},t.toHex=o,t.isInRange=function(e,t,r){return e>=t&&e<=r},t.brightenColor=function(e,t){t>0?(e.r=e.r*(1-t)+t,e.g=e.g*(1-t)+t,e.b=e.b*(1-t)+t):(e.r*=t+1,e.g*=t+1,e.b*=t+1)},t.colorToCSSString=function(e){if(e){var t=Math.floor(255*e.r),r=Math.floor(255*e.g),i=Math.floor(255*e.b);return 1===e.a?"#"+o(t)+o(r)+o(i):"rgba("+t+","+r+","+i+","+e.a.toFixed(4)+")"}},t.cssStringToColor=function(e){var t=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(e);if(t)return{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255,a:1};var r=/^rgba\((\d+),(\d+),(\d+),(\d+\.\d+)\)$/i.exec(e);return r?{r:+r[1]/255,g:+r[2]/255,b:+r[3]/255,a:+r[4]}:void 0},t.pointToString=function(e){return e.x+","+e.y+" "},t.isMissingNumber=function(e){return isNaN(e)},t.lineDashStyleToDashArray=a,t.createStrokeDashArray=function(e,t){return a(e).map((function(e){return e*t}))}},104:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.UserAction||(t.UserAction={})).Render="render",r.Select="select",r.Deselect="deselect",r.Hover="hover",r.Unhover="unhover";var i=function(){function e(e){this.isActive=!0,this.start=performance.now(),this.data={actions:[],isSuccess:!0,entry:e}}return e.prototype.addAction=function(e){-1===this.data.actions.indexOf(e)&&this.data.actions.push(e)},e.prototype.setError=function(e){this.data.isSuccess=!1,this.data.errorMessage=e.message},e.prototype.end=function(){if(this.isActive){this.isActive=!1;var e=performance.now();this.data.duration=e-this.start,this.data.actions.sort(),(t=n.pop())&&t.sink.write(t.activity.getData())}var t},e.prototype.getEntry=function(){return this.data.entry},e.prototype.getData=function(){if(this.isActive)throw new Error("Data is invalid while activity is active.");return this.data},e}();t.Activity=i;var n=[];function s(e,t){var r=new i(t);return n.push({sink:e,activity:r}),r}function o(){var e;return null===(e=n[n.length-1])||void 0===e?void 0:e.activity}t.startActivity=s,t.getCurrentActivity=o,t.wrapWithActivity=function(e,t,r){var i,n;try{return e&&s(e,t),r()}catch(e){null===(i=o())||void 0===i||i.setError(e)}finally{null===(n=o())||void 0===n||n.end()}},t.wrapTimeout=function(e,t){var r,i;if("string"==typeof e)throw new Error("No string based timer.");var a,l=(null===(r=o())||void 0===r?void 0:r.getEntry())+"_timeout",c=null===(i=n[n.length-1])||void 0===i?void 0:i.sink;return setTimeout((a=c,function(){var t,r;try{a&&s(a,l),e()}catch(e){null===(t=o())||void 0===t||t.setError(e)}finally{null===(r=o())||void 0===r||r.end()}}),t)}},4354:function(e,t,r){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(104),s=function(){function e(){this.activities=[],this.timeout=-1,this.ignorableActions=[n.UserAction.Render,n.UserAction.Select,n.UserAction.Deselect]}return e.prototype.write=function(e){var t=this;e.actions.length>0&&e.actions.every((function(e){return-1!==t.ignorableActions.indexOf(e)}))?this.writeAggregated(e):(this.activities.push(e),-1!==this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){return t.flushActivities()}),1e3))},e.prototype.flushActivities=function(){for(var e;this.activities.length>0;){for(var t=this.activities[0],r=[],n=this.activities.length-1;n>=0;n--){var s=this.activities[n];this.shouldAggregate(t,s)&&(r.push(null!=(e=s.duration)?e:0),this.activities.splice(n,1))}var o=r.reduce((function(e,t){return e+t}))/r.length;this.writeAggregated(i(i({},t),{duration:{average:o,count:r.length}}))}},e.prototype.shouldAggregate=function(e,t){return e.errorMessage===t.errorMessage&&e.entry===t.entry&&e.actions.length===t.actions.length&&e.actions.every((function(e,r){return t.actions[r]===e}))},e}();t.AggregatingActivitySink=s},690:function(e,t,r){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},i(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this)||this;return r.callback=t,r}return n(t,e),t.prototype.writeAggregated=function(e){this.callback(e)},t}(r(4354).AggregatingActivitySink);t.CallbackActivitySink=s},8956:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.minX=Number.MAX_VALUE,this.maxX=-Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE}return e.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},e.prototype.getBounds=function(){return{min:{x:this.minX,y:this.minY},max:{x:this.maxX,y:this.maxY}}},e.prototype.isEmpty=function(){return this.minX===Number.MAX_VALUE&&this.maxX===-Number.MAX_VALUE&&this.minY===Number.MAX_VALUE&&this.maxY===-Number.MAX_VALUE},e.prototype.reset=function(){this.minX=Number.MAX_VALUE,this.maxX=-Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE},e}();t.Bounds2D=r},3976:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(8688),s=r(7882),o=r(8202),a=function(){function e(e){this.filled=!1,this.masterInstancer=new s.MasterInstancer,this.isCreatingMaster=!1;var t=e.getContext("2d");if(!t)throw new Error("Invalid canvas");this.context=t,n.scale2DCanvasContextByDevicePixelRatio(this.context),this.context.clearRect(0,0,e.width,e.height)}return e.prototype.beginGeometry=function(e){return this.formatObject=e,!0},e.prototype.endGeometry=function(){return this.formatObject=void 0,this.masterInstancer.reset(),!0},e.prototype.beginPath=function(e){return!this.isCreatingMaster||this.masterInstancer.beginPath(e)},e.prototype.endPath=function(){return!this.isCreatingMaster||this.masterInstancer.endPath()},e.prototype.beginFigure=function(e,t,r){return this.isCreatingMaster?this.masterInstancer.beginFigure(e,t,r):(this.context.beginPath(),this.context.moveTo(e.x+.5,e.y+.5),this.filled=t,!0)},e.prototype.endFigure=function(e){if(!this.formatObject)throw new Error("Missing format object.");if(this.isCreatingMaster)return this.masterInstancer.endFigure(e);if(this.context.save(),e&&this.context.closePath(),this.filled){var t=this.formatObject.getFill();if(!i.isSolidFillFormat(t))throw new Error("Unsupported fill.");this.context.fillStyle=t.color,this.context.fill()}var r=this.formatObject.getLineThickness();if("number"==typeof r&&(this.context.lineWidth=r),0!==r){var n=this.formatObject.getLineDashType(),s=this.formatObject.getLineCapType();n!==i.LineDashType.Solid&&this.context.setLineDash(o.createStrokeDashArray(n,r,s));var a=this.formatObject.getLineFill();if(!i.isSolidFillFormat(a))throw new Error("Unsupported line fill.");this.context.strokeStyle=a.color,this.context.stroke()}return this.context.restore(),!0},e.prototype.addLines=function(e){if(this.isCreatingMaster)return this.masterInstancer.addLines(e);for(var t=0,r=e;t<r.length;t++){var i=r[t];this.context.lineTo(i.x+.5,i.y+.5)}return!0},e.prototype.addBeziers=function(e){if(this.isCreatingMaster)return this.masterInstancer.addBeziers(e);for(var t=0;t<e.length;t+=3)this.context.bezierCurveTo(e[t+0].x+.5,e[t+0].y+.5,e[t+1].x+.5,e[t+1].y+.5,e[t+2].x+.5,e[t+2].y+.5);return!0},e.prototype.addEscape=function(e,t){if(this.isCreatingMaster&&101!==e)return this.masterInstancer.addEscape(e,t);switch(e){case 100:this.masterInstancer.reset(),this.isCreatingMaster=!0;break;case 101:this.isCreatingMaster=!1;break;case 102:this.masterInstancer.createInstance(this,t)}return!0},e.prototype.render=function(e){var t=this;e.enumerateGeometry(this),this.renderText(e.getText()),e.getChildren().forEach((function(e){return t.render(e)}))},e.prototype.renderText=function(e){if(e){this.context.save(),this.context.translate(e.getLocation().x,e.getLocation().y),this.context.rotate(Math.PI*e.getAngle()/180);for(var t=0,r=0,i=e.getLines();r<i.length;r++){for(var n=i[r],s=0,o=0,a=n.getRuns();o<a.length;o++){var l=a[o],c="";2===l.getStyle()?c+="italic ":1===l.getStyle()&&(c+="oblique "),l.getWeight()>=700&&(c+="bold ");var h=""+c+l.getPixelSize()+"px "+l.getFaceName();this.context.font=h,this.context.fillStyle=l.getColor(),this.context.fillText(l.getText(),s,t+n.getBaseline()),s+=this.context.measureText(l.getText()).width}t+=n.getHeight()}this.context.restore()}},e}();t.CanvasSink=a},532:function(e,t,r){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(7828);!function(e){e[e.Idle=0]="Idle",e[e.LayoutInProgress=1]="LayoutInProgress",e[e.RenderInProgress=2]="RenderInProgress",e[e.LayoutAndRenderInProgress=3]="LayoutAndRenderInProgress"}(n=t.HostStatus||(t.HostStatus={}));var o=function(){function e(e,t,r){var i=this;this.layoutInProgress=!1,this.renderInProgress=!1,this.listeners={},this.layoutProvider=e,this.chartPlayer=new s.ChartPlayer(t,r),this.chartPlayer.on("finish",(function(e,t){i.onRenderFinish(e,t)})),this.chartPlayer.on("error",(function(e,t){i.onRenderError(e,t)}))}return e.prototype.on=function(e,t){return this.listeners[e]=t,this},e.prototype.getLayoutProvider=function(){return this.layoutProvider},e.prototype.setElement=function(e){this.chartPlayer.setElement(e),this.renderCurrent()},e.prototype.getRenderSettings=function(){return this.chartPlayer.getRenderSettings()},e.prototype.setRenderer=function(e){this.chartPlayer.setRenderer(e),this.renderCurrent()},e.prototype.setConfiguration=function(e){var t=i({},e);this.beginLayout(t)},e.prototype.beginLayout=function(e){var t=this;this.layoutInProgress?this.pendingChartDefinition=e:(this.setLayoutInProgress(!0),this.layoutProvider.getResource(e,this.chartPlayer.getRenderSettings().renderer,(function(e,r){if(t.setLayoutInProgress(!1),e?t.notifyError("LayoutFailed: "+e):(t.currentChartLayout=r,t.renderCurrent()),t.pendingChartDefinition){var i=t.pendingChartDefinition;t.pendingChartDefinition=void 0,t.beginLayout(i)}})))},e.prototype.renderCurrent=function(){this.currentChartLayout&&this.chartPlayer.getElement()&&(this.setRenderInProgress(!0),this.chartPlayer.render(this.currentChartLayout))},e.prototype.setLayoutInProgress=function(e){this.layoutInProgress!==e&&(this.layoutInProgress=e,this.layoutInProgress?this.notifyStatusChanged("layout-start"):this.notifyStatusChanged("layout-finish"))},e.prototype.setRenderInProgress=function(e){this.renderInProgress!==e&&(this.renderInProgress=e,this.renderInProgress?this.notifyStatusChanged("render-start"):this.notifyStatusChanged("render-finish"))},e.prototype.notifyStatusChanged=function(e){this.listeners[e]&&this.listeners[e](e,this.getStatus())},e.prototype.notifyError=function(e){this.listeners.error&&this.listeners.error("error",e)},e.prototype.getStatus=function(){return this.layoutInProgress?this.renderInProgress?n.LayoutAndRenderInProgress:n.LayoutInProgress:this.renderInProgress?n.RenderInProgress:n.Idle},e.prototype.onRenderFinish=function(e,t){this.setRenderInProgress(!1)},e.prototype.onRenderError=function(e,t){this.notifyError("RenderFailed: "+t)},e}();t.ChartHost=o},7828:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(8688),s=r(311),o=r(6363),a=r(8911),l=r(2777),c=r(3636),h=r(873),u=r(8282),d=r(4092),p=r(3976),f=r(4002),g=r(7906),m=r(7938),y=r(104),_=r(690);!function(e){e[e.Idle=0]="Idle",e[e.Rendering=1]="Rendering",e[e.Finished=2]="Finished"}(i=t.RenderStatus||(t.RenderStatus={}));var v=function(){function e(e,t,r){this.renderingStatus=i.Idle,this.listeners={},this.activitySink=new _.CallbackActivitySink(this.handleActivity.bind(this)),this.renderSettings=e,this.element=t,this.renderHost=r||new h.DefaultRenderHost}return e.prototype.getElement=function(){return this.element},e.prototype.setElement=function(e){this.element=e},e.prototype.getRenderSettings=function(){return this.renderSettings},e.prototype.setRenderer=function(e){this.renderSettings.renderer=e},e.prototype.on=function(e,t){return this.listeners[e]=t,this},e.prototype.render=function(e,t){var r=this;y.wrapWithActivity(this.activitySink,"ChartPlayer.render",(function(){var n;if(!r.element)throw new Error("Missing element.");r.renderingStatus!==i.Rendering&&(r.setAndNotifyStatus(i.Rendering),r.renderSettings.renderer===o.IvyRenderer.Image?r.renderImage(r.element,e):r.renderSettings.renderer===o.IvyRenderer.JSON?r.renderJson(r.element,e):r.renderSettings.renderer===o.IvyRenderer.Canvas?r.renderCanvas(r.element,e):r.renderSettings.renderer===o.IvyRenderer.Svg&&r.renderSvg(r.element,e,t),null===(n=y.getCurrentActivity())||void 0===n||n.addAction(y.UserAction.Render),r.setAndNotifyStatus(i.Finished))}))},e.prototype.select=function(e){var t=this;y.wrapWithActivity(this.activitySink,"ChartPlayer.select",(function(){var r;return null===(r=t.interactivityManager)||void 0===r?void 0:r.select(e)}))},e.prototype.selectParent=function(){var e=this;y.wrapWithActivity(this.activitySink,"ChartPlayer.selectParent",(function(){var t;return null===(t=e.interactivityManager)||void 0===t?void 0:t.selectParent()}))},e.prototype.selectFirstChild=function(){var e=this;y.wrapWithActivity(this.activitySink,"ChartPlayer.selectFirstChild",(function(){var t;return null===(t=e.interactivityManager)||void 0===t?void 0:t.selectFirstChild()}))},e.prototype.selectNextSibling=function(){var e=this;y.wrapWithActivity(this.activitySink,"ChartPlayer.selectNextSibling",(function(){var t;return null===(t=e.interactivityManager)||void 0===t?void 0:t.selectNextSibling()}))},e.prototype.selectPreviousSibling=function(){var e=this;y.wrapWithActivity(this.activitySink,"ChartPlayer.selectPreviousSibling",(function(){var t;return null===(t=e.interactivityManager)||void 0===t?void 0:t.selectPreviousSibling()}))},e.prototype.getDescription=function(){var e=this;return y.wrapWithActivity(this.activitySink,"ChartPlayer.getDescription",(function(){var t;return null===(t=e.interactivityManager)||void 0===t?void 0:t.getDescription()}))},Object.defineProperty(e.prototype,"isInteractivityEnabled",{set:function(e){var t=this;y.wrapWithActivity(this.activitySink,"ChartPlayer.isInteractivityEnabled",(function(){t.interactivityManager&&(t.interactivityManager.isEnabled=e)}))},enumerable:!0,configurable:!0}),e.prototype.renderCanvas=function(e,t){if("object"!=typeof t.data)throw new Error("Unsupported svg resource.");var r=new s.SceneGraph(t.data),i=r.getSize(),o=n.createCanvas(e,i.width,i.height);new p.CanvasSink(o).render(r.getRoot())},e.prototype.renderSvg=function(e,t,r){var i=this;if(!this.renderHost)throw new Error("Render host is needed for svg rendering.");if("object"!=typeof t.data)throw new Error("Unsupported svg resource.");var o=new s.SceneGraph(t.data),h=o.getSize(),p=o.getBorderWidth(),y=document.createElementNS(u.svgns,"svg");this.renderSettings.disableChartElementResize||(y.setAttribute("width",""+(h.width+2*p)),y.setAttribute("height",""+(h.height+2*p))),n.replaceChildren(e,[y]);var _=new d.SvgSink(o,y,this.renderHost,this.activitySink);if(_.render(),r){var v=new a.Interactivity(r.data),b=this.renderHost.isFeatureEnabled("EnableTooltips",!1)?new l.SvgTooltip(y):new m.NullTooltip(y),w=new g.NotifyingSelector(new f.SvgSelector(y),(function(e,t){return i.notifySelectionChanged(e,t)}),(function(e){return i.notifyDoubleClick(e)}));w.setHandles(_.getHandles()),w.setPathWidths(_.getPathWidths());var T=new c.InteractivityManager(b,w,v.getRoot());_.addObserver(T),this.interactivityManager=T}},e.prototype.renderImage=function(e,t){if("string"!=typeof t.data)throw new Error("Invalid image.");var r="data:image"===t.data.substring(0,10)?t.data:"data:image/png;base64,"+t.data,i=document.createElement("img");i.alt="Chart",i.src=r,n.replaceChildren(e,[i])},e.prototype.renderJson=function(e,t){var r=document.createElement("pre");r.innerText=JSON.stringify(t.data,null,2),n.replaceChildren(e,[r])},e.prototype.setAndNotifyStatus=function(e){if(this.renderingStatus!==e)switch(this.renderingStatus=e,this.renderingStatus){case i.Rendering:this.notifyStateChanged("start");break;case i.Finished:this.notifyStateChanged("finish")}},e.prototype.notifyStateChanged=function(e){this.listeners[e]&&this.listeners[e](e,this.renderingStatus)},e.prototype.handleActivity=function(e){e.isSuccess?this.notifyLog(JSON.stringify(e)):this.notifyError(JSON.stringify(e))},e.prototype.notifyLog=function(e){this.listeners.log&&this.listeners.log("log",e)},e.prototype.notifyError=function(e){this.listeners.error&&this.listeners.error("error",e)},e.prototype.notifySelectionChanged=function(e,t){this.listeners.select&&this.listeners.select("select",e,t)},e.prototype.notifyDoubleClick=function(e){this.listeners.dblclick&&this.listeners.dblclick("dblclick",e)},e}();t.ChartPlayer=v},8202:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428);t.createStrokeDashArray=function(e,t,r){var n=function(e){switch(e){case i.LineDashType.Dash:return[4,3];case i.LineDashType.Dot:return[1,3];case i.LineDashType.DashDot:return[4,3,1,3];case i.LineDashType.DashDotDot:return[4,3,1,3,1,3];case i.LineDashType.RoundDot:return[1,1];case i.LineDashType.SquareDot:return[3,1];case i.LineDashType.LongDash:return[8,3];case i.LineDashType.LongDashDot:return[8,3,1,3];case i.LineDashType.LongDashDotDot:return[8,3,1,3,1,3];case i.LineDashType.Solid:default:return[0]}}(e);return r===i.LineCapType.Flat?n.map((function(e){return e*t})):n.map((function(e,t){return t%2==0?e-1:e+1})).map((function(e){return e*t}))}},873:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.renderCustomData=function(e,t){},e.prototype.isFeatureEnabled=function(e,t){return t},e.prototype.setFeatureIsEnabled=function(e,t){throw new Error("DefaultRenderHost does not allow setting feature enablement.")},e}();t.DefaultRenderHost=r},8688:(e,t)=>{function r(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function i(e,t){r(e),t.forEach((function(t){e.appendChild(t)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.removeChildren=r,t.replaceChildren=i,t.getParentElement=function(e){var t,r=e.parentNode;if((null===(t=r)||void 0===t?void 0:t.nodeType)===Node.ELEMENT_NODE)return r},t.getOffsetInRect=function(e,t,r){return{x:t-e.left,y:r-e.top}},t.createCanvas=function(e,t,r){var n=document.createElement("canvas"),s=window.devicePixelRatio||1;return n.style.width=t+"px",n.style.height=r+"px",n.width=t*s,n.height=r*s,i(e,[n]),n},t.scale2DCanvasContextByDevicePixelRatio=function(e){var t=window.devicePixelRatio||1;e.scale(t,t)},t.customDataClassName="custom-data",t.hitTestingClassName="hit-test"},8282:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.svgns="http://www.w3.org/2000/svg",t.xlinkns="http://www.w3.org/1999/xlink"},9569:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(6363),n=function(){function e(e){var t,r;this.extensionsUrl=null!=(t=e.extensionsUrl)?t:e.base+"/charts/extensions?clientId="+e.clientId,this.layoutUrl=null!=(r=e.layoutUrl)?r:e.base+"/charts?clientId="+e.clientId}return e.prototype.getExtensions=function(e){this.get(this.extensionsUrl,e)},e.prototype.getResource=function(e,t,r){t===i.IvyRenderer.Image?this.getImage(e,r):this.getJson(e,r)},e.prototype.getImage=function(e,t){this.callPost("image/png",e,t)},e.prototype.getJson=function(e,t){this.callPost("application/json",e,t)},e.prototype.callPost=function(e,t,r){this.post(this.layoutUrl,e,t,r)},e.prototype.post=function(e,t,r,i){var n=new XMLHttpRequest;n.open("POST",e),n.setRequestHeader("Accept",t),n.setRequestHeader("Content-Type","text/plain"),n.send(JSON.stringify(r)),this.completeAjax(n,i)},e.prototype.get=function(e,t){var r=new XMLHttpRequest;r.open("GET",e),r.send(null),this.completeAjax(r,t)},e.prototype.completeAjax=function(e,t){e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(200===e.status?t(null,JSON.parse(e.responseText)):t("Edera RequestFailed StatusCode: "+e.status,null))}},e}();t.EderaLayoutProvider=n},9072:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDomIdFromElementId=function(e,t){return"number"==typeof t?"ce"+e+"-"+t:"ce"+e};var r=/^ce([\w.]+)(-\d)?$/;t.isElementDomId=function(e){return r.test(e)},t.getElementIdFromDomId=function(e){var t;return null===(t=r.exec(e))||void 0===t?void 0:t[1]},t.getElementInfoFromDomId=function(e){if("string"==typeof e){var t=r.exec(e);if(t&&3===t.length){if(void 0===t[2])return{id:t[1]};var i=parseInt(t[2].slice(1),10);return{id:t[1],datapointIndex:i}}}}},3640:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.resetTimer=0,this.initial=e,this.value=e}return e.prototype.getValue=function(){return this.value},e.prototype.setValue=function(e,t){var r=this;clearTimeout(this.resetTimer),this.value=e,this.resetTimer=setTimeout((function(){return r.reset()}),t)},e.prototype.reset=function(){clearTimeout(this.resetTimer),this.value=this.initial},e}();t.ExpiringValue=r},1432:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=0;t.generateUniqueId=function(){return"MSChart-"+(++r).toString()}},9140:(e,t,r)=>{function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(1428)),i(r(6363)),i(r(532)),i(r(7828)),i(r(9569)),i(r(6725))},143:function(e,t){var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.handles=[]}return e.prototype.getHandles=function(){return r(this.handles)},e.prototype.reset=function(){this.handles=[]},e.prototype.beginGeometry=function(e){return!0},e.prototype.endGeometry=function(){return!0},e.prototype.beginPath=function(e){return!0},e.prototype.endPath=function(){return!0},e.prototype.beginFigure=function(e,t,r){return this.handles.push(e),!0},e.prototype.endFigure=function(e){return!0},e.prototype.addLines=function(e){return this.handles=this.handles.concat(e),!0},e.prototype.addBeziers=function(e){var t=e.filter((function(e,t){return(t+1)%3==0}));return this.handles=this.handles.concat(t),!0},e.prototype.addEscape=function(e,t){return!0},e}();t.HandleSink=i},9639:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(6341),s=function(){function e(e){this.element=e}return e.prototype.getId=function(){return this.element.id},e.prototype.getDescription=function(){return this.element.description},e.prototype.getOnlyShowText=function(){return!!this.element.onlyShowText&&this.element.onlyShowText},e.prototype.hasDescription=function(){return"string"==typeof this.element.description},e.prototype.getChildren=function(){return this.element.children?this.element.children.map((function(t){return new e(t)})):[]},e.prototype.getDatapointChildren=function(){return this.element.datapointChildren?this.element.datapointChildren.map((function(e){return new n.InteractiveElementDatapoint(e)})):[]},e.prototype.getSelectionHandleOption=function(){return this.element.selectionHandleOption?this.element.selectionHandleOption:i.SelectionHandleOption.All},e}();t.InteractiveElement=s},6341:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(6662),n=function(){function e(e){this.element=e}return e.prototype.getIndex=function(){return this.element.index},e.prototype.getTitle=function(){return this.element.title},e.prototype.getDescription=function(){return this.element.description?this.element.description.map((function(e){return new i.InteractiveElementDatapointDescription(e)})):[]},e.prototype.hasTooltip=function(){return"string"==typeof this.element.title||this.getDescription().length>0},e.prototype.getDatapointChildren=function(){return this.element.children?this.element.children.map((function(t){return new e(t)})):[]},e}();t.InteractiveElementDatapoint=n},6662:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.element=e}return e.prototype.getHeading=function(){return this.element.heading},e.prototype.getValue=function(){return this.element.value},e}();t.InteractiveElementDatapointDescription=r},8911:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(9639),n=function(){function e(e){this.root=new i.InteractiveElement(e.root)}return e.prototype.getRoot=function(){return this.root},e}();t.Interactivity=n},3636:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(5629),s=r(9759),o=r(3640),a=r(1428),l=r(9072),c=r(104);!function(e){e[e.None=0]="None",e[e.ChartElement=1]="ChartElement",e[e.Datapoint=2]="Datapoint",e[e.Count=3]="Count"}(i||(i={}));var h=function(){function e(e,t,r){this.tooltips={},this.datapointTooltips={},this.tooltipType=i.None,this.delayDatapointTooltip=new o.ExpiringValue(!0),this.selectables=[],this._isEnabled=!0,this.tooltip=e,this.selector=t,this.root=r,this.cacheTooltipText(r),this.cacheSelectables(r)}return e.prototype.receiveMouseOver=function(e){var t=this;if(this._isEnabled){var r=e.target?this.getSelectionCandidateId(e.target):void 0;this.hover(r);for(var n=e.target;n;){var s=l.getDomIdFromElementId(n.getId());if(-1!==Object.keys(this.datapointTooltips).indexOf(s)){this.tooltipType=i.Datapoint;var o=this.datapointTooltips[s],a=o.getTitle();a&&this.tooltip.setHeader(a),o.getDescription().forEach((function(e){t.tooltip.addPair(e.getHeading(),e.getValue())})),this.showDatapointTooltip(e);break}if(-1!==Object.keys(this.tooltips).indexOf(s)){this.tooltipType=i.ChartElement,this.tooltip.setHeader(this.tooltips[s]),this.showNonDatapointTooltip(e);break}n=n.getParent()}}},e.prototype.receiveMouseMove=function(e){if(this._isEnabled){var t=e.target?this.getSelectionCandidateId(e.target):void 0;switch(this.hover(t),this.tooltipType){case i.ChartElement:this.showNonDatapointTooltip(e);break;case i.Datapoint:this.showDatapointTooltip(e)}}},e.prototype.receiveMouseOut=function(){this._isEnabled&&(this.hover(void 0),this.removeTooltips())},e.prototype.receiveMouseDown=function(e){this._isEnabled&&this.handleSelection(e,n.PointerType.Mouse)},e.prototype.receivePointerDown=function(e,t){if(this._isEnabled){var r=n.convertPointerTypeToEnum(t);this.handleSelection(e,r)}},e.prototype.receiveDoubleClick=function(e){if(this._isEnabled){var t=e.target?this.getSelectionCandidateId(e.target):void 0;t?(this.selector.doubleClick(t),e.stopPropagation()):this.selector.doubleClick(void 0)}},e.prototype.select=function(e){if(this._isEnabled){if(e===this.selector.getSelectedId())return;if(e&&-1===this.selectables.indexOf(e))this.selector.select(void 0,!1,a.SelectionHandleOption.All);else{var t=!1,r=a.SelectionHandleOption.All;if(e){var i=this.getInteractiveElement(this.root,e);if(!i)throw new Error("Invalid selection.");t=i.getOnlyShowText(),r=i.getSelectionHandleOption()}this.selector.select(e,t,r)}}},e.prototype.selectParent=function(){this._isEnabled&&0!==this.selectables.length&&this.selector.getSelectedId()&&this.select(void 0)},e.prototype.selectFirstChild=function(){this._isEnabled&&0!==this.selectables.length&&(this.selector.getSelectedId()||this.select(this.selectables[0]))},e.prototype.selectNextSibling=function(){this.selectSibling(!0)},e.prototype.selectPreviousSibling=function(){this.selectSibling(!1)},e.prototype.getDescription=function(){var e=this.selector.getSelectedId();if(e){var t=this.getInteractiveElement(this.root,e);if(t)return t.getDescription();throw new Error("Invalid selection.")}return this.root.getDescription()},Object.defineProperty(e.prototype,"isEnabled",{set:function(e){e!==this._isEnabled&&(e||(this.hover(void 0),this.selector.select(void 0,!1,a.SelectionHandleOption.All),this.removeTooltips()),this._isEnabled=e)},enumerable:!0,configurable:!0}),e.prototype.hover=function(e){var t=this;if(this.hoverTimer&&clearTimeout(this.hoverTimer),e){var r=this.getInteractiveElement(this.root,e);if(!r)throw new Error("Invalid selection.");this.hoverTimer=c.wrapTimeout((function(){return t.selector.hover(e,r.getOnlyShowText())}),16)}else this.selector.hover(void 0,!1)},e.prototype.getInteractiveElement=function(e,t){if(e.getId()===t)return e;for(var r=0,i=e.getChildren();r<i.length;r++){var n=i[r],s=this.getInteractiveElement(n,t);if(s)return s}},e.prototype.removeTooltips=function(){this.tooltipType===i.Datapoint&&this.tooltip.isVisible()&&this.delayDatapointTooltip.setValue(!1,250),this.tooltipType=i.None,clearTimeout(this.showTooltipTimer),this.showTooltipTimer=0,this.tooltip.hide(),this.tooltip.removePairs()},e.prototype.cacheTooltipText=function(e){var t=this,r=e.getId(),i=e.getDescription();i&&(this.tooltips[l.getDomIdFromElementId(r)]=i),e.getChildren().forEach((function(e){t.cacheTooltipText(e)})),e.getDatapointChildren().filter((function(e){return e.hasTooltip()})).forEach((function(e){t.datapointTooltips[l.getDomIdFromElementId(r,e.getIndex())]=e}))},e.prototype.cacheSelectables=function(e){var t=this;e.getChildren().forEach((function(e){t.selectables.push(e.getId()),t.cacheSelectables(e)}))},e.prototype.getSelectionCandidateId=function(e){for(var t=e;t&&-1===this.selectables.indexOf(t.getId());)t=t.getParent();if(t)return t.getId()},e.prototype.showDatapointTooltip=function(e){this.tooltip.setPosition(e.x,e.y),this.tooltip.isVisible()||this.showTooltip(!this.delayDatapointTooltip.getValue(),s.TooltipOffset.Above)},e.prototype.showNonDatapointTooltip=function(e){this.tooltip.isVisible()||(this.tooltip.setPosition(e.x,e.y),this.showTooltip(!1,s.TooltipOffset.BelowRight))},e.prototype.showTooltip=function(e,t){var r=this,i=function(){r.tooltip.setOffset(t),r.tooltip.show()};e?i():(clearTimeout(this.showTooltipTimer),this.showTooltipTimer=setTimeout(i,250))},e.prototype.selectSibling=function(e){if(this._isEnabled&&0!==this.selectables.length){var t=this.selector.getSelectedId();if(t){var r=this.selectables.indexOf(t);if(r<0)throw new Error("Invalid selection.");r===(e?this.selectables.length-1:0)?this.select(this.selectables[e?0:this.selectables.length-1]):this.select(this.selectables[e?r+1:r-1])}}},e.prototype.handleSelection=function(e,t){var r=e.target?this.getSelectionCandidateId(e.target):void 0;r?((t===n.PointerType.Mouse&&this.selector.getSelectedId()!==r||t===n.PointerType.Touch)&&this.selectElement(r,t),e.stopPropagation()):this.selector.select(void 0,!1,a.SelectionHandleOption.All,t)},e.prototype.selectElement=function(e,t){var r=this.getInteractiveElement(this.root,e);if(!r)throw new Error("Invalid selection.");this.selector.select(e,r.getOnlyShowText(),r.getSelectionHandleOption(),t)},e}();t.InteractivityManager=h},7906:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(5629),n=function(){function e(e,t,r){this.wrapped=e,this.selectCallback=t,this.doubleClickCallback=r}return e.prototype.doubleClick=function(e){this.doubleClickCallback(e)},e.prototype.select=function(e,t,r,n){this.wrapped.select(e,t,r),this.selectCallback(e,n===i.PointerType.Touch)},e.prototype.getSelectedId=function(){return this.wrapped.getSelectedId()},e.prototype.hover=function(e,t){this.wrapped.hover(e,t)},e.prototype.setHandles=function(e){this.wrapped.setHandles(e)},e.prototype.setPathWidths=function(e){this.wrapped.setPathWidths(e)},e}();t.NotifyingSelector=n},7938:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.rootElement=e}return e.prototype.show=function(){},e.prototype.hide=function(){},e.prototype.isVisible=function(){return!1},e.prototype.setPosition=function(e,t){},e.prototype.setOffset=function(e){},e.prototype.setHeader=function(e){},e.prototype.addPair=function(e,t){},e.prototype.removePairs=function(){},e.prototype.getRoot=function(){return this.rootElement},e}();t.NullTooltip=r},5629:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Mouse="mouse",e.Touch="touch"}(r=t.PointerType||(t.PointerType={})),t.convertPointerTypeToEnum=function(e){switch(e){case"mouse":return r.Mouse;case"pen":case"touch":return r.Touch;default:throw new Error("PointerType not supported")}}},9759:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.TooltipOffset||(t.TooltipOffset={}))[r.Above=0]="Above",r[r.BelowRight=1]="BelowRight"},6725:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(8282),n=function(){function e(){this.features={}}return e.prototype.renderCustomData=function(e,t){this.setInnerHTML(e,t)},e.prototype.isFeatureEnabled=function(e,t){var r=this.features[e];return"boolean"==typeof r?r:t},e.prototype.setFeatureIsEnabled=function(e,t){this.features[e]=t},e.prototype.setInnerHTML=function(e,t){var r=document.createElementNS(i.svgns,"g");if(void 0!==r.innerHTML)r.innerHTML=t;else{if(!r.ownerDocument)throw new Error("Cannot render content.");var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;r.appendChild(r.ownerDocument.importNode(n,!0))}for(var s=r.querySelector("svg")||r;s.firstElementChild;){var o=s.firstElementChild;s.removeChild(o),e.appendChild(o)}},e}();t.OfficeRenderHost=n},7877:function(e,t,r){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(1428),s=r(7022),o=r(8685),a=r(3554),l=function(){function e(e,t){var r;this.formatResolver=new s.FormatResolver,this.element=e,this.parent=t,this.id=null!=(r=e.id)?r:"MISSING_ID",this.element.renderingProperties?this.formatResolver.pushFormat(this.getFormatFromRenderingProperties(this.element.renderingProperties)):this.element.format&&this.formatResolver.pushFormat(this.element.format)}return e.prototype.getFill=function(){return this.formatResolver.getFill()},e.prototype.getLineFill=function(){return this.formatResolver.getLineFill()},e.prototype.getLineThickness=function(){return this.formatResolver.getLineThickness()},e.prototype.getLineDashType=function(){return this.formatResolver.getLineDashType()},e.prototype.getLineCapType=function(){return this.formatResolver.getLineCapType()},e.prototype.getLineJoinType=function(){return this.formatResolver.getLineJoinType()},e.prototype.getHeadEnd=function(){return this.formatResolver.getHeadEnd()},e.prototype.getTailEnd=function(){return this.formatResolver.getTailEnd()},e.prototype.getClipRectIndex=function(){return this.formatResolver.getClipRectIndex()},e.prototype.getId=function(){return this.id},e.prototype.getText=function(){return this.element.text?n.Experimental.isExperimentalText(this.element.text)?new o.ExperimentalText(this.element.text,this.formatResolver):new a.LegacyText(this.element.text):void 0},e.prototype.getCustomData=function(){return this.element.customData},e.prototype.getChildren=function(){var t=this;return this.element.children?this.element.children.map((function(r,n){return new e(i({id:t.id+"-"+n},r),t)})):[]},e.prototype.getParent=function(){return this.parent},e.prototype.enumerateGeometry=function(e){if(Array.isArray(this.element.geometry))for(var t=0,r=this.element.geometry;t<r.length;t++){var i=r[t];switch(i.op){case 0:if(i.format?this.formatResolver.pushFormat(i.format):i.formatObject?this.formatResolver.pushFormat(this.getFormatFromFormatObject(i.formatObject)):this.formatResolver.pushFormat({}),!e.beginGeometry(this.copy()))throw new Error("Invalid operation: BeginGeometry failed.");break;case 1:if(this.formatResolver.popFormat(),!e.endGeometry())throw new Error("Invalid operation: EndGeometry failed.");break;case 2:if(!e.beginPath(i.fillMode))throw new Error("Invalid operation: BeginPath failed.");break;case 3:if(!e.endPath())throw new Error("Invalid operation: EndPath failed.");break;case 4:if(!e.beginFigure(i.startPoint,i.filled,i.type))throw new Error("Invalid operation: BeginFigure failed.");break;case 6:if(!e.addLines(i.points))throw new Error("Invalid operation: AddLines failed.");break;case 7:if(!e.addBeziers(i.points))throw new Error("Invalid operation: AddBeziers failed.");break;case 8:if(!e.addEscape(i.escape,i.data))throw new Error("Invalid operation: AddEscape failed.");break;case 5:if(!e.endFigure(i.closed))throw new Error("Invalid operation: EndFigure failed.");break;default:throw new Error("Invalid operation: default case should not be reached")}}},e.prototype.copy=function(){var t=new e(this.element,this.parent);return t.formatResolver=this.formatResolver.copy(),t},e.prototype.getFormatFromRenderingProperties=function(e){if(!e)return{};var t={line:{thickness:e.lineThickness,dashStyle:e.lineDashStyle}},r=n.Utils.colorToCSSString(e.fillColor);r&&(t.fill={color:r});var i=n.Utils.colorToCSSString(e.lineColor);return i&&t.line&&(t.line.fill={color:i}),t},e.prototype.getFormatFromFormatObject=function(e){return e?{fill:{color:e.fillColor},line:{fill:{color:e.lineColor}}}:{}},e}();t.Element=l},8685:function(e,t,r){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},i(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=r(960),o=function(e){function t(t,r){var i=e.call(this)||this;return i.text=t,i.resolver=r,i}return n(t,e),t.prototype.getLines=function(){var e=this;return this.text.lines.map((function(t){return new a(e.text,t,e.resolver)}))},t.prototype.getAngle=function(){return this.text.angle},t.prototype.getText=function(){return this.text.text},t.prototype.getSize=function(){return this.text.size},t.prototype.getLocation=function(){return this.text.location},t.prototype.getTextAlignment=function(){return 2},t}(s.ElementText);t.ExperimentalText=o;var a=function(e){function t(t,r,i){var n=e.call(this)||this;return n.text=t,n.line=r,n.resolver=i,n}return n(t,e),t.prototype.getRuns=function(){var e=this;return this.line.runs.map((function(t){return new l(e.text,t,e.resolver)}))},t.prototype.getHeight=function(){return this.line.height},t.prototype.isTrimmed=function(){return this.line.isTrimmed},t.prototype.getBaseline=function(){return Math.max.apply(Math,this.line.runs.map((function(e){return e.baseline})))},t}(s.ElementTextLine),l=function(e){function t(t,r,i){var n=e.call(this)||this;return n.text=t,n.run=r,n.resolver=i.copy(),n.resolver.pushFormat({text:n.run.format}),n}return n(t,e),t.prototype.getColor=function(){return this.resolver.getFontColor()},t.prototype.getWeight=function(){return this.resolver.getFontWeight()},t.prototype.getStyle=function(){return this.resolver.getFontStyle()},t.prototype.getFaceName=function(){return this.resolver.getFontFaceName()},t.prototype.getPixelSize=function(){return this.resolver.getFontPixelSize()},t.prototype.getText=function(){return this.text.text.substr(this.run.start,this.run.length)},t}(s.ElementTextRun)},7022:function(e,t,r){var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i};Object.defineProperty(t,"__esModule",{value:!0});var n=r(1428),s=function(){function e(){this.formats=[],this.defaults={fill:{color:"white"},lineFill:{color:"black"},lineThickness:1,lineDashType:n.LineDashType.Solid,lineCapType:n.LineCapType.Flat,lineJoinType:n.LineJoinType.Round,headEnd:{type:n.LineEndType.None,width:n.LineEndSize.Small,length:n.LineEndSize.Small},tailEnd:{type:n.LineEndType.None,width:n.LineEndSize.Small,length:n.LineEndSize.Small},fontColor:"#595959",fontWeight:400,fontStyle:0,fontFaceName:"Calibri",fontPixelSize:12,clipRectIndex:-1}}return e.prototype.pushFormat=function(e){this.formats.push(e)},e.prototype.popFormat=function(){return this.formats.pop()},e.prototype.copy=function(){var t=new e;return t.formats=i(this.formats),t},e.prototype.getFill=function(){var e;return null!=(e=this.resolve((function(e){return e.fill})))?e:this.defaults.fill},e.prototype.getLineFill=function(){var e;return null!=(e=this.resolve((function(e){var t,r;return null===(r=null===(t=e)||void 0===t?void 0:t.line)||void 0===r?void 0:r.fill})))?e:this.defaults.lineFill},e.prototype.getLineThickness=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.line)||void 0===t?void 0:t.thickness})))?e:this.defaults.lineThickness},e.prototype.getLineDashType=function(){var e,t;return null!=(t=null!=(e=this.resolve((function(e){var t;return null===(t=e.line)||void 0===t?void 0:t.dashType})))?e:function(e){switch(e){case"Dash":return n.LineDashType.Dash;case"DashDot":return n.LineDashType.DashDot;case"DashDotDot":return n.LineDashType.DashDotDot;case"Dot":return n.LineDashType.Dot;case"Solid":return n.LineDashType.Solid;case"Count":return n.LineDashType.Count;default:return e}}(this.resolve((function(e){var t;return null===(t=e.line)||void 0===t?void 0:t.dashStyle}))))?t:this.defaults.lineDashType},e.prototype.getLineCapType=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.line)||void 0===t?void 0:t.capType})))?e:this.defaults.lineCapType},e.prototype.getLineJoinType=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.line)||void 0===t?void 0:t.joinType})))?e:this.defaults.lineJoinType},e.prototype.getHeadEnd=function(){var e;return null!=(e=this.resolve((function(e){var t,r;return null===(r=null===(t=e)||void 0===t?void 0:t.line)||void 0===r?void 0:r.headEnd})))?e:this.defaults.headEnd},e.prototype.getTailEnd=function(){var e;return null!=(e=this.resolve((function(e){var t,r;return null===(r=null===(t=e)||void 0===t?void 0:t.line)||void 0===r?void 0:r.tailEnd})))?e:this.defaults.tailEnd},e.prototype.getFontColor=function(){var e;return null!=(e=this.resolve((function(e){var t,r;return null===(r=null===(t=e.text)||void 0===t?void 0:t.fill)||void 0===r?void 0:r.color})))?e:this.defaults.fontColor},e.prototype.getFontWeight=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.text)||void 0===t?void 0:t.weight})))?e:this.defaults.fontWeight},e.prototype.getFontStyle=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.text)||void 0===t?void 0:t.style})))?e:this.defaults.fontStyle},e.prototype.getFontFaceName=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.text)||void 0===t?void 0:t.faceName})))?e:this.defaults.fontFaceName},e.prototype.getFontPixelSize=function(){var e;return null!=(e=this.resolve((function(e){var t;return null===(t=e.text)||void 0===t?void 0:t.pixelSize})))?e:this.defaults.fontPixelSize},e.prototype.getClipRectIndex=function(){var e;return null!=(e=this.resolve((function(e){return e.clipRectIndex})))?e:this.defaults.clipRectIndex},e.prototype.resolve=function(e){return this.formats.reduceRight((function(t,r){return void 0===t?e(r):t}),void 0)},e}();t.FormatResolver=s},3554:function(e,t,r){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},i(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=r(960),o=function(e){function t(t){var r=e.call(this)||this;return r.text=t,r}return n(t,e),t.prototype.getLines=function(){var e=this;return this.text.layout.map((function(t,r){return new a(e.text,r)}))},t.prototype.getAngle=function(){return this.text.angle},t.prototype.getText=function(){return this.text.text},t.prototype.getSize=function(){return this.text.size},t.prototype.getLocation=function(){return this.text.location},t.prototype.getTextAlignment=function(){return this.text.format.textAlignment},t}(s.ElementText);t.LegacyText=o;var a=function(e){function t(t,r){var i=e.call(this)||this;return i.index=0,i.text=t,i.index=r,i}return n(t,e),t.prototype.getRuns=function(){return[new l(this.text,this.index)]},t.prototype.getHeight=function(){return this.text.layout[this.index].height},t.prototype.isTrimmed=function(){return this.text.layout[this.index].isTrimmed},t.prototype.getBaseline=function(){return this.text.layout[this.index].baseline},t}(s.ElementTextLine);t.LegacyTextLine=a;var l=function(e){function t(t,r){var i=e.call(this)||this;i.index=0,i.start=0,i.text=t,i.index=r;for(var n=0;n<i.index;n++)i.start+=i.text.layout[n].length;return i}return n(t,e),t.prototype.getColor=function(){return this.text.format.textColor},t.prototype.getWeight=function(){return this.text.format.fontWeight},t.prototype.getStyle=function(){return this.text.format.fontStyle},t.prototype.getFaceName=function(){return this.text.format.faceName},t.prototype.getPixelSize=function(){return this.text.format.pixelSize},t.prototype.getText=function(){var e=this.text.layout[this.index],t=e.isTrimmed&&isFinite(this.text.trimStart)?this.text.trimStart-this.start:e.length-e.newlineLength;return this.text.text.substr(this.start,t)},t}(s.ElementTextRun);t.LegacyTextRun=l},7882:(e,t)=>{function r(e,t){return{x:e.x+t.x,y:e.y+t.y}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.master=[]}return e.prototype.reset=function(){this.master=[]},e.prototype.beginGeometry=function(e){return this.master.push({op:0,formatObject:e}),!0},e.prototype.endGeometry=function(){return this.master.push({op:1}),!0},e.prototype.beginPath=function(e){return this.master.push({op:2,fillMode:e}),!0},e.prototype.endPath=function(){return this.master.push({op:3}),!0},e.prototype.beginFigure=function(e,t,r){return this.master.push({op:4,startPoint:e,filled:t,figureType:r}),!0},e.prototype.endFigure=function(e){return this.master.push({op:5,closed:e}),!0},e.prototype.addLines=function(e){return this.master.push({op:6,points:e}),!0},e.prototype.addBeziers=function(e){return this.master.push({op:7,points:e}),!0},e.prototype.addEscape=function(e,t){return this.master.push({op:8,escape:e,data:t}),!0},e.prototype.createInstance=function(e,t){return this.master.every((function(i){switch(i.op){case 0:return e.beginGeometry(i.formatObject);case 1:return e.endGeometry();case 2:return e.beginPath(i.fillMode);case 3:return e.endPath();case 4:return e.beginFigure(r(t,i.startPoint),i.filled,i.figureType);case 5:return e.endFigure(i.closed);case 6:return e.addLines(i.points.map((function(e){return r(t,e)})));case 7:return e.addBeziers(i.points.map((function(e){return r(t,e)})));case 8:return e.addEscape(i.escape,i.data);default:throw new Error("Unexpected geometry.")}}))},e}();t.MasterInstancer=i},311:function(e,t,r){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(7877),s=function(){function e(e){this.root=new n.Element(i({id:"ROOT_ELEMENT"},e.root)),this.sceneGraph=e}return e.prototype.getRoot=function(){return this.root},e.prototype.getElementById=function(e){return this.findElementWithIdFromElement(this.root,e)},e.prototype.getSize=function(){return this.sceneGraph.size},e.prototype.getBorderWidth=function(){var e;return null!=(e=this.sceneGraph.borderWidth)?e:1},e.prototype.getClipRects=function(){var e;return null!=(e=this.sceneGraph.clipRects)?e:[]},e.prototype.findElementWithIdFromElement=function(e,t){if(e.getId()===t)return e;for(var r=0,i=e.getChildren();r<i.length;r++){var n=i[r],s=this.findElementWithIdFromElement(n,t);if(s)return s}},e}();t.SceneGraph=s},960:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.ElementTextRun=function(){};t.ElementTextLine=function(){};t.ElementText=function(){}},959:function(e,t,r){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(9072),s=r(8688),o=r(104),a=function(){function e(e,t,r){var i=this;this.observers=[],this.handleMouseOver=function(e){o.wrapWithActivity(i.activitySink,"ObservableSvgElement.handleMouseOver",(function(){var t=i.convertMouseEvent(e);i.observers.forEach((function(e){return e.receiveMouseOver(t)}))}))},this.handleMouseMove=function(e){o.wrapWithActivity(i.activitySink,"ObservableSvgElement.handleMouseMove",(function(){var t=i.convertMouseEvent(e);i.observers.forEach((function(e){return e.receiveMouseMove(t)}))}))},this.handleMouseOut=function(){o.wrapWithActivity(i.activitySink,"ObservableSvgElement.handleMouseOut",(function(){return i.observers.forEach((function(e){return e.receiveMouseOut()}))}))},this.handleMouseDown=function(e){o.wrapWithActivity(i.activitySink,"ObservableSvgElement.handleMouseDown",(function(){var t=i.convertMouseEvent(e);i.observers.forEach((function(e){return e.receiveMouseDown(t)}))}))},this.handleDoubleClick=function(e){o.wrapWithActivity(i.activitySink,"ObservableSvgElement.handleDoubleClick",(function(){var t=i.convertMouseEvent(e);i.observers.forEach((function(e){return e.receiveDoubleClick(t)}))}))},this.handlePointerDown=function(e){o.wrapWithActivity(i.activitySink,"ObservableSvgElement.handlePointerDown",(function(){var t=i.convertMouseEvent(e);i.observers.forEach((function(r){return r.receivePointerDown(t,e.pointerType)}))}))},this.sceneGraph=e,this.activitySink=r,this.renderHost=t}return e.prototype.bind=function(e){this.unbind(),this.element=e,this.renderHost&&this.renderHost.isFeatureEnabled("EnablePointerEvents",!1)?this.element.addEventListener("pointerdown",this.handlePointerDown):this.element.addEventListener("mousedown",this.handleMouseDown),this.element.addEventListener("mouseover",this.handleMouseOver),this.element.addEventListener("mousemove",this.handleMouseMove),this.element.addEventListener("mouseout",this.handleMouseOut),this.element.addEventListener("dblclick",this.handleDoubleClick)},e.prototype.unbind=function(){this.element&&(this.renderHost&&this.renderHost.isFeatureEnabled("EnablePointerEvents",!1)?this.element.removeEventListener("pointerdown",this.handlePointerDown):this.element.removeEventListener("mousedown",this.handleMouseDown),this.element.removeEventListener("mouseover",this.handleMouseOver),this.element.removeEventListener("mousemove",this.handleMouseMove),this.element.removeEventListener("mouseout",this.handleMouseOut),this.element.removeEventListener("dblclick",this.handleDoubleClick)),this.element=void 0},e.prototype.addObserver=function(e){this.observers.push(e)},e.prototype.removeObservers=function(){this.observers=[]},e.prototype.getElementFromTarget=function(e){if(!(e instanceof Element))throw new Error("Invalid event target.");for(var t=e;t&&!n.isElementDomId(t.id);)t=s.getParentElement(t);if(t){var r=n.getElementIdFromDomId(t.id);if(!r)throw new Error("Unexpected error.");var i=this.sceneGraph.getElementById(r);if(!i)throw new Error("Unexpected error.");return i}},e.prototype.convertMouseEvent=function(e){if(!e.target)throw new Error("Unexpected event.");if(!this.element)throw new Error("Unexpected error. Binding required.");var t=s.getOffsetInRect(this.element.getBoundingClientRect(),e.clientX,e.clientY);return i(i({},t),{target:this.getElementFromTarget(e.target),stopPropagation:function(){return e.stopPropagation()}})},e}();t.ObservableSvgElement=a},5626:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1432),n=r(8282),s=function(){function e(e,t){this.svg=e,this.idPrefix=i.generateUniqueId(),this.count=t.length,this.ensureClipRects(t)}return e.prototype.getIdForIndex=function(e){if(e>=this.count)throw new Error("Invalid index.");return this.idPrefix+"-"+e},e.prototype.ensureClipRects=function(e){var t=this;e.forEach((function(e,r){t.ensureClipRect(e,r)}))},e.prototype.ensureClipRect=function(e,t){var r=document.createElementNS(n.svgns,"clipPath");r.id=this.getIdForIndex(t);var i=document.createElementNS(n.svgns,"rect");i.setAttribute("x",""+e.left),i.setAttribute("y",""+e.top),i.setAttribute("width",""+(e.right-e.left)),i.setAttribute("height",""+(e.bottom-e.top)),r.appendChild(i),this.svg.appendChild(r)},e}();t.SvgClipRectStorage=s},4030:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(8282),n=function(){function e(e){this.defs=e}return e.prototype.storeLinearGradient=function(e,t,r){var n=this.translateLinearGradientShade(e.angle),s=n.start,o=n.end,a=document.createElementNS(i.svgns,"linearGradient");a.setAttribute("x1",s.x.toString()),a.setAttribute("y1",s.y.toString()),a.setAttribute("x2",o.x.toString()),a.setAttribute("y2",o.y.toString()),this.appendGradient(a,t,r)},e.prototype.storeRadialGradient=function(e,t,r,n){var s=this.translateRadialGradientShade(e.center,r),o=document.createElementNS(i.svgns,"radialGradient");o.setAttribute("fx",s.focal.x.toString()),o.setAttribute("fy",s.focal.y.toString()),o.setAttribute("cx",s.center.x.toString()),o.setAttribute("cy",s.center.y.toString()),o.setAttribute("r",s.radius.toString()),s.translate&&s.scale&&o.setAttribute("gradientTransform","translate("+s.translate.x+", "+s.translate.y+") scale("+s.scale.x+", "+s.scale.y+")"),this.appendGradient(o,t,n)},e.prototype.appendGradient=function(e,t,r){e.id=r,t.sort((function(e,t){return e.pos-t.pos}));for(var n=0,s=t;n<s.length;n++){var o=s[n],a=document.createElementNS(i.svgns,"stop");a.setAttribute("offset",o.pos.toString()),a.setAttribute("stop-color",o.color),e.appendChild(a)}this.defs.appendChild(e)},e.prototype.translateLinearGradientShade=function(e){(e+=180)<0?(e%=360,e+=360):e%=360;var t,r,i,n=Math.floor(e/90),s=(e-90*n)*Math.PI/180,o={x:Math.cos(s),y:Math.sin(s)},a=(t={x:-1,y:-1}).x*(r=o).x+t.y*r.y,l={x:o.x*a,y:o.y*a};switch(n){case 0:default:i=l;break;case 1:i={x:-l.y,y:l.x};break;case 2:i={x:-l.x,y:-l.y};break;case 3:i={x:l.y,y:-l.x}}var c={x:-i.x,y:-i.y},h=function(e){return{x:(e.x+1)/2,y:(e.y+1)/2}};return i=h(i),{start:c=h(c),end:i}},e.prototype.translateRadialGradientShade=function(e,t){var r=t.max.x-t.min.x,i=t.max.y-t.min.y,n=r/2,s=Math.sqrt(r*r+i*i)/2,o=(n+s-(n-s))/r/2,a={x:r*e.x/r,y:i*e.y/i},l=i/r,c=(l-1)/-2;a.y=e.y*l+c;var h=(t.max.x-t.min.x)/(t.max.y-t.min.y),u={x:1,y:h},d={x:0,y:(h-1)/-2};if(e.y>1||e.y<0)if(a.y<0){var p=.5-o-a.y;a.x=.5,a.y+=p,d.y-=p,u.y+=p}else p=a.y-(.5+o),a.x=.5,a.y-=p,u.y+=p;else{var f={x:a.x-.5,y:a.y-.5},g=f.x*f.x+f.y*f.y;g>=o*o&&(o=Math.sqrt(g))}return{focal:a,center:{x:.5,y:.5},radius:o,translate:d,scale:u}},e}();t.SvgGradientStorage=n},1273:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(8282),s=function(){function e(e){this.refXOffset=.1,this.defs=e}return e.prototype.storeTriangleLineEnd=function(e,t,r,i,s){var o=this.translateTriangleLineEndSize(e,t),a=o.x,l=o.y,c=this.createTrianglePath(a,l,0)+" Z",h=document.createElementNS(n.svgns,"marker");h.setAttribute("refX",this.refXOffset.toString()),h.setAttribute("refY",l.toString());var u=document.createElementNS(n.svgns,"path");u.setAttribute("d",c),u.setAttribute("fill",r),h.appendChild(u),this.appendLineEnd(h,i,s)},e.prototype.storeArrowLineEnd=function(e,t,r,i,s){var o=this.translateTriangleLineEndSize(e,t),a=o.x,l=o.y,c=this.createArrowPath(a,l,s)+" Z",h=document.createElementNS(n.svgns,"marker");h.setAttribute("refX",(s+this.refXOffset).toString()),h.setAttribute("refY",(s+l).toString());var u=document.createElementNS(n.svgns,"path");u.setAttribute("d",c),u.setAttribute("fill","none"),u.setAttribute("stroke",r),u.setAttribute("stroke-linecap","round"),h.appendChild(u),this.appendLineEnd(h,i,s)},e.prototype.storeDiamondLineEnd=function(e,t,r,i,s){var o=this.translateDiamondLineEndSize(e,t),a=o.x,l=o.y,c=this.createDiamondPath(a,l)+" Z",h=document.createElementNS(n.svgns,"marker");h.setAttribute("refX",(a/2).toString()),h.setAttribute("refY",l.toString());var u=document.createElementNS(n.svgns,"path");u.setAttribute("d",c),u.setAttribute("fill",r),h.appendChild(u),this.appendLineEnd(h,i,s)},e.prototype.storeOvalLineEnd=function(e,t,r,i,s){var o=this.translateOvalLineEndSize(e,t),a=o.x,l=o.y,c=a.toString(),h=l.toString(),u=document.createElementNS(n.svgns,"marker");u.setAttribute("refX",a.toString()),u.setAttribute("refY",l.toString());var d=document.createElementNS(n.svgns,"ellipse");d.setAttribute("cx",c),d.setAttribute("cy",h),d.setAttribute("rx",c),d.setAttribute("ry",h),d.setAttribute("fill",r),u.appendChild(d),this.appendLineEnd(u,i,s)},e.prototype.storeStealthLineEnd=function(e,t,r,i,s){var o=this.translateTriangleLineEndSize(e,t),a=o.x,l=o.y,c=this.createStealthPath(a,l,0)+" Z",h=document.createElementNS(n.svgns,"marker");h.setAttribute("refX",(a/4+this.refXOffset).toString()),h.setAttribute("refY",l.toString());var u=document.createElementNS(n.svgns,"path");u.setAttribute("d",c),u.setAttribute("fill",r),h.appendChild(u),this.appendLineEnd(h,i,s)},e.prototype.enumToNumber=function(e){return"number"==typeof e?e:+i.LineEndSize[e]},e.prototype.appendLineEnd=function(e,t,r){e.id=t,e.setAttribute("orient","auto-start-reverse"),e.setAttribute("markerWidth",(7*r).toString()),e.setAttribute("markerHeight",(7*r).toString()),this.defs.appendChild(e)},e.prototype.translateTriangleLineEndSize=function(e,t){var r=this.enumToNumber(e);return{x:this.enumToNumber(t)+2,y:r/2+1.5}},e.prototype.translateDiamondLineEndSize=function(e,t){var r=this.enumToNumber(e);return{x:this.enumToNumber(t)+.75,y:r+.75}},e.prototype.translateOvalLineEndSize=function(e,t){var r=this.enumToNumber(e);return{x:this.enumToNumber(t)/2+1.25,y:r/2+1.25}},e.prototype.createTrianglePath=function(e,t,r){var i=r.toString();return"M "+i+" "+i+" L "+(e+r).toString()+" "+(t+r).toString()+" L "+i+" "+(r+2*t).toString()},e.prototype.createArrowPath=function(e,t,r){var i=this.createTrianglePath(e,t,r),n=(e+r).toString(),s=(t+r).toString();return i+" M "+r.toString()+" "+s+" L "+n+" "+s},e.prototype.createDiamondPath=function(e,t){var r=e.toString(),i=t.toString();return"M 0 "+i+" L "+r+" 0 L "+(2*e).toString()+" "+i+" L "+r+" "+(2*t).toString()},e.prototype.createStealthPath=function(e,t,r){return this.createTrianglePath(e,t,r)+" L "+(e/4).toString()+" "+t.toString()},e}();t.SvgLineEndStorage=s},8827:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(8956),s=function(){function e(){this.pathBounds=new n.Bounds2D,this.finishedPaths=[],this.currentPath=this.createEmptyPath(),this.isLines=!0,this.hasGradient=!1}return e.prototype.shift=function(){return this.finishedPaths.shift()},Object.defineProperty(e.prototype,"length",{get:function(){return this.finishedPaths.length},enumerable:!0,configurable:!0}),e.prototype.setDatapointIndex=function(e){""!==this.currentPath.data&&this.currentPath.datapointIndex!==e&&this.finishCurrentPath(),this.currentPath.datapointIndex=e},e.prototype.setFilled=function(e){""!==this.currentPath.data&&this.currentPath.filled!==e&&this.finishCurrentPath(),this.currentPath.filled=e},e.prototype.move=function(e){this.currentPath.data+="M"+i.Utils.pointToString(e),this.isLines&&this.pathBounds.addPoint(e)},e.prototype.addLines=function(e){if(e.length>0){this.currentPath.data+="L";for(var t=0,r=e;t<r.length;t++){var n=r[t];this.currentPath.data+=i.Utils.pointToString(n),this.isLines&&this.pathBounds.addPoint(n)}}},e.prototype.addBeziers=function(e){if(e.length>0){this.currentPath.data+="C",this.isLines=!1;for(var t=0,r=e;t<r.length;t++){var n=r[t];this.currentPath.data+=i.Utils.pointToString(n)}}},e.prototype.close=function(){this.currentPath.data+="Z"},e.prototype.finishCurrentPath=function(){""!==this.currentPath.data&&(this.hasGradient&&this.isLines&&!this.pathBounds.isEmpty()&&this.expandBoundsOfOrthogonalLine(),this.finishedPaths.push(this.currentPath),this.currentPath=this.createEmptyPath(),this.isLines=!0,this.hasGradient=!1,this.pathBounds.reset())},e.prototype.setHasGradient=function(e){this.hasGradient=e},e.prototype.expandBoundsOfOrthogonalLine=function(){var e=this.pathBounds.getBounds(),t=e.max.x-e.min.x,r=e.max.y-e.min.y;0===r&&0===t||(0===r?this.currentPath.data+="M"+e.max.x+","+(e.max.y+.005):0===t&&(this.currentPath.data+="M"+(e.max.x+.005)+","+e.max.y))},e.prototype.createEmptyPath=function(){return{data:"",filled:!1}},e}();t.SvgPathBuilder=s},6687:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(1432),s=r(8282),o=function(){function e(e){this.patterns={},this.defs=e}return e.prototype.storePattern=function(e){var t=e.pattern+","+e.backgroundColor+","+e.foregroundColor;if(this.patterns[t])return this.patterns[t];var r=document.createElementNS(s.svgns,"pattern");r.id=n.generateUniqueId(),r.setAttribute("patternUnits","userSpaceOnUse"),r.setAttribute("width",d.toString()),r.setAttribute("height",d.toString());var i=1/u;r.setAttribute("patternTransform","scale("+i+" "+i+")");var o=document.createElementNS(s.svgns,"image");o.id=n.generateUniqueId(),o.setAttribute("width",d.toString()),o.setAttribute("height",d.toString()),o.setAttribute("preserveAspectRatio","none");var l=a(e);o.setAttributeNS(s.xlinkns,"href",l.toDataURL("image/jpeg",1)),this.defs.appendChild(o);var c=document.createElementNS(s.svgns,"use");return c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.setAttributeNS(s.xlinkns,"href","#"+o.id),r.appendChild(c),this.defs.appendChild(r),this.patterns[t]=r.id,this.patterns[t]},e}();function a(e){var t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("Missing canvas support.");t.width=t.height=d,r.clearRect(0,0,d,d);for(var n=0,s=0,o=e.pattern*h,a=e.backgroundColor,p=e.foregroundColor,f=function(e,t,r){var n=i.Utils.cssStringToColor(e);if(!n)throw new Error("Invalid color.");var s=i.Utils.cssStringToColor(t);if(!s)throw new Error("Invalid color.");var o,a,l=i.Utils.colorToCSSString(function(e,t){return{r:e.r+t.r,g:e.g+t.g,b:e.b+t.b,a:e.a+t.a}}(n,function(e,t){return{r:e.r*t,g:e.g*t,b:e.b*t,a:e.a*t}}((a=n,{r:(o=s).r-a.r,g:o.g-a.g,b:o.b-a.b,a:o.a-a.a}),.5)));if(!l)throw new Error("Invalid color.");return l}(e.backgroundColor,e.foregroundColor),g=0;g<h;g++)for(var m=l[o+g],y=0;y<4;y++){var _=m>>y%4*2,v=a;2&_?v=p:1&_&&(v=f),r.fillStyle=v,r.fillRect(n*u,s*u,u,u),++n===c&&(n=0,s++)}return t}t.SvgPatternStorage=o,t.createPatternCanvas=a;var l=new Uint8Array([255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0,7,64,29,0,116,0,208,1,64,7,0,29,0,116,1,208,1,208,0,116,0,29,64,7,208,1,116,0,29,0,7,64,255,255,3,0,3,0,3,0,3,0,3,0,3,0,3,0,7,208,29,116,116,29,208,7,208,7,116,29,29,116,7,208,3,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,3,0,0,3,0,0,0,0,3,0,0,3,3,0,0,48,48,0,0,3,3,0,0,48,48,0,0,3,3,48,48,3,3,48,48,3,3,48,48,3,3,48,48,51,51,12,12,51,51,192,192,51,51,12,12,51,51,192,192,51,51,204,204,51,51,204,192,51,51,204,204,51,51,192,204,51,51,204,204,51,51,204,204,51,51,204,204,51,51,204,204,63,63,204,204,243,243,204,204,63,63,204,204,243,243,204,204,252,252,207,207,252,252,207,207,252,252,207,207,252,252,207,207,252,252,255,255,207,207,255,255,252,252,255,255,207,207,255,255,63,255,255,255,255,63,255,255,63,255,255,255,255,63,255,255,255,255,255,255,255,255,255,252,255,255,255,255,255,255,252,255,3,3,12,12,48,48,192,192,3,3,12,12,48,48,192,192,192,192,48,48,12,12,3,3,192,192,48,48,12,12,3,3,15,15,60,60,240,240,195,195,15,15,60,60,240,240,195,195,240,240,60,60,15,15,195,195,240,240,60,60,15,15,195,195,15,192,63,0,252,0,240,3,192,15,0,63,0,252,3,240,3,240,0,252,0,63,192,15,240,3,252,0,63,0,15,192,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,255,255,0,0,0,0,0,0,255,255,0,0,0,0,0,0,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,255,255,0,0,255,255,0,0,255,255,0,0,255,255,0,0,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,0,0,0,0,255,255,255,255,0,0,0,0,0,0,0,0,3,3,12,12,48,48,192,192,0,0,0,0,0,0,0,0,192,192,48,48,12,12,3,3,0,0,0,0,255,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,3,0,3,0,3,0,3,0,0,3,0,3,0,3,0,3,3,0,0,3,12,0,0,48,192,0,0,192,48,0,0,12,243,192,240,0,0,240,192,243,207,3,15,0,0,15,3,207,3,192,12,48,48,12,192,3,3,192,12,48,48,12,192,3,0,0,192,3,48,204,15,0,0,0,192,3,48,204,15,0,0,192,0,48,0,12,0,3,192,3,48,12,12,48,3,192,255,255,3,0,3,0,3,0,255,255,0,3,0,3,0,3,3,3,204,12,48,48,12,204,3,3,192,12,48,48,204,192,51,51,204,204,51,51,204,204,255,0,255,0,255,0,255,0,0,0,192,0,0,3,192,0,0,0,3,0,0,192,3,0,51,51,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,48,48,0,0,0,3,0,0,48,48,0,0,0,240,3,12,12,3,240,0,0,15,0,48,0,192,0,192,255,255,60,60,255,255,195,195,255,255,60,60,255,255,195,195,252,252,3,195,3,255,3,255,252,252,195,3,255,3,255,3,255,255,3,3,3,3,3,3,255,255,3,3,3,3,3,3,195,195,60,60,60,60,195,195,195,195,60,60,60,60,195,195,255,0,255,0,255,0,255,0,0,255,0,255,0,255,0,255,3,48,12,12,48,3,192,0,48,3,12,12,3,48,0,192,192,0,240,3,252,15,255,63,252,15,240,3,192,0,0,0]),c=8,h=16,u=8,d=c*u},4002:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(8827),n=r(1428),s=r(8282),o=r(9072),a=r(8688),l=r(104),c=r(6256),h=function(){function e(e){this.handles={},this.pathWidths={},this.svg=e,this.selectionLayer=document.createElementNS(s.svgns,"g"),this.svg.appendChild(this.selectionLayer),this.createHighContrastStyle(),this.ensurePaths()}return e.prototype.doubleClick=function(e){throw new Error("Method not implemented.")},e.prototype.select=function(e,t,r){e!==this.selectPath.attachedId&&(this.removeAllHandles(),this.hidePath(this.hoverPath,l.UserAction.Unhover),this.hidePath(this.selectPath,l.UserAction.Deselect),e&&(this.overlayPath(e,this.selectPath,t,l.UserAction.Select),this.createHandlesForElement(e,r)))},e.prototype.getSelectedId=function(){return this.selectPath.attachedId},e.prototype.hover=function(e,t){e!==this.hoverPath.attachedId&&(this.svg.style.cursor=e?"default":"","string"==typeof this.selectPath.attachedId&&this.selectPath.attachedId===e||(this.hidePath(this.hoverPath,l.UserAction.Unhover),e&&this.overlayPath(e,this.hoverPath,t,l.UserAction.Hover)))},e.prototype.setHandles=function(e){this.handles=e},e.prototype.setPathWidths=function(e){this.pathWidths=e},e.prototype.hidePath=function(e,t){var r;e.attachedId&&(e.path.removeAttribute("d"),e.attachedId=void 0,null===(r=l.getCurrentActivity())||void 0===r||r.addAction(t))},e.prototype.getPathsForSelection=function(e){var t;if(!e.querySelector("."+a.customDataClassName)&&!e.querySelector("."+a.hitTestingClassName))return e.querySelectorAll("path");for(var r=e.querySelectorAll("path"),i=[],n=0;n<r.length;n++){for(var s=r[n],o=!0;void 0!==s&&s!==e&&o;){var l=null!=(t=s.getAttribute("class"))?t:"";o=-1===l.split(" ").indexOf(a.customDataClassName)&&-1===l.split(" ").indexOf(a.hitTestingClassName),s=a.getParentElement(s)}o&&i.push(r[n])}return i},e.prototype.overlayPath=function(e,t,r,n){var s,a,c=this;if(e!==t.attachedId){var h=this.svg.getBoundingClientRect(),u=this.getAdjustmentFromViewBox(null!=(s=this.svg.getAttribute("viewBox"))?s:"0"),d=o.getDomIdFromElementId(e),p=this.svg.getElementById(d);if(p&&(null===(a=l.getCurrentActivity())||void 0===a||a.addAction(n),t.attachedId=e,this.shouldShowBorder(d)||n!==l.UserAction.Select)){if(!r){var f=this.getPathsForSelection(p);if(f.length>0){for(var g="",m=0;m<f.length;m++){var y=f[m].getAttribute("d");"string"==typeof y&&(g+=y)}return void t.path.setAttribute("d",g)}}var _=[],v=p.querySelectorAll("text");if(v.length>0)this.groupElements(v).forEach((function(e){var t=e.map((function(e){return c.getBoundingBox(h,u,e)})).reduce((function(e,t){return c.getUnionOfBoundingBoxes(e,t)}));_.push({x:t.left-4,y:t.top-4},{x:t.right+4,y:t.top-4},{x:t.right+4,y:t.bottom+4},{x:t.left-4,y:t.bottom+4})}));else{var b=this.getBoundingBox(h,u,p);_.push({x:b.left,y:b.top},{x:b.right,y:b.top},{x:b.right,y:b.bottom},{x:b.left,y:b.bottom})}var w=new i.SvgPathBuilder;for(m=0;m<_.length;m+=4)w.move(_[m]),w.addLines(_.slice(m+1,m+4)),w.close();w.finishCurrentPath();var T=w.shift();if(!T)throw new Error("Unexpected missing path.");t.path.setAttribute("d",T.data),this.handles[e]=_}}},e.prototype.groupElements=function(e){for(var t={},r=0;r<e.length;r++){for(var i=e[r],n=i;!n.id;){var s=a.getParentElement(n);if(!s)throw new Error("Invalid element.");n=s}t[n.id]?t[n.id].push(i):t[n.id]=[i]}return Object.keys(t).map((function(e){return t[e]}))},e.prototype.getBoundingBox=function(e,t,r){var i=r.getBoundingClientRect();return{left:i.left-e.left+t,top:i.top-e.top+t,right:i.left-e.left+i.width+t,bottom:i.top-e.top+i.height+t}},e.prototype.getUnionOfBoundingBoxes=function(e,t){return{left:Math.min(e.left,t.left),top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom)}},e.prototype.getAdjustmentFromViewBox=function(e){var t=parseInt(e,10);if(isNaN(t))throw new Error("Invalid view box.");return t},e.prototype.createHighContrastStyle=function(){var t=document.createElementNS(s.svgns,"style");this.selectionLayer.appendChild(t);var r=new c.SvgStyle(t);r.addRule("@media screen and (-ms-high-contrast: active) {\n                path."+e.highContrastSelectionPathClassName+" {\n                    stroke: highlight;\n                }\n            }"),r.addRule("@media screen and (-ms-high-contrast: active) {\n                circle."+e.highContrastSelectionHandleClassName+" {\n                    stroke: highlight;\n                    fill: window;\n                }\n            }")},e.prototype.ensurePaths=function(){this.hoverPath={path:document.createElementNS(s.svgns,"path")},this.hoverPath.path.setAttribute("stroke","#0078D2"),this.hoverPath.path.setAttribute("stroke-width","1px"),this.hoverPath.path.setAttribute("fill-opacity","0"),this.hoverPath.path.setAttribute("pointer-events","none"),this.hoverPath.path.setAttribute("class",e.highContrastSelectionPathClassName),this.selectionLayer.appendChild(this.hoverPath.path),this.selectPath={path:document.createElementNS(s.svgns,"path")},this.selectPath.path.setAttribute("stroke","#0078D2"),this.selectPath.path.setAttribute("stroke-width","1px"),this.selectPath.path.setAttribute("fill-opacity","0"),this.selectPath.path.setAttribute("pointer-events","none"),this.selectPath.path.setAttribute("class",e.highContrastSelectionPathClassName),this.selectionLayer.appendChild(this.selectPath.path)},e.prototype.createHandlesForElement=function(e,t){var r,i=this,s=this.handles[e];if(s&&s.length>0)if(t===n.SelectionHandleOption.EndPoints&&s.length>1)this.createHandle(s[0]),this.createHandle(s[s.length-1]);else if(t===n.SelectionHandleOption.Maximum&&s.length>16){this.createHandle(s[s.length-1]);for(var o=(s.length-1)/15,a=0;Math.round(a)<s.length-1;a+=o)this.createHandle(s[Math.round(a)])}else s.forEach((function(e){return i.createHandle(e)}));else{var l=this.svg.getBoundingClientRect(),c=this.getAdjustmentFromViewBox(null!=(r=this.svg.getAttribute("viewBox"))?r:"0"),h=this.getBoundingBox(l,c,this.selectPath.path);this.createHandle({x:h.left,y:h.top}),this.createHandle({x:h.right,y:h.top}),this.createHandle({x:h.right,y:h.bottom}),this.createHandle({x:h.left,y:h.bottom})}},e.prototype.createHandle=function(t){var r=document.createElementNS(s.svgns,"circle");r.setAttribute("class","handle "+e.highContrastSelectionHandleClassName),r.setAttribute("stroke","#0078D2"),r.setAttribute("stroke-width","1px"),r.setAttribute("fill","#B2D6F9"),r.setAttribute("pointer-events","none"),r.setAttribute("cx",t.x.toString()),r.setAttribute("cy",t.y.toString()),r.setAttribute("r","3"),this.selectionLayer.appendChild(r)},e.prototype.removeAllHandles=function(){for(var e=this.selectionLayer.querySelectorAll(".handle"),t=0;t<e.length;t++)this.selectionLayer.removeChild(e[t])},e.prototype.shouldShowBorder=function(e){var t=this.pathWidths[e];return"number"!=typeof t||t>1},e.highContrastSelectionPathClassName="MSChart-HighContrastSelectionPath",e.highContrastSelectionHandleClassName="MSChart-HighContrastSelectionHandle",e}();t.SvgSelector=h},4092:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1428),n=r(8202),s=r(6256),o=r(7882),a=r(4030),l=r(6687),c=r(8282),h=r(8956),u=r(8827),d=r(1432),p=r(9072),f=r(143),g=r(8688),m=r(8688),y=r(959),_=r(5626),v=r(1273),b=function(){function e(t,r,i,n){this.pathBuilder=new u.SvgPathBuilder,this.groupStack=[],this.masterInstancer=new o.MasterInstancer,this.isCreatingMaster=!1,this.handleSink=new f.HandleSink,this.handles={},this.pathWidths={},this.sceneGraph=t,this.renderHost=i,this.observable=new y.ObservableSvgElement(this.sceneGraph,i,n);var h=this.sceneGraph.getSize(),d=this.sceneGraph.getBorderWidth();r.setAttribute("viewBox",-d+" "+-d+" "+(h.width+2*d)+" "+(h.height+2*d)),r.setAttribute("class",""+e.chartRootClassName);var p=document.createElementNS(c.svgns,"style");r.appendChild(p),this.svgStyle=new s.SvgStyle(p),this.svgStyle.addRule("@media screen and (-ms-high-contrast: active) {\n                path."+e.highContrastClassName+" {\n                    fill: window;\n                    stroke: windowText;\n                }\n            }"),this.svgStyle.addRule("@media screen and (-ms-high-contrast: active) {\n                path."+e.highContrastNoFillClassName+" {\n                    stroke: windowText;\n                }\n            }"),this.svgStyle.addRule("@media screen and (-ms-high-contrast: active) {\n                path."+e.highContrastNoStrokeClassName+" {\n                    fill: window;\n                }\n            }"),this.svgStyle.addRule("@media screen and (-ms-high-contrast: active) {\n                tspan."+e.highContrastClassName+" {\n                    fill: windowText;\n                    stroke: none;\n                }\n            }"),this.svgStyle.addRule("svg."+e.chartRootClassName+" {\n                font-size: 12px;\n                pointer-events: painted;\n            }");var g=document.createElementNS(c.svgns,"defs");this.gradientStorage=new a.SvgGradientStorage(g),this.patternStorage=new l.SvgPatternStorage(g),this.lineEndStorage=new v.SvgLineEndStorage(g),r.appendChild(g),this.clipRectStorage=new _.SvgClipRectStorage(r,t.getClipRects());var m=document.createElementNS(c.svgns,"g");r.appendChild(m),this.observable.bind(m),this.groupStack.push(m)}return e.prototype.addObserver=function(e){this.observable.addObserver(e)},e.prototype.removeObservers=function(){this.observable.removeObservers()},e.prototype.beginGeometry=function(e){if(this.isCreatingMaster)return this.masterInstancer.beginGeometry(e);if(!this.handleSink.beginGeometry(e))return!1;if(this.pathBounds=this.shouldStartCollectingPathBounds(e)?new h.Bounds2D:void 0,this.formatObject=e,this.formatObject){var t=this.formatObject.getFill(),r=this.formatObject.getLineFill(),n=i.isGradientFillFormat(r)||i.isGradientFillFormat(t);this.pathBuilder.setHasGradient(n)}return!0},e.prototype.endGeometry=function(){if(this.isCreatingMaster)return this.masterInstancer.endGeometry();if(!this.handleSink.endGeometry())return!1;for(this.pathBuilder.finishCurrentPath();this.pathBuilder.length>0;)this.addPathToSvg(this.pathBuilder.shift());return this.formatObject=void 0,!0},e.prototype.beginPath=function(e){return this.isCreatingMaster?this.masterInstancer.beginPath(e):!!this.handleSink.beginPath(e)},e.prototype.endPath=function(){return this.isCreatingMaster?this.masterInstancer.endPath():!!this.handleSink.endPath()},e.prototype.beginFigure=function(e,t,r){if(this.isCreatingMaster)return this.masterInstancer.beginFigure(e,t,r);if(!this.handleSink.beginFigure(e,t,r))return!1;for(this.pathBuilder.setFilled(t),this.pathBuilder.move(e);this.pathBuilder.length>0;)this.addPathToSvg(this.pathBuilder.shift());return this.pathBounds&&this.pathBounds.addPoint(e),!0},e.prototype.endFigure=function(e){return this.isCreatingMaster?this.masterInstancer.endFigure(e):!!this.handleSink.endFigure(e)&&(e&&this.pathBuilder.close(),!0)},e.prototype.addLines=function(e){if(this.isCreatingMaster)return this.masterInstancer.addLines(e);if(!this.handleSink.addLines(e))return!1;if(this.pathBuilder.addLines(e),this.pathBounds){var t=this.pathBounds;e.forEach((function(e){return t.addPoint(e)}))}return!0},e.prototype.addBeziers=function(e){if(this.isCreatingMaster)return this.masterInstancer.addBeziers(e);if(!this.handleSink.addBeziers(e))return!1;if(this.pathBuilder.addBeziers(e),this.pathBounds){var t=this.pathBounds;e.forEach((function(e){return t.addPoint(e)}))}return!0},e.prototype.addEscape=function(e,t){if(this.isCreatingMaster&&101!==e)return this.masterInstancer.addEscape(e,t);if(!this.handleSink.addEscape(e,t))return!1;switch(e){case 100:this.masterInstancer.reset(),this.isCreatingMaster=!0;break;case 101:this.isCreatingMaster=!1;break;case 200:if("number"!=typeof t)return!1;this.pathBuilder.setDatapointIndex(t);break;case 201:this.pathBuilder.setDatapointIndex(void 0);break;case 102:this.masterInstancer.createInstance(this,t)}return!0},e.prototype.render=function(){this.renderElement(this.sceneGraph.getRoot())},e.prototype.getHandles=function(){return this.handles},e.prototype.getPathWidths=function(){return this.pathWidths},e.prototype.renderElement=function(e){var t=this;this.createAndPushGroup(e),this.renderGeometry(e),this.renderText(e),this.renderCustomData(e.getId(),e.getCustomData(),this.renderHost);var r=this.handleSink.getHandles();this.handleSink.reset(),r.length>0&&(this.handles[e.getId()]=r),e.getChildren().forEach((function(e){return t.renderElement(e)})),this.popGroup()},e.prototype.addPathToSvg=function(e){if(!this.formatObject)throw new Error("Missing format object.");var t=document.createElementNS(c.svgns,"path");t.setAttribute("d",e.data);var r=this.getTop();if(!r)throw new Error("Element stack should not be empty.");if(r.appendChild(t),null!==e.datapointIndex){var i=r.id;if(i){var n=p.getElementIdFromDomId(i);n&&"number"==typeof e.datapointIndex&&t.setAttribute("id",p.getDomIdFromElementId(n,e.datapointIndex))}}var s=this.formatObject.getClipRectIndex();s>=0&&t.setAttribute("clip-path","url(#"+this.clipRectStorage.getIdForIndex(s)+")"),this.stylePath(e,r,t)},e.prototype.stylePath=function(t,r,s){if(!this.formatObject)throw new Error("Missing format object.");var o=this.formatObject.getFill(),a=this.formatObject.getLineFill();if(t.filled||a){var l=[];if(t.filled?l.push({name:"fill",value:this.resolveFill(o)}):l.push({name:"fill",value:"none"}),a){var h=a,u=this.resolveFill(h);l.push({name:"stroke",value:""+u});var d=this.formatObject.getLineThickness(),p="number"==typeof d,f=p?d:1;p&&l.push({name:"stroke-width",value:f.toString()});var g=this.formatObject.getLineDashType(),y=this.formatObject.getLineCapType(),_=this.formatObject.getLineJoinType();if(g!==i.LineDashType.Solid){var v=n.createStrokeDashArray(g,f,y).toString();l.push({name:"stroke-dasharray",value:v})}l.push({name:"stroke-linecap",value:this.getStrokeLineCap(y)}),l.push({name:"stroke-linejoin",value:this.getStrokeJoinType(_)});var b=this.formatObject.getHeadEnd(),w=this.formatObject.getTailEnd();if(b.type!==i.LineEndType.None&&l.push({name:"marker-start",value:this.resolveLineEnd(b,u,f)}),w.type!==i.LineEndType.None&&l.push({name:"marker-end",value:this.resolveLineEnd(w,u,f)}),f<6&&!t.filled){var T=document.createElementNS(c.svgns,"path");T.setAttribute("class",m.hitTestingClassName),T.setAttribute("d",t.data),T.setAttribute("stroke","transparent"),T.setAttribute("fill","none"),T.setAttribute("stroke-width",6..toString());var x=this.formatObject.getClipRectIndex();x>=0&&T.setAttribute("clip-path","url(#"+this.clipRectStorage.getIdForIndex(x)+")"),r.appendChild(T)}if(!t.filled){var C="number"==typeof this.pathWidths[r.id]?this.pathWidths[r.id]:1;this.pathWidths[r.id]=Math.min(C,f)}}else l.push({name:"stroke",value:"none"});var S=this.svgStyle.ensureRule(l),P=t.filled?a?e.highContrastClassName:e.highContrastNoStrokeClassName:e.highContrastNoFillClassName;s.setAttribute("class",P+" "+S)}},e.prototype.getStrokeLineCap=function(e){switch(e){case i.LineCapType.Flat:return"butt";case i.LineCapType.Round:return"round";case i.LineCapType.Square:return"square";default:return"butt"}},e.prototype.getStrokeJoinType=function(e){switch(e){case i.LineJoinType.Round:return"round";case i.LineJoinType.Bevel:return"bevel";case i.LineJoinType.Miter:return"miter";default:return"round"}},e.prototype.resolveFill=function(e){if(i.isSolidFillFormat(e))return e.color;if(i.isGradientFillFormat(e)){var t=d.generateUniqueId();if(i.isLinearGradientShade(e.shade))this.gradientStorage.storeLinearGradient(e.shade,e.stops,t);else{if(!i.isRadialGradientShade(e.shade))throw new Error("Invalid IGradientFillFormat.");if(!this.pathBounds)throw new Error("Bounds required for radial gradient.");this.gradientStorage.storeRadialGradient(e.shade,e.stops,this.pathBounds.getBounds(),t)}return"url(#"+t+")"}if(i.isPatternFillFormat(e))return"url(#"+this.patternStorage.storePattern(e)+")";throw new Error("Invalid format.")},e.prototype.resolveLineEnd=function(e,t,r){var n=d.generateUniqueId();switch(e.type){case i.LineEndType.Triangle:this.lineEndStorage.storeTriangleLineEnd(e.width,e.length,t,n,r);break;case i.LineEndType.Stealth:this.lineEndStorage.storeStealthLineEnd(e.width,e.length,t,n,r);break;case i.LineEndType.Diamond:this.lineEndStorage.storeDiamondLineEnd(e.width,e.length,t,n,r);break;case i.LineEndType.Oval:this.lineEndStorage.storeOvalLineEnd(e.width,e.length,t,n,r);break;case i.LineEndType.Arrow:this.lineEndStorage.storeArrowLineEnd(e.width,e.length,t,n,r);break;default:throw new Error("'None' format line end.")}return"url(#"+n+")"},e.prototype.getTop=function(){return this.groupStack.length>0?this.groupStack[this.groupStack.length-1]:void 0},e.prototype.createAndPushGroup=function(e){var t=document.createElementNS(c.svgns,"g");t.setAttribute("id",p.getDomIdFromElementId(e.getId()));var r=this.getTop();r&&r.appendChild(t),this.groupStack.push(t)},e.prototype.popGroup=function(){this.groupStack.pop()},e.prototype.renderText=function(t){var r=this,i=t.getText();if(i){var n=this.getTop();if(!n)throw new Error("Element stack should not be empty.");var s=document.createElementNS(c.svgns,"g"),o=i.getLocation(),a="translate("+o.x+", "+o.y+")",l="rotate("+i.getAngle()+")";s.setAttribute("transform",a+" "+l);var h=0;i.getLines().forEach((function(t){if(0!==t.getHeight()){var n=document.createElementNS(c.svgns,"text");n.setAttribute("y",(h+t.getBaseline()).toString(10));var o=0;2===i.getTextAlignment()&&(o=i.getSize().width/2,n.setAttribute("text-anchor","middle")),n.setAttribute("x",o.toString(10)),t.getRuns().forEach((function(i,s){var o=document.createElementNS(c.svgns,"tspan");o.textContent=i.getText();var a=s===t.getRuns().length-1;t.isTrimmed()&&a&&(o.textContent+="…");var l=[{name:"font-family",value:i.getFaceName()},{name:"font-size",value:i.getPixelSize()+"px"},{name:"stroke",value:"none"},{name:"fill",value:i.getColor()},{name:"white-space",value:"pre"},{name:"font-weight",value:i.getWeight().toString()}];switch(i.getStyle()){case 0:l.push({name:"font-style",value:"normal"});break;case 2:l.push({name:"font-style",value:"italic"});break;case 1:l.push({name:"font-style",value:"oblique"})}var h=r.svgStyle.ensureRule(l);o.setAttribute("class",e.highContrastClassName+" "+h),n.appendChild(o)})),h+=t.getHeight(),s.appendChild(n)}})),n.appendChild(s)}},e.prototype.renderCustomData=function(e,t,r){if(t&&r){var i=this.getTop();if(!i)throw new Error("Element stack should not be empty.");var n=document.createElementNS(c.svgns,"g");n.setAttribute("class",g.customDataClassName),i.appendChild(n),r.renderCustomData(n,t)}},e.prototype.renderGeometry=function(e){e.enumerateGeometry(this)},e.prototype.shouldStartCollectingPathBounds=function(e){var t=e.getFill(),r=e.getLineFill();return!!(r&&i.isGradientFillFormat(r)&&i.isRadialGradientShade(r.shade))||!!(t&&i.isGradientFillFormat(t)&&i.isRadialGradientShade(t.shade))},e.chartRootClassName="MSChart-ChartRoot",e.highContrastClassName="MSChart-HighContrast",e.highContrastNoFillClassName="MSChart-HighContrastNoFill",e.highContrastNoStrokeClassName="MSChart-HighContrastNoStroke",e}();t.SvgSink=b},6256:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(1432),n=function(){function e(e){this.content="",this.rules=[],this.element=e}return e.prototype.addRule=function(e){var t=e.replace(/(\n|\s+)/g," ");t&&(this.content+=t),this.updateElement()},e.prototype.ensureRule=function(e){var t=this;e.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var r="";if(!this.rules.some((function(i){return!!t.areRulesEqual(i.properties,e)&&(r=i.className,!0)}))){var n="."+(r=i.generateUniqueId())+" {";e.forEach((function(e){n+=e.name+": "+e.value+";"})),n+="}",this.rules.push({className:r,properties:e}),this.addRule(n)}return r},e.prototype.areRulesEqual=function(e,t){return e.length===t.length&&e.every((function(e,r){return e.name===t[r].name&&e.value===t[r].value}))},e.prototype.updateElement=function(){this.element.textContent=this.content},e}();t.SvgStyle=n},2777:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(8282),n=r(9759),s=function(){function e(e){this.padding=10,this.x=0,this.y=0,this.offset=n.TooltipOffset.Above,this.rootElement=e,this.ensureTooltip()}return e.prototype.show=function(){this.updateRectangle(),this.tooltipGroup.setAttribute("visibility","visible")},e.prototype.hide=function(){this.tooltipGroup.setAttribute("visibility","hidden")},e.prototype.isVisible=function(){return"visible"===this.tooltipGroup.getAttribute("visibility")},e.prototype.setPosition=function(e,t){this.x=e,this.y=t;for(var r=this.tooltipText.getBoundingClientRect(),i=this.getOffsetDimensions(e,t,r.width,r.height),n=this.tooltipText.childNodes,s=0;s<n.length;++s)n[s].nodeType===Node.ELEMENT_NODE&&n[s].setAttribute("x",""+i[0]);this.tooltipText.setAttribute("y",""+i[1]),this.tooltipBorderRectangle.setAttribute("x",""+(i[0]-this.padding/2)),this.tooltipBorderRectangle.setAttribute("y",""+(i[1]-2*this.padding))},e.prototype.setOffset=function(e){this.offset!==e&&(this.offset=e,this.setPosition(this.x,this.y))},e.prototype.setHeader=function(e){this.tooltipTspan.textContent=e,this.tooltipTspan.setAttribute("x","0")},e.prototype.addPair=function(e,t){var r=e,n=document.createElementNS(i.svgns,"tspan");n.textContent=r,n.setAttribute("dy","17px"),n.setAttribute("x","0"),this.setStyle(n,a);var s=document.createElementNS(i.svgns,"tspan");s.textContent=t,s.setAttribute("dy","12px"),s.setAttribute("x","0"),this.setStyle(s,l),this.tooltipText.appendChild(n),this.tooltipText.appendChild(s)},e.prototype.removePairs=function(){for(var e=this.tooltipText.childElementCount;e>1;)this.tooltipText.removeChild(this.tooltipText.lastChild),e-=1},e.prototype.getRoot=function(){return this.rootElement},e.prototype.ensureTooltip=function(){this.tooltipGroup=document.createElementNS(i.svgns,"g"),this.tooltipGroup.setAttribute("visibility","hidden"),this.tooltipGroup.setAttribute("transform","translate(0,0) rotate(0)"),this.tooltipGroup.style.pointerEvents="none",this.tooltipBorderRectangle=document.createElementNS(i.svgns,"rect"),this.setStyle(this.tooltipBorderRectangle,c),this.tooltipGroup.appendChild(this.tooltipBorderRectangle),this.tooltipText=document.createElementNS(i.svgns,"text"),this.tooltipGroup.appendChild(this.tooltipText),this.tooltipTspan=document.createElementNS(i.svgns,"tspan"),this.setStyle(this.tooltipTspan,o),this.tooltipText.appendChild(this.tooltipTspan),this.rootElement.appendChild(this.tooltipGroup)},e.prototype.setStyle=function(e,t){var r="";t.forEach((function(e){r+=e.name+": "+e.value+";"})),e.setAttribute("style",""+r)},e.prototype.getOffsetDimensions=function(e,t,r,i){switch(this.offset){case n.TooltipOffset.Above:return[e-r/2,t-i+this.padding/2];case n.TooltipOffset.BelowRight:return[e+this.padding,t+i+1.5*this.padding];default:throw new Error("Invalid offset.")}},e.prototype.updateRectangle=function(){var e=this.tooltipText.getBoundingClientRect();this.tooltipBorderRectangle.setAttribute("width",""+(e.width+this.padding)),this.tooltipBorderRectangle.setAttribute("height",""+(e.height+this.padding/2))},e}();t.SvgTooltip=s;var o=[{name:"font-family",value:"Calibri"},{name:"font-size",value:"17px"},{name:"stroke",value:"none"},{name:"fill",value:"#000000"},{name:"white-space",value:"pre"},{name:"font-weight",value:"400"},{name:"font-style",value:"normal"}],a=[{name:"font-family",value:"Calibri"},{name:"font-size",value:"13px"},{name:"stroke",value:"none"},{name:"fill",value:"#000000"},{name:"white-space",value:"pre"},{name:"font-weight",value:"400"},{name:"font-style",value:"normal"}],l=[{name:"font-family",value:"Calibri"},{name:"font-size",value:"15px"},{name:"stroke",value:"none"},{name:"fill",value:"#000000"},{name:"white-space",value:"pre"},{name:"font-weight",value:"700"},{name:"font-style",value:"normal"}],c=[{name:"stroke",value:"black"},{name:"fill",value:"white"},{name:"fill-opacity",value:".93"},{name:"stroke-width",value:".5px"}]},6363:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.IvyRenderer||(t.IvyRenderer={}))[r.Image=0]="Image",r[r.Svg=1]="Svg",r[r.Canvas=2]="Canvas",r[r.JSON=3]="JSON"},1380:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};t.__esModule=!0,n(r(4122),t),n(r(3353),t),n(r(3584),t)},5751:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};t.__esModule=!0,t.Model=t.VisualModel=t.PropertyModel=t.TokenizedPropId=void 0;var o=s(r(4122)),a=function(){function e(){this.str={},this.double={},this.int={},this.bool={},this.color={},this.enum={}}return e.prototype.applyDiff=function(e,t){var r=this;if(e.r){var i=e.r;Object.keys(i).forEach((function(e){var t=o.getAttributeType(e,r.valueType);t&&r.removeAttribute(e,t)}))}if(t)switch(t){case o.UniformPropertyType.Str:this.valueType=o.PropAttributeType.Str;break;case o.UniformPropertyType.Double:this.valueType=o.PropAttributeType.Double;break;case o.UniformPropertyType.Int:case o.UniformPropertyType.Enum:this.valueType=o.PropAttributeType.Int;break;case o.UniformPropertyType.Bool:this.valueType=o.PropAttributeType.Bool;break;case o.UniformPropertyType.Color:this.valueType=o.PropAttributeType.Color;break;default:this.valueType=void 0}if(e.c){var n=e.c;Object.keys(n).forEach((function(e){var t=n[e],i=o.getAttributeType(e,r.valueType);i&&r.changeAttribute(e,i,t)}))}},e.prototype.changeAttribute=function(e,t,r){switch(t){case o.PropAttributeType.Str:this.str[e]=r;break;case o.PropAttributeType.Double:this.double[e]=r;break;case o.PropAttributeType.Int:this.int[e]=r;break;case o.PropAttributeType.Bool:this.bool[e]=r;break;case o.PropAttributeType.Color:this.color[e]=r;break;case o.PropAttributeType.EnumNamesToken:this.enum[e]=r;break;default:throw new Error("Unexpected PropAttributeType in changeAttribute")}},e.prototype.removeAttribute=function(e,t){switch(t){case o.PropAttributeType.Str:delete this.str[e];break;case o.PropAttributeType.Double:delete this.double[e];break;case o.PropAttributeType.Int:delete this.int[e];break;case o.PropAttributeType.Bool:delete this.bool[e];break;case o.PropAttributeType.Color:delete this.color[e];break;case o.PropAttributeType.EnumNamesToken:delete this.enum[e];break;default:throw new Error("Unexpected PropAttributeType in removeAttribute")}},e}(),l=function(){function e(e,t){void 0===t&&(t=void 0),this.nameToken=e,this.index=t}return e.prototype.equals=function(e){return this.nameToken===e.nameToken&&this.index===e.index},e}();t.TokenizedPropId=l;var c=function(){function e(e,t){this.attributes=new a,this.childNames=[],this.children=[],this.parent=0,this.type=o.UniformPropertyType.Object,this.owningVisual=e,this.token=t}return e.prototype.applyDiff=function(e){if(void 0!==e.t&&(this.type=e.t),void 0!==e.a&&this.attributes.applyDiff(e.a,e.t),void 0!==e.c){if(void 0!==e.cn)this.childNames=e.cn.map((function(e){return new l(e)}));else{if(void 0===e.cin)throw new Error("Error: PropertyModel.applyDiff: missing child names");this.childNames=[];for(var t=0;t<e.c.length;t++)this.childNames.push(new l(e.cin,t))}this.children=e.c}void 0!==e.p&&(this.parent=e.p)},e.prototype.getParent=function(){var e=this.owningVisual.getProp(this.parent);if(e!==this)return e},e.prototype.getIdOfChild=function(e){var t=this.children.indexOf(e);if(-1===t)throw new Error("getIdOfChild called with non-child");return this.childNames[t]},e.prototype.getChildById=function(e){for(var t=0;t<this.childNames.length;t++)if(e.equals(this.childNames[t]))return this.children[t];throw new Error("getChildById called with non-child")},e}();t.PropertyModel=c;var h=function(){function e(e){this.props={},this.owningModel=e}return e.prototype.applyDiff=function(e){var t=this;Object.keys(e.p).forEach((function(r){var i=e.p[r];if(i.r)delete t.props[r];else{var n=t.props[r];void 0===n&&(n=new c(t,parseInt(r)),t.props[r]=n),n.applyDiff(i)}}))},e.prototype.getProp=function(e){return this.props[e]},e.prototype.getTokenizedPropPath=function(e){for(var t=[],r=e;0!==r;){var i=this.getProp(r),n=i.parent;if(void 0===n)break;var s=this.getProp(n).getIdOfChild(r);t.push(s),r=i.parent}return t.slice().reverse()},e.prototype.getPropPath=function(e){var t=this.getTokenizedPropPath(e);return this.owningModel.detokenizePropPath(t)},e.prototype.tokenizedLookupProp=function(e,t){var r=this,i=e;return t.forEach((function(e){var t=r.getProp(i);i=t.getChildById(new l(e.nameToken,e.index))})),this.getProp(i)},e.prototype.lookupProp=function(e,t){var r=this.owningModel.tokenizePropPath(t);return this.tokenizedLookupProp(e,r)},e}();t.VisualModel=h;var u=function(){function e(){this.stringTable=[],this.reverseStringTable={},this.enumTable=[],this.visuals={}}return e.prototype.resetModelState=function(){this.version=void 0,this.stringTable=[],this.reverseStringTable={},this.enumTable=[],this.visuals={}},e.prototype.getVisual=function(e){var t=this.visuals[e];if(!t)throw new Error("Visual not found");return t},e.prototype.tokenizeString=function(e){return this.reverseStringTable[e]},e.prototype.detokenizeString=function(e){return this.stringTable[e]},e.prototype.detokenizeEnumTable=function(e){return this.enumTable[e]},e.prototype.tokenizeId=function(e){var t=function(e){for(var t,r,i=e.length-1;i>=0;i--)if(!((r=e.charAt(i))>="0"&&r<="9")){t=i;break}if(void 0===t)throw new Error("invalid property ID");if(t===e.length-1)return{name:e,index:void 0};var n=e.slice(void 0,t+1),s=e.slice(t+1);return{name:n,index:parseInt(s,10)}}(e),r=this.reverseStringTable[t.name];return new l(r,t.index)},e.prototype.detokenizeId=function(e){var t=this.stringTable[e.nameToken];return void 0!==e.index&&(t=t.concat(e.index.toString())),t},e.prototype.detokenizePropPath=function(e){var t,r=this,i="";return e.forEach((function(e){if(void 0===t)i=r.detokenizeId(e);else if(void 0!==e.index){if(t.nameToken!==e.nameToken)throw new Error("Malformed property path, collection content not under matching collection");i=i.concat(e.index.toString())}else i=i.concat("_",r.detokenizeId(e));t=e})),i},e.prototype.tokenizePropPath=function(e){var t=this,r=e.split("_");if(0==r.length)return[];""===r[0]&&(r=r.slice(1));var i=[];return r.forEach((function(e){var r=t.tokenizeId(e);void 0!==r.index&&i.push(new l(r.nameToken,void 0)),i.push(r)})),i},e.prototype.applyChange=function(e){var t=this;if(e.full&&this.resetModelState(),void 0!==this.version&&void 0!==e.ver&&this.version+1!==e.ver)throw new o.DesyncError("Version has de-synchronized.");this.version=e.ver;var r=e.s.s;if(r!==this.stringTable.length)throw new o.DesyncError("String table has de-synchronized.");e.s.v.forEach((function(e){t.stringTable[r]=e,t.reverseStringTable[e]=r,r++}));var i=e.e.s;if(i!==this.enumTable.length)throw new o.DesyncError("Enum table has de-synchronized.");e.e.v.forEach((function(e){t.enumTable[i]=e,i++})),this.applyVisualDiff(e.v)},e.prototype.applyVisualDiff=function(e){var t=this;Object.keys(e).forEach((function(r){var i=e[r];if(i.r)delete t.visuals[r];else{var n=t.visuals[r];void 0===n&&(n=new h(t),t.visuals[r]=n),n.applyDiff(i)}}))},e}();t.Model=u},4122:function(e,t){var r,i,n,s,o,a,l,c,h=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});t.__esModule=!0,t.DesyncError=t.UniformPropertyType=t.getAttributeType=t.EnumNamesTokenPropAttributeName=t.StringPropAttributeName=t.ValuePropAttributeName=t.IntPropAttributeName=t.BoolPropAttributeName=t.PropAttributeType=void 0,function(e){e.Str="Str",e.Double="Double",e.Int="Int",e.Bool="Bool",e.Color="Color",e.EnumNamesToken="EnumNamesToken"}(i=t.PropAttributeType||(t.PropAttributeType={})),function(e){e.WriteOnly="WO",e.ReadOnly="RO",e.HideEntireSubtreeUI="HESUI",e.HideMeButShowChildrenUI="HMBSCUI",e.ExpandableUI="EUI",e.NextPropOnSameLine="NPOSL",e.HideLabel="HL",e.ShowResetUI="SRUI",e.HasOwnExpandableSection="HOES",e.NextPropOnSameLineFOTP="NPOSLFOTP",e.ShowResetUIFOTP="SRUIFOTP",e.Untransferable="U",e.NotTriviallyUndoable="NTU",e.HasDefault="HDe",e.IsDefault="IDe"}(n=t.BoolPropAttributeName||(t.BoolPropAttributeName={})),function(e){e.Size="S",e.MinSize="MiS",e.MaxSize="MaS"}(s=t.IntPropAttributeName||(t.IntPropAttributeName={})),function(e){e.Value="V",e.Min="Mi",e.Max="Ma",e.StepSize="SS"}(o=t.ValuePropAttributeName||(t.ValuePropAttributeName={})),function(e){e.LocalizedName="LN"}(a=t.StringPropAttributeName||(t.StringPropAttributeName={})),function(e){e.EnumOptions="EO",e.EnumLocalizedOptions="ELO"}(l=t.EnumNamesTokenPropAttributeName||(t.EnumNamesTokenPropAttributeName={})),t.getAttributeType=function(e,t){switch(e){case n.WriteOnly:case n.ReadOnly:case n.HideEntireSubtreeUI:case n.HideMeButShowChildrenUI:case n.ExpandableUI:case n.NextPropOnSameLine:case n.HideLabel:case n.ShowResetUI:case n.HasOwnExpandableSection:case n.NextPropOnSameLineFOTP:case n.ShowResetUIFOTP:case n.Untransferable:case n.NotTriviallyUndoable:case n.HasDefault:case n.IsDefault:return i.Bool;case s.Size:case s.MinSize:case s.MaxSize:return i.Int;case o.Value:case o.Min:case o.Max:case o.StepSize:return t;case a.LocalizedName:return i.Str;case l.EnumOptions:case l.EnumLocalizedOptions:return i.EnumNamesToken}},(c=t.UniformPropertyType||(t.UniformPropertyType={}))[c.Object=0]="Object",c[c.Collection=1]="Collection",c[c.Str=2]="Str",c[c.Double=3]="Double",c[c.Int=4]="Int",c[c.Bool=5]="Bool",c[c.Enum=6]="Enum",c[c.Color=7]="Color",c[c.Count=8]="Count";var u=function(e){function t(r){var i=e.call(this,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return h(t,e),t}(Error);t.DesyncError=u},3584:function(e,t,r){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};t.__esModule=!0,t.getProperty=t.isEnumProperty=t.isColorProperty=t.isBoolProperty=t.isIntProperty=t.isDoubleProperty=t.isStringProperty=t.isCollectionProperty=t.isObjectProperty=t.EnumProperty=t.ColorProperty=t.BoolProperty=t.IntProperty=t.DoubleProperty=t.StringProperty=t.CollectionProperty=t.ObjectProperty=t.Property=void 0;var l=a(r(4122)),c=function(){function e(e){this.prop=e}return e.prototype.getType=function(){throw new Error("Undetermined property type")},e.prototype.getBoolAttribute=function(e){return this.prop.attributes.bool[e]},e.prototype.getStringAttribute=function(e){return this.prop.attributes.str[e]},e.prototype.getEnumNamesTokenAttribute=function(e){return this.prop.attributes.enum[e]},e}();t.Property=c;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Object},t.prototype.getProperty=function(e){var t=this.prop.owningVisual.lookupProp(this.prop.token,e);if(t)return v(t)},t.prototype.forEachChild=function(e){if(this.prop.childNames.length!==this.prop.children.length)throw new Error("name and children length mismatch");for(var t=0;t<this.prop.children.length;t++){var r=this.prop.childNames[t],i=this.prop.owningVisual.owningModel.detokenizeId(r),n=this.prop.children[t];e(i,v(this.prop.owningVisual.getProp(n)))}},t}(c);t.ObjectProperty=h;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Collection},t.prototype.length=function(){return this.prop.children.length},t.prototype.getAt=function(e){var t=this.prop.children[e],r=v(this.prop.owningVisual.getProp(t));if(!_(r))throw new Error("collection contains a non-object");return r},t.prototype.forEachChild=function(e){for(var t=0;t<this.prop.children.length;t++){var r=this.prop.children[t],i=v(this.prop.owningVisual.getProp(r));if(!_(i))throw new Error("collection contains a non-object");e(t,i)}},t}(c);t.CollectionProperty=u;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Str},t.prototype.getValueAttribute=function(e){return this.prop.attributes.str[e]},t}(c);t.StringProperty=d;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Double},t.prototype.getValueAttribute=function(e){return this.prop.attributes.double[e]},t}(c);t.DoubleProperty=p;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Int},t.prototype.getValueAttribute=function(e){return this.prop.attributes.int[e]},t}(c);t.IntProperty=f;var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Bool},t.prototype.getValueAttribute=function(e){return this.prop.attributes.bool[e]},t}(c);t.BoolProperty=g;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Color},t.prototype.getValueAttribute=function(e){return this.prop.attributes.color[e]},t}(c);t.ColorProperty=m;var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getType=function(){return l.UniformPropertyType.Enum},t.prototype.getValueAttribute=function(e){return this.prop.attributes.int[e]},t.prototype.getValueAsString=function(){var e=this.getValueAttribute(l.ValuePropAttributeName.Value);if(void 0!==e){var t=this.getEnumNamesTokenAttribute(l.EnumNamesTokenPropAttributeName.EnumOptions);if(void 0!==t){var r=this.prop.owningVisual.owningModel.detokenizeEnumTable(t)[e];return this.prop.owningVisual.owningModel.detokenizeString(r)}}},t.prototype.getLocalizedValue=function(){var e=this.getValueAttribute(l.ValuePropAttributeName.Value);if(void 0!==e){var t=this.getEnumNamesTokenAttribute(l.EnumNamesTokenPropAttributeName.EnumLocalizedOptions);if(void 0!==t){var r=this.prop.owningVisual.owningModel.detokenizeEnumTable(t)[e];return this.prop.owningVisual.owningModel.detokenizeString(r)}}},t}(c);function _(e){return e.getType()===l.UniformPropertyType.Object}function v(e){switch(e.type){case l.UniformPropertyType.Object:return new h(e);case l.UniformPropertyType.Collection:return new u(e);case l.UniformPropertyType.Str:return new d(e);case l.UniformPropertyType.Double:return new p(e);case l.UniformPropertyType.Int:return new f(e);case l.UniformPropertyType.Bool:return new g(e);case l.UniformPropertyType.Enum:return new y(e);case l.UniformPropertyType.Color:return new m(e)}throw new Error("Unexpected UniformPropertyType")}t.EnumProperty=y,t.isObjectProperty=_,t.isCollectionProperty=function(e){return e.getType()===l.UniformPropertyType.Collection},t.isStringProperty=function(e){return e.getType()===l.UniformPropertyType.Str},t.isDoubleProperty=function(e){return e.getType()===l.UniformPropertyType.Double},t.isIntProperty=function(e){return e.getType()===l.UniformPropertyType.Int},t.isBoolProperty=function(e){return e.getType()===l.UniformPropertyType.Bool},t.isColorProperty=function(e){return e.getType()===l.UniformPropertyType.Color},t.isEnumProperty=function(e){return e.getType()===l.UniformPropertyType.Enum},t.getProperty=v},3353:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};t.__esModule=!0,t.VisualsMirror=t.AlterTrackingResponseScope=t.Endpoint=t.VisualMirror=void 0;var o=s(r(5751)),a=s(r(3584)),l=function(){function e(e){this.model=e}return e.prototype.getRootProperty=function(){var t=a.getProperty(this.model.getProp(e.rootPropToken));if(a.isObjectProperty(t))return t;throw new Error("A visual's root property is always expected to be an object.")},e.rootPropToken=0,e}();t.VisualMirror=l;var c;t.Endpoint=function(){this.trackedVisualIDs=[],this.relevantAttributes=[]},function(e){e.Incremental="inc",e.Full="full"}(c=t.AlterTrackingResponseScope||(t.AlterTrackingResponseScope={}));var h=function(){this.v=[],this.a=[]},u=function(){this.g=[]},d=function(){function e(){this.model=new o.Model,this.endpoints={}}return e.prototype.createTrackingAlterationRequestJson=function(e){for(var t={},r=0,i=Object.keys(this.endpoints);r<i.length;r++)for(var n=i[r],s=0,o=this.endpoints[n].trackedVisualIDs;s<o.length;s++){var a=o[s],l=t[a];l?l.push(n):t[a]=[n]}for(var d={},p=0,f=Object.keys(t);p<f.length;p++){var g=f[p],m=t[g],y=m.join(),_=d[y];if(_)_.v.push(g);else{for(var v=new Set,b=0,w=m;b<w.length;b++)for(var T=w[b],x=0,C=this.endpoints[T].relevantAttributes;x<C.length;x++){var S=C[x];v.add(S)}var P=new h;P.v=[g],P.a=Array.from(v),d[y]=P}}var E=new u;return e===c.Full&&(E.s=e),E.g=Object.values(d),JSON.stringify(E)},e.prototype.updateModel=function(e){var t=JSON.parse(e);this.model.applyChange(t)},e.prototype.getVisualMirror=function(e){return new l(this.model.getVisual(e))},e}();t.VisualsMirror=d},3774:(e,t,r)=>{r.d(t,{J:()=>l,$:()=>a});var i=r(2661),n=r(4591);class s extends i.B{getGeometry(e){switch(e.type){case 0:const t=this.get(e.preset);if(void 0===t)throw new Error(`Unregistered geometry for type:${e.preset}`);return t;case 1:return e.custom;default:(0,n.t)(e)}}}var o=r(2489);const a=new s([]);function l(e,t){r.e(835).then(r.bind(r,5402)).then((r=>{(0,o.PN)(0,55e3,"Loaded GC2Video.js"),r.ensureSharedGeometriesRegistered(),r.setGeometry(e,t)})).catch((()=>{(0,o.H)(0,55e3,"Failed to load GC2Video.js")}))}},943:(e,t,r)=>{function i(e){if(null===e)return"";let t=e.toString().toUpperCase();return t.startsWith("{")||(t=`{${t}`),t.endsWith("}")||(t=`${t}}`),t}r.d(t,{n:()=>i})},5735:(e,t,r)=>{r.d(t,{D:()=>n});var i=r(1459);const n={p:[{s:[[0,"l","t"],[1,"r","t"],[1,"r","b"],[1,"l","b"],[5]]}],i:["l","t","r","b"],c:[[i.eh,"hc","t"],[i.PI,"l","vc"],[i._b,"hc","b"],[0,"r","vc"]],u:!0}},4874:(e,t,r)=>{r.d(t,{A:()=>i});class i{constructor(){this.extendedProperties=new Map}}},2489:(e,t,r)=>{r.d(t,{H:()=>o,KE:()=>a,MP:()=>s,PN:()=>l,WD:()=>n,_v:()=>c});let i={logOperation(e){},logTrace(e){}};function n(e){i=e}function s(e,t,r){i.logOperation({name:e,durationMs:t,props:r})}function o(e,t,r){i.logTrace({level:0,id:e,category:t,message:r})}function a(e,t,r){i.logTrace({level:1,id:e,category:t,message:r})}function l(e,t,r){i.logTrace({level:2,id:e,category:t,message:r})}function c(e,t,r){i.logTrace({level:3,id:e,category:t,message:r})}},3849:(e,t,r)=>{r.d(t,{C:()=>n,R:()=>s});let i={logVeto(){}};function n(e){i=e}function s(e,t,r){i.logVeto(e,t,r)}},6487:(e,t,r)=>{r.d(t,{LW:()=>s,Yr:()=>n});var i=r(1459);function n(e){return e*i.PI/180}function s(e){const t=e%360;return t<0?t+360:t}},1459:(e,t,r)=>{r.d(t,{AF:()=>p,KK:()=>u,PI:()=>i,W0:()=>d,_E:()=>o,_b:()=>l,av:()=>s,eh:()=>a,oP:()=>c,ql:()=>h,uo:()=>n});const i=Math.PI,n=2*Math.PI,s=n/3,o=3*Math.PI,a=1.5*Math.PI,l=Math.PI/2,c=Math.PI/3,h=Math.PI/4,u=Math.PI/6,d=Math.PI/12,p=12700},2661:(e,t,r)=>{r.d(t,{B:()=>i,o:()=>n});class i{constructor(e){this.registry=new Map(e)}register(e,t){return this.registry.set(e,t),this}get(e){return this.registry.get(e)}}class n extends i{constructor(e){super(e),this.values=new Set(e.map((e=>e[1])))}register(e,t){return super.register(e,t),this.values.add(t),this}[Symbol.iterator](){return this.values[Symbol.iterator]()}}},4814:(e,t,r)=>{r.d(t,{H:()=>a,_:()=>o});var i=r(2489),n=r(4874),s=r(3849);function o(e,t){throw(0,i.H)(0,e,t),new Error(`Error: ${t}, Category: ${e}`)}function a(e,t,r){const i=new n.A;throw i.extendedProperties.set("message",r),(0,s.R)(e,t,i),new Error(`Veto: ${e}, Error: ${t}`)}},4591:(e,t,r)=>{r.d(t,{t:()=>n});var i=r(4814);function n(e){(0,i._)(0,`Unreachable ${e}`)}}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var s=i[e]={exports:{}};return r[e].call(s.exports,s,s.exports,n),s.exports}n.m=r,n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"Gc2Video.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="@gc2/host-ppt:",n.l=(r,i,s,o)=>{if(e[r])e[r].push(i);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var u=c[h];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+s){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+s),a.src=r),e[r]=[i];var d=(t,i)=>{a.onerror=a.onload=null,clearTimeout(p);var n=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((e=>e(i))),t)return t(i)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={649:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var s=new Promise(((r,n)=>i=e[t]=[r,n]));r.push(i[2]=s);var o=n.p+n.u(t),a=new Error;n.l(o,(r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var s=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,i[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,s,[o,a,l]=r,c=0;if(o.some((t=>0!==e[t]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);l&&l(n)}for(t&&t(r);c<o.length;c++)s=o[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0},r=self.webpackChunk_gc2_host_ppt=self.webpackChunk_gc2_host_ppt||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s={};(()=>{let e;function t(){return e}var r;n.r(s),n.d(s,{pptGraphicFactoryGlobal:()=>uf}),function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Started=1]="Started",e[e.Succeeded=2]="Succeeded",e[e.Failed=3]="Failed"}(r||(r={}));class i{constructor(e){this.health=e}logKpiUsage(e,t,r,i){this.health.recordKpiUsage(e,t,i,r)}logKpiFailure(e,t,r,i,n){this.health.recordKpiFailure(e,t,r,i,n)}logKpiSuccess(e,t){this.health.recordKpiSuccess(e,t)}}class o{constructor(e){this.health=e}logVeto(e,t,r){r.extendedProperties.set("internalVetoName",e),this.health.recordQosError(t,["GraphicsExperienceDegraded"],!1,!1,!1,!1,r)}}class a{constructor(e){this.initializer=e}get value(){return void 0===this.instance&&(this.instance=this.initializer()),this.instance}get valid(){return void 0!==this.instance}}class l{constructor(){this.listeners=[]}on(e){this.listeners.push(e)}off(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}use(e){return this.on(e),()=>{this.off(e)}}emit(...e){this.listeners.forEach((t=>{t(...e)}))}}function c(){const e=()=>new l;return{pointerdown:new a(e),pointermove:new a(e),pointerup:new a(e),pointercancel:new a(e),pointerover:new a(e),pointerout:new a(e)}}var h=n(6487);class u{constructor(e,t){this.x=e,this.y=t}normalize(){const e=Math.sqrt(this.x*this.x+this.y*this.y);this.x=this.x/e,this.y=this.y/e}multiply(e){const t=this.x*e.m11+this.y*e.m21+e.m31,r=this.x*e.m12+this.y*e.m22+e.m32;this.x=t,this.y=r}add(e){return this.x+=e.x,this.y+=e.y,this}rotate(e,t=new u(0,0)){const r=(0,h.Yr)(e),i=Math.cos(r),n=Math.sin(r),s=this.x-t.x,o=this.y-t.y;this.x=s*i-o*n+t.x,this.y=s*n+o*i+t.y}transform(e){const t=new u(this.x,this.y);return t.multiply(e),t}}class d{constructor(e,t,r,i){this.left=e,this.top=t,this.right=r,this.bottom=i}width(){return this.right-this.left}height(){return this.bottom-this.top}isEmpty(){return 0===this.width()||0===this.height()}center(){return new u((this.left+this.right)/2,(this.top+this.bottom)/2)}clone(){return new d(this.left,this.top,this.right,this.bottom)}equals(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom}scale(e,t){this.left*=e,this.top*=t,this.right*=e,this.bottom*=t}}class p{constructor(e=!1,t=!1){this.x=e,this.y=t}clone(){return new p(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}}class f{constructor(e=0,t=0){this.x=e,this.y=t}clone(){return new f(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}multiply(e){const t=this.x*e.m11+this.y*e.m21+e.m31,r=this.x*e.m12+this.y*e.m22+e.m32;return this.x=t,this.y=r,this}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}scale(e,t){return this.x*=e,this.y*=t,this}set(e){return this.x=e.x,this.y=e.y,this}}class g{constructor(e=0,t=0){this.width=e,this.height=t}clone(){return new g(this.width,this.height)}equals(e){return this.width===e.width&&this.height===e.height}subtract(e){return this.width-=e.width,this.height-=e.height,this}scale(e,t){return this.width*=e,this.height*=t,this}}class m{constructor(e=new f,t=new g,r=new p,i=0){this.pos=e,this.size=t,this.flip=r,this.rot=i}clone(){return new m(this.pos.clone(),this.size.clone(),this.flip.clone(),this.rot)}equals(e){return this.pos.equals(e.pos)&&this.size.equals(e.size)&&this.flip.equals(e.flip)&&this.rot===e.rot}getCenter(){return new u(this.pos.x+this.size.width/2,this.pos.y+this.size.height/2)}}var y=n(4814);const _=function(e){if(void 0!==window.FinalizationRegistry)return new window.FinalizationRegistry((e=>{const t=`Failed to teardown TeardownTracker ${e}`;(0,y._)(0,t)}))}();class v{constructor(e){this._tornDown=!1,this.inFinalizationRegistry=!1,this.handlers=[],this.name=e}get tornDown(){return this._tornDown}onTeardown(e){this.handlers.push(e)}teardown(){this._tornDown;for(let e=this.handlers.length-1;e>=0;e-=1)this.handlers[e]();this.inFinalizationRegistry&&void 0!==_&&(_.unregister(this),this.inFinalizationRegistry=!1),this._tornDown=!0}}var b=n(2489);class w{constructor(e){this.props=new Map,this.name=e,this.id=w.opCount,w.opCount+=1,performance.mark(this.getStartMarker())}setProp(e,t){this.props.set(e,t.toString())}complete(){performance.mark(this.getEndMarker()),performance.measure(this.name,this.getStartMarker(),this.getEndMarker());const e=performance.getEntriesByName(this.name,"measure");e.length>0&&(0,b.MP)(this.name,e[e.length-1].duration,this.props.size>0?this.props:void 0),performance.clearMarks(this.getStartMarker()),performance.clearMarks(this.getEndMarker()),performance.clearMeasures(this.name)}getStartMarker(){return`${this.name}.${this.id}.Start`}getEndMarker(){return`${this.name}.${this.id}.End`}}w.opCount=0;const T=.001;class x{constructor(e,t){this.x=e,this.y=t}static Flip(e,t){return new x(e?-1:1,t?-1:1)}negate(){return new x(-this.x,-this.y)}inverse(){return new x(1/this.x,1/this.y)}normalized(){const e=this.length();return e?this.scale(1/e):void 0}abs(){return new x(Math.abs(this.x),Math.abs(this.y))}floor(){return new x(Math.floor(this.x),Math.floor(this.y))}ceil(){return new x(Math.ceil(this.x),Math.ceil(this.y))}sign(){return new x(this.x<0?-1:1,this.y<0?-1:1)}isZero(){return 0==this.x&&0==this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}static Distance(e,t){return e.subtract(t).length()}equals(e){return this.x==e.x&&this.y==e.y}equalsWithEpsilon(e,t=.001){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t}add(e){return new x(this.x+e.x,this.y+e.y)}subtract(e){return new x(this.x-e.x,this.y-e.y)}multiply(e){return new x(this.x*e.x,this.y*e.y)}divide(e){return new x(this.x/e.x,this.y/e.y)}dot(e){return this.x*e.x+this.y*e.y}scale(e){return new x(this.x*e,this.y*e)}rotate(e){return e?new x(this.x*Math.cos(e)-this.y*Math.sin(e),this.x*Math.sin(e)+this.y*Math.cos(e)):this}transformVector(e){return e.transformVector(this)}transformPoint(e){return e.transformPoint(this)}static InterpolateLinear(e,t,r){return e.add(t.subtract(e).scale(r))}static InterpolateQuadratic(e,t,r,i){return x.InterpolateLinear(x.InterpolateLinear(e,t,i),x.InterpolateLinear(t,r,i),i)}static QuadraticTangent(e,t,r,i){return x.InterpolateLinear(t,r,i).subtract(x.InterpolateLinear(e,t,i)).normalized()}static CalculateLineIntersection(e,t,r,i,n=.001){const s=(i.x-r.x)*(e.y-r.y)-(i.y-r.y)*(e.x-r.x),o=(i.y-r.y)*(t.x-e.x)-(i.x-r.x)*(t.y-e.y);if(Math.abs(o)>n)return x.InterpolateLinear(e,t,s/o)}static MeasureQuadraticLength(e,t,r){return F(e.x,e.y,t.x,t.y,r.x,r.y)}}x.Zero=new x(0,0),x.One=new x(1,1);class C{constructor(e,t,r){this.x=e,this.y=t,this.z=r}}C.Zero=new C(0,0,0),C.One=new C(1,1,1);class S{constructor(e,t,r,i,n,s,o,a,l){this.m=new Float32Array([e,t,r,i,n,s,o,a,l])}toMatrix3(){return this}isIdentity(){return this==S.Identity||this.equals(S.Identity)}multiply(e){const t=this.m,r=e.m;return new S(t[0]*r[0]+t[1]*r[3]+t[2]*r[6],t[0]*r[1]+t[1]*r[4]+t[2]*r[7],t[0]*r[2]+t[1]*r[5]+t[2]*r[8],t[3]*r[0]+t[4]*r[3]+t[5]*r[6],t[3]*r[1]+t[4]*r[4]+t[5]*r[7],t[3]*r[2]+t[4]*r[5]+t[5]*r[8],t[6]*r[0]+t[7]*r[3]+t[8]*r[6],t[6]*r[1]+t[7]*r[4]+t[8]*r[7],t[6]*r[2]+t[7]*r[5]+t[8]*r[8])}inverse(){const e=this.m,t=e[0]*e[4]-e[1]*e[3];return 0==t?void 0:new S(e[4]/t,-e[1]/t,0,-e[3]/t,e[0]/t,0,(e[3]*e[7]-e[4]*e[6])/t,(-e[0]*e[7]+e[1]*e[6])/t,1)}transformVector(e){return new x(e.x*this.m[0]+e.y*this.m[3],e.x*this.m[1]+e.y*this.m[4])}transformPoint(e){return new x(e.x*this.m[0]+e.y*this.m[3]+this.m[6],e.x*this.m[1]+e.y*this.m[4]+this.m[7])}isSimpleScaleTranslationOnly(){return 0==this.m[1]&&0==this.m[2]&&0==this.m[3]&&0==this.m[5]&&1==this.m[8]}getSimpleScale(){return new x(this.m[0],this.m[4])}getSimpleTranslation(){return new x(this.m[6],this.m[7])}equals(e){for(let t=0;t<9;t++)if(this.m[t]!=e.m[t])return!1;return!0}tryGetTransform(e){const t=this.transformVector(new x(1,0)),r=this.transformVector(new x(0,1));if(Math.abs(t.x*r.x+t.y*r.y)>T)return;const i=t.x*r.y-t.y*r.x>0?new x(t.length(),r.length()):new x(t.length(),-r.length()),n=t.y>0?Math.acos(t.x/i.x):-Math.acos(t.x/i.x),s=this.transformPoint(e.negate());return new P(e,i,n,s)}static Translation2D(e){return new S(1,0,0,0,1,0,e.x,e.y,1)}static Scale2D(e){return new S(e.x,0,0,0,e.y,0,0,0,1)}static ScaleTranslation2D(e,t){return new S(e.x,0,0,0,e.y,0,t.x,t.y,1)}static RotationZ(e){const t=Math.cos(e),r=Math.sin(e);return new S(t,r,0,-r,t,0,0,0,1)}static RotationAroundPoint(e,t){return new P(t.negate(),x.One,e,t).toMatrix3()}static FromTransforms(...e){if(0==e.length)return S.Identity;let t=e[0].toMatrix3();for(let r=1;r<e.length;r++)t=t.multiply(e[r].toMatrix3());return t}}S.Identity=new S(1,0,0,0,1,0,0,0,1);class P{constructor(e,t,r,i){this.preTranslation=e||x.Zero,this.scale=t||x.One,this.rotation=null!=r?r:0,this.translation=i||x.Zero}toMatrix3(){const e=Math.cos(this.rotation),t=Math.sin(this.rotation),r=this.scale.x*e,i=this.scale.x*t,n=this.scale.y*-t,s=this.scale.y*e;return new S(r,i,0,n,s,0,this.preTranslation.x*r+this.preTranslation.y*n+this.translation.x,this.preTranslation.y*s+this.preTranslation.x*i+this.translation.y,1)}isIdentity(){return this==P.Identity||this.equals(P.Identity)}toInverseMatrix3(){const e=Math.cos(-this.rotation),t=Math.sin(-this.rotation),r=e/this.scale.x,i=t/this.scale.y,n=-t/this.scale.x,s=e/this.scale.y;return new S(r,i,0,n,s,0,-this.translation.x*r-this.translation.y*n-this.preTranslation.x,-this.translation.y*s-this.translation.x*i-this.preTranslation.y,1)}transformVector(e){return e.multiply(this.scale).rotate(this.rotation)}transformPoint(e){return e.add(this.preTranslation).multiply(this.scale).rotate(this.rotation).add(this.translation)}applyScaleAndTranslationBefore(e,t){return new P(this.preTranslation.add(t).divide(e),this.scale.multiply(e),this.rotation,this.translation)}applyTranslationAfter(e){return new P(this.preTranslation,this.scale,this.rotation,this.translation.add(e))}equals(e){return this.preTranslation.equals(e.preTranslation)&&this.scale.equals(e.scale)&&this.rotation==e.rotation&&this.translation.equals(e.translation)}static fromScaleAndTranslation(e,t){return new P(void 0,e,void 0,t)}static fromTransformAndPretranslation(e,t){return new P(t,e.scale,e.rotation,e.translation)}static fromTransformAndScale(e,t){return new P(e.preTranslation,t,e.rotation,e.translation)}static fromTransformAndRotation(e,t){return new P(e.preTranslation,e.scale,t,e.translation)}static fromTransformAndTranslation(e,t){return new P(e.preTranslation,e.scale,e.rotation,t)}}P.Identity=new P;class E{constructor(e=0,t=0,r=0,i=0){this.left=e,this.top=t,this.right=r,this.bottom=i}static FromSize(e){return new E(0,0,e.x,e.y)}static FromSizeAndCenter(e,t){return new E(t.x-.5*e.x,t.y-.5*e.y,t.x+.5*e.x,t.y+.5*e.y)}static FromPoints(e,t){return new E(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.max(e.x,t.x),Math.max(e.y,t.y))}isEmpty(){return this.left==this.right&&this.top==this.bottom}isValid(){return this.left<=this.right&&this.top<=this.bottom}get width(){return this.right-this.left}get height(){return this.bottom-this.top}get size(){return new x(this.right-this.left,this.bottom-this.top)}get center(){return new x((this.left+this.right)/2,(this.top+this.bottom)/2)}get leftTop(){return new x(this.left,this.top)}get rightBottom(){return new x(this.right,this.bottom)}isPointInRect(e){return this.left<=e.x&&e.x<=this.right&&this.top<=e.y&&e.y<=this.bottom}equals(e){return this.left==e.left&&this.top==e.top&&this.right==e.right&&this.bottom==e.bottom}inflate(e){return new E(this.left-e,this.top-e,this.right+e,this.bottom+e)}inflateToInteger(){return new E(Math.floor(this.left),Math.floor(this.top),Math.ceil(this.right),Math.ceil(this.bottom))}multiply(e){return E.FromPoints(this.leftTop.multiply(e),this.rightBottom.multiply(e))}divide(e){return E.FromPoints(this.leftTop.divide(e),this.rightBottom.divide(e))}translate(e){return new E(this.left+e.x,this.top+e.y,this.right+e.x,this.bottom+e.y)}transformedBounds(e){let t,r=[new x(this.left,this.top),new x(this.right,this.top),new x(this.right,this.bottom),new x(this.left,this.bottom)];for(let i=0;i<4;i++)t=E.UnionPoint(t,r[i].transformPoint(e));return t}static UnionPoint(e,t){return e&&e.isValid()?new E(Math.min(e.left,t.x),Math.min(e.top,t.y),Math.max(e.right,t.x),Math.max(e.bottom,t.y)):new E(t.x,t.y,t.x,t.y)}static UnionRect(e,t){return e&&t&&e.isValid()&&t.isValid()?new E(Math.min(e.left,t.left),Math.min(e.top,t.top),Math.max(e.right,t.right),Math.max(e.bottom,t.bottom)):e&&e.isValid()?e:t&&t.isValid()?t:void 0}static IntersectRect(e,t){if(e&&t&&e.isValid()&&t.isValid()){const r=new E(Math.max(e.left,t.left),Math.max(e.top,t.top),Math.min(e.right,t.right),Math.min(e.bottom,t.bottom));return r.isValid()?r:void 0}}static SegmentBounds(e,t){return new E(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.max(e.x,t.x),Math.max(e.y,t.y))}static QuadraticBezierBounds(e,t,r){let i;i=E.SegmentBounds(e,r);const n=(e.x-t.x)/(e.x+r.x-2*t.x);0<n&&n<1&&(i=E.UnionPoint(i,x.InterpolateQuadratic(e,t,r,n)));const s=(e.y-t.y)/(e.y+r.y-2*t.y);return 0<s&&s<1&&(i=E.UnionPoint(i,x.InterpolateQuadratic(e,t,r,s))),i}static InterpolateLinear(e,t,r){return new E(I(e.left,t.left,r),I(e.top,t.top,r),I(e.right,t.right,r),I(e.bottom,t.bottom,r))}}E.Zero=new E(0,0,0,0);class M{constructor(e,t,r,i){this.xMin=e,this.yMin=t,this.xMax=r,this.yMax=i}equals(e){return this.xMin===e.xMin&&this.yMin===e.yMin&&this.xMax===e.xMax&&this.yMax===e.yMax}clip(e){const t=new E(void 0===this.xMin?e.left:this.xMin,void 0===this.yMin?e.top:this.yMin,void 0===this.xMax?e.right:this.xMax,void 0===this.yMax?e.bottom:this.yMax);return E.IntersectRect(e,t)}static CreateFromRect(e){return new M(e.left,e.top,e.right,e.bottom)}}function R(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function A(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))}function B(e,t,r){return Math.min(r,Math.max(t,e))}function I(e,t,r){return e+(t-e)*r}function F(e,t,r,i,n,s){const o=n-e,a=s-t;if(Math.abs(o*(i-t)-a*(r-e))<T)return Math.sqrt(o*o+a*a);const l=n-2*r+e,c=s-2*i+t,h=2*r-2*n,u=2*i-2*s,d=4*(l*l+c*c),p=4*(l*h+c*u),f=h*h+u*u,g=2*Math.sqrt(d+p+f),m=Math.sqrt(d),y=2*Math.sqrt(f),_=p/m;return(m*(2*d*g+p*(g-y))+(4*f*d-p*p)*Math.log((2*m+_+g)/(_+y)))/(8*d*m)}function D(e,t){return e==t||null!=e&&null!=t&&e.equals(t)}class L{static Error(e,t){return L.s_logger.sendTraceTag(e,306,10,t),new Error(t+" "+e)}static Message(e,t){L.s_logger.sendTraceTag(e,306,50,t)}static setLogger(e){e&&(L.s_logger=e)}}L.s_logger={sendTraceTag:(e,t,r,i)=>{console.log(e,i)},shipAssertTag:()=>{},debugAssertTag:()=>{}};const k="undefined"!=typeof FinalizationRegistry?new FinalizationRegistry((e=>{const t=e;for(let e in t)t[e].onFinalization()})):void 0;class O{constructor(e,t){if(e instanceof O)this.m_sharedPathStorage=e.m_sharedPathStorage,this.m_transform=t||e.transform;else{const r=[];for(const t of e.figures)r.push(t instanceof G?t.createFigure():t);this.m_sharedPathStorage={figures:r,fillMode:null==e.fillMode?1:e.fillMode,lineEnabled:null==e.lineEnabled||e.lineEnabled,extrusionEnabled:null==e.extrusionEnabled||e.extrusionEnabled,glyphCacheId:e.glyphCacheId?{fontId:e.glyphCacheId.fontId,glyphId:e.glyphCacheId.glyphId}:void 0,isUntransformedRect:W(r),untransformedBounds:H(r),renderDataMap:{}},this.m_transform=t||(e.transform?e.transform:P.Identity)}null==k||k.register(this,this.renderDataMap)}static CreateFromFigure(e){return new O({figures:[e]})}static CreateFromRect(e){return new O({figures:[V.CreateFromRect(e)]})}get figures(){return this.m_sharedPathStorage.figures}get transform(){return this.m_transform}get fillMode(){return this.m_sharedPathStorage.fillMode}get lineEnabled(){return this.m_sharedPathStorage.lineEnabled}get extrusionEnabled(){return this.m_sharedPathStorage.extrusionEnabled}get glyphCacheId(){return this.m_sharedPathStorage.glyphCacheId}get maxPressure(){return 4096}get renderDataMap(){return this.m_sharedPathStorage.renderDataMap}get hasPressureInfo(){return this.figures.some((e=>!!(8&e.format)))}get isUntransformedRect(){return this.m_sharedPathStorage.isUntransformedRect}get untransformedBounds(){return this.m_sharedPathStorage.untransformedBounds}measureLength(e=P.Identity){let t=0;for(const r of this.figures)t+=r.measureLength(e);return t}equals(e){return this.m_sharedPathStorage==e.m_sharedPathStorage&&this.m_transform.equals(e.m_transform)}}const U=.1;function N(e){let t=(1&e?2:0)+(2&e?1:0)+(4&e?1:0)+(8&e?1:0)+(16&e?2:0);return 32&e&&(t=4*Math.ceil(t/4)),t}class V{constructor(e,t=!1,r=3){if(this.m_points=e,this.m_isClosed=t,this.m_format=r,this.m_pointDataSize=N(r),this.m_points.length%this.m_pointDataSize!=0)throw L.Error(592520776,"list of points invalid")}static CreateFromRect(e){return new V([e.left,e.top,1,e.right,e.top,1,e.right,e.bottom,1,e.left,e.bottom,1],!0)}static CreateFromRoundedRect(e,t){const r=Math.min(t,Math.min(e.width,e.height)/2),i=new G;return i.moveTo(e.center.x-e.width/2,e.center.y-(e.height/2-r)),i.arcTo(r,r,-Math.PI,Math.PI/2),i.lineTo(e.right-r,e.top),i.arcTo(r,r,-Math.PI/2,Math.PI/2),i.lineTo(e.right,e.bottom-r),i.arcTo(r,r,0,Math.PI/2),i.lineTo(e.left+r,e.bottom),i.arcTo(r,r,Math.PI/2,Math.PI/2),i.lineTo(e.left,e.top+r),i.close(),i.createFigure()}get points(){return this.m_points}get format(){return this.m_format}get pointDataSize(){return this.m_pointDataSize}get isClosed(){return this.m_isClosed}isLastPointDuplicated(){return this.getPoint(0).equalsWithEpsilon(this.getPoint(-1),U)}getPointCount(){return this.m_points.length/this.m_pointDataSize}getPoint(e){const t=this.getPointCount(),r=e<0?e%t+t:e%t;return new x(this.m_points[r*this.m_pointDataSize],this.m_points[r*this.m_pointDataSize+1])}getPointType(e){if(!(2&this.m_format))return 1;const t=this.getPointCount(),r=e<0?e%t+t:e%t;return this.m_points[r*this.m_pointDataSize+2]}toPolygon(){const e=this.getPointCount(),t=new G([],this.m_isClosed,1);for(let r=0;r<e;r++){const e=this.getPoint(r);if(2!=this.getPointType(r))t.pushPoint(e.x,e.y);else{const i=this.getPoint(r-1),n=this.getPoint(r+1),s=8;for(let r=1;r<s;r++){const o=x.InterpolateQuadratic(i,e,n,r/s);t.pushPoint(o.x,o.y)}}}return t.createFigure()}measureLength(e=P.Identity){let t=0;return this.forEachSegment(((e,r,i)=>(t+=r?x.MeasureQuadraticLength(e,r,i):x.Distance(e,i),!0)),e),t}getPointFromDist(e,t=P.Identity,r=!1){let i,n=0;return this.forEachSegment(((t,r,s)=>{const o=r?x.MeasureQuadraticLength(t,r,s):x.Distance(t,s);if(n+o>e){const a=(e-n)/o;i=r?x.InterpolateQuadratic(t,r,s,a):x.InterpolateLinear(t,s,a)}return n+=o,n<=e}),t,r),i||this.getPoint(r?0:this.getPointCount()-1).transformPoint(t)}getTangentFromDist(e,t=P.Identity,r=!1){let i=0,n=x.Zero;return this.forEachSegment(((t,r,s)=>{const o=r?x.MeasureQuadraticLength(t,r,s):x.Distance(t,s);return n=r?x.QuadraticTangent(t,r,s,(e-i)/o):s.subtract(t).scale(1/o),i+=o,i<e}),t,r),n}forEachSegment(e,t=P.Identity,r=!1){const i=this.getPointCount(),n=r?0:i-1,s=r?-1:1;for(let o=r?i-1:0;o!=n;o+=s){const r=o+s,n=r+s,a=2==this.getPointType(r);if(2!=this.getPointType(o)&&(this.m_isClosed||r==r%i)&&(!a||this.m_isClosed||n==n%i)&&!e(this.getPoint(o).transformPoint(t),a?this.getPoint(r).transformPoint(t):void 0,this.getPoint(a?n:r).transformPoint(t)))return}}}class G{constructor(e=[],t=!1,r=3){if(this._points=e,this.isClosed=t,this.format=r,this.pointDataSize=N(r),this.lastPointX=0,this.lastPointY=0,this._points.length%this.pointDataSize!=0)throw L.Error(592520777,"list of points invalid")}createFigure(){return new V(this._points,this.isClosed,this.format)}pushPoint(e,t,r=1,i){switch(this.lastPointX=e,this.lastPointY=t,this.pointDataSize){case 2:return void this._points.push(e,t);case 3:return void this._points.push(e,t,r);case 4:return void this._points.push(e,t,r,i?i[0]:0);case 5:return void this._points.push(e,t,r,i?i[0]:0,i?i[1]:0);case 6:return void this._points.push(e,t,r,i?i[0]:0,i?i[1]:0,i?i[2]:0);case 7:return void this._points.push(e,t,r,i?i[0]:0,i?i[1]:0,i?i[2]:0,i?i[3]:0)}throw L.Error(592520778,"Unsupported data size")}moveTo(e,t,r){if(0!=this._points.length)throw L.Error(592520779,"Figures should have only one MoveTo");this.pushPoint(e,t,1,r)}moveToPoint(e,t){this.moveTo(e.x,e.y,t)}lineTo(e,t,r){if(this._points.length<this.pointDataSize)throw L.Error(592520780,"All figures should start with a MoveTo");(Math.abs(e-this.lastPointX)>U||Math.abs(t-this.lastPointY)>U)&&this.pushPoint(e,t,1,r)}lineToPoint(e,t){this.lineTo(e.x,e.y,t)}quadBezierTo(e,t,r,i,n){if(this._points.length<this.pointDataSize)throw L.Error(592520781,"All figures should start with a MoveTo");const s=this.lastPointX,o=this.lastPointY;if(Math.abs(r-s)>U||Math.abs(i-o)>U){const a=Math.sqrt((e-s)*(e-s)+(t-o)*(t-o)),l=Math.sqrt((r-e)*(r-e)+(i-t)*(i-t)),c=Math.abs(e-s)<U&&Math.abs(t-o)<U,h=Math.abs(r-e)<U&&Math.abs(i-t)<U;!c&&!h&&Math.abs(a/l)>U&&Math.abs(l/a)>U?(this.pushPoint(e,t,2),this.pushPoint(r,i,1,n)):this.pushPoint(r,i,1,n)}}quadBezierToPoint(e,t,r){this.quadBezierTo(e.x,e.y,t.x,t.y,r)}cubicBezierTo(e,t,r,i,n,s){this.cubicBezierToPoint(new x(e,t),new x(r,i),new x(n,s))}cubicBezierToPoint(e,t,r){if(this._points.length<this.pointDataSize)throw L.Error(592520782,"All figures should start with a MoveTo");const i=new x(this.lastPointX,this.lastPointY),n=Math.abs(e.x-i.x)<U&&Math.abs(e.y-i.y)<U,s=Math.abs(t.x-e.x)<U&&Math.abs(t.y-e.y)<U,o=Math.abs(r.x-t.x)<U&&Math.abs(r.y-t.y)<U;if(s&&(n||o))n!=o&&this.lineToPoint(r);else{const n=4;let s=i,o=i,a=e;for(let l=0;l<n;l++){const c=(l+1)/n,h=x.InterpolateQuadratic(i,e,t,c),u=x.InterpolateQuadratic(e,t,r,c),d=x.InterpolateLinear(h,u,c),p=a.subtract(o).normalized(),f=u.subtract(h).normalized();let g;if(p&&f&&Math.abs(p.dot(f))<Math.sqrt(2)/2)g=x.CalculateLineIntersection(o,a,h,u,T);else{const o=(l+.5)/n,a=x.InterpolateLinear(x.InterpolateQuadratic(i,e,t,o),x.InterpolateQuadratic(e,t,r,o),o),c=s.add(d).scale(.5);g=c.add(a.subtract(c).scale(2))}g?this.quadBezierTo(g.x,g.y,d.x,d.y):this.lineTo(d.x,d.y),s=d,o=h,a=u}}}arcTo(e,t,r,i){if(this._points.length<this.pointDataSize)throw L.Error(592520783,"All figures should start with a MoveTo");const n=2*Math.PI,s=e<T||t<T,o=s?r:Math.atan2(e*Math.sin(r),t*Math.cos(r)),a=i<0?-1:1;let l=Math.abs(i);if(l>=n)l=n;else{let i=r+l*a;i=s?i:Math.atan2(e*Math.sin(i),t*Math.cos(i)),l=(i-o)*a,l<0&&(l+=n)}const c=this.lastPointX,h=this.lastPointY,u=c-Math.cos(o)*e,d=h-Math.sin(o)*t,p=Math.ceil(8*Math.abs(l)/n);for(let r=0;r<p;r++){const i=a*n/8,s=o+r*i,c=r==p-1?a*l-r*i:i,h=s+c,f=s+c/2,g=1/Math.cos(c/2),m=new x(u+Math.cos(f)*g*e,d+Math.sin(f)*g*t),y=new x(u+Math.cos(h)*e,d+Math.sin(h)*t);Math.abs(c)>T?this.quadBezierTo(m.x,m.y,y.x,y.y):this.lineTo(y.x,y.y)}}close(){if(this._points.length<this.pointDataSize)throw L.Error(592520784,"All figures should start with a MoveTo");this.isClosed=!0}isLastPointDuplicated(){return this.getPoint(0).equalsWithEpsilon(this.getPoint(-1),U)}getPointCount(){return this._points.length/this.pointDataSize}getPoint(e){const t=this.getPointCount(),r=e<0?e%t+t:e%t;return new x(this._points[r*this.pointDataSize],this._points[r*this.pointDataSize+1])}get data(){return this._points}}function z(e){const t="["+e.replace(/(M|L|Q|C|A|E|;)/g,(e=>"M"==e?"0":"L"==e?"1":"Q"==e?"2":"C"==e?"3":"A"==e?"4":"E"==e?"5":","))+"]",r=new Float32Array(JSON.parse(t)),i=[];let n,s=0;const o=2*Math.PI/216e5;for(;s<r.length;)switch(r[s++]){case 0:if(s+1>=r.length)throw L.Error(592520785,"Invalid LineTo");n&&i.push(n),n=new G,n.moveTo(r[s++],r[s++]);break;case 1:if(!n||s+1>=r.length)throw L.Error(592520786,"Invalid LineTo");n.lineTo(r[s++],r[s++]);break;case 2:if(!n||s+3>=r.length)throw L.Error(592520787,"Invalid MoveTo");n.quadBezierTo(r[s++],r[s++],r[s++],r[s++]);break;case 3:if(!n||s+5>=r.length)throw L.Error(592520788,"Invalid CubicBezierTo");n.cubicBezierTo(r[s++],r[s++],r[s++],r[s++],r[s++],r[s++]);break;case 4:if(!n||s+3>=r.length)throw L.Error(592520789,"Invalid Arc of ellipse");n.arcTo(r[s++],r[s++],r[s++]*o,r[s++]*o);break;case 5:if(!n)throw L.Error(592520790,"All paths should start with a MoveTo");n.close(),i.push(n),n=void 0}return n&&i.push(n),i}function H(e){let t;for(const r of e){if(!r.cachedBounds){const e=r.points.length/r.pointDataSize;if(e<1)return;let t=r.points[0],i=t,n=r.points[1],s=n;for(let o=0;o<e;o++){const a=o*r.pointDataSize,l=(o-1+e)%e*r.pointDataSize,c=(o+1)%e*r.pointDataSize;let h,u,d;2&r.format?(h=r.points[a+2],u=r.points[l+2],d=r.points[c+2]):h=u=d=1;const p=r.points[a],f=r.points[a+1];if(1==h&&1==d)t=p<t?p:t,i=p>i?p:i,n=f<n?f:n,s=f>s?f:s;else if(1==u&&2==h&&1==d){const e=r.points[l],o=r.points[l+1],a=r.points[c],h=r.points[c+1];t=e<t?e:t,i=e>i?e:i,n=o<n?o:n,s=o>s?o:s,t=a<t?a:t,i=a>i?a:i,n=h<n?h:n,s=h>s?h:s;const u=(e-p)/(e+a-2*p);if(0<u&&u<1){const r=u*u,l=e*(r-2*u+1)+a*r+2*p*(u-r),c=o*(r-2*u+1)+h*r+2*f*(u-r);t=l<t?l:t,i=l>i?l:i,n=c<n?c:n,s=c>s?c:s}const d=(o-f)/(o+h-2*f);if(0<d&&d<1){const r=d*d,l=e*(r-2*d+1)+a*r+2*p*(d-r),c=o*(r-2*d+1)+h*r+2*f*(d-r);t=l<t?l:t,i=l>i?l:i,n=c<n?c:n,s=c>s?c:s}}}r.cachedBounds=new E(t,n,i,s)}t=E.UnionRect(t,r.cachedBounds)}return t}function W(e){if(1!=e.length)return!1;const t=e[0];if((4!=t.getPointCount()||!t.isClosed||t.isLastPointDuplicated())&&(5!=t.getPointCount()||!t.isClosed||!t.isLastPointDuplicated()))return!1;const r=[t.getPoint(0),t.getPoint(1),t.getPoint(2),t.getPoint(3)],i=new E(Math.min(r[0].x,r[1].x,r[2].x,r[3].x),Math.min(r[0].y,r[1].y,r[2].y,r[3].y),Math.max(r[0].x,r[1].x,r[2].x,r[3].x),Math.max(r[0].y,r[1].y,r[2].y,r[3].y));for(let e=0;e<4;e++){const t=r[e],n=r[(e+1)%4];if(t.x!=i.left&&t.x!=i.right||t.y!=i.top&&t.y!=i.bottom||t.x!=n.x&&t.y!=n.y)return!1}return!0}function j(e,t){const r=new x(t*q(e.width,e.end),t*X(e.length,e.end));let i;if(1==e.end||5==e.end)i=new V([-.5*r.x,-1*r.y,1,0,0,1,.5*r.x,-1*r.y,1],1==e.end);else if(2==e.end)i=new V([-.5*r.x,-1*r.y,1,0,0,1,.5*r.x,-1*r.y,1,0,-.5*r.y,1],!0);else if(3==e.end)i=new V([0,.5*r.y,1,.5*r.x,0,1,0,-.5*r.y,1,-.5*r.x,0,1],!0);else if(4==e.end){const e=new G;e.moveTo(.5*r.x,0),e.arcTo(.5*r.x,.5*r.y,0,2*Math.PI),e.close(),i=e.createFigure()}return i||L.Error(572867280,"bad arrow head"),i}function q(e,t){return 0==e?5==t?2.5:2:1==e?5==t?3.5:3:2==e?5:(L.Error(572867281,"bad arrow head"),0)}function X(e,t){return 0==e?2:1==e?3:2==e?5==t?4.5:5:(L.Error(572867282,"bad arrow head"),0)}function $(e,t,r,i,n){const s=(3==r.end||4==r.end?.5:1)*X(r.length,r.end)*i,o=(t?e.getPoint(e.getPointCount()-1):e.getPoint(0)).transformPoint(n),a=e.getPointFromDist(s,n,t),l=o.subtract(a).normalized();if(!l)return;const c=new x(-l.y,l.x);return new S(c.x,c.y,0,l.x,l.y,0,0,0,1).multiply(S.Translation2D(o))}function K(e,t){return e?0==e.end||4==e.end||3==e.end?0:5==e.end||2==e.end?t*X(e.length,e.end)/q(e.width,e.end):2*t:0}function Y(e,t,r,i,n){if(0==r&&e.cachedBoundsContributor)return{points:e.cachedBoundsContributor.points,curves:e.cachedBoundsContributor.curves,transform:t};const s=0!=r,o={points:new Array,curves:new Array,transform:s?void 0:t},a=e.getPointCount();for(let l=0;l<a;l++){let a=e.getPoint(l-1),c=e.getPoint(l),h=e.getPoint(l+1);if(s&&(a=t.transformPoint(a),c=t.transformPoint(c),h=t.transformPoint(h)),2==e.getPointType(l))r?(o.curves.push([a.add(new x(-r,0)),c.add(new x(-r,0)),h.add(new x(-r,0))]),o.curves.push([a.add(new x(r,0)),c.add(new x(r,0)),h.add(new x(r,0))]),o.curves.push([a.add(new x(0,-r)),c.add(new x(0,-r)),h.add(new x(0,-r))]),o.curves.push([a.add(new x(0,r)),c.add(new x(0,r)),h.add(new x(0,r))])):o.curves.push([a,c,h]);else if(o.points.push(c),r)if(2==i)r?(o.points.push(c.add(new x(-r,0))),o.points.push(c.add(new x(r,0))),o.points.push(c.add(new x(0,-r))),o.points.push(c.add(new x(0,r)))):o.points.push(c);else{let e=c.subtract(a).normalized(),t=h.subtract(c).normalized();if(e&&t){e=e.scale(r),t=t.scale(r);let s=new x(-e.y,e.x),a=new x(-t.y,t.x);e.dot(a)<0&&(s=s.negate(),a=a.negate());const l=c.add(s),h=c.add(a);if(o.points.push(l),o.points.push(h),1==i||3==i){const s=x.CalculateLineIntersection(l,l.add(e),h,h.subtract(t));s&&(x.Distance(s,c)<n*r?o.points.push(s):1==i&&(o.points.push(l.add(e.scale(n))),o.points.push(h.subtract(t.scale(n)))))}}}}return 0!=r||e.cachedBoundsContributor||(e.cachedBoundsContributor={points:o.points,curves:o.curves,transform:void 0}),o}function J(e,t){let r=!0,i=0,n=0,s=0,o=0;const a=e.transform&&t?e.transform.multiply(t):t||e.transform,l=!a||a.isSimpleScaleTranslationOnly(),c=l?void 0:a,h=e.points,u=e.curves,d=h&&h.length>0?h[0]:u&&u.length>0?u[0][0]:void 0;if(d){let e=0,t=0,p=0,f=0,g=0,m=0;if(c&&(e=c.m[0],t=c.m[1],p=c.m[3],f=c.m[4],g=c.m[6],m=c.m[7]),r&&(i=c?d.x*e+d.y*p+g:d.x,s=c?d.x*t+d.y*f+m:d.y,n=i,o=s,r=!1),h&&h.length>0)for(let r=1;r<h.length;r++){const a=h[r],l=c?a.x*e+a.y*p+g:a.x,u=c?a.x*t+a.y*f+m:a.y;i=l<i?l:i,n=l>n?l:n,s=u<s?u:s,o=u>o?u:o}for(const r of u||[]){const a=r[0],l=r[1],h=r[2],u=c?a.x*e+a.y*p+g:a.x,d=c?a.x*t+a.y*f+m:a.y,y=c?l.x*e+l.y*p+g:l.x,_=c?l.x*t+l.y*f+m:l.y,v=c?h.x*e+h.y*p+g:h.x,b=c?h.x*t+h.y*f+m:h.y;i=u<i?u:i,n=u>n?u:n,s=d<s?d:s,o=d>o?d:o,i=v<i?v:i,n=v>n?v:n,s=b<s?b:s,o=b>o?b:o;const w=(u-y)/(u+v-2*y);if(0<w&&w<1){const e=w*w,t=u*(e-2*w+1)+v*e+2*y*(w-e),r=d*(e-2*w+1)+b*e+2*_*(w-e);i=t<i?t:i,n=t>n?t:n,s=r<s?r:s,o=r>o?r:o}const T=(d-_)/(d+b-2*_);if(0<T&&T<1){const e=T*T,t=u*(e-2*T+1)+v*e+2*y*(T-e),r=d*(e-2*T+1)+b*e+2*_*(T-e);i=t<i?t:i,n=t>n?t:n,s=r<s?r:s,o=r>o?r:o}}let y=new E(i,s,n,o);return l&&(y=a?y.multiply(a.getSimpleScale()).translate(a.getSimpleTranslation()):y),y}}function Z(e){let t;for(const r of e){if(0!=r.transform.rotation)return;const e=r.untransformedBounds;e&&(t=E.UnionRect(t,e.transformedBounds(r.transform)))}return t}let Q=1,ee=8,te=16,re=0;function ie(e,t){Q=e,ee=t}let ne=!0,se=!0,oe=!0,ae=0,le=!1;let ce=1040;class he{constructor(e,t=!1){this.m_changeTracker=new ue,this.deferTracking=t,this.m_changeTracker=new ue(t?this.getHash:void 0),this.m_elements=[],e&&(this.elements=e)}getHash(){return this.m_elements.map((e=>e.changeTracker.currentUniqueId)).join(",")}get changeTracker(){return this.m_changeTracker}get length(){return this.m_elements.length}get elements(){return this.m_elements}set elements(e){this.removeAll();for(let t of e)this.push(t)}getAt(e){if(e<0||e>=this.elements.length)throw L.Error(592520775,"Out of range");return this.m_elements[e]}setAt(e,t){this.deferTracking||(ue.RemoveListener(this.getAt(e).changeTracker,this.m_changeTracker),ue.AddListener(t.changeTracker,this.m_changeTracker)),this.m_elements[e]=t}push(e){this.deferTracking||ue.AddListener(e.changeTracker,this.m_changeTracker),this.m_elements.push(e)}insertAt(e,t){this.deferTracking||ue.AddListener(t.changeTracker,this.m_changeTracker),this.m_elements.splice(e,0,t)}removeAll(){if(!this.deferTracking)for(let e of this.m_elements)ue.RemoveListener(e.changeTracker,this.m_changeTracker);this.m_elements=[]}removeAt(e){this.deferTracking||ue.RemoveListener(this.getAt(e).changeTracker,this.m_changeTracker),this.m_elements.splice(e,1)}}class ue{constructor(e){this.trackerId=ue.s_nextUniqueId++,this.m_version=0,this.m_getDeferedHashFunction=e,this.m_currentUniqueId=this.trackerId+"v0",this.m_listeners=[]}get version(){return this.m_getDeferedHashFunction&&this.verifyDeferedHash(),this.m_version}get currentUniqueId(){return this.m_getDeferedHashFunction&&this.verifyDeferedHash(),this.m_currentUniqueId}get listenerCount(){var e,t;return(null===(e=this.m_weakListeners)||void 0===e?void 0:e.length)||(null===(t=this.m_listeners)||void 0===t?void 0:t.length)||0}verifyDeferedHash(){if(this.m_getDeferedHashFunction){const e=this.m_getDeferedHashFunction();e!=this.m_deferedHash&&(this.notifyChange(),this.m_deferedHash=e)}}notifyChange(){var e;if(this.m_version++,this.m_currentUniqueId=this.trackerId+"v"+this.m_version,this.m_weakListeners){this.m_weakListeners.length;this.m_weakListeners=this.m_weakListeners.filter((e=>null!=e.deref()));for(const t of this.m_weakListeners)null===(e=t.deref())||void 0===e||e.notifyChange()}else if(this.m_listeners)for(const e of this.m_listeners)e.notifyChange()}replaceListener(e,t){e!=t&&(e&&ue.RemoveListener(e.changeTracker,this),t&&ue.AddListener(t.changeTracker,this))}static AddListener(e,t){if(e)if(e.m_weakListeners){if(void 0===e.m_weakListeners.find((e=>e.deref()===t))){if("undefined"==typeof WeakRef)throw L.Error(525337749,"WeakRef not supported");e.m_weakListeners.push(new WeakRef(t)),t.notifyChange()}}else{if(!e.m_listeners)throw L.Error(525337750,"No dependency array");-1==e.m_listeners.indexOf(t)&&(e.m_listeners.push(t),t.notifyChange())}}static RemoveListener(e,t){if(e)if(e.m_weakListeners)e.m_weakListeners=e.m_weakListeners.filter((e=>e.deref()!=t)),t.notifyChange();else if(e.m_listeners){const r=e.m_listeners.indexOf(t);-1!=r&&(e.m_listeners.splice(r,1),t.notifyChange())}}}function de(e,t,r){t!=r&&e.notifyChange()}function pe(e,t,r){t==r||t&&r&&t.equals(r)||e.notifyChange()}function fe(e,t,r){if(t!=r)if(t&&r&&t.length==r.length){for(let i=0;i<t.length;i++)if(!t[i].equals(r[i]))return void e.notifyChange()}else e.notifyChange()}ue.s_nextUniqueId=1;class ge{constructor(e,t,r,i=1){this.r=e,this.g=t,this.b=r,this.a=i}equals(e){return this.r==e.r&&this.g==e.g&&this.b==e.b&&this.a==e.a}modulateOpacity(e){return new ge(this.r,this.g,this.b,this.a*e)}static Gray(e){return new ge(e,e,e,1)}static FromRGBA(e){return new ge(e.r,e.g,e.b,e.a)}static InterpolateLinear(e,t,r){return new ge(B(I(e.r,t.r,r),0,1),B(I(e.g,t.g,r),0,1),B(I(e.b,t.b,r),0,1),B(I(e.a,t.a,r),0,1))}}ge.Transparent=new ge(0,0,0,0),ge.Black=new ge(0,0,0,1),ge.White=new ge(1,1,1,1),ge.Red=new ge(1,0,0,1),ge.Orange=new ge(1,.5,0,1),ge.Yellow=new ge(1,1,0,1),ge.Green=new ge(0,1,0,1),ge.Cyan=new ge(0,1,1,1),ge.Blue=new ge(0,0,1,1),ge.Magenta=new ge(1,0,1,1);class me{constructor(){this.renderDataMap={},this.m_changeTracker=new ue}get changeTracker(){return this.m_changeTracker}get id(){return this.m_id}set id(e){this.m_id!=e&&(this.m_changeTracker.notifyChange(),this.m_id=e)}releaseGeneratedResources(){for(const e in this.renderDataMap)this.renderDataMap[e].releaseGeneratedResources()}}class ye{constructor(){this.m_changeTrackers={colorChangeTracker:new ue,alphaChangeTracker:new ue}}get changeTracker(){return this.m_changeTrackers.colorChangeTracker}get version(){return this.m_changeTrackers.colorChangeTracker.version}get alphaChangeTracker(){return this.m_changeTrackers.alphaChangeTracker}get rotateWithShape(){return!0}static IsGradient(e){return 2<=e&&e<=5}}class _e extends ye{constructor(e){super(),this.m_color=e}clone(){return new _e(this.m_color)}get color(){return this.m_color}set color(e){pe(this.changeTracker,this.m_color,e),de(this.alphaChangeTracker,this.m_color.a,e.a),this.m_color=e}getType(){return 1}}class ve{constructor(e,t){this.position=e,this.color=t}equals(e){return this.position==e.position&&this.color.equals(e.color)}}class be extends ye{constructor(e,t){super(),this.m_type=e,this.m_angle=0,this.m_fillFromRect=new E(0,0,1,1),this.m_fillToRect=new E(.5,.5,.5,.5),this.m_rotateWithShape=!0,this.m_isStretched=!1,this.m_shadeFromTitle=!1,this.m_gradientStops=t?t.slice(0):[],this.m_isGammaCorrected=!0,ue.AddListener(this.changeTracker,this.alphaChangeTracker)}clone(){const e=new be(this.m_type,this.m_gradientStops);return e.m_angle=this.m_angle,e.m_fillFromRect=this.m_fillFromRect,e.m_fillToRect=this.m_fillToRect,e.m_rotateWithShape=this.m_rotateWithShape,e.m_isStretched=this.m_isStretched,e.m_shadeFromTitle=this.m_shadeFromTitle,e.m_isGammaCorrected=this.m_isGammaCorrected,e}get gradientStops(){return this.m_gradientStops}get angle(){return this.m_angle}get fillFromRect(){return this.m_fillFromRect}get fillToRect(){return this.m_fillToRect}get isStretched(){return this.m_isStretched}get shadeFromTitle(){return this.m_shadeFromTitle}get rotateWithShape(){return 5==this.m_type||this.m_rotateWithShape}get isGammaCorrected(){return this.m_isGammaCorrected}get blendBellShape(){return this.m_blendBellShape}set gradientStops(e){fe(this.changeTracker,this.m_gradientStops,e),this.m_gradientStops=e.slice(0)}set angle(e){de(this.changeTracker,this.m_angle,e),this.m_angle=e}set fillFromRect(e){pe(this.changeTracker,this.m_fillFromRect,e),this.m_fillFromRect=e}set fillToRect(e){pe(this.changeTracker,this.m_fillToRect,e),this.m_fillToRect=e}set rotateWithShape(e){de(this.changeTracker,this.m_rotateWithShape,e),this.m_rotateWithShape=e}set isStretched(e){de(this.changeTracker,this.m_isStretched,e),this.m_isStretched=e}set shadeFromTitle(e){de(this.changeTracker,this.m_shadeFromTitle,e),this.m_shadeFromTitle=e}set isGammaCorrected(e){de(this.changeTracker,this.m_isGammaCorrected,e),this.m_isGammaCorrected=e}set blendBellShape(e){pe(this.changeTracker,this.m_blendBellShape,e),this.m_blendBellShape=e}getType(){return this.m_type}}class we extends ye{constructor(e,t){super(),this.m_fillToPreserveAspectRatio=!1,this.m_isAlphaInvariant=!!t,this.changeTracker.replaceListener(void 0,e),this.m_isAlphaInvariant||this.alphaChangeTracker.replaceListener(void 0,e),this.m_image=e,this.m_isStretched=!0,this.m_scale=x.One,this.m_offset=x.Zero,this.m_alignment=4,this.m_opacity=1,this.m_rotateWithShape=!0}clone(){const e=new we(this.m_image);return e.m_isStretched=this.m_isStretched,e.m_scale=this.m_scale,e.m_offset=this.m_offset,e.m_alignment=this.m_alignment,e.m_opacity=this.m_opacity,e.m_rotateWithShape=this.m_rotateWithShape,e}get image(){return this.m_image}get wrapMode(){return this.m_wrapMode}get isStretched(){return this.m_isStretched}get scale(){return this.m_scale}get offset(){return this.m_offset}get alignment(){return this.m_alignment}get opacity(){return this.m_opacity}get rotateWithShape(){return this.m_rotateWithShape}get pictureEffects(){return this.m_pictureEffects}get isAlphaInvariant(){return this.m_isAlphaInvariant}get fillToPreserveAspectRatio(){return this.m_fillToPreserveAspectRatio}set image(e){this.changeTracker.replaceListener(this.m_image,e),this.m_isAlphaInvariant||this.alphaChangeTracker.replaceListener(this.m_image,e),this.m_image=e}set wrapMode(e){de(this.changeTracker,this.m_wrapMode,e),de(this.alphaChangeTracker,this.m_wrapMode,e),this.m_wrapMode=e}set isStretched(e){de(this.changeTracker,this.m_isStretched,e),de(this.alphaChangeTracker,this.m_isStretched,e),this.m_isStretched=e}set scale(e){pe(this.changeTracker,this.m_scale,e),pe(this.alphaChangeTracker,this.m_scale,e),this.m_scale=e}set offset(e){pe(this.changeTracker,this.m_offset,e),pe(this.alphaChangeTracker,this.m_offset,e),this.m_offset=e}set alignment(e){de(this.changeTracker,this.m_alignment,e),de(this.alphaChangeTracker,this.m_alignment,e),this.m_alignment=e}set opacity(e){de(this.changeTracker,this.m_opacity,e),de(this.alphaChangeTracker,this.m_opacity,e),this.m_opacity=e}set rotateWithShape(e){de(this.changeTracker,this.m_rotateWithShape,e),de(this.alphaChangeTracker,this.m_rotateWithShape,e),this.m_rotateWithShape=e}set pictureEffects(e){this.m_pictureEffects!=e&&(this.changeTracker.replaceListener(this.m_pictureEffects,e),this.alphaChangeTracker.replaceListener(this.m_pictureEffects,e),this.m_pictureEffects=e)}set isAlphaInvariant(e){this.m_isAlphaInvariant!=e&&(e?this.alphaChangeTracker.replaceListener(this.m_image,void 0):this.alphaChangeTracker.replaceListener(void 0,this.m_image),this.m_isAlphaInvariant=e)}set fillToPreserveAspectRatio(e){de(this.changeTracker,this.m_fillToPreserveAspectRatio,e),de(this.alphaChangeTracker,this.m_fillToPreserveAspectRatio,e),this.m_fillToPreserveAspectRatio=e}getType(){return 6}}class Te extends ye{constructor(e,t,r){super(),this.m_pattern=e,this.m_foregroundColor=t,this.m_backgroundColor=r}clone(){return new Te(this.m_pattern,this.m_foregroundColor,this.m_backgroundColor)}get pattern(){return this.m_pattern}get foregroundColor(){return this.m_foregroundColor}get backgroundColor(){return this.m_backgroundColor}get rotateWithShape(){return!1}set pattern(e){de(this.changeTracker,this.m_pattern,e),de(this.alphaChangeTracker,this.m_pattern,e),this.m_pattern=e}set foregroundColor(e){pe(this.changeTracker,this.m_foregroundColor,e),de(this.changeTracker,this.m_foregroundColor.a,e.a),this.m_foregroundColor=e}set backgroundColor(e){pe(this.changeTracker,this.m_backgroundColor,e),de(this.changeTracker,this.m_backgroundColor.a,e.a),this.m_backgroundColor=e}getType(){return 7}}class xe{constructor(e,t,r,i,n){this.widthMin=e,this.end=t,this.cap=r,this.width=i,this.length=n}}class Ce{constructor(e=0,t=2,r=8){this.headEnd=new xe(0,0,0,1,1),this.tailEnd=new xe(0,0,0,1,1),this.m_changeTracker=new ue,this.m_lineWidth=e,this.m_lineJoin=t,this.m_miterLimit=r,this.m_dashType=0,this.m_compoundType=0,this.m_alignment=0,this.m_useRoundDash=!1}clone(){const e=new Ce(this.m_lineWidth);return e.m_lineJoin=this.m_lineJoin,e.m_miterLimit=this.m_miterLimit,e.m_dashType=this.m_dashType,e.m_compoundType=this.m_compoundType,e.m_alignment=this.m_alignment,e.m_useRoundDash=this.m_useRoundDash,e}get changeTracker(){return this.m_changeTracker}get version(){return this.m_changeTracker.version}get lineWidth(){return this.m_lineWidth?this.m_lineWidth:this.m_lineHeight?this.m_lineHeight:0}get adjustedLineWidth(){return Math.max(Q,this.lineWidth)}get adjustedLineWidthForArrowHead(){return Math.max(ee,this.lineWidth)}get lineHeight(){return this.m_lineHeight?this.m_lineHeight:this.m_lineWidth?this.m_lineWidth:0}get tipScale(){return this.m_lineWidth&&this.m_lineHeight?new x(1,this.m_lineHeight/this.m_lineWidth):x.One}get lineJoin(){return this.m_lineJoin}get miterLimit(){return this.m_miterLimit}get dashType(){return this.m_dashType}get useRoundDash(){return this.m_useRoundDash}get dashOffset(){return null==this.m_dashOffset?0:this.m_dashOffset}get compoundType(){return this.m_compoundType}get alignment(){return this.m_alignment}get tipType(){return null==this.m_tipType?0:this.m_tipType}set lineWidth(e){de(this.changeTracker,this.m_lineWidth,e),this.m_lineWidth=e}set lineHeight(e){de(this.changeTracker,this.m_lineHeight,e),this.m_lineHeight=e}set lineJoin(e){de(this.changeTracker,this.m_lineJoin,e),this.m_lineJoin=e}set miterLimit(e){de(this.changeTracker,this.m_miterLimit,e),this.m_miterLimit=e}set dashType(e){de(this.changeTracker,this.m_dashType,e),this.m_dashType=e}set useRoundDash(e){de(this.changeTracker,this.m_useRoundDash,e),this.m_useRoundDash=e}set dashOffset(e){de(this.changeTracker,this.m_dashOffset,e),this.m_dashOffset=e}set compoundType(e){de(this.changeTracker,this.m_compoundType,e),this.m_compoundType=e}set alignment(e){de(this.changeTracker,this.m_alignment,e),this.m_alignment=e}set tipType(e){de(this.changeTracker,this.m_tipType,e),this.m_tipType=e}}class Se{constructor(e,t,r=new Ce,i=0){this.m_changeTracker=new ue,this.m_alphaChangeTracker=new ue,this.m_penChangeTracker=new ue,this.m_fillChangeTrackers={colorChangeTracker:new ue,alphaChangeTracker:new ue},this.m_lineChangeTrackers={colorChangeTracker:new ue,alphaChangeTracker:new ue},this.m_pictureChangeTrackers={colorChangeTracker:new ue,alphaChangeTracker:new ue},ue.AddListener(this.m_fillChangeTrackers.colorChangeTracker,this.m_changeTracker),ue.AddListener(this.m_lineChangeTrackers.colorChangeTracker,this.m_changeTracker),ue.AddListener(this.m_pictureChangeTrackers.colorChangeTracker,this.m_changeTracker),ue.AddListener(this.m_fillChangeTrackers.alphaChangeTracker,this.m_alphaChangeTracker),ue.AddListener(this.m_lineChangeTrackers.alphaChangeTracker,this.m_alphaChangeTracker),ue.AddListener(this.m_pictureChangeTrackers.alphaChangeTracker,this.m_alphaChangeTracker),ue.AddListener(this.m_penChangeTracker,this.m_changeTracker),this.m_pen=r,this.fillBrush=e,this.lineBrush=t,this.m_blendingMode=i,this.m_penChangeTracker.replaceListener(void 0,r)}clone(){const e=new Se;return e.fillBrush=this.m_fillBrush?this.m_fillBrush.clone():void 0,e.lineBrush=this.m_lineBrush?this.m_lineBrush.clone():void 0,e.pictureBrush=this.m_pictureBrush?this.m_pictureBrush.clone():void 0,e.pictureEffects=this.m_pictureEffects?this.m_pictureEffects.clone():void 0,e.m_pictureOverflow=this.m_pictureOverflow,e.pen=this.m_pen.clone(),e.blendingMode=this.m_blendingMode,e.m_hitTransparentFill=this.m_hitTransparentFill,e}get changeTracker(){return this.m_changeTracker}get alphaChangeTracker(){return this.m_alphaChangeTracker}get penChangeTracker(){return this.m_penChangeTracker}get version(){return this.m_changeTracker.version}get fillBrush(){return this.m_fillBrush}get lineBrush(){return this.m_lineBrush}get pictureBrush(){return this.m_pictureBrush}get pictureEffects(){return this.m_pictureEffects}get pictureOverflow(){return this.m_pictureOverflow||0}get pen(){return this.m_pen}get hasLine(){return null!=this.m_lineBrush}get blendingMode(){return this.m_blendingMode}get hitTransparentFill(){return!!this.m_hitTransparentFill}set fillBrush(e){Pe(this.m_fillChangeTrackers.colorChangeTracker,this.m_fillChangeTrackers.alphaChangeTracker,this.m_fillBrush,e),this.m_fillBrush=e}set lineBrush(e){Pe(this.m_lineChangeTrackers.colorChangeTracker,this.m_lineChangeTrackers.alphaChangeTracker,this.m_lineBrush,e),this.m_lineBrush=e}set pictureBrush(e){Pe(this.m_pictureChangeTrackers.colorChangeTracker,this.m_pictureChangeTrackers.alphaChangeTracker,this.m_pictureBrush,e),this.m_pictureBrush=e}set pictureEffects(e){this.m_pictureEffects!=e&&(this.changeTracker.replaceListener(this.m_pictureEffects,e),this.m_pictureEffects=e)}set pictureOverflow(e){de(this.changeTracker,this.m_pictureOverflow,e),this.m_pictureOverflow=e}set pen(e){this.m_penChangeTracker.replaceListener(this.m_pen,e),this.m_pen=e}set blendingMode(e){de(this.changeTracker,this.m_blendingMode,e),this.m_blendingMode=e}set hitTransparentFill(e){de(this.changeTracker,this.m_hitTransparentFill,e),this.m_hitTransparentFill=e}getBrushImages(){const e=Ee(this.fillBrush);return e.push(...Ee(this.lineBrush)),e.push(...Ee(this.pictureBrush)),e}}function Pe(e,t,r,i){r!=i&&(r&&(ue.RemoveListener(r.changeTracker,e),ue.RemoveListener(r.alphaChangeTracker,t)),i&&(ue.AddListener(i.changeTracker,e),ue.AddListener(i.alphaChangeTracker,t)))}function Ee(e){const t=[];if(e&&6==e.getType()){const r=e;r.image&&t.push(r.image)}return t}class Me{constructor(e=ge.Transparent,t=0,r=!1){this.m_changeTracker=new ue,this.m_color=e,this.m_radius=t,this.m_isSharp=r}get changeTracker(){return this.m_changeTracker}get color(){return this.m_color}get radius(){return this.m_radius}get isSharp(){return this.m_isSharp}set color(e){pe(this.m_changeTracker,this.m_color,e),this.m_color=e}set radius(e){de(this.m_changeTracker,this.m_radius,e),this.m_radius=e}set isSharp(e){de(this.m_changeTracker,this.m_isSharp,e),this.m_isSharp=e}clone(){return new Me(this.m_color,this.m_radius,this.m_isSharp)}}class Re{constructor(e=ge.Transparent,t=0,r=0,i=0,n=x.One,s=x.Zero,o=4,a=!1,l=0){this.m_changeTracker=new ue,this.m_color=e,this.m_radius=t,this.m_angle=r,this.m_distance=i,this.m_scale=n,this.m_skew=s,this.m_alignment=o,this.m_rotateWithShape=a,this.m_shadowType=l}get changeTracker(){return this.m_changeTracker}get color(){return this.m_color}get radius(){return this.m_radius}get angle(){return this.m_angle}get distance(){return this.m_distance}get scale(){return this.m_scale}get skew(){return this.m_skew}get alignment(){return this.m_alignment}get rotateWithShape(){return this.m_rotateWithShape}get shadowType(){return this.m_shadowType}set color(e){pe(this.m_changeTracker,this.m_color,e),this.m_color=e}set radius(e){de(this.m_changeTracker,this.m_radius,e),this.m_radius=e}set angle(e){de(this.m_changeTracker,this.m_angle,e),this.m_angle=e}set distance(e){de(this.m_changeTracker,this.m_distance,e),this.m_distance=e}set scale(e){pe(this.m_changeTracker,this.m_scale,e),this.m_scale=e}set skew(e){pe(this.m_changeTracker,this.m_skew,e),this.m_skew=e}set alignment(e){de(this.m_changeTracker,this.m_alignment,e),this.m_alignment=e}set rotateWithShape(e){de(this.m_changeTracker,this.m_rotateWithShape,e),this.m_rotateWithShape=e}set shadowType(e){de(this.m_changeTracker,this.m_shadowType,e),this.m_shadowType=e}clone(){return new Re(this.m_color,this.m_radius,this.m_angle,this.m_distance,this.m_scale,this.m_skew,this.m_alignment,this.m_rotateWithShape,this.m_shadowType)}}class Ae{constructor(e=ge.Transparent,t=0,r=0,i=0){this.m_changeTracker=new ue,this.m_color=e,this.m_radius=t,this.m_angle=r,this.m_distance=i}get changeTracker(){return this.m_changeTracker}get color(){return this.m_color}get radius(){return this.m_radius}get angle(){return this.m_angle}get distance(){return this.m_distance}set color(e){pe(this.m_changeTracker,this.m_color,e),this.m_color=e}set radius(e){de(this.m_changeTracker,this.m_radius,e),this.m_radius=e}set angle(e){de(this.m_changeTracker,this.m_angle,e),this.m_angle=e}set distance(e){de(this.m_changeTracker,this.m_distance,e),this.m_distance=e}clone(){return new Ae(this.m_color,this.m_radius,this.m_angle,this.m_distance)}}class Be{constructor(e=0,t=1,r=0,i=0,n=1,s=0){this.m_changeTracker=new ue,this.m_radius=e,this.m_startAlpha=t,this.m_startPosition=r,this.m_endAlpha=i,this.m_endPosition=n,this.m_distance=s}get changeTracker(){return this.m_changeTracker}get radius(){return this.m_radius}get startAlpha(){return this.m_startAlpha}get startPosition(){return this.m_startPosition}get endAlpha(){return this.m_endAlpha}get endPosition(){return this.m_endPosition}get distance(){return this.m_distance}set radius(e){de(this.m_changeTracker,this.m_radius,e),this.m_radius=e}set startAlpha(e){de(this.m_changeTracker,this.m_startAlpha,e),this.m_startAlpha=e}set startPosition(e){de(this.m_changeTracker,this.m_startPosition,e),this.m_startPosition=e}set endAlpha(e){de(this.m_changeTracker,this.m_endAlpha,e),this.m_endAlpha=e}set endPosition(e){de(this.m_changeTracker,this.m_endPosition,e),this.m_endPosition=e}set distance(e){de(this.m_changeTracker,this.m_distance,e),this.m_distance=e}clone(){return new Be(this.m_radius,this.m_startAlpha,this.m_startPosition,this.m_endAlpha,this.m_endPosition,this.m_distance)}}class Ie{constructor(e=0){this.m_changeTracker=new ue,this.m_radius=e}get changeTracker(){return this.m_changeTracker}notifyChange(){this.m_changeTracker.notifyChange()}get radius(){return this.m_radius}set radius(e){this.m_radius!=e&&(this.notifyChange(),this.m_radius=e)}clone(){return new Ie(this.m_radius)}}class Fe{constructor(e,t,r,i,n){this.m_changeTracker=new ue,this.glow=e,this.shadow=t,this.innerShadow=r,this.reflection=i,this.softEdges=n}get changeTracker(){return this.m_changeTracker}notifyChange(){this.m_changeTracker.notifyChange()}get glow(){return this.m_glow}get shadow(){return this.m_shadow}get innerShadow(){return this.m_innerShadow}get reflection(){return this.m_reflection}get softEdges(){return this.m_softEdges}get direction(){return this.m_direction||0}get hasEffects(){return!!(this.m_glow||this.m_shadow||this.m_innerShadow||this.m_reflection||this.m_softEdges)}set glow(e){this.m_changeTracker.replaceListener(this.m_glow,e),this.m_glow=e}set shadow(e){this.m_changeTracker.replaceListener(this.m_shadow,e),this.m_shadow=e}set innerShadow(e){this.m_changeTracker.replaceListener(this.m_innerShadow,e),this.m_innerShadow=e}set reflection(e){this.m_changeTracker.replaceListener(this.m_reflection,e),this.m_reflection=e}set softEdges(e){this.m_changeTracker.replaceListener(this.m_softEdges,e),this.m_softEdges=e}set direction(e){de(this.m_changeTracker,this.m_direction,e),this.m_direction=e}clone(){return new Fe(this.m_glow?this.m_glow.clone():void 0,this.m_shadow?this.m_shadow.clone():void 0,this.m_innerShadow?this.m_innerShadow.clone():void 0,this.m_reflection?this.m_reflection.clone():void 0,this.m_softEdges?this.m_softEdges.clone():void 0)}}const De=256;class Le{constructor(e,t){this.start=e,this.length=t}get last(){return this.start+this.length-1}equals(e){return this.start==e.start&&this.length==e.length}includes(e){return e>=this.start&&e<=this.last}intersects(e){return this.start<=e.last&&this.last>=e.start}contains(e){return this.start<=e.start&&e.last<=this.last}getIntersection(e){const t=Le.FromFirstLast(Math.max(this.start,e.start),Math.min(this.last,e.last));return t.length>=0?t:void 0}move(e){return new Le(this.start+e,this.length)}static FromFirstLast(e,t){return new Le(e,t+1-e)}}class ke{constructor(e){this.m_defaultData=e}onDataChange(){}onRangeChange(){}onDataRemoved(e){}onDataAdded(e){}get defaultData(){return this.m_defaultData}get ranges(){const e=[];for(let t of this.m_dataPerRange||[])e.push(t.range);return e}get allData(){const e=[this.m_defaultData];for(let t of this.m_dataPerRange||[])e.push(t.data);return e}get dataPerRange(){return this.m_dataPerRange||[]}set defaultData(e){this.m_defaultData=e}set(e,t){if(this.onDataChange(),t){for(let r of this.m_dataPerRange||[])if(r.range.start==t.start&&r.range.last==t.last)return this.onDataRemoved(r.data),r.data=e,void this.onDataAdded(r.data);for(let e of this.m_dataPerRange||[])this.onDataRemoved(e.data);this.onRangeChange();const r=[];let i=!1;for(let n of this.m_dataPerRange||[])n.range.start<t.start&&r.push({range:Le.FromFirstLast(n.range.start,Math.min(n.range.last,t.start-1)),data:n.data}),t.last<n.range.last&&(i||(r.push({range:t,data:e}),i=!0),r.push({range:Le.FromFirstLast(Math.max(n.range.start,t.last+1),n.range.last),data:n.data}));i||r.push({range:t,data:e}),this.m_dataPerRange=r;for(let e of this.m_dataPerRange||[])this.onDataAdded(e.data)}else{for(let e of this.m_dataPerRange||[])this.onDataRemoved(e.data);this.m_defaultData=e,this.m_dataPerRange=void 0}}getAt(e){for(let t of this.m_dataPerRange||[])if(t.range.start<=e&&e<=t.range.last)return t.data;return this.m_defaultData}shiftIndices(e,t){if(this.m_dataPerRange){const r=[],i=t-e.length;for(let n of this.m_dataPerRange)if(e.contains(n.range)&&e.start!=n.range.start)this.onDataRemoved(n.data);else if(n.range.includes(e.start)){const i=Math.min(e.length,n.range.last+1-e.start);r.push({range:new Le(n.range.start,n.range.length+t-i),data:n.data})}else n.range.start<=e.last&&e.last<=n.range.last?r.push({range:Le.FromFirstLast(e.start+t,n.range.last+i),data:n.data}):e.last<n.range.start?r.push({range:n.range.move(i),data:n.data}):r.push(n);this.m_dataPerRange=r}}}class Oe extends ke{constructor(e){super(e),this.m_changeTracker=new ue,this.m_rangeChangeTracker=new ue,this.m_changeTracker.replaceListener(void 0,e)}get changeTracker(){return this.m_changeTracker}get rangeChangeTracker(){return this.m_rangeChangeTracker}onDataChange(){this.m_changeTracker.notifyChange()}onRangeChange(){this.rangeChangeTracker.notifyChange()}onDataRemoved(e){ue.RemoveListener(e.changeTracker,this.m_changeTracker)}onDataAdded(e){ue.AddListener(e.changeTracker,this.m_changeTracker)}}class Ue{constructor(e,t,r,i){this.m_changeTracker=new ue,this.m_type=e,this.m_verticalCenter=t,this.m_thickness=r,this.style=i}clone(){return new Ue(this.m_type,this.m_verticalCenter,this.m_thickness,this.m_style?this.m_style.clone():void 0)}get type(){return this.m_type}get verticalCenter(){return this.m_verticalCenter}get thickness(){return this.m_thickness}get style(){return this.m_style}get changeTracker(){return this.m_changeTracker}set type(e){de(this.changeTracker,this.m_type,e),this.m_type=e}set verticalCenter(e){de(this.changeTracker,this.m_verticalCenter,e),this.m_verticalCenter=e}set thickness(e){de(this.changeTracker,this.m_thickness,e),this.m_thickness=e}set style(e){this.changeTracker.replaceListener(this.m_style,e),this.m_style=e}}class Ne{constructor(e,t,r=!1){this.m_changeTracker=new ue,this.m_animationTransform=t,this.m_isHidden=r,this.fade=e}clone(){return new Ne(this.m_fade?this.m_fade.clone():void 0,this.m_animationTransform)}equals(e){return(this.m_fade==e.m_fade||null!=this.m_fade&&null!=e.m_fade&&this.m_fade.equals(e.m_fade))&&(this.m_animationTransform==e.m_animationTransform||null!=this.m_animationTransform&&null!=e.m_animationTransform&&this.m_animationTransform.equals(e.m_animationTransform))&&this.m_isHidden==e.m_isHidden}get fade(){return this.m_fade}get animationTransform(){return this.m_animationTransform}get isHidden(){return!!this.m_isHidden}get changeTracker(){return this.m_changeTracker}set fade(e){this.m_changeTracker.replaceListener(this.m_fade,e),this.m_fade=e}set animationTransform(e){pe(this.m_changeTracker,this.m_animationTransform,e),this.m_animationTransform=e}set isHidden(e){e!=this.isHidden&&(this.m_changeTracker.notifyChange(),this.m_isHidden=e)}}const Ve=new S(0,-1,0,1,0,0,0,0,1);class Ge{constructor(e,t,r,i,n,s){this.lineRect=e,this.path=t,this.alignment=r,this.scale=i,this.pivot=n,this.isVerticalLayout=s,this.pathLength=t.measureLength(),this.equivalentWarpingEnvelope=this.calculateEquivalentWarpingEnvelope()}equals(e){return this.lineRect.equals(e.lineRect)&&this.path==e.path&&this.alignment==e.alignment&&this.scale==e.scale&&this.pivot==e.pivot&&this.isVerticalLayout==e.isVerticalLayout}getPathPosition(e){const t=this.isVerticalLayout?e.transformedBounds(Ve):e,r=this.isVerticalLayout?this.lineRect.transformedBounds(Ve):this.lineRect;if(!t||!r)return;const i=r.width;let n=0;if(i*this.scale<this.pathLength){const e=this.pathLength-i*this.scale;n=this.alignment*(e/this.pathLength)}const s=(t.left-r.left)*this.scale/this.pathLength+n;return(s+(s+t.width/this.pathLength*this.scale))/2}getTransform(e){const t=this.getPathPosition(e),r=this.isVerticalLayout?e.transformedBounds(Ve):e;if(!t||!r)return;const i=B(t,0,1)*this.pathLength,n=this.path.getPointFromDist(i),s=this.path.getTangentFromDist(i);if(!s)return;const o=(r.left+r.right)/2,a=r.top+r.height*this.pivot;let l=S.Translation2D(new x(-o,-a));l=l.multiply(S.Scale2D(new x(this.scale,this.scale)));const c=s.x,h=s.y;return l=l.multiply(new S(c,h,0,-h,c,0,0,0,1)),l=l.multiply(S.Translation2D(n)),this.isVerticalLayout&&(l=Ve.multiply(l)),l}calculateEquivalentWarpingEnvelope(){const e=new G,t=new G,r=this.isVerticalLayout?0:this.lineRect.height/2,i=this.isVerticalLayout?this.lineRect.top:this.lineRect.left,n=this.isVerticalLayout?this.lineRect.bottom:this.lineRect.right;let s=this.lineRect;for(let o=0;o<=1;o+=.00390625){const a=i+(n-i)*o,l=this.isVerticalLayout?new E(this.lineRect.right,a-r,this.lineRect.left,a+r):new E(a-r,this.lineRect.top,a+r,this.lineRect.bottom),c=this.getPathPosition(l);if(null!=c&&c>=0&&c<=1){const i=a+(2*o-1)*r,n=this.getTransform(l);if(n){const r=n.transformPoint(this.isVerticalLayout?new x(l.left,i):new x(i,l.top)),o=n.transformPoint(this.isVerticalLayout?new x(l.right,i):new x(i,l.bottom));0==e.getPointCount()?(e.moveToPoint(r),t.moveToPoint(o),s=new E(this.isVerticalLayout?s.left:i,this.isVerticalLayout?i:s.top,s.right,s.bottom)):(e.lineToPoint(r),t.lineToPoint(o),s=new E(s.left,s.top,this.isVerticalLayout?s.right:i,this.isVerticalLayout?i:s.bottom))}}}return new He(s,e.createFigure(),t.createFigure(),this.isVerticalLayout)}}class ze{constructor(e){this.currentX=0,this.currentY=0,this.m_samplesX=new Float32Array(257),this.m_samplesY=new Float32Array(257);const t=e.measureLength();for(let r=0;r<=De;r++){const i=e.getPointFromDist(t*r/De);this.m_samplesX[r]=i.x,this.m_samplesY[r]=i.y}}moveTo(e){const t=Math.floor(e*De),r=Math.min(t+1,De),i=e*De-t;this.currentX=this.m_samplesX[t]*(1-i)+this.m_samplesX[r]*i,this.currentY=this.m_samplesY[t]*(1-i)+this.m_samplesY[r]*i}equals(e){for(let t=0;t<=De;t++)if(this.m_samplesX[t]!=e.m_samplesX[t]||this.m_samplesY[t]!=e.m_samplesY[t])return!1;return!0}}class He{constructor(e,t,r,i=!1){this.sourceRect=e,this.topPath=t,this.bottomPath=r,this.isVerticalLayout=i,this.topCurve=new ze(t),this.bottomCurve=new ze(r)}equals(e){return this.sourceRect.equals(e.sourceRect)&&this.topCurve.equals(e.topCurve)&&this.bottomCurve.equals(e.bottomCurve)&&this.isVerticalLayout==e.isVerticalLayout}warpPoint(e){const t=B(this.isVerticalLayout?(e.y-this.sourceRect.top)/this.sourceRect.height:(e.x-this.sourceRect.left)/this.sourceRect.width,0,1),r=B(this.isVerticalLayout?1-(e.x-this.sourceRect.left)/this.sourceRect.width:(e.y-this.sourceRect.top)/this.sourceRect.height,0,1);return this.topCurve.moveTo(t),this.bottomCurve.moveTo(t),new x(I(this.topCurve.currentX,this.bottomCurve.currentX,r),I(this.topCurve.currentY,this.bottomCurve.currentY,r))}warpPath(e){const t=[],r=Math.max(this.sourceRect.width)/4,i=S.FromTransforms(e.transform);for(let n of e.figures)if(n.getPointCount()>0){const e=new G;e.moveToPoint(this.warpPoint(n.getPoint(0).transformPoint(i))),n.forEachSegment(((t,n,s)=>{const o=n||x.InterpolateLinear(t,s,.5),a=r>0?Math.max(1,Math.ceil(Math.abs(s.x-t.x)/r)):1;for(let r=0;r<a;r++){const n=this.warpPoint(x.InterpolateQuadratic(t,o,s,r/a).transformPoint(i)),l=this.warpPoint(x.InterpolateQuadratic(t,o,s,(r+.5)/a).transformPoint(i)),c=this.warpPoint(x.InterpolateQuadratic(t,o,s,(r+1)/a).transformPoint(i)),h=l.add(l.subtract(x.InterpolateLinear(n,c,.5)));e.quadBezierToPoint(h,c)}return!0})),n.isClosed&&e.close(),t.push(e.createFigure())}return new O({figures:t,fillMode:e.fillMode,lineEnabled:e.lineEnabled,extrusionEnabled:e.extrusionEnabled,transform:void 0})}}class We{constructor(e,t,r){this.image=e,this.rect=t,this.transform=r}equals(e){return this.image==e.image&&this.rect==e.rect}}class je{constructor(e,t,r,i,n,s){this.layoutBounds=e,this.paths=t instanceof Array?t.slice(0):t,this.outlinePath=s instanceof Array?s.slice(0):s,this.forceWarping=r,this.isWhiteSpace=i,this.textImage=n}equals(e){if(!this.layoutBounds.equals(e.layoutBounds))return!1;if(!this.paths&&!e.paths)return!0;if(this.paths instanceof O&&e.paths instanceof O)return this.paths.equals(e.paths);if(this.paths instanceof Array&&e.paths instanceof Array){if(this.paths.length!=e.paths.length)return!1;for(let t=0;t<this.paths.length;t++)if(!this.paths[t].equals(e.paths[t]))return!1;return!0}return!this.paths&&!e.paths}getTranslatedCopy(e){let t;if(this.paths instanceof O)t=new O(this.paths,this.paths.transform.applyTranslationAfter(e));else if(this.paths){t=new Array(this.paths.length);for(let r=0;r<this.paths.length;r++)t[r]=new O(this.paths[r],this.paths[r].transform.applyTranslationAfter(e))}return new je(this.layoutBounds.translate(e),t,this.forceWarping)}}class qe{constructor(e,t,r,i){this.m_changeTracker=new ue,this.m_character=e,this.style=t,this.effects=r,this.strokes=i}clone(){const e=new qe(this.m_character,this.m_style?this.m_style.clone():void 0,this.m_effects?this.m_effects.clone():void 0);if(this.m_strokes){e.m_strokes=new he;for(let t of this.m_strokes.elements)e.m_strokes.push(t.clone())}return e}get character(){return this.m_character}get style(){return this.m_style}get effects(){return this.m_effects}get strokes(){return this.m_strokes}get changeTracker(){return this.m_changeTracker}set character(e){this.m_character.equals(e)||(this.m_changeTracker.notifyChange(),this.m_character=e)}set style(e){this.m_changeTracker.replaceListener(this.m_style,e),this.m_style=e}set effects(e){this.m_changeTracker.replaceListener(this.m_effects,e),this.m_effects=e}set strokes(e){this.m_changeTracker.replaceListener(this.m_strokes,e),this.m_strokes=e}equals(e){return!!this.m_character.equals(e.m_character)&&this.m_style==e.m_style&&this.m_effects==e.effects&&this.m_strokes==e.m_strokes}}class Xe{constructor(e,t,r){this.ascent=e,this.descent=t,this.fontHeightInPoints=r}equals(e){return this.ascent==e.ascent&&this.descent==e.descent&&this.fontHeightInPoints==e.fontHeightInPoints}}class $e{constructor(e,t){this.m_changeTracker=new ue,this.m_characters=[],this.m_localRange=e,this.m_layoutBounds=t,this.m_fillBounds=t,this.m_offset=x.Zero}clone(){const e=new $e(this.m_localRange,this.m_layoutBounds);for(let t of this.m_characters)e.addCharacter(t);return e.m_offset=this.m_offset,e.m_fillBounds=this.m_fillBounds,e.m_textEffectMetrics=this.m_textEffectMetrics,e.bender=this.m_bender,e}get characters(){return this.m_characters}get localRange(){return this.m_localRange}get offset(){return this.m_offset}get layoutBounds(){return this.m_layoutBounds}get fillBounds(){return this.m_fillBounds}get textEffectMetrics(){return this.m_textEffectMetrics}get bender(){return this.m_bender}get changeTracker(){return this.m_changeTracker}get flowDirection(){return 0==this.m_characters.length?0:Math.sign(this.m_characters[this.m_characters.length-1].layoutBounds.left-this.m_characters[0].layoutBounds.left)}set localRange(e){pe(this.m_changeTracker,this.m_localRange,e),this.m_localRange=e}set offset(e){pe(this.m_changeTracker,this.m_offset,e),this.m_offset=e}set layoutBounds(e){pe(this.m_changeTracker,this.m_layoutBounds,e),this.m_layoutBounds=e}set fillBounds(e){pe(this.m_changeTracker,this.m_fillBounds,e),this.m_fillBounds=e}set textEffectMetrics(e){pe(this.m_changeTracker,this.m_textEffectMetrics,e),this.m_textEffectMetrics=e}set bender(e){this.bender==e||this.bender instanceof Ge&&e instanceof Ge&&this.bender.equals(e)||this.bender instanceof He&&e instanceof He&&this.bender.equals(e)||(this.m_changeTracker.notifyChange(),this.m_bender=e)}set characters(e){fe(this.m_changeTracker,this.m_characters,e),this.m_characters=e.slice(0)}removeAllCharacters(){this.characters=[]}addCharacter(e){this.m_changeTracker.notifyChange(),this.m_characters.push(e)}}class Ke{constructor(e,t){this.m_lines=[],this.m_localWordRanges=[],this.m_changeTracker=new ue,this.m_globalRange=e,this.m_stylePerLocalRange=new Oe(t),this.m_effectsPerLocalRange=new Oe(new Fe),this.m_strokesPerLocalRange=new Oe(new he),this.m_changeTracker.replaceListener(void 0,this.m_stylePerLocalRange),this.m_offset=x.Zero}clone(){const e=new Ke(this.m_globalRange,this.m_stylePerLocalRange.defaultData);for(let t of this.m_lines)e.addLine(t.clone());e.m_offset=this.m_offset,e.bullet=this.m_bullet?this.m_bullet.clone():void 0;for(let t of this.m_stylePerLocalRange.ranges)e.m_stylePerLocalRange.set(this.m_stylePerLocalRange.getAt(t.start).clone(),t);e.m_effectsPerLocalRange.defaultData=this.m_effectsPerLocalRange.defaultData;for(let t of this.m_effectsPerLocalRange.ranges)e.m_effectsPerLocalRange.set(this.m_effectsPerLocalRange.getAt(t.start).clone(),t);e.m_strokesPerLocalRange.defaultData=this.m_strokesPerLocalRange.defaultData;for(let t of this.m_strokesPerLocalRange.ranges){const r=this.m_strokesPerLocalRange.getAt(t.start),i=new he;for(let e of r.elements)i.push(e.clone());e.m_strokesPerLocalRange.set(i,t)}return e.m_localWordRanges=this.m_localWordRanges.slice(0),e}get lines(){return this.m_lines}get stylePerLocalRange(){return this.m_stylePerLocalRange}get effectsPerLocalRange(){return this.m_effectsPerLocalRange}get strokesPerLocalRange(){return this.m_strokesPerLocalRange}get globalRange(){return this.m_globalRange}get offset(){return this.m_offset}get bullet(){return this.m_bullet}get localWordRanges(){return this.m_localWordRanges}get changeTracker(){return this.m_changeTracker}set stylePerLocalRange(e){this.m_changeTracker.replaceListener(this.m_stylePerLocalRange,e),this.m_stylePerLocalRange=e}set effectsPerLocalRange(e){this.m_changeTracker.replaceListener(this.m_effectsPerLocalRange,e),this.m_effectsPerLocalRange=e}set strokesPerLocalRange(e){this.m_changeTracker.replaceListener(this.m_strokesPerLocalRange,e),this.m_strokesPerLocalRange=e}set globalRange(e){this.m_globalRange.equals(e)||(this.m_changeTracker.notifyChange(),this.m_globalRange=e)}set offset(e){pe(this.m_changeTracker,this.m_offset,e),this.m_offset=e}set bullet(e){this.m_changeTracker.replaceListener(this.m_bullet,e),this.m_bullet=e}set localWordRanges(e){fe(this.m_changeTracker,this.m_localWordRanges,e),this.m_localWordRanges=e.slice(0)}removeAllLocalWordRanges(){this.localWordRanges=[]}addLocalWordRange(e){this.m_changeTracker.notifyChange(),this.m_localWordRanges.push(e)}set lines(e){this.removeAllLines();for(let t of e)this.addLine(t)}removeAllLines(){for(let e of this.m_lines)ue.RemoveListener(e.changeTracker,this.m_changeTracker);this.m_lines=[]}addLine(e){ue.AddListener(e.changeTracker,this.m_changeTracker),this.m_lines.push(e)}}class Ye{constructor(){this.m_paragraphs=[],this.m_changeTracker=new ue,this.m_animationChangeTracker=new ue,this.m_selectionChangeTracker=new ue,this.m_layoutToFrame=P.Identity,this.m_frameToShape=P.Identity,this.m_renderMode=0}clone(){const e=new Ye;for(let t of this.m_paragraphs)e.addParagraph(t.clone());if(e.m_layoutToFrame=this.m_layoutToFrame,e.m_frameToShape=this.m_frameToShape,this.m_animationProps){e.m_animationProps=new Oe(new Ne),e.m_animationProps.defaultData=this.m_animationProps.defaultData;for(let t of this.m_animationProps.ranges)e.m_animationProps.set(this.m_animationProps.getAt(t.start).clone(),t)}if(this.m_selectionHighlights){e.m_selectionHighlights=[];for(let t of this.m_selectionHighlights)e.m_selectionHighlights.push(t.clone())}return e}createAnimationProps(){this.animationProps=new Oe(new Ne)}hasAnimationProps(){return!!this.animationProps}get paragraphs(){return this.m_paragraphs}get layoutToFrame(){return this.m_layoutToFrame}get frameToShape(){return this.m_frameToShape}get animationProps(){return this.m_animationProps}get selectionHighlights(){return this.m_selectionHighlights}get clipBounds(){return this.m_clipBounds}get applyEffectsPerCharacter(){return!!this.m_applyEffectsPerCharacter}get changeTracker(){return this.m_changeTracker}get animationChangeTracker(){return this.m_animationChangeTracker}get textVersion(){return this.m_changeTracker.version}get selectionVersion(){return this.m_selectionChangeTracker.version}get renderMode(){return this.m_renderMode}get linesCutoutMargin(){return this.m_linesCutoutMargin||x.Zero}get spreadFill(){return!!this.m_spreadFill}set layoutToFrame(e){pe(this.m_changeTracker,this.m_layoutToFrame,e),this.m_layoutToFrame=e}set frameToShape(e){pe(this.m_changeTracker,this.m_frameToShape,e),this.m_frameToShape=e}set selectionHighlights(e){!function(e,t,r){if(t!=r)if(t&&r&&t.length==r.length){for(let i=0;i<t.length;i++)if(t[i]!=r[i])return void e.notifyChange()}else e.notifyChange()}(this.m_selectionChangeTracker,this.m_selectionHighlights,e),this.m_selectionHighlights=e?e.slice(0):void 0}set clipBounds(e){pe(this.m_changeTracker,this.m_clipBounds,e),this.m_clipBounds=e}set applyEffectsPerCharacter(e){de(this.m_changeTracker,!!this.m_applyEffectsPerCharacter,e),this.m_applyEffectsPerCharacter=e}set animationProps(e){this.m_animationProps!=e&&(this.m_animationProps&&(ue.RemoveListener(this.m_animationProps.changeTracker,this.m_animationChangeTracker),ue.RemoveListener(this.m_animationProps.rangeChangeTracker,this.m_changeTracker)),e&&(ue.AddListener(e.changeTracker,this.m_animationChangeTracker),ue.AddListener(e.rangeChangeTracker,this.m_changeTracker)),this.m_animationProps=e)}set paragraphs(e){if(this.m_paragraphs!=e){this.removeAllParagraphs();for(let t of e)this.addParagraph(t)}}set renderMode(e){de(this.m_changeTracker,this.m_renderMode,e),this.m_renderMode=e}set linesCutoutMargin(e){pe(this.m_changeTracker,this.m_linesCutoutMargin,e),this.m_linesCutoutMargin=e}set spreadFill(e){de(this.m_changeTracker,!!this.m_spreadFill,e),this.m_spreadFill=e}forceSplit(e){(!this.m_explicitTextSplit||e>this.m_explicitTextSplit)&&(this.m_changeTracker.notifyChange(),this.m_explicitTextSplit=e)}removeAllParagraphs(){for(let e of this.m_paragraphs)ue.RemoveListener(e.changeTracker,this.m_changeTracker);this.m_paragraphs=[]}addParagraph(e){ue.AddListener(e.changeTracker,this.m_changeTracker),this.m_paragraphs.push(e)}removeParagraph(e){ue.RemoveListener(this.m_paragraphs[e].changeTracker,this.m_changeTracker),this.m_paragraphs.splice(e)}getFullRange(){return this.paragraphs.length<1?void 0:Le.FromFirstLast(this.paragraphs[0].globalRange.start,this.paragraphs[this.paragraphs.length-1].globalRange.last)}getRunRanges(){const e=this.getFullRange();if(e){let t=[];for(const e of this.paragraphs)if(2==this.m_explicitTextSplit||this.applyEffectsPerCharacter)for(let r=e.globalRange.start;r<=e.globalRange.last;r++)Je(t,r);else{const r=e.globalRange.start;for(let i of e.lines)Je(t,r+i.localRange.start),Je(t,r+i.localRange.last+1);for(let i of e.stylePerLocalRange.ranges)Je(t,r+i.start),Je(t,r+i.last+1);for(let i of e.effectsPerLocalRange.ranges)Je(t,r+i.start),Je(t,r+i.last+1);for(let i of e.strokesPerLocalRange.ranges)Je(t,r+i.start),Je(t,r+i.last+1);if(1==this.m_explicitTextSplit)for(let i of e.localWordRanges)Je(t,r+i.start),Je(t,r+i.last+1)}if(this.animationProps)for(let e of this.animationProps.ranges)t.some((t=>t==e.start))||t.push(e.start),t.some((t=>t==e.last+1))||t.push(e.last+1);return Ze(t,e)}return[]}getAnimatablePartRanges(e,t,r){let i=t||this.getFullRange();if(!i||0==i.length)return;if(t&&r){if(t.start<0||t.start>=this.paragraphs.length||t.last<0||t.last>=this.paragraphs.length)return void L.Error(592525336,"bad paragraph range");i=Le.FromFirstLast(this.paragraphs[t.start].globalRange.start,this.paragraphs[t.last].globalRange.last)}if(0==e)return i?[i]:void 0;let n=[];for(let t of this.paragraphs){const r=t.globalRange.start;for(let i of t.lines)if(Je(n,r+i.localRange.start),Je(n,r+i.localRange.last+1),2==e){const e=r+i.localRange.start;let t=!1;for(let r=0;r<i.characters.length;r++)t||Je(n,e+r),t=1==i.characters[r].isWhiteSpace}if(1==e)for(let e of t.localWordRanges)Je(n,r+e.start)}return Ze(n,i)}getTextPathsForCharacter(e,t,r,i){const n=[],s=i&&e.outlinePath?e.outlinePath:e.paths,o=s instanceof O?[s]:null!=s?s:[];for(let i of o)if(i.figures.length>0){const s=S.Translation2D(t).multiply(this.layoutToFrame.toMatrix3());let o=i.transform.toMatrix3().multiply(s).tryGetTransform(i.transform.preTranslation);if(!o)throw L.Error(592525337,"unexpected transform");{let t=new O(i,o),a=r instanceof He?r:void 0;if(r instanceof Ge){const n=e.layoutBounds.isEmpty()?void 0:e.layoutBounds.transformedBounds(s);if(e.forceWarping||!n)a=r.equivalentWarpingEnvelope;else{const e=r.getTransform(n);e&&(o=o.toMatrix3().multiply(e.toMatrix3()).tryGetTransform(i.transform.preTranslation),t=o?new O(i,o):void 0)}}a&&t&&(t=a.warpPath(t)),t&&n.push(t)}}return n}getTextPathsForRange(e,t){const r=[];for(let i of this.paragraphs)if(i.globalRange.intersects(e))for(let n of i.lines){const s=new Le(0,n.characters.length).getIntersection(e.move(-i.globalRange.start-n.localRange.start));if(s)for(let e=s.start;e<=s.last;e++){const s=this.getTextPathsForCharacter(n.characters[e],n.offset.add(i.offset),n.bender,t);r.push(...s)}}return r}getLineAndParagraphAt(e){for(let t of this.paragraphs)if(t.globalRange.includes(e)){const r=e-t.globalRange.start;for(let e of t.lines)if(e.localRange.includes(r))return{line:e,paragraph:t}}}getStyleAt(e){for(let t of this.paragraphs)if(t.globalRange.includes(e))return t.stylePerLocalRange.getAt(e-t.globalRange.start)}getEffetcsAt(e){for(let t of this.paragraphs)if(t.globalRange.includes(e))return t.effectsPerLocalRange.getAt(e-t.globalRange.start)}getStrokesAt(e){for(let t of this.paragraphs)if(t.globalRange.includes(e))return t.strokesPerLocalRange.getAt(e-t.globalRange.start)}getPathFromLayoutRect(e,t,r){const i=S.Translation2D(r).multiply(this.layoutToFrame.toMatrix3()).tryGetTransform(x.Zero);if(i){let r=new O({figures:[V.CreateFromRect(e)],transform:i});const n=t.bender instanceof Ge?t.bender.equivalentWarpingEnvelope:t.bender;return n&&(r=n.warpPath(r)),r}}getSelectionRectPaths(e){let t;for(let r of this.paragraphs){const i=e?e.move(-r.globalRange.start):void 0;for(let e of r.lines){let n;if(!i||e.characters&&i.intersects(e.localRange))for(let t=0;t<e.characters.length;t++){const r=e.localRange.start+t;(!i||i.start<=r&&r<=i.last)&&(n=E.UnionRect(n,e.characters[t].layoutBounds))}if(n){const i=this.getPathFromLayoutRect(n,e,e.offset.add(r.offset));i&&(t||(t=[]),t.push(i))}}}return t}getCutoutLinePath(e,t){let r;const i=[];for(let r of this.paragraphs){const n=e?e.move(-r.globalRange.start):void 0;for(let e of r.lines){let s;if(!n||e.characters&&n.intersects(e.localRange))for(let t=0;t<e.characters.length;t++){const r=e.localRange.start+t;(!n||n.start<=r&&r<=n.last)&&(s=E.UnionRect(s,e.characters[t].layoutBounds))}if(s){const t=e.offset.add(r.offset),i=S.Translation2D(t).multiply(this.layoutToFrame.toMatrix3());s=s.transformedBounds(i)}e.bender&&L.Error(528320162,"LinesCutout currently not supported with Benders."),s&&i.push(new E(s.left-t.x,s.top-t.y,s.right+t.x,s.bottom+t.y))}}if(i.length>0){const e=new G;e.moveTo(i[0].left,i[0].top),e.lineTo(i[0].right,i[0].top);for(let t=0;t<i.length-1;t++){const r=i[t].right,n=i[t+1].right,s=r>n?i[t].bottom:i[t+1].top;e.lineTo(r,s),e.lineTo(n,s)}e.lineTo(i[i.length-1].right,i[i.length-1].bottom),e.lineTo(i[i.length-1].left,i[i.length-1].bottom);for(let t=i.length-1;t>0;t--){const r=i[t].left,n=i[t-1].left,s=r<n?i[t].top:i[t-1].bottom;e.lineTo(r,s),e.lineTo(n,s)}e.close(),r=[O.CreateFromFigure(e.createFigure())]}return r}getBoundsOfRange(e,t,r=!1){if(!r||!this.animationProps)return this.getBoundsOfRangeStatic(e,t);let i=this.getFullRange();if(!i)return;let n=[];for(let e of this.animationProps.ranges)Je(n,e.start),Je(n,e.last+1);const s=Ze(n,i);let o;for(let e of s){const r=this.animationProps.getAt(e.start).animationTransform,i=t&&r?t.toMatrix3().multiply(r):t||r;o=E.UnionRect(o,this.getBoundsOfRangeStatic(e,i))}return o}getBoundsOfRangeStatic(e,t){let r;const i=t?this.frameToShape.toMatrix3().multiply(t.toMatrix3()):this.frameToShape;let n=this.getSelectionRectPaths(e);for(let t of this.paragraphs)if(t.bullet&&t.lines.length>0&&(!e||e.includes(t.globalRange.start))){const e=this.getPathFromLayoutRect(t.bullet.character.layoutBounds,t.lines[0],t.offset);e&&(n=n?n.concat(e):[e])}for(let e of n||[])e.untransformedBounds&&(r=E.UnionRect(r,e.untransformedBounds.transformedBounds(e.transform.toMatrix3().multiply(i.toMatrix3()))));return r}getSelectionLayoutCaretPath(e,t,r){for(let i of this.paragraphs){const n=e-i.globalRange.start;for(let e of i.lines){e.localRange.length!=e.characters.length&&L.Error(592525338,"character count mismatch");const s=n-e.localRange.start;let o;if(0<=s&&s<e.characters.length){const r=e.characters[s].layoutBounds,i=e.flowDirection>0?r.left:r.right;o=new E(i-.5*t,r.top,i+.5*t,r.bottom)}else if(0==s&&0==e.characters.length){const r=e.flowDirection>0?e.layoutBounds.left:e.layoutBounds.right;o=new E(r-.5*t,e.layoutBounds.top,r+.5*t,e.layoutBounds.bottom)}else if(r&&n==e.localRange.last+1){const r=e.characters[e.characters.length-1].layoutBounds,i=e.flowDirection>0?r.right:r.left;o=new E(i-.5*t,r.top,i+.5*t,r.bottom)}if(o)return this.getPathFromLayoutRect(o,e,e.offset.add(i.offset))}}}getLineAndParagraphFromLayoutPosition(e){let t,r;for(let i of this.paragraphs)for(let n of i.lines){if(e.subtract(i.offset).subtract(n.offset).y<n.layoutBounds.bottom)return{paragraph:i,line:n};t=n,r=i}return{paragraph:r,line:t}}getSelectionFromLayoutPosition(e){const t=this.getLineAndParagraphFromLayoutPosition(e);if(!t.paragraph||!t.line||!t.line.characters)return;const r=e.subtract(t.paragraph.offset).subtract(t.line.offset);for(let e=0;e<t.line.characters.length;e++)if(r.x<(t.line.characters[e].layoutBounds.right+t.line.characters[e].layoutBounds.left)/2)return{characterIndex:t.paragraph.globalRange.start+t.line.localRange.start+e,isAnchoredToPrevious:!1};return{characterIndex:t.paragraph.globalRange.start+t.line.localRange.last+1,isAnchoredToPrevious:!0}}hitTest(e){for(let t of this.paragraphs)for(let r of t.lines||[]){const i=e.subtract(t.offset).subtract(r.offset);if(r.layoutBounds.isPointInRect(i))return!0}return!1}getBrushImages(){const e=[];for(let t of this.paragraphs){t.bullet&&t.bullet.style&&e.push(...t.bullet.style.getBrushImages()),t.stylePerLocalRange.allData.forEach((t=>{e.push(...t.getBrushImages())})),t.strokesPerLocalRange.allData.forEach((t=>{for(let r of t.elements)r.style&&e.push(...r.style.getBrushImages())}));for(let r of t.lines)for(let t of r.characters)t.textImage&&e.push(t.textImage.image)}return e}}function Je(e,t){e.some((e=>e==t))||e.push(t)}function Ze(e,t){Je(e,t.start),Je(e,t.last+1),e.sort(((e,t)=>e-t));const r=[];for(let i=0;i<e.length-1;i++){const n=Le.FromFirstLast(e[i],e[i+1]-1).getIntersection(t);n&&n.length>0&&r.push(n)}return r}class Qe{constructor(){this.textShapes=[],this.hitTestLineShapes=[]}clearCache(){for(let e of this.textShapes)e.clearCache();for(let e of this.hitTestLineShapes)e.clearCache();for(let e of this.selectionShapes||[])e.clearCache()}getTextShapes(){return this.textShapes}getSelectionShapes(){return this.selectionShapes||[]}initShapeEffectsAndBoundsOverrides(e,t,r,i,n,s){if(t.effects=function(e,t,r){if(!e)return;const i=t?t.fontHeightInPoints:0,n=e.clone(),s=0==i?1:i/pt;return n.glow&&(n.glow.radius=it(n.glow.radius,i,nt,st,ot)/2),n.shadow&&(n.shadow.radius=it(n.shadow.radius,i,at,lt,ct),n.shadow.distance=it(n.shadow.distance,i,at,lt,ct)),n.innerShadow&&(n.innerShadow.radius=it(n.innerShadow.radius,i,ht,ut,dt),n.innerShadow.distance=it(n.innerShadow.distance,i,ht,ut,dt)),n.reflection&&(n.reflection.radius*=s,t&&(n.reflection.distance*=0!=t.ascent&&0!=t.descent?i*t.descent/t.ascent/ft:s)),n.softEdges&&(n.softEdges.radius*=s),n.direction=r,n}(e.getEffetcsAt(n),r?r.textEffectMetrics:void 0,-e.frameToShape.rotation)||new Fe,!r.bender){if(e.applyEffectsPerCharacter||s){const r=e.getBoundsOfRange(new Le(n,1));t.effectsBoundsOverride=r,s&&t.style.fillBrush instanceof we||(t.fillBoundsOverride=r)}else{const n=r.fillBounds.translate(i).transformedBounds(S.FromTransforms(e.layoutToFrame,e.frameToShape));t.effectsBoundsOverride=n,t.fillBoundsOverride=e.spreadFill?e.getBoundsOfRange(void 0):n}t.textEffectMetrics=r.textEffectMetrics}}getTextShape(e,t){const r=e.getStyleAt(t.start),i=e.getTextPathsForRange(t,null==r?void 0:r.hasLine),n=new yt(i,r),s=e.getLineAndParagraphAt(t.start);return s&&this.initShapeEffectsAndBoundsOverrides(e,n,s.line,s.line.offset.add(s.paragraph.offset),t.start,!1),n.role=3,n.textRange=t,n.overlapMode=1,n.transform=e.frameToShape,n}getStrokeShape(e,t,r){const i=new yt(this.getStrokePaths(e,t,r),r.style?r.style:e.getStyleAt(t.start)),n=e.getLineAndParagraphAt(t.start);return n&&this.initShapeEffectsAndBoundsOverrides(e,i,n.line,n.line.offset.add(n.paragraph.offset),t.start,!1),i.role=3,i.textRange=t,i.overlapMode=1,i.transform=e.frameToShape,i}getSelectionHighlightShapes(e){if(!e.selectionHighlights)return;const t=[];for(let r of e.selectionHighlights)if(r.range.length>0){let i=e.getSelectionRectPaths(r.range);i&&t.push(new yt(i,r.style))}else{let i=e.getSelectionLayoutCaretPath(r.range.start,r.caretWidth,r.isAnchoredToPrevious);i&&t.push(new yt([i],r.style))}return t}update(e){if(e.textVersion!=this.lastKnownTextVersion){this.lastKnownTextVersion=e.textVersion,this.clearCache(),this.textShapes=[],this.hitTestLineShapes=[];const t=[],r=[];0!=e.renderMode&&(this.cutoutLayerPaths=void 0);for(let i of e.paragraphs)if(i.bullet){const n=e.getLineAndParagraphAt(i.globalRange.start);if(n){const s=new Le(i.globalRange.start,0);for(let n of i.bullet.strokes?i.bullet.strokes.elements:[])0==n.type?t.push(this.getStrokeShape(e,s,n)):r.push(this.getStrokeShape(e,s,n));const o=e.getTextPathsForCharacter(i.bullet.character,i.offset,i.lines.length>0?i.lines[0].bender:void 0),a=new yt(o,i.bullet.style?i.bullet.style:e.getStyleAt(s.start));this.initShapeEffectsAndBoundsOverrides(e,a,n.line,n.paragraph.offset,s.start,!0),a.role=3,a.textRange=new Le(i.globalRange.start,0),a.transform=e.frameToShape,r.push(a)}}const i=e.getSelectionRectPaths(void 0);for(let t of i||[]){const r=new yt([t],new Se(new _e(ge.Black)));r.transform=e.frameToShape,this.hitTestLineShapes.push(r)}const n=e.getRunRanges(),s=[];for(let t of n){const r=e.getBoundsOfRange(t);if(r&&r.width>2048){const e=Math.ceil(r.width/2048);for(let r=0;r<e;r++){const i=Math.floor(t.start+r*t.length/e),n=r==e-1?t.last+1:Math.floor(t.start+(r+1)*t.length/e);i<n&&s.push(Le.FromFirstLast(i,n-1))}}else s.push(t)}for(let t of s)r.push(this.getTextShape(e,t));for(let i of s){const n=e.getStrokesAt(i.start);for(let s of n?n.elements:[])0==s.type?t.push(this.getStrokeShape(e,i,s)):r.push(this.getStrokeShape(e,i,s))}for(let t of e.paragraphs)for(let e of t.lines)for(let i=0;i<e.characters.length;i++){const n=e.characters[i];if(n.textImage){const s=yt.CreateRectangle(n.textImage.rect,new Se(new we(n.textImage.image)));s.role=3,s.textRange=new Le(i+e.localRange.start+t.globalRange.start,1),s.transform=n.textImage.transform,r.push(s)}}if(le){for(let t of e.paragraphs)for(let i of t.lines)if(i.bender instanceof He){const n=new yt([O.CreateFromFigure(i.bender.topPath)],new Se(void 0,new _e(ge.Cyan),new Ce(1))),s=new yt([O.CreateFromFigure(i.bender.bottomPath)],new Se(void 0,new _e(ge.Magenta),new Ce(1)));n.textRange=s.textRange=i.localRange.move(t.globalRange.start),n.transform=e.frameToShape,s.transform=e.frameToShape,r.push(n),r.push(s)}else if(i.bender instanceof Ge){const n=new yt([O.CreateFromFigure(i.bender.path)],new Se(void 0,new _e(ge.Yellow),new Ce(1)));n.textRange=i.localRange.move(t.globalRange.start),n.transform=e.frameToShape,r.push(n)}const t=e.getAnimatablePartRanges(2,void 0,!0);for(let i of t||[]){const t=e.getBoundsOfRange(i);if(t){const e=new yt([O.CreateFromRect(t)],new Se(void 0,new _e(ge.Blue),new Ce(1)));e.textRange=i,r.push(e)}}for(let t of e.paragraphs)for(let i of t.lines){const n=i.fillBounds.translate(i.offset.add(t.offset)).transformedBounds(S.FromTransforms(e.layoutToFrame,e.frameToShape));if(n&&i.textEffectMetrics){const e=new E(n.left,n.top,n.right,n.top+i.textEffectMetrics.ascent),s=new E(n.left,n.bottom-i.textEffectMetrics.descent,n.right,n.bottom),o=new yt([O.CreateFromRect(e)],new Se(void 0,new _e(ge.Red),new Ce(1))),a=new yt([O.CreateFromRect(s)],new Se(void 0,new _e(ge.Green),new Ce(1)));o.textRange=i.localRange.move(t.globalRange.start),a.textRange=i.localRange.move(t.globalRange.start),r.push(o),r.push(a)}}}this.textShapes.push(...t),this.textShapes.push(...r);for(let t of this.textShapes)t.clipBounds=e.clipBounds;if(0!=e.renderMode){if(this.cutoutLayerPaths=[],3==e.renderMode){const t=e.getCutoutLinePath(void 0,e.linesCutoutMargin);for(let e of t||[])this.cutoutLayerPaths.push(e)}for(let e of t)this.cutoutLayerPaths.push(...e.paths||[]);for(let e of r)this.cutoutLayerPaths.push(...e.paths||[])}}if(e.selectionVersion!=this.lastKnownSelectionVersion){this.lastKnownSelectionVersion=e.selectionVersion;const t=this.getSelectionHighlightShapes(e);if(t){if(this.selectionShapes=[],new Se(new _e(ge.White)).blendingMode=2,t){this.selectionShapes.push(...t);for(let t of this.selectionShapes)t.transform=e.frameToShape}}else{for(let e of this.selectionShapes||[])e.clearCache();this.selectionShapes=void 0}}}getStrokePaths(e,t,r){const i=[];for(let n of e.paragraphs)if(n.globalRange.intersects(t))for(let s of n.lines){let o,a;const l=new Le(0,s.characters.length).getIntersection(t.move(-n.globalRange.start-s.localRange.start));if(l)for(let e=l.start;e<=l.last;e++){const t=s.characters[e].layoutBounds;t.isEmpty()||(o=null==o?t.left:Math.min(o,t.left),a=null==a?t.right:Math.max(a,t.right))}if(null!=o&&null!=a&&o<a){const t=S.Translation2D(s.offset.add(n.offset)).multiply(e.layoutToFrame.toMatrix3()).tryGetTransform(x.Zero);if(t){let e=new O({figures:rt(r,o,a),transform:t});const n=s.bender instanceof Ge?s.bender.equivalentWarpingEnvelope:s.bender;n&&(e=n.warpPath(e)),i.push(e)}}}return i}}function et(e,t,r){const i=t.y-r,n=Math.ceil(t.x/(2*i));let s=e.x;const o=new G;o.moveTo(s,e.y),o.lineTo(s,e.y+r);for(let a=0;a<n;a++)s+=i,o.lineTo(s,e.y+t.y),s+=i,o.lineTo(s,e.y+r);o.lineTo(s,e.y);for(let a=0;a<n;a++)s-=i,o.lineTo(s,e.y+t.y-r),s-=i,o.lineTo(s,e.y);return o.close(),o.createFigure()}function tt(e,t,r,i,n,s){const o=[];let a=e.x;const l=t.y,c=t.y*r,h=t.y*i,u=s?e.y-t.y:e.y,d=s?e.y+t.y/2:e.y+t.y;let p=0;for(;a<e.x+t.x;){const r=n&&p%(n+1)!=0?l:c,i=Math.min(a+r,t.x+e.x);o.push(V.CreateFromRect(new E(a,u,i,d))),a+=h+r,p++}return o}function rt(e,t,r){const i=new x(t,e.verticalCenter-.5*e.thickness),n=new x(r-t,e.thickness),s=[],o=3==e.type||5==e.type||7==e.type||9==e.type||11==e.type||13==e.type||15==e.type;switch(e.type){case 3:case 1:case 0:o?s.push(V.CreateFromRect(new E(i.x,i.y-n.y,i.x+n.x,i.y+Math.ceil(n.y/2)))):s.push(V.CreateFromRect(new E(i.x,i.y,i.x+n.x,i.y+n.y)));break;case 2:{const e=!1;s.push(...function(e,t,r){const i=[];return r?(i.push(V.CreateFromRect(new E(e.x,e.y,e.x+t.x,e.y+t.y/2))),i.push(V.CreateFromRect(new E(e.x,e.y+t.y,e.x+t.x,e.y+3*t.y/2)))):(i.push(V.CreateFromRect(new E(e.x,e.y-t.y,e.x+t.x,e.y-t.y/2))),i.push(V.CreateFromRect(new E(e.x,e.y+t.y/2,e.x+t.x,e.y+t.y)))),i}(i,n,e));break}case 5:case 4:s.push(...tt(i,n,1,1,1,o));break;case 7:case 6:s.push(...tt(i,n,3,2,0,o));break;case 9:case 8:s.push(...tt(i,n,7,4,0,o));break;case 10:case 11:s.push(...tt(i,n,3,2,1,o));break;case 12:case 13:s.push(...tt(i,n,3,2,2,o));break;case 14:case 15:{let t=2*n.y,r=1;15==e.type&&(t=Math.floor(Math.max(3,2*n.y)),r=Math.max(2,Math.floor(n.y/2))),s.push(et(new x(i.x,i.y-Math.ceil(n.y/2)),new x(n.x,t),r))}break;case 16:{const e=1,t=Math.max(2,n.y),r=i.y-t;s.push(et(new x(i.x,r),new x(n.x,t),e)),s.push(et(i,new x(n.x,t),e))}break;default:L.Error(591525085,"Unknown stroke type")}return s}function it(e,t,r,i,n){return 0!=t&&n<e?(e-n)*Math.pow(t,i)/Math.pow(r,i)+n:0==t?e:0}const nt=72,st=.7,ot=1,at=72,lt=.7,ct=.4,ht=108,ut=1,dt=.001,pt=72,ft=4;class gt{constructor(e,t){this.transform=e,this.opacity=null==t?void 0:t.opacity,this.colorMatrix=null==t?void 0:t.colorMatrix,this.colorOffset=null==t?void 0:t.colorOffset,this.groupIndex=null==t?void 0:t.groupIndex}}gt.DefaultArray=[new gt(S.Identity)];class mt{constructor(e=new Fe,t=P.Identity,r){this.m_animationChangeTracker=new ue,this.renderDataMap={},this.m_changeTracker=new ue(r),this.m_alphaTracker=new ue(r),this.m_changeTracker.replaceListener(void 0,e),this.m_alphaTracker.replaceListener(void 0,e),this.m_effects=e,this.m_isHidden=!1,this.m_transform=t,null==k||k.register(this,this.renderDataMap)}cloneItemData(e){var t,r;e.effects=this.m_effects.clone(),e.m_transform=this.m_transform,e.fade=this.m_fade?this.m_fade.clone():void 0,e.m_animationTransform=this.m_animationTransform,e.m_fillBoundsOverride=this.m_fillBoundsOverride,e.m_effectsBoundsOverride=this.m_effectsBoundsOverride,e.m_scene3D=this.m_scene3D,e.m_isHidden=this.m_isHidden,e.m_instanceOffsets=null===(t=this.m_instanceOffsets)||void 0===t?void 0:t.slice(0),e.m_instances=null===(r=this.m_instances)||void 0===r?void 0:r.slice(0),e.m_clipBounds=this.m_clipBounds,e.clientData=this.clientData}get changeTracker(){return this.m_changeTracker}get animationChangeTracker(){return this.m_animationChangeTracker}get alphaTracker(){return this.m_alphaTracker}notifyChange(){this.m_changeTracker.notifyChange()}get version(){return this.m_changeTracker.version}get effects(){return this.m_effects}get transform(){return this.m_transform}get isHidden(){return this.m_isHidden}get instanceOffsets(){return this.m_instanceOffsets}get instances(){return this.m_instances}get fade(){return this.m_fade}get animationTransform(){return this.m_animationTransform}get fillBoundsOverride(){return this.m_fillBoundsOverride}get effectsBoundsOverride(){return this.m_effectsBoundsOverride}get scene3D(){return this.m_scene3D}get clipBounds(){return this.m_clipBounds}set effects(e){this.m_changeTracker.replaceListener(this.m_effects,e),this.m_effects=e}set transform(e){this.m_transform.equals(e)||(this.onTransformChanged(this.m_transform,e),this.notifyChange(),this.m_transform=e)}set isHidden(e){de(this.m_changeTracker,this.m_isHidden,e),this.m_isHidden=e}set instanceOffsets(e){this.m_instanceOffsets=e?e.slice(0):void 0,this.m_instances=e?e.map((e=>new gt(S.Translation2D(e)))):void 0}set instances(e){this.m_instances=e?e.slice(0):void 0}set fade(e){this.m_animationChangeTracker.replaceListener(this.m_fade,e),this.m_fade=e}set animationTransform(e){pe(this.m_animationChangeTracker,this.m_animationTransform,e),this.m_animationTransform=e}set fillBoundsOverride(e){pe(this.m_changeTracker,this.m_fillBoundsOverride,e),this.m_fillBoundsOverride=e}set effectsBoundsOverride(e){pe(this.m_changeTracker,this.m_effectsBoundsOverride,e),this.m_effectsBoundsOverride=e}set scene3D(e){this.m_scene3D!=e&&(this.notifyChange(),this.m_scene3D=e,this.clearCache())}set clipBounds(e){pe(this.changeTracker,this.m_clipBounds,e),pe(this.alphaTracker,this.m_clipBounds,e),this.m_clipBounds=e}getBounds(e=!0,t=!0,r=!0,i){return Tt(this,t,r?31:0,r?31:0,null==i?void 0:i.toMatrix3(),!0,void 0,e)}onTransformChanged(e,t){}clearCache(){for(const e in this.renderDataMap)this.renderDataMap[e].releaseGeneratedResources()}releaseGeneratedResources(){this.clearCache();const e=this.getBrushImages();for(let t of e)t.releaseGeneratedResources()}}class yt extends mt{constructor(e,t=new Se,r=new Fe,i=P.Identity){super(r,i),this.m_role=0,this.m_geometryTracker=new ue,this.m_paths=e,this.m_overlapMode=0,this.m_mergeMode=0,this.changeTracker.replaceListener(void 0,t),ue.AddListener(t.penChangeTracker,this.m_geometryTracker),ue.AddListener(t.alphaChangeTracker,this.alphaTracker),ue.AddListener(this.m_geometryTracker,this.alphaTracker),this.m_style=t}clone(){let e=new yt;return e.paths=this.m_paths?this.m_paths.slice(0):void 0,e.m_overlapMode=this.m_overlapMode,e.m_mergeMode=this.m_mergeMode,e.style=this.m_style.clone(),e.m_shape3D=this.m_shape3D,e.text=this.m_text?this.m_text.clone():void 0,e.m_textEffectMetrics=this.m_textEffectMetrics,e.m_role=this.m_role,this.cloneItemData(e),e}static CreateRectangle(e,t=new Se,r=new Fe,i=P.Identity){return new yt([O.CreateFromRect(e)],t,r,i)}get paths(){return this.m_paths}get incrementalPath(){return this.m_incrementalPath}get overlapMode(){return this.m_overlapMode}get mergeMode(){return this.m_mergeMode}get style(){return this.m_style}get shape3D(){return this.m_shape3D}get text(){return this.m_text}get textEffectMetrics(){return this.m_textEffectMetrics}get role(){return this.m_role}set paths(e){this.m_paths!=e&&(this.clearPathCache(),this.notifyGeometryChange(),this.m_paths=e)}set incrementalPath(e){this.changeTracker.replaceListener(this.m_incrementalPath,e),this.alphaTracker.replaceListener(this.m_incrementalPath,e),this.m_incrementalPath=e}set overlapMode(e){this.m_overlapMode!=e&&(this.notifyGeometryChange(),this.m_overlapMode=e)}set mergeMode(e){this.m_mergeMode!=e&&(this.notifyGeometryChange(),this.m_mergeMode=e)}set style(e){this.m_style!=e&&(ue.RemoveListener(this.m_style.penChangeTracker,this.m_geometryTracker),ue.AddListener(e.penChangeTracker,this.m_geometryTracker),ue.RemoveListener(this.m_style.alphaChangeTracker,this.alphaTracker),ue.AddListener(e.alphaChangeTracker,this.alphaTracker),this.changeTracker.replaceListener(this.m_style,e),this.m_style=e)}set shape3D(e){this.m_shape3D!=e&&(this.notifyGeometryChange(),this.m_shape3D=e)}set role(e){this.m_role!=e&&(this.notifyChange(),this.m_geometryTracker.notifyChange(),this.m_role=e)}set text(e){this.m_text!=e&&(this.m_text&&(this.m_text.cache&&this.m_text.cache.clearCache(),ue.RemoveListener(this.m_text.changeTracker,this.changeTracker),ue.RemoveListener(this.m_text.changeTracker,this.alphaTracker),ue.RemoveListener(this.m_text.animationChangeTracker,this.animationChangeTracker)),this.m_text=e,this.m_text&&(ue.AddListener(this.m_text.changeTracker,this.changeTracker),ue.AddListener(this.m_text.changeTracker,this.alphaTracker),ue.AddListener(this.m_text.animationChangeTracker,this.animationChangeTracker)))}set textEffectMetrics(e){pe(this.changeTracker,this.m_textEffectMetrics,e),pe(this.alphaTracker,this.m_textEffectMetrics,e),this.m_textEffectMetrics=e}onTransformChanged(e,t){e.scale.equals(t.scale)||this.m_geometryTracker.notifyChange()}clearCache(){super.clearCache(),this.text&&this.text.cache&&(this.text.cache.clearCache(),this.text.cache=void 0),this.clearPathCache(),this.clearBoundsCache()}clearPathCache(){for(let e of this.paths||[])for(let t in e.renderDataMap)e.renderDataMap[t].releaseGeneratedResources()}clearBoundsCache(){this.shapeBoundsCache=void 0}get geometryTracker(){return this.m_geometryTracker}notifyGeometryChange(){this.notifyChange(),this.m_geometryTracker.notifyChange(),this.clearBoundsCache()}getBrushImages(){const e=this.style.getBrushImages();return this.text&&e.push(...this.text.getBrushImages()),e}isSolidRectGeometry(){return!(!this.m_paths||1!=this.m_paths.length||!this.m_paths[0].isUntransformedRect||1!=this.m_paths[0].fillMode||this.m_paths[0].transform instanceof S||this.m_paths[0].transform instanceof P&&0!=this.m_paths[0].transform.rotation)}isSolidRect(){return!(!this.isSolidRectGeometry()||this.style.hasLine||this.style.pictureOverflow>0||this.text&&0!=this.text.renderMode)}hasSmallDetails(){return 3==this.role||this.style.hasLine&&this.style.pen.lineWidth<3||this.m_paths&&this.m_paths.some((e=>e.hasPressureInfo))}getType(){return 1}}class _t extends mt{constructor(e,t=new Fe,r=P.Identity){const i=e instanceof he?e:new he(e,false);super(t,r,i.deferTracking?()=>i.getHash():void 0),this.changeTracker.replaceListener(void 0,i),this.alphaTracker.replaceListener(void 0,i),this.m_items=i,this.m_opacity=1}clone(){const e=new _t;for(const t of this.m_items.elements)e.items.push(t.clone());return e.groupFillBrush=this.m_groupFillBrush?this.m_groupFillBrush.clone():void 0,e.m_isDocumentShape=this.m_isDocumentShape,this.cloneItemData(e),e}get items(){return this.m_items}get groupFillBrush(){return this.m_groupFillBrush}get isDocumentShape(){return this.m_isDocumentShape}get opacity(){return this.m_opacity}set groupFillBrush(e){this.m_groupFillBrush=e}set isDocumentShape(e){this.m_isDocumentShape=e}set items(e){this.setItems(e)}set opacity(e){this.m_opacity!=e&&(this.notifyChange(),this.m_opacity=e)}setItems(e){const t=e instanceof he?e:new he(e);this.changeTracker.replaceListener(this.m_items,t),this.alphaTracker.replaceListener(this.m_items,t),this.m_items=t}clearCache(){super.clearCache();for(let e=0;e<this.m_items.length;e++)this.m_items.getAt(e).clearCache()}getBrushImages(){const e=Ee(this.groupFillBrush);for(const t of this.m_items.elements)e.push(...t.getBrushImages());return e}getType(){return 2}}function vt(e,t){if(!e)return!0;if(1==e.getType()){const r=e;if(t(r),r.text&&r.text.cache){for(const e of r.text.cache.getTextShapes())if(!vt(e,t))return!1;for(const e of r.text.cache.getSelectionShapes()||[])if(!vt(e,t))return!1}}else{if(2!=e.getType())throw L.Error(591525086,"Unknown Item type");{const r=e;for(const e of r.items.elements)if(!vt(e,t))return!1}}return!0}function bt(e){return 1==e.alignment?-1:2==e.alignment?1:0}function wt(e,t,r){if(e.incrementalPath)return r?e.incrementalPath.bounds.transformedBounds(r):e.incrementalPath.bounds;e.shapeBoundsCache&&e.shapeBoundsCache.geometryVersion==e.geometryTracker.version||(e.shapeBoundsCache={geometryVersion:e.geometryTracker.version});let i=0;t&&e.style.hasLine&&(i=e.style.pen.adjustedLineWidth*(.5+Math.abs(Math.max(bt(e.style.pen))))),t&&e.shape3D&&e.shape3D.adjustedContourWidth>0&&(i+=.5*e.shape3D.adjustedContourWidth);const n=!r||r.isSimpleScaleTranslationOnly();let s=i?e.shapeBoundsCache.pathsBoundsWithLine:e.shapeBoundsCache.pathsBounds;if(!s&&!i&&n&&e.paths&&(s=e.shapeBoundsCache.pathsBounds=Z(e.paths)),s){if(!r)return s;if(n)return s.multiply(r.getSimpleScale()).translate(r.getSimpleTranslation())}let o=i?e.shapeBoundsCache.pathsBoundsContributorsWithLine:e.shapeBoundsCache.pathsBoundsContributors;if(!o){const t=S.Scale2D(e.transform.scale);o=[],e.paths&&function(e,t,r,i,n,s){for(const o of e){const e=o.transform.toMatrix3().multiply(i);for(const i of o.figures)if(s.push(Y(i,e,t,n?1:r.pen.lineJoin,r.pen.miterLimit)),t&&!i.isClosed&&r.pen){if(r.pen.headEnd&&0!=r.pen.headEnd.end){const n=j(r.pen.headEnd,r.pen.adjustedLineWidthForArrowHead);if(n){const o=$(i,!1,r.pen.headEnd,2*t,e);o&&s.push(Y(n,o,t,1,r.pen.miterLimit))}}if(r.pen.tailEnd&&0!=r.pen.tailEnd.end){const n=j(r.pen.tailEnd,r.pen.adjustedLineWidthForArrowHead);if(n){const o=$(i,!0,r.pen.tailEnd,2*t,e);o&&s.push(Y(n,o,t,1,r.pen.miterLimit))}}}}}(e.paths,i,e.style,t,null!=e.shape3D,o),i?e.shapeBoundsCache.pathsBoundsContributorsWithLine=o:e.shapeBoundsCache.pathsBoundsContributors=o}const a=S.Scale2D(e.transform.scale.inverse()),l=r?a.multiply(r):a;let c;for(const e of o||[]){const t=J(e,l);c=E.UnionRect(c,t)}if(c&&n){const i=r?c.translate(r.getSimpleTranslation().negate()).multiply(r.getSimpleScale().inverse()):c;t?e.shapeBoundsCache.pathsBoundsWithLine=i:e.shapeBoundsCache.pathsBounds=i}return c}function Tt(e,t,r,i,n,s=!0,o,a=!1){let l=a?e.animationTransform:void 0,c=n&&l?n.multiply(l):n||l;const h=c?e.transform.toMatrix3().multiply(c):e.transform.toMatrix3();let u;if(1==e.getType()){const r=e;if(o||(u=wt(r,!0,h)),r.text&&t&&(s||o)){const i=new P(x.Zero,x.One,e.transform.rotation,e.transform.translation),s=r.text.hasAnimationProps()?n:c,l=s?i.toMatrix3().multiply(s):i.toMatrix3(),h=Pt(r);if(h)for(let e of h.textShapes)o&&e.textRange&&!o.intersects(e.textRange)||(u=E.UnionRect(u,e.getBounds(a,t,!0,l)))}}else if(2==e.getType()&&!o&&s){const r=e;for(let e=0;e<r.items.length;e++){const n=r.items.getAt(e),s=n instanceof yt&&3==n.role;!t&&s||(u=E.UnionRect(u,Tt(n,t,i,i,h)))}}if(!o){let n,s;const o=1&r&&e.effects&&e.effects.glow&&e.effects.glow.radius,a=2&r&&e.effects&&e.effects.shadow,l=4&r&&e.effects&&e.effects.reflection;if((o||a||l)&&(s=c?Tt(e,t,r,i):u),(a||l)&&(n=e.effectsBoundsOverride?e.effectsBoundsOverride:Tt(e,!1,0,1)),u&&s&&1&r&&e.effects&&e.effects.glow&&e.effects.glow.radius&&(s=s.inflate(2*e.effects.glow.radius),u=u.inflate(2*e.effects.glow.radius)),(a||l)&&!t&&e instanceof yt&&e.text){const t=Tt(e,!0,r,i);t&&(s=E.UnionRect(s,t))}if(u&&s&&n&&2&r&&e.effects&&e.effects.shadow){const t=Ct(e.effects.shadow.alignment,n),r=St(e.effects.shadow.angle,e.effects.shadow.distance,e.effects.shadow.scale,e.effects.shadow.skew,t),i=(e.effects.shadow.radius?s.inflate(e.effects.shadow.radius):s).transformedBounds(c?r.multiply(c):r),o=(e.effects.shadow.radius?s.inflate(e.effects.shadow.radius):s).transformedBounds(c?r.multiply(c):r);s=E.UnionRect(s,i),u=E.UnionRect(u,o)}if(u&&s&&n&&4&r&&e.effects&&e.effects.reflection){let t=e.effects.reflection,r=n.bottom+e.effects.reflection.distance/2;e instanceof yt&&e.textEffectMetrics&&(r-=e.textEffectMetrics.descent);const i=S.Translation2D(new x(0,-r)).multiply(S.Scale2D(new x(1,-1))).multiply(S.Translation2D(new x(0,r))),o=(t.radius?s.inflate(t.radius):s).transformedBounds(i),a=c?(t.radius?s.inflate(t.radius):s).transformedBounds(i.multiply(c)):o;u=E.UnionRect(u,a)}}return u}const xt=[new x(0,0),new x(.5,0),new x(1,0),new x(0,.5),new x(.5,.5),new x(1,.5),new x(0,1),new x(.5,1),new x(1,1)];function Ct(e,t){return t?xt[e].multiply(t.size).add(t.leftTop):xt[e]}function St(e,t,r,i,n){const s=S.Translation2D(n.negate()),o=new x(t,0).rotate(e).add(n),a=new S(r.x,i.y,0,i.x,r.y,0,o.x,o.y,1);return s.multiply(a)}function Pt(e){if(e.text)return e.text.cache||(e.text.cache=new Qe),e.text.cache.update(e.text),e.text.cache}function Et(e){e.items.removeAll(),e.clearCache()}class Mt{}class Rt{constructor(){this.type=Mt,this.pointerEventNotifiers=c(),this.hitTestSlop=0,this.scene=new _t,this.sourceAnchorBounds=new d(0,0,0,0),this.scaleFactor=Rt.defaultScaleFactor,this.transform=new m,this.emuToSourceScale=1,this.isHitTestOnly=!1,this.teardownTracker=new v("ShapeBuilderViewModel"),this.itemTeardowns=[]}static setDefaultScaleFactor(e){Rt.defaultScaleFactor=e}addItem(e){this.scene.items.push(e)}addTeardown(e){this.itemTeardowns.push(e)}setItems(e){e.length>0&&function(e){const t=new w("ShapeBuilderViewModel.clearTextures");try{t.setProp("renderDataMapSize",Object.keys(e.renderDataMap).length),t.setProp("sceneSize",e.items.length),e.releaseGeneratedResources()}finally{t.complete()}}(this.scene),this.scene.setItems(e)}removeItem(e){const t=this.scene.items.elements.indexOf(e);-1!==t&&this.scene.items.removeAt(t)}clear(){this.itemTeardowns.forEach((e=>{e()})),this.itemTeardowns=[],this.scene.items.removeAll()}teardown(){Et(this.scene),this.itemTeardowns.forEach((e=>{e()})),this.teardownTracker.teardown()}}function At(e){return e.type===Mt}Rt.defaultScaleFactor=1;var Bt=function(e,t){return Bt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Bt(e,t)};function It(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Bt(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var Ft=function(){return Ft=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},Ft.apply(this,arguments)};function Dt(e,t,r,i){return new(r||(r=Promise))((function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))}Object.create,Object.create;class Lt{constructor(){this.elements=[]}clearCache(){this.elements.forEach((e=>e.clearCache()))}}const kt=[0,1,2,0,3,4];class Ot{constructor(){this.totalCostMs=0,this.shapeRenderCostMs=0,this.distanceFieldForTextCostMs=0,this.distanceFieldForGlyphTableCostMs=0,this.distanceFieldForShapeCostMs=0,this.patternTextureCostMs=0,this.pathGradientTextureCostMs=0,this.gradientTextureCostMs=0,this.fadeTextureCostMs=0,this.effectsCostMs=0,this.cacheToSpriteCostMs=0,this.drawTapeCostMs=0,this.glResetCostMs=0,this.glRestoreCostMs=0,this.pathCount=0,this.glyphCount=0,this.glyphCountAddedToCache=0,this.glyphCountReadFromCache=0,this.glyphCountRenderedAsPath=0,this.glyphCountLargeText=0,this.glyphCountTextOutline=0,this.pixelCountDistanceField=0,this.pixelCountShapeRender=0,this.shapeLayerCount=0,this.shapeLayerCountText=0,this.dynamicTextureAlloc=0,this.beginTime=0,this.endTime=0}add(e){this.totalCostMs+=e.totalCostMs,this.shapeRenderCostMs+=e.shapeRenderCostMs,this.distanceFieldForTextCostMs+=e.distanceFieldForTextCostMs,this.distanceFieldForGlyphTableCostMs+=e.distanceFieldForGlyphTableCostMs,this.distanceFieldForShapeCostMs+=e.distanceFieldForShapeCostMs,this.patternTextureCostMs+=e.patternTextureCostMs,this.pathGradientTextureCostMs+=e.pathGradientTextureCostMs,this.gradientTextureCostMs+=e.gradientTextureCostMs,this.fadeTextureCostMs+=e.fadeTextureCostMs,this.effectsCostMs+=e.effectsCostMs,this.cacheToSpriteCostMs+=e.cacheToSpriteCostMs,this.drawTapeCostMs+=e.drawTapeCostMs,this.glResetCostMs+=e.glResetCostMs,this.glRestoreCostMs+=e.glRestoreCostMs,this.pathCount+=e.pathCount,this.glyphCount+=e.glyphCount,this.glyphCountAddedToCache+=e.glyphCountAddedToCache,this.glyphCountReadFromCache+=e.glyphCountReadFromCache,this.glyphCountRenderedAsPath+=e.glyphCountRenderedAsPath,this.glyphCountLargeText+=e.glyphCountLargeText,this.glyphCountTextOutline+=e.glyphCountTextOutline,this.pixelCountDistanceField+=e.pixelCountDistanceField,this.pixelCountShapeRender+=e.pixelCountShapeRender,this.shapeLayerCount+=e.shapeLayerCount,this.shapeLayerCountText+=e.shapeLayerCountText,this.dynamicTextureAlloc+=e.dynamicTextureAlloc,this.beginTime=0,this.endTime=0}}class Ut{constructor(){this.frameCount=0}}class Nt{constructor(){this.recreatingSprites=0,this.pictureCropBWTextures=0}}var Vt,Gt=function(){function e(e,t,r,i){void 0===t&&(t=!1),this.initalize(e,t,r,i)}return e.prototype.initalize=function(e,t,r,i){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=r,this.currentTarget=i,this},e}(),zt=function(e,t,r){void 0===r&&(r=null),this.callback=e,this.mask=t,this.scope=r,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},Ht=(function(){function e(){}e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(t,r,i,n){void 0===i&&(i=-1),void 0===n&&(n=null);var s=new e;s._observers=new Array,s._observables=t;for(var o=0,a=t;o<a.length;o++){var l=a[o].add(r,i,!1,n);l&&s._observers.push(l)}return s}}(),function(){function e(e){this._observers=new Array,this._eventState=new Gt(0),e&&(this._onObserverAdded=e)}return Object.defineProperty(e.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),e.prototype.add=function(e,t,r,i,n){if(void 0===t&&(t=-1),void 0===r&&(r=!1),void 0===i&&(i=null),void 0===n&&(n=!1),!e)return null;var s=new zt(e,t,i);return s.unregisterOnNextCall=n,r?this._observers.unshift(s):this._observers.push(s),this._onObserverAdded&&this._onObserverAdded(s),s},e.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},e.prototype.remove=function(e){return!!e&&-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)},e.prototype.removeCallback=function(e,t){for(var r=0;r<this._observers.length;r++){var i=this._observers[r];if(!(i._willBeUnregistered||i.callback!==e||t&&t!==i.scope))return this._deferUnregister(i),!0}return!1},e.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((function(){t._remove(e)}),0)},e.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},e.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},e.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},e.prototype.notifyObservers=function(e,t,r,i,n){if(void 0===t&&(t=-1),!this._observers.length)return!0;var s=this._eventState;s.mask=t,s.target=r,s.currentTarget=i,s.skipNextObservers=!1,s.lastReturnValue=e,s.userInfo=n;for(var o=0,a=this._observers;o<a.length;o++){var l=a[o];if(!l._willBeUnregistered&&(l.mask&t&&(l.scope?s.lastReturnValue=l.callback.apply(l.scope,[e,s]):s.lastReturnValue=l.callback(e,s),l.unregisterOnNextCall&&this._deferUnregister(l)),s.skipNextObservers))return!1}return!0},e.prototype.notifyObserversWithPromise=function(e,t,r,i,n){var s=this;void 0===t&&(t=-1);var o=Promise.resolve(e);if(!this._observers.length)return o;var a=this._eventState;return a.mask=t,a.target=r,a.currentTarget=i,a.skipNextObservers=!1,a.userInfo=n,this._observers.forEach((function(r){a.skipNextObservers||r._willBeUnregistered||r.mask&t&&(o=r.scope?o.then((function(t){return a.lastReturnValue=t,r.callback.apply(r.scope,[e,a])})):o.then((function(t){return a.lastReturnValue=t,r.callback(e,a)})),r.unregisterOnNextCall&&s._deferUnregister(r))})),o.then((function(){return e}))},e.prototype.notifyObserver=function(e,t,r){void 0===r&&(r=-1);var i=this._eventState;i.mask=r,i.skipNextObservers=!1,e.callback(t,i)},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,r=this._observers;t<r.length;t++){var i=r[t];if(i.mask&e||i.mask===e)return!0}return!1},e}()),Wt=function(){},jt=function(){function e(){}return e.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.Depth=12]="Depth",e[e.CubeRawRGBD=13]="CubeRawRGBD"}(Vt||(Vt={}));var qt=function(){function e(e,t,r){void 0===r&&(r=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new Ht,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=Vt.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._textureArray=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._gammaSpace=null,this._engine=e,this._source=t,r||(this._webGLTexture=e._createTexture())}return e.prototype.getEngine=function(){return this._engine},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),e.prototype.incrementReferences=function(){this._references++},e.prototype.updateSize=function(e,t,r){void 0===r&&(r=1),this.width=e,this.height=t,this.depth=r,this.baseWidth=e,this.baseHeight=t,this.baseDepth=r,this._size=e*t*r},e.prototype._rebuild=function(){var t,r,i=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case Vt.Temp:return;case Vt.Url:return void(r=this._engine.createTexture(null!==(t=this._originalUrl)&&void 0!==t?t:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){r._swapAndDie(i),i.isReady=!0}),null,this._buffer,void 0,this.format));case Vt.Raw:return(r=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case Vt.Raw3D:return(r=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case Vt.Raw2DArray:return(r=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case Vt.Dynamic:return(r=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case Vt.RenderTarget:var n=new Wt;if(n.generateDepthBuffer=this._generateDepthBuffer,n.generateMipMaps=this.generateMipMaps,n.generateStencilBuffer=this._generateStencilBuffer,n.samplingMode=this.samplingMode,n.type=this.type,this.isCube)r=this._engine.createRenderTargetCubeTexture(this.width,n);else{var s={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};r=this._engine.createRenderTargetTexture(s,n)}return r._swapAndDie(this),void(this.isReady=!0);case Vt.Depth:var o={bilinearFiltering:2!==this.samplingMode,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},a={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(r=this._engine.createDepthStencilTexture(a,o))._swapAndDie(this),void(this.isReady=!0);case Vt.Cube:return void(r=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){r._swapAndDie(i),i.isReady=!0}),null,this.format,this._extension));case Vt.CubeRaw:return(r=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case Vt.CubeRawRGBD:return r=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void e._UpdateRGBDAsync(r,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then((function(){r._swapAndDie(i),i.isReady=!0}));case Vt.CubePrefiltered:return void((r=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(i),i.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},e.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,e._isRGBD=this._isRGBD,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),e._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var t,r=this._engine.getLoadedTexturesCache();-1!==(t=r.indexOf(this))&&r.splice(t,1),-1===(t=r.indexOf(e))&&r.push(e)},e.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},e._UpdateRGBDAsync=function(e,t,r,i,n){throw jt.WarnImport("environmentTextureTools")},e}();class Xt{static load(e){Xt.m_settings=e}static readBooleanOrDefault(e,t){const r=void 0===Xt.m_settings?"":typeof Xt.m_settings[e];return"string"===r?"true"===Xt.m_settings[e].toLowerCase():"boolean"===r?Xt.m_settings[e]:t}static readNumberOrDefault(e,t){const r=void 0===Xt.m_settings?"":typeof Xt.m_settings[e];return"string"===r||"number"===r?Number(Xt.m_settings[e]):t}static readStringOrDefault(e,t){return void 0===Xt.m_settings||"string"!=typeof Xt.m_settings[e]?t:Xt.m_settings[e]}}let $t=1,Kt=1;const Yt=4096,Jt=2048;class Zt{constructor(){this.textureMemoryAllocated=0,this.allocatedTextures=[]}register(e){this.textureMemoryAllocated+=e.memoryUsage,this.allocatedTextures.push(e)}unregister(e){this.textureMemoryAllocated-=e.memoryUsage,this.allocatedTextures=this.allocatedTextures.filter((t=>t!==e))}}function Qt(e){$t=Kt=e}let er=!0;function tr(e){er=e}function rr(e,t){return{center:e.center.add(t.preTranslation).multiply(t.scale).rotate(t.rotation).add(t.translation),size:e.size.multiply(t.scale.abs()),rotation:t.rotation,flipX:t.scale.x<0,flipY:t.scale.y<0}}class ir{constructor(e,t,r,i,n,s,o){if(this.m_originalSize=x.Zero,this.m_changeTracker=new ue,this.m_compatibleGraphicsProcessorId=0,this.m_isMipMapped=!1,this.m_usageRecord=[],!t.isValid())throw L.Message(512297123,"Unable to create texture on invalid renderer");if(hr(n),this.wrapMode=s,this.releasePolicy=o,this.scenario=e,this.creationTime=performance.now(),this.m_lastRenderTime=r?performance.now():void 0,!isFinite(i.x)||!isFinite(i.y)||i.x<=0||i.y<=0){const t=Xt.readBooleanOrDefault("throwOnInvalidTextureSize",!1),r=L.Error(572319067,`Invalid texture size: ${i.x} x ${i.y}, scenario: ${e}`);if(t)throw r}else{const o=i.ceil();if(o.equals(i)||L.Error(572319068,`Bad texture size. Should be positive integers: ${i.x} x ${i.y}, scenario: ${e}`),this.m_graphicsProcessor=t.getGraphicsProcessor(),!this.m_graphicsProcessor)throw L.Error(592525214,"Unable to set texture if processor not initialized");if(this.m_originalSize=o,this.m_babylonTexture=r instanceof qt?r:r?this.m_graphicsProcessor.createTextureGraphicsResourceFromExternalWebGLTexture(o,n,r,void 0):void 0,this.m_compatibleGraphicsProcessorId=this.m_graphicsProcessor.getUniqueGraphicsProcessorId(),this.m_babylonTexture){const r=ir.GetRequiredSizeForWrapMode(this.m_graphicsProcessor,o,s);if(4!=s&&!r.equals(o)){if(Xt.readBooleanOrDefault("noResample",!1))throw L.Error(572303306,"Invalid texture size for non-clamp scenario: ${scenario}");L.Error(572867283,`Texture size not supported for this wrap mode. The texture will be resampled and the copy will be managed by ShapeBuilder. Please conside resampling explicitely using WrapMode.clamp and cloneWithNewWrapMode when necessary. Scenario: ${e}`);const i=ir.ResampleBabylonTexture(t,this.m_babylonTexture,this.originalSize,4,r,s,n);2==this.releasePolicy?this.releasePolicy=0:this.m_babylonTexture.dispose(),this.m_babylonTexture=i}}}const a=t;this.m_textureManager=a.getTextureManager(),this.m_textureManager.register(this)}static CreateFromByteBuffer(e,t,r,i,n,s,o,a,l,c,h){return ir.CreateOrUpdateFromByteBuffer(e,void 0,t,r,i,n,s,o,a,l,c,h)}static CreateOrUpdateFromByteBuffer(e,t,r,i,n,s,o,a,l,c,h,u){var d,p;if(!r.isValid())throw L.Message(512297122,"Unable to create/update texture on invalid renderer");let f=t;const g=r.getGraphicsProcessor();if(!g)throw L.Error(592525215,"No Graphics Processor");const m=-1==s||-3==s?4:-2==s?5:s;if(!f||f.isValidForGraphicsProcessor(g)&&f.size.equals(i)&&f.m_babylonTexture&&f.format==m&&f.wrapMode==o&&f.m_babylonTexture.invertY==!!l||(f.release(),f=void 0),4==s||5==s||1==s||2==s){if(f&&f.m_babylonTexture)return g.updateTextureGraphicsResourceFromByteBuffer(f.m_babylonTexture,n,n instanceof Float32Array,u||4),f.changeTracker.notifyChange(),f.m_lastRenderTime=performance.now(),f;{const t=g.createTextureGraphicsResource(i,n,s,n instanceof Float32Array,!1,!1,o,a,!!l,u);return new ir(e,r,t,i,s,o,null==c?0:c)}}if(-1==s||-2==s||-3==s){const t=(null==f?void 0:f.m_textureConverterCache)||{},c=-3==s?1:m,g=-1==s||-2==s;let y;if(t.primary=ir.CreateOrUpdateFromByteBuffer(e+"/primary",t.primary,r,i,n,c,o,a,l,0,h,u),t.secondary=-3==s?ir.CreateOrUpdateFromByteBuffer(e+"/secondary",t.secondary,r,new x(Math.ceil(.5*i.x),Math.ceil(.5*i.y)),n.slice(i.x*Math.ceil(i.y/(u||4))*(u||4)),2,o,a,l,0,h,u):void 0,t.primary.m_babylonTexture&&(y=ir.ConvertTexture(e,r,f instanceof nr?f:void 0,t.primary,g,t.secondary,m),y&&h?y.m_textureConverterCache=t:(null===(d=t.primary)||void 0===d||d.release(),null===(p=t.secondary)||void 0===p||p.release()),y))return y.m_lastRenderTime=performance.now(),y}throw"Unsupported texture format"}static CreateFromHTMLElement(e,t,r,i=4,n=!0){if(!t.isValid())throw L.Message(512297121,"Unable to create texture on invalid renderer");const s=t.getGraphicsProcessor();if(!s)throw L.Error(592525216,"No Graphics Processor");const o=new x(r.width,r.height),a=s.createTextureGraphicsResource(o,r,5,!1,!1,!1,i,n,!0);return new ir(e,t,a,o,5,i,0)}static CreateFromHTMLImageElement(e,t,r,i=4,n=!0){return ir.CreateFromHTMLElement(e,t,r,i,n)}static CreateOrUpdateFromHTMLElement(e,t,r,i,n=4,s=!0){if(!r.isValid())throw L.Message(512297120,"Unable to create/update texture on invalid renderer");const o=r.getGraphicsProcessor();if(!o)throw"No Graphics Processor";const a=new x(i.width,i.height);if(t){if(t.isValidForGraphicsProcessor(o)&&t.m_babylonTexture&&t.size.equals(a)&&t.wrapMode==n)return o.updateTextureGraphicsResourceFromHTMLElement(t.m_babylonTexture,i,!0),t.changeTracker.notifyChange(),t.m_lastRenderTime=performance.now(),t;t.release()}return ir.CreateFromHTMLElement(e,r,i,n,s)}static CreateFromTextureAndMask(e,t,r,i,n,s=4,o=!0){const a=t,l=new nr(e,t,n,0,{disableFiltering:!o,wrapMode:s});return a.drawTextureToTexture(l,r,4,{secondaryTexture:i}),l}get graphicsProcessor(){return this.m_graphicsProcessor}get size(){return this.m_babylonTexture?new x(this.m_babylonTexture.width,this.m_babylonTexture.height):x.Zero}get originalSize(){return this.m_originalSize}get changeTracker(){return this.m_changeTracker}get lastUsage(){return this.m_usageRecord.length>0?Math.max(...this.m_usageRecord.map((e=>e.lastUsage))):0}get format(){return this.m_babylonTexture?this.m_babylonTexture.format:(L.Error(572073351,"No texture, no format"),5)}get memoryUsage(){if(!this.graphicsProcessor)return 0;let e=kt[this.format],t=0,r=0;if(this.m_babylonTexture){switch(this.m_babylonTexture.type){case 0:t=1;break;case 1:t=4;break;case 2:t=2;break;default:L.Error(572867285,"Unknown texture type")}r=this.m_babylonTexture._generateStencilBuffer?1:0}return Math.ceil(this.size.x*this.size.y*(e*t+r)*(this.m_isMipMapped?4/3:1))}get usageRecord(){return this.m_usageRecord}get lastRenderTime(){return this.m_lastRenderTime}tryUseBabylonTexture(e,t,r){const i=this.m_usageRecord.find((e=>e.clientObject==t));return i?(i.lastScenario=r,i.lastUsage=performance.now(),i.usageCount++):this.m_usageRecord.push({clientObject:t,lastScenario:r,lastUsage:performance.now(),usageCount:1}),this.isValidForGraphicsProcessor(e)?this.m_babylonTexture:void 0}set originalSize(e){this.m_changeTracker.notifyChange(),this.m_originalSize=e}set contentLocation(e){this.m_changeTracker.notifyChange(),this.m_contentLocation=e}generateMipMap(){const e=this.graphicsProcessor;e&&this.m_babylonTexture?(e.generateMipMap(this.m_babylonTexture),this.m_textureManager&&(this.m_textureManager.textureMemoryAllocated-=this.memoryUsage),this.m_isMipMapped=!0,this.m_textureManager&&(this.m_textureManager.textureMemoryAllocated+=this.memoryUsage)):L.Error(592525218,"Cannot generate mipmaps")}isValidForGraphicsProcessor(e){return this.m_babylonTexture&&this.m_graphicsProcessor==e&&this.m_compatibleGraphicsProcessorId==e.getUniqueGraphicsProcessorId()}isValid(e){const t=e.getGraphicsProcessor();return t&&this.isValidForGraphicsProcessor(t)}getState(e){const t=e.getGraphicsProcessor();return this.m_babylonTexture?t&&this.m_graphicsProcessor==t?this.isValidForGraphicsProcessor(t)?0==this.m_babylonTexture._references?2:0:4:3:1}tryGetWebGLTexture(){return this.m_babylonTexture&&this.m_babylonTexture._webGLTexture||void 0}unregisterFromTextureManager(){this.m_textureManager&&(this.m_textureManager.unregister(this),this.m_textureManager=void 0)}release(){var e,t,r,i;this.unregisterFromTextureManager(),this.m_babylonTexture&&2!=this.releasePolicy&&this.m_babylonTexture.dispose(),this.m_babylonTexture=void 0,null===(t=null===(e=this.m_textureConverterCache)||void 0===e?void 0:e.primary)||void 0===t||t.release(),null===(i=null===(r=this.m_textureConverterCache)||void 0===r?void 0:r.secondary)||void 0===i||i.release(),this.m_changeTracker.notifyChange()}get contentLocation(){const e=this.size;return this.m_contentLocation?this.m_contentLocation:{logicalCenter:e.scale(.5),logicalSize:e,physicalCenter:e.scale(.5),physicalSize:e,rotation:0,flipX:!1,flipY:!1}}get isMipMapped(){return this.m_isMipMapped}cloneWithNewWrapMode(e,t,r,i){const n=this.m_graphicsProcessor;if(!n||!this.m_babylonTexture||!this.isValidForGraphicsProcessor(n))return void L.Error(592472278,"Failed to get graphicsProcessor or valid texture");this.wrapMode==r&&L.Error(592472277,"Why cloning if the wrapmode is the same?");const s=ir.GetRequiredSizeForWrapMode(n,this.size,r),o=ir.ResampleBabylonTexture(t,this.m_babylonTexture,this.originalSize,this.wrapMode,s,r,this.format);if(!o)return;const a=new ir(e,t,o,s,this.m_babylonTexture.format,r,i);return a.originalSize=this.originalSize,a}static GetRequiredSizeForWrapMode(e,t,r){return e.needPowerOf2TexturesForTilingOrMipMap()&&4!=r?new x(B(R((i=t).x),1,2048),B(R(i.y),1,2048)):t;var i}static ResampleBabylonTexture(e,t,r,i,n,s,o){const a=e,l=a.getGraphicsProcessor();if(!l)return void L.Error(572867286,"Failed to get graphicsProcessor");const c=new ir("TMP/ResampleSrc",e,t,r,t.format,i,2),h=new nr("TMP/ResampleDst",e,n,0,{disableFiltering:1==t.samplingMode,format:o});a.drawTextureToTexture(h,c,0);const u=h.m_babylonTexture;return h.unregisterFromTextureManager(),h.m_babylonTexture=void 0,h.release(),u&&l.setWrapMode(u,s),c.release(),u}static ConvertTexture(e,t,r,i,n,s,o){var a;const l=t;if(!l.getGraphicsProcessor())return void L.Error(526714142,"Failed to get graphicsProcessor");const c=1==(null===(a=i.m_babylonTexture)||void 0===a?void 0:a.samplingMode),h=nr.RecycleOrReplace(e,r,t,i.size,!1,o,!1,0,i.wrapMode,c);return l.drawTextureToTexture(h,i,n?2:s?3:0,{secondaryTexture:s}),h}}class nr extends ir{constructor(e,t,r=x.Zero,i,n){if(!t.isValid())throw L.Message(512297119,"Unable to create TargetTexture on invalid renderer");const s=r.ceil(),o=n&&void 0!==n.wrapMode?n.wrapMode:4,a=t,l=a.getGraphicsProcessor();if(!l)return void L.Error(592525217,"Graphics processor not initialized");if(s.isZero())return void L.Error(572867287,"Creating TargetTexture of size 0x0");const c=n&&n.format?n.format:5;let h;hr(c),h=n&&n.externalTexture?l.createTextureGraphicsResourceFromExternalWebGLTexture(s,c,n.externalTexture,n?n.externalFrameBuffer:void 0):l.createTextureGraphicsResource(s,void 0,c,!(!n||!n.useFloat),!0,!!n&&!!n.needsRenderBuffer,o,!n||!n.disableFiltering,!1),super(e,t,h,s,c,o,i),2!=i&&(a.getCurrentFramePerformanceSummary().dynamicTextureAlloc+=this.memoryUsage)}tryGetBabylonTextureForRenderToTexture(e){return this.m_lastRenderTime=performance.now(),this.isValidForGraphicsProcessor(e)?this.m_babylonTexture:void 0}tryConvertToBufferRGBA(){if(this.m_graphicsProcessor&&this.m_babylonTexture)return this.m_graphicsProcessor.copyTexturePixelsToArray(this.m_babylonTexture,E.FromSize(this.size),!0)}tryConvertToCanvas(){if(!this.m_graphicsProcessor||!this.m_babylonTexture)return;const e=document.createElement("canvas");e.width=this.m_babylonTexture.width,e.height=this.m_babylonTexture.height;var t=e.getContext("2d");if(t){const r=this.tryConvertToBufferRGBA();if(r){const i=this.size,n=t.createImageData(i.x,i.y);return n.data.set(r),t.putImageData(n,0,0),t.globalCompositeOperation="copy",t.setTransform(1,0,0,-1,0,i.y),t.drawImage(e,0,0),e}}}tryConvertToDataURL(){const e=this.tryConvertToCanvas();if(e)return e.toDataURL()}static RecycleOrReplace(e,t,r,i,n,s,o,a,l,c){hr(s);const h=r.getGraphicsProcessor();if(t){if(h&&t.isValidForGraphicsProcessor(h)&&t.size.equals(i)&&t.m_babylonTexture&&t.m_babylonTexture.format==s)return t.releasePolicy!=a&&L.Error(572867288,"RecycleOrReplace with different releasePolicy"),t;t.release()}return new nr(e,r,i,a,{format:s,needsRenderBuffer:o,useFloat:n,wrapMode:l,disableFiltering:c})}}const sr=[{attributeName:"a_0",attributeSize:4,offset:0}],or=[{attributeName:"a_1",attributeSize:4,offset:0}];function ar(e,t,r){0==e.length&&L.Error(509634196,"Cannot create vertex buffer array from empty rectangle array.");const i=new Float32Array(4*r);for(let n=0;n<r;n++){const r=e[Math.min(n,e.length-1)];i[4*n+0]=r.left/t.x,i[4*n+1]=r.top/t.y,i[4*n+2]=r.right/t.x,i[4*n+3]=r.bottom/t.y}return i}function lr(e,t,r,i,n,s,o,a,l,c){const h=e.getGraphicsProcessor();if(!h||!h.isValid())return void L.Error(509634336,"Invalid Graphics Processor for Sharpness Filter");if(!r.isValidForGraphicsProcessor(h))return void L.Error(509634335,"Invalid Texture for Sharpness Filter");const u=Math.max(o.length,a.length);if(0==u)return;const d=ar(o,r.size,u),p=ar(a,l,u),f=h.activateShaderProgram(9);f.begin(i.tryGetBabylonTextureForRenderToTexture(h),ge.Transparent,!0);const g=h.getBabylonEngine(),m=g.createVertexBuffer(d),y=g.createVertexBuffer(p);g.bindInstancesBuffer(m,sr,!1),g.bindInstancesBuffer(y,or,!1),f.setTexture("t_0",r.tryUseBabylonTexture(h,void 0,"sharpnessFilterPass")),f.setTexture("t_1",t.tryUseBabylonTexture(h,void 0,"sharpnessFilterPass"));const _=c.sharpness,v=_<0?10.5*-_:1.25*_,b=_<0?1+.8*-_:1,w=1==n&&_>0;f.getBabylonEffect().setFloat("ufrag_0",v),f.getBabylonEffect().setFloat("ufrag_1",b),f.getBabylonEffect().setFloat("ufrag_2",s),f.getBabylonEffect().setInt("ufrag_3",n),f.getBabylonEffect().setBool("ufrag_4",w),f.drawQuadInstances(u),f.disableInstanceAttribute("a_0"),f.disableInstanceAttribute("a_1"),g._releaseBuffer(m),g._releaseBuffer(y),f.end()}function cr(e,t,r,i,n,s,o,a=1,l,c){var h;if(!r.isValidForGraphicsProcessor(e))return void L.Error(591192838,"Invalid Texture");const u=Math.max(i.length,n.length);if(0==u)return;const d=ar(i,r.size,u),p=ar(n,s,u),f=e.getBabylonEngine(),g=f.createVertexBuffer(d),m=f.createVertexBuffer(p);if(f.bindInstancesBuffer(g,sr,!1),f.bindInstancesBuffer(m,or,!1),t.setTexture("t_0",r.tryUseBabylonTexture(e,void 0,"drawTextureRects")),8!=t.programId&&t.getBabylonEffect().setFloat("ufrag_0",a),6==t.programId){const i=null==c?void 0:c.secondaryTexture;t.setTexture("t_1",null==i?void 0:i.tryUseBabylonTexture(e,void 0,"drawTextureRects/Secondary")),t.getBabylonEffect().setInt("ufrag_1",o),function(e,t){const r=null==t?void 0:t.brightnessContrast;if(r){let t,i;ne?(t=1,i=r.brightness):r.brightness>=1?(t=0,i=1):(t=r.brightness>0?1/(1-r.brightness):Math.max(0,1+r.brightness),i=0),e.getBabylonEffect().setInt("ufrag_3",1),e.getBabylonEffect().setArray2("ufrag_4",[t,i]),e.getBabylonEffect().setArray4("ufrag_5",function(e){if(se)return[0,0,e,(1-e)/2];const t=Math.min(Math.abs(e/4),1/4-1/65025),r=64*t*t*t-48*t*t-4*t+3,i=-64*t/r,n=96*t/r,s=(r-32*t)/r;if(e>=0)return[i,n,s,0];const o=Math.max(0,(-n+Math.sqrt(n*n-4*i*s))/(2*i));return[(64*t-32*o)/3,-32*t+16*o,(32*t-22*o+3)/3,o]}(r.contrast))}else e.getBabylonEffect().setInt("ufrag_3",0);const i=null==t?void 0:t.hueSaturationLuminance;i?(e.getBabylonEffect().setInt("ufrag_6",1),e.getBabylonEffect().setFloat("ufrag_7",i.hueRotation),e.getBabylonEffect().setFloat("ufrag_8",i.saturationFactor),e.getBabylonEffect().setFloat("ufrag_9",i.luminanceFactor)):e.getBabylonEffect().setInt("ufrag_6",0);const n=null==t?void 0:t.recolor;if(n){const t=void 0===n.threshold?1:255,r=void 0===n.threshold?0:.5-t*n.threshold;e.getBabylonEffect().setInt("ufrag_10",1),e.getBabylonEffect().setFloat("ufrag_11",t),e.getBabylonEffect().setFloat("ufrag_12",r),e.getBabylonEffect().setVector3("ufrag_13",{x:n.darkColor.r,y:n.darkColor.g,z:n.darkColor.b}),e.getBabylonEffect().setVector3("ufrag_14",{x:n.brightColor.r,y:n.brightColor.g,z:n.brightColor.b})}else e.getBabylonEffect().setInt("ufrag_10",0);const s=null==t?void 0:t.colorTemperature;s?(e.getBabylonEffect().setInt("ufrag_15",1),e.getBabylonEffect().setFloat("ufrag_16",s.redGain),e.getBabylonEffect().setFloat("ufrag_17",s.blueGain),e.getBabylonEffect().setFloat("ufrag_18",s.greenGain)):e.getBabylonEffect().setInt("ufrag_15",0);const o=null==t?void 0:t.sharpness;oe&&o?(e.getBabylonEffect().setInt("ufrag_20",1),e.getBabylonEffect().setFloat("ufrag_21",o.sharpness)):e.getBabylonEffect().setInt("ufrag_20",0)}(t,null==c?void 0:c.pictureEffects),t.getBabylonEffect().setDirectColor4("ufrag_19",l||ge.Transparent),t.getBabylonEffect().setVector2("ufrag_22",r.size);const n=null==c?void 0:c.lookupTableTexture;if((null===(h=null==c?void 0:c.pictureEffects)||void 0===h?void 0:h.lookupTable)&&n){const r=null==c?void 0:c.pictureEffects.lookupTable;t.getBabylonEffect().setFloat4("ufrag_23",r.dimensionR,r.dimensionG,r.dimensionB,r.blocksPerRow),t.setTexture("t_2",n.tryUseBabylonTexture(e,void 0,"drawTextureRects/Secondary"))}else t.getBabylonEffect().setFloat4("ufrag_23",0,0,0,0),t.setTexture("t_2",void 0)}else 8==t.programId&&(null==c?void 0:c.textureTransform)&&(t.getBabylonEffect().setVector2("ufrag_22",r.size),t.getBabylonEffect().setMatrix3x3("u_1",null==c?void 0:c.textureTransform.m));t.drawQuadInstances(u),t.disableInstanceAttribute("a_0"),t.disableInstanceAttribute("a_1"),f._releaseBuffer(g),f._releaseBuffer(m)}function hr(e){switch(e){case 4:case 5:case 1:case 2:break;default:throw"Unsupported texture format"}}function ur(e){return 0==(e&e-1)}class dr{constructor(e,t,r,i){this.triangleCount=t,this.vertexBuffer=r,this.indexBuffer=i,this.m_engine=e.getBabylonEngine(),this.m_compatibleGraphicsProcessorId=e.getUniqueGraphicsProcessorId()}isValid(e){return this.m_compatibleGraphicsProcessorId==e.getUniqueGraphicsProcessorId()}discard(){this.m_engine._releaseBuffer(this.vertexBuffer),this.m_engine._releaseBuffer(this.indexBuffer)}static CreateGridXY(e,t,r,i){const n=new Float32Array(t*r*2);for(let e=0;e<r;e++){const s=I(i.top,i.bottom,e/(r-1));for(let r=0;r<t;r++){const o=2*(r+e*t);n[o]=I(i.left,i.right,r/(t-1)),n[o+1]=s}}const s=new Uint16Array((t-1)*(r-1)*2*3);for(let e=0;e<r-1;e++)for(let r=0;r<t-1;r++)s.set([r+e*t,r+1+e*t,r+(e+1)*t,r+1+(e+1)*t,r+(e+1)*t,r+1+e*t],6*(r+e*(t-1)));const o=e.getBabylonEngine();return new dr(e,(t-1)*(r-1)*2,o.createVertexBuffer(n),o.createIndexBuffer(s))}}const pr=[{attributeName:"a_0",attributeSize:2,offset:0,divisor:0}],fr=[{attributeName:"a_1",attributeSize:2,offset:0,divisor:0}];function gr(e,t,r,i,n,s,o,a,l,c){const h=r.tryUseBabylonTexture(e,c,"blurSrc");if(!h)return void L.Error(592525250,"Invalid Texture");const u=i.tryGetBabylonTextureForRenderToTexture(e);if(!u)return void L.Error(572867298,"Invalid Texture");const d=e.activateShaderProgram(3);d.begin(u,ge.Transparent,!1);const p=d.getBabylonEffect();p.setFloat("u_0",s),p.setVector2("u_1",t),p.setVector2("u_2",a),p.setVector2("u_3",r.size),p.setInt("u_4",l?1:2),d.setTexture("tex_0",h),p.setDirectColor4("ufrag_0",n||ge.Transparent),p.setFloat("ufrag_2",Math.log(s/4)/Math.log(2)),p.setInt("ufrag_3",o),p.setInt("ufrag_4",l?1:2),d.drawQuads(1),d.end(),i.generateMipMap()}function mr(e,t){const r=xr(t,e.contentLocation.logicalSize);let i=S.Scale2D(r.multiply(x.Flip(e.contentLocation.flipX,e.contentLocation.flipY)));return i=i.multiply(S.RotationZ(e.contentLocation.rotation)),i=i.multiply(S.Translation2D(e.contentLocation.logicalCenter)),i=i.multiply(S.Scale2D(e.size.inverse())),i=i.multiply(S.Translation2D(new x(-.5,-.5))),i}function yr(e){return e?e.size.x+"x"+e.size.y:"undefined"}class _r{constructor(e,t){this.contentRotation=0,this.depth=0,this.depthFar=0,this.depthNear=0,this.blendingMode=0,this.overallOpacity=1,this.contentCenter=e?e.center:x.Zero,this.contentSize=e?e.size:x.One,this.contentFlip=e?x.Flip(e.flipX,e.flipY):x.One,this.contentRotation=e?e.rotation:0,this.customMesh=t}getDebugStringInfo(){return["Layer"]}}class vr extends _r{constructor(e,t,r){super(t,r),this.texture=e}getDebugStringInfo(){return["Texture: "+yr(this.texture),(this.fadeInfo?" +Fade ":"")+(this.reflectionGradient?" + Reflection ":"")+(this.customMesh?" + CustomMesh ":"")]}}class br extends _r{constructor(e,t,r,i,n,s){super({center:x.Zero,size:x.One,rotation:0,flipX:!1,flipY:!1},n),this.progress=0,this.textureA=e,this.textureB=t,this.panVector=s,r&&i&&(this.morphingGrid=[r,i])}getDebugStringInfo(){return["Textures: "+yr(this.textureA)+" ➡️ "+yr(this.textureB),(this.fadeInfo?" +Fade ":"")+(this.customMesh?" + CustomMesh ":"")+(this.morphingGrid?" + MorphingGrid ":"")]}}class wr extends br{constructor(e,t,r,i,n,s,o,a,l,c){super(e,t,o,a,l,c),this.textureDeltaWhiteA=r,this.textureDeltaWhiteB=i,this.texturePictureA=n,this.texturePictureB=s}getDebugStringInfo(){return["Textures: "+yr(this.textureA)+" ➡️ "+yr(this.textureB),"TexturesW: "+yr(this.textureDeltaWhiteA)+" ➡️ "+yr(this.textureDeltaWhiteB),"TextureP: "+yr(this.texturePictureA)+" ➡️ "+yr(this.texturePictureB),(this.fadeInfo?" +Fade ":"")+(this.customMesh?" + CustomMesh ":"")+(this.morphingGrid?" + MorphingGrid ":"")]}}class Tr extends vr{constructor(e,t,r,i){super(e,t,i),this.fillBrightness=0,this.distanceFieldMode=2,this.style=r}getDebugStringInfo(){return["Texture: "+yr(this.texture),(this.fadeInfo?" +Fade ":"")+(this.reflectionGradient?" + Reflection ":"")+(this.customMesh?" + CustomMesh ":"")]}}function xr(e,t){return 0!=e.x&&0!=e.y?t.divide(e):0!=e.x?x.One.scale(t.x/e.x):0!=e.y?x.One.scale(t.y/e.y):x.Zero}function Cr(e,t,r){const i=xr(t,e.logicalSize),n=E.FromSizeAndCenter(e.physicalSize,e.physicalCenter.subtract(e.logicalCenter)),s=S.RotationZ(-e.rotation),o=S.ScaleTranslation2D(x.Flip(e.flipX,e.flipY).divide(i),r);return n.transformedBounds(s.multiply(o))}function Sr(e,t,r,i){const n=Ct(t.alignment,e),s=t.isStretched?e:e.transformedBounds(new P(n.negate(),r.originalSize.divide(e.size),0,n));if(s){const o=t.isStretched?t.offset.multiply(s.size):t.offset;let a=t.scale;if(t.isStretched&&t.fillToPreserveAspectRatio){const t=r.originalSize.x/r.originalSize.y,i=e.size.x/e.size.y;a=a.multiply(new x(t>i?t/i:1,t<i?i/t:1))}const l=s.transformedBounds(new P(n.negate(),a,0,n.add(o)));return l&&i?l.transformedBounds(i):l}}function Pr(e,t,r,i,n,s,o){var a,l,c;const h=t instanceof vr?t:void 0,u=t instanceof br?t:void 0,d=t instanceof wr?t:void 0,p=u?u.textureA:h?h.texture:void 0,f=u?u.textureB:void 0,g=u&&u.panVector&&(!p||!f);let m=0;u&&(m=g?p?0:1:u.progress);const y=h?h.reflectionGradient:void 0,_=t instanceof Tr&&!p;if(!_&&!(p&&p.isValidForGraphicsProcessor(e)||f&&f.isValidForGraphicsProcessor(e)))return void L.Error(592525252,"No Texture");const v=t.contentCenter;let b=S.Identity,w=S.Identity;const T=r.getBabylonEffect(),P=r.getBabylonEngine();if(u&&u.morphingGrid&&2==u.morphingGrid.length)T.setInt("u_16",1),T.setFloat("u_17",u.progress),P.bindInstancesBuffer(u.morphingGrid[0],pr),P.bindInstancesBuffer(u.morphingGrid[1],fr),b=S.Scale2D(t.contentSize),w=S.Scale2D(t.contentSize);else{T.setInt("u_16",0),T.setFloat("u_17",0),r.setDummyPointerAttribute("a_0"),r.setDummyPointerAttribute("a_1");const e=p?Cr(p.contentLocation,t.contentSize,t.contentCenter):_?E.FromSizeAndCenter(t.contentSize,t.contentCenter):void 0,i=f?Cr(f.contentLocation,t.contentSize,t.contentCenter):void 0;let n=e&&i?E.UnionRect(e,i):e||i;if(t instanceof Tr&&t.style.pictureOverflow>0&&t.style.pictureBrush&&t.pictureTexture){const e=Sr(t.fillBoundsOverride?t.fillBoundsOverride:E.FromSizeAndCenter(t.contentSize,t.contentCenter),t.style.pictureBrush,t.pictureTexture);e&&(n=E.UnionRect(n,e))}if(!n)return void L.Error(592525253,"Undefined physical bounds");if(n=n.translate(t.contentCenter.negate()),n=t.effectTransform?n.transformedBounds(t.effectTransform):n,n=n&&t.localClipRect?E.IntersectRect(n,t.localClipRect):n,!n)return;n=n.translate(t.contentCenter),b=S.ScaleTranslation2D(n.size,n.center.subtract(v));const s=t.effectTransform?t.effectTransform.inverse():void 0;w=s?b.multiply(s):b}const M=p?w.multiply(mr(p,t.contentSize)):S.Identity,R=f?w.multiply(mr(f,t.contentSize)):S.Identity;let A=S.Identity;if(t instanceof Tr&&t.textCutoutTexture&&p){const e=t.textCutoutTransform||S.Identity;A=w.multiply(e).multiply(mr(t.textCutoutTexture,t.contentSize))}let I=v;g&&u&&u.panVector&&(I=v.add(u.panVector.scale(u.progress-(f?1:0))));let F=S.RotationZ(t.contentRotation).multiply(S.Translation2D(I));n&&(F=F.multiply(n)),T.setMatrix3x3("u_0",b.m),T.setVector2("u_15",t.contentFlip),T.setMatrix3x3("u_1",F.m),T.setVector2("u_2",i),T.setMatrix3x3("u_3",M.m),T.setMatrix3x3("u_11",A.m),T.setMatrix3x3("u_4",R.m),T.setFloat2("ufrag_12",y?y.opacity0:1,y?y.opacity1:1),T.setVector2("u_20",y?y.pos0:x.Zero),T.setVector2("u_21",y?y.pos1:x.Zero),T.setDirectColor4("ufrag_13",s||ge.Transparent),T.setFloat("ufrag_36",m);const D=t.fadeInfo?t.fadeInfo.fadeTexture:void 0;r.setTexture("t_3",D?D.tryUseBabylonTexture(e,t.clientObject,"fadeTexture"):void 0);let k=0;if(t.fadeInfo&&t.fadeInfo.fade){k=t.fadeInfo.fadeMode;const r=t.fadeInfo.fade,i=r.reverse?1-r.progress:r.progress;T.setVector2("ufrag_17",r.getFadeScaleOffset(i,0)),0!=r.preset&&(t.fadeInfo.fadeTexture&&t.fadeInfo.fadeTexture.isValidForGraphicsProcessor(e)?T.setMatrix3x3("u_10",13==r.preset?w.multiply(mr(t.fadeInfo.fadeTexture,t.contentSize)).m:M.multiply(r.getFadeTransform()).m):L.Error(592525254,"fade texture missing"))}T.setInt("ufrag_16",k),T.setFloat("u_18",t.depthFar),T.setFloat("u_19",t.depthNear),T.setFloat("ufrag_41",t.overallOpacity),T.setMatrix3x3("ufrag_42",null!==(l=null===(a=t.colorMatrix)||void 0===a?void 0:a.m)&&void 0!==l?l:S.Identity.m),T.setVector3("ufrag_43",null!==(c=t.colorOffset)&&void 0!==c?c:C.Zero),t instanceof Tr?(function(e,t,r,i,n,s){const o=r.texture,a=r.style;t.setFloat("ufrag_0",r.distRangeSize?.5/r.distRangeSize:1),t.setInt("ufrag_34",o?0:1);const l=7==s&&a.hitTransparentFill,c=a.fillBrush;let h=l?1:c?c.getType():0;const u=6==h?r.fillTexture:void 0;6!=h||u||(h=0);const d=c instanceof _e?!c.color.equals(ge.Transparent):0!=h;if(t.setInt("ufrag_10",h),4==h)t.setFloatArray4("ufrag_3",Er(c));else{const e=l?ge.White:1==h?c.color:7==h?c.foregroundColor:ge.Transparent;t.setDirectColor4("ufrag_3",e)}t.setInt("ufrag_18",6==h&&u&&4==u.wrapMode?1:0),t.setFloat("ufrag_20",6==h?c.opacity:1),t.setInt("u_13",7==h?1:0),t.setMatrix3x3("u_4",r.fillTransformUV?7==h?r.fillTransformUV.m:i.multiply(r.fillTransformUV).m:i.m),t.setDirectColor4("ufrag_22",7==h?c.backgroundColor:ge.Transparent),t.setFloat("ufrag_28",r.fillBrightness);const p=r.pictureTexture;if(t.setInt("ufrag_30",p?1:0),p){const e=a.pictureBrush;t.setInt("ufrag_31",p&&4==p.wrapMode?1:0),t.setFloat("ufrag_32",e.opacity),t.setMatrix3x3("u_5",r.pictureTransformUV?i.multiply(r.pictureTransformUV).m:S.Identity.m)}let f=7==ae?3:7!=s||!a.hasLine||d||p?0:te,g=a.lineBrush&&2!=s?a.lineBrush.getType():0;const m=6==g?r.lineTexture:void 0;6!=g||m||(g=0),f&&(g=1);const y=7==ae?f:Math.max(f,a.hasLine?a.pen.adjustedLineWidth:0);if(t.setFloat("ufrag_1",y),t.setInt("ufrag_11",g),4==g)t.setFloatArray4("ufrag_4",Er(a.lineBrush));else{let e=ge.Transparent;f?e=7==ae?ge.Red:ge.White:1==g?e=a.lineBrush.color:7==g&&(e=a.lineBrush.foregroundColor),t.setDirectColor4("ufrag_4",e)}t.setInt("ufrag_19",6==g&&m&&4==m.wrapMode?1:0),t.setFloat("ufrag_21",6==g?a.lineBrush.opacity:1),t.setInt("u_14",7==g?1:0),t.setMatrix3x3("u_6",r.lineTransformUV?7==g?r.lineTransformUV.m:i.multiply(r.lineTransformUV).m:i.m),t.setDirectColor4("ufrag_23",7==g?a.lineBrush.backgroundColor:ge.Transparent),t.setFloat("ufrag_29",1==r.mergeMode?1:0),t.setFloat("ufrag_6",a.pen&&0!=a.pen.dashType&&a.pen.useRoundDash?1:0);const _=f?Mr[0]:!(v=a.pen).compoundType||v.tipType?Mr[0]:v.compoundType>=0&&v.compoundType<Mr.length?Mr[v.compoundType]:(L.Error(587220940,"unsupported compoundType"),Mr[0]);var v;t.setFloatArray3("ufrag_8",_.centers),t.setFloatArray3("ufrag_9",_.slopes);const b=Math.sqrt(2)/2,w=new x(b,b),T=n?n.transformVector(w).length():1;if(t.setFloat("ufrag_2",1/T),t.setFloat("ufrag_27",B(bt(a.pen),-1,1)*y/2),t.setInt("ufrag_37",o&&2==r.distanceFieldMode?1:0),t.setInt("ufrag_38",0==a.pen.dashType&&0==a.pen.compoundType||7==s?1:0),r.softEdges&&r.softEdges.radius>0&&r.softEdgesTexture&&r.softEdgesTexture.isValidForGraphicsProcessor(e)?(t.setInt("ufrag_24",1),t.setMatrix3x3("u_7",i.multiply(mr(r.softEdgesTexture,r.contentSize)).m)):(t.setInt("ufrag_24",0),r.softEdges&&r.softEdges.radius>0&&L.Error(588006213,"soft edges texture not ready")),r.innerShadow&&r.innerShadow.color.a>0&&r.innerShadowTexture&&r.innerShadowTexture.isValidForGraphicsProcessor(e)){const e=new x(r.innerShadow.distance,0).rotate(r.innerShadow.angle),n=i.multiply(S.Translation2D(e)).multiply(mr(r.innerShadowTexture,r.contentSize));t.setInt("ufrag_25",1),t.setMatrix3x3("u_8",n.m),t.setDirectColor4("ufrag_26",r.innerShadow.color)}else t.setInt("ufrag_25",0),r.innerShadow&&r.innerShadow.color.a>0&&L.Error(588006214,"inner shadow  exture not ready");t.setInt("ufrag_39",r.textRenderMode||0),t.setFloat("ufrag_40",a.pictureOverflow),t.setInt("ufrag_15",7==s||5==s?1:5==ae?10:0!=ae&&7!=ae?ae+10:0),7==ae&&(t.setInt("ufrag_10",0),t.setInt("ufrag_11",1)),0==s&&3==r.blendingMode&&t.setDirectColor4("ufrag_13",ge.White)}(e,T,t,w,n,o),r.setTexture("t_0",p?p.tryUseBabylonTexture(e,t.clientObject,"distanceField"):void 0),r.setTexture("t_1",t.fillTexture?t.fillTexture.tryUseBabylonTexture(e,t.clientObject,"fillTexture"):void 0),r.setTexture("t_2",t.lineTexture?t.lineTexture.tryUseBabylonTexture(e,t.clientObject,"lineTexture"):void 0),r.setTexture("t_4",t.softEdgesTexture?t.softEdgesTexture.tryUseBabylonTexture(e,t.clientObject,"softEdgesTexture"):void 0),r.setTexture("t_5",t.innerShadowTexture?t.innerShadowTexture.tryUseBabylonTexture(e,t.clientObject,"innerShadowTexture"):void 0),r.setTexture("t_6",t.pictureTexture?t.pictureTexture.tryUseBabylonTexture(e,t.clientObject,"pictureTexture"):void 0),r.setTexture("t_7",t.textCutoutTexture?t.textCutoutTexture.tryUseBabylonTexture(e,t.clientObject,"textCutoutTexture"):void 0)):(function(e){e.setFloat("ufrag_0",0),e.setFloat("ufrag_1",0),e.setFloat("ufrag_2",0),e.setDirectColor4("ufrag_3",ge.Transparent),e.setDirectColor4("ufrag_4",ge.Transparent),e.setFloat("ufrag_6",0),e.setFloatArray3("ufrag_8",new Float32Array([0,0,0])),e.setFloatArray3("ufrag_9",new Float32Array([0,0,0])),e.setInt("ufrag_10",0),e.setInt("ufrag_11",0),e.setInt("ufrag_18",0),e.setInt("ufrag_19",0),e.setFloat("ufrag_20",1),e.setFloat("ufrag_21",1),e.setDirectColor4("ufrag_22",ge.Transparent),e.setDirectColor4("ufrag_23",ge.Transparent),e.setInt("ufrag_24",0),e.setInt("ufrag_25",0),e.setDirectColor4("ufrag_26",ge.Transparent),e.setFloat("ufrag_27",0),e.setFloat("ufrag_28",0),e.setFloat("ufrag_29",0),e.setInt("ufrag_30",0),e.setInt("ufrag_31",0),e.setFloat("ufrag_32",0),e.setInt("ufrag_34",0),e.setInt("u_13",0),e.setInt("u_14",0),e.setInt("ufrag_39",0),e.setFloat("ufrag_40",0)}(T),T.setInt("ufrag_15",d?3:2),r.setTexture("t_0",p?p.tryUseBabylonTexture(e,t.clientObject,t instanceof br?"morphA":"sprite"):void 0),r.setTexture("t_1",f?f.tryUseBabylonTexture(e,t.clientObject,"morphB"):void 0),r.setTexture("t_2",d?d.textureDeltaWhiteA.tryUseBabylonTexture(e,t.clientObject,"morphAW"):void 0),r.setTexture("t_4",d?d.textureDeltaWhiteB.tryUseBabylonTexture(e,t.clientObject,"morphBW"):void 0),r.setTexture("t_5",d?d.texturePictureA.tryUseBabylonTexture(e,t.clientObject,"morphAP"):void 0),r.setTexture("t_6",d?d.texturePictureB.tryUseBabylonTexture(e,t.clientObject,"morphBP"):void 0),r.setTexture("t_7",void 0),d&&T.setMatrix3x3("u_5",d.pictureTransformUV?w.multiply(d.pictureTransformUV).m:S.Identity.m));const O=0==o,U=1==t.blendingMode||5==t.blendingMode;T.setInt("ufrag_35",O&&U?1:0),r.setBlendingMode(O?t.blendingMode:0),t.customMesh?r.drawMesh(t.customMesh):r.drawQuads(1)}function Er(e){const t=e.fillToRect?e.fillToRect:new E(.5,.5,.5,.5),r=e.fillFromRect?e.fillFromRect:new E(0,0,1,1),i=t.translate(r.leftTop.negate()).multiply(r.size.inverse());return new Float32Array([1/i.left,1/i.top,1/(1-i.right),1/(1-i.bottom)])}const Mr=[{centers:new Float32Array([0,0,0]),slopes:new Float32Array([1,1,1])},{centers:new Float32Array([-2/3,2/3,2/3]),slopes:new Float32Array([3,3,3])},{centers:new Float32Array([-.4,.8,.8]),slopes:new Float32Array([5/3,5,5])},{centers:new Float32Array([-.8,.4,.4]),slopes:new Float32Array([5,5/3,5/3])},{centers:new Float32Array([-5/6,0,5/6]),slopes:new Float32Array([6,3,6])}],Rr=[1,1,2,4,8,16,16];function Ar(e,t,r=!1,i=!1,n){const s=[],o=i?[]:void 0;if(!e.figures||0==e.figures.length)return{buffers:s,endDistance:0};let a=0;for(let l=0;l<e.figures.length;l++){const c=r?e.figures[l].toPolygon():e.figures[l],h=N(43),u=c.isLastPointDuplicated(),d=c.isClosed||u,p=Br(c.points,c.format,43,0,u?c.points.length-c.pointDataSize:c.points.length,1,3,d,e.maxPressure),f=p.length/h;let g;if(i){const e=Ir(p,43,d,a,n,1,3);g=e.distanceArray,a=e.endDistance}const m=p.length;if(m>t){const e=t/h-4,r=Math.ceil((f-4)/e),i=e+4;let n=0;for(let e=0;e<r;e++){const e=Math.min(i,f-n),t=e-4;s.push(p.subarray(n*h,(n+e)*h)),o&&g&&o.push(g.subarray(n,n+e)),n+=t}}else{const e=new Float32Array(4*Math.ceil(m/4));e.set(p,0),s.push(e),o&&g&&o.push(g)}}return o&&o.length!=s.length&&L.Error(592525388,"Invalid distance array"),{buffers:s,distanceBuffers:o,endDistance:a}}function Br(e,t,r,i=0,n=e.length,s=0,o=0,a=!0,l=1){let c=N(t),h=n-i;if(!(h%c==0&&1&t&&1&r))throw L.Error(592525389,"list of source points invalid");let u=e,d=h/c;1==d&&(u=new Float32Array(2*e.length),u.set(e,0),u.set(e,e.length),d=2);const p=c;c=N(r);const f=new Float32Array((s+d+o)*c);for(let e=0;e<d;e++){let n=i+e*p,o=(s+e)*c;for(const e of Rr)e&r&&(f[o]=8==e?e&t?u[n]/l:1:e&t?u[n]:2==e?1:0,o++),e&t&&n++}if((s||o)&&(s>0&&f.copyWithin(0,f.length-(s+o)*c,f.length-o*c),o>0&&f.copyWithin(f.length-o*c,s*c,(s+o)*c),!a&&2&r)){for(let e=0;e<s;e++)f[e*c+2]=0;for(let e=0;e<o;e++)f[f.length-(e+1)*c+2]=0}return f}function Ir(e,t,r,i=0,n,s=0,o=0){const a=n?function(e,t,r){const i=N(t);if(0==i||e.length%i!=0||!(1&t))throw L.Error(592525390,"list of points for invalid for measuring distance");const n=r.m,s=new Float32Array(e);for(let t=0;t<e.length;t+=i){const r=e[t],i=e[t+1];s[t]=r*n[0]+i*n[3]+n[6],s[t+1]=r*n[1]+i*n[4]+n[7]}return s}(e,t,n):e,l=N(t);if(0==l||a.length%l!=0||a.length/l<s+o+1||!(1&t))throw L.Error(587534800,"list of points for invalid for measuring distance");const c=new Float32Array(a.length/l),h=s*l,u=(a.length-o*l-h)/l,d=2&t;let p=i||0;for(let e=0;e<u;e++){const t=h+e*l;if(2!=(d?a[t+2]:1)&&(c[s+e]=p,r||e<u-1)){const i=h+(e+1)%u*l,n=d?a[i+2]:1;if(2!=n){let e=a[i]-a[t],r=a[i+1]-a[t+1];p+=Math.sqrt(e*e+r*r)}else if(2==n&&(r||e<u-2)){const r=h+(e+2)%u*l;p+=F(a[t],a[t+1],a[i],a[i+1],a[r],a[r+1])}}}const f=p-i;for(let e=0;e<s;e++)c[e]=c[s+u-s+e]-f;for(let e=s+u;e<a.length/l;e++)c[e]=c[e+s-(s+u)]+f;for(let e=0;e<u;e++){const t=h+e*l;if(d&&2==a[t+2]){const t=0==s&&0==e?u-1:s+e-1,r=0==o&&e==u-1?s:s+e+1;c[s+e]=.5*(c[t]+c[r])}}return{distanceArray:c,endDistance:p}}class Fr{constructor(e,t,r,i,n,s,o,a){this.m_renderer=t,this.pathIndexRange=r,this.fillMode=i,this.distRangeSize=0,this.contentQuality=0,this.enableMipMap=!1,this.mergeMode=0,this.distanceFieldMode=s,this.scenario=e,this.releasePolicy=o,this.isDisplacementMap=a}get size(){return this.texture?this.texture.size:x.Zero}refresh(e,t,r){const i=e,n=i.getGraphicsProcessor();if(!n)throw L.Error(591524387,"Graphics processor not initialized");const s=Xt.readBooleanOrDefault("forceRefreshDistanceField",!1);if(!r&&!s&&this.geometryUniqueId==t.geometryTracker.currentUniqueId&&this.texture&&this.texture.isValidForGraphicsProcessor(n))return!0;const o=this.getContentBounds(t);if(!o)return L.Error(570959637,"Shape has no bounds"),this.texture&&this.texture.release(),!1;const a=this.getQualityToUse(t),l=this.getPixelPaddingInShapeUnits(t),c=o.size.scale(a).add(new x(2*l*a,2*l*a)),h=this.enableMipMap?new x(A(c.x),A(c.y)):c.ceil(),u=h.scale(Math.min(1,Yt/h.x,Yt/h.y)).ceil(),d=new x(B(u.x,16,Yt),B(u.y,16,Yt)),p=this.texture;if(this.texture=nr.RecycleOrReplace(this.scenario,p,e,d,this.isDisplacementMap,5,!0,this.releasePolicy),!this.texture||!this.texture.graphicsProcessor)return!1;if(r&&p!=this.texture)return L.Error(591524416,"Cannot update incrementally: texture had to be recreated"),!1;const f=a*Math.min(d.x/c.x,d.y/c.y),g=E.FromSizeAndCenter(d.scale(1/f),o.center),m=l*f/a;return this.rasterize(t,r,g,f,m,i.getCurrentFramePerformanceSummary()),!0}getQualityToUse(e){return this.qualityOverride?this.qualityOverride:e.hasSmallDetails()?2*$t:$t}getContentBounds(e){if(this.contentBoundsOverride)return this.contentBoundsOverride;const t=e.incrementalPath?e.incrementalPath.bounds:wt(e,1!=this.distanceFieldMode);if(!t)return;const r=t.size;if(!isFinite(r.x)||!isFinite(r.y))return void L.Error(562151697,`Invalid shape bounds for SDF: ${r.x} x ${r.y}, scenario: ${this.scenario}`);const i=e.transform.scale;if(isFinite(i.x)&&isFinite(i.y))return t.multiply(i.abs());L.Error(562151698,`Invalid shape scale for SDF: ${i.x} x ${i.y}, scenario: ${this.scenario}`)}getFillBrightness(){return 2==this.fillMode?.4:3==this.fillMode?.2:4==this.fillMode?-.4:5==this.fillMode?-.2:0}getPixelPaddingInShapeUnits(e){if(null!=this.paddingOverride)return this.paddingOverride;const t=Xt.readNumberOrDefault("maxReasonableZoomOut",10);return e.style.hasLine?Math.ceil(Math.max(te/2,t)):t}rasterize(e,t,r,i,n,s){if(!this.texture||!this.texture.graphicsProcessor)return L.Error(591524418,"No gl texture or context"),!1;const o=e.transform.scale.abs();let a=wt(e,!1,S.Scale2D(o).multiply(new P(r.center.negate(),e.transform.scale.sign(),0,r.center).toMatrix3()));if(!a)return L.Error(591524420,"Nothing to render"),!1;const l=new x(i,i),c=r.size,h=this.size.scale(.5),u=new P(r.center.negate(),l,0,h),d=r.transformedBounds(u),p=a.transformedBounds(u);if(!d||!p)return L.Error(588006216,"Nothing to render"),!1;if(this.contentQuality=i,this.localBounds=r?r.multiply(o.inverse()):void 0,this.renderScale=l.divide(this.size),this.uvScale=c.multiply(this.renderScale).multiply(e.transform.scale.sign()),this.texture.contentLocation={logicalCenter:p.center,logicalSize:p.size,physicalCenter:d.center,physicalSize:d.size,rotation:0,flipX:e.transform.scale.x<0,flipY:e.transform.scale.y<0},!this.localBounds||!this.renderScale)return L.Error(591524421,"no bounds or renderScale"),!1;s.pixelCountDistanceField+=Math.floor(this.size.x*this.size.y);const f=5==ae;let g=.5*(e.style.pen?e.style.pen.adjustedLineWidth*(1+Math.min(Math.abs(bt(e.style.pen)),1)):0);if(this.isDisplacementMap&&e.shape3D){let t=.5*Math.max(e.shape3D.topBevel?e.shape3D.topBevel.size.x:0,e.shape3D.bottomBevel?e.shape3D.bottomBevel.size.x:0,e.shape3D?.5*e.shape3D.adjustedContourWidth:0);g=Math.max(g,2*t-g)}return this.distRangeSize=f?Math.max(c.x/2,c.y/2):Math.max(g,n),function(e,t,r,i,n,s,o,a,l,c,h,u,d){const p=performance.now(),f=r.texture;if(!f)return L.Error(572842049,"DistanceFieldTexture not initialized"),!1;let g,m=h?void 0:ge.Transparent;if(i.paths&&!i.incrementalPath)g=$r(e,t,i.paths,i.style.hasLine?i.style.pen:void 0,!1,1!=l,2==l,i.transform.scale,n,u,d,!!r.isGlyphCache,!!r.isGlyphCacheDisabled);else if(i.incrementalPath){const s=f.tag,o=s&&s.incrementalPathTrackerId==i.incrementalPath.changeTracker.trackerId;(!o||s&&(0==s.figureCount||1==s.figureCount&&0==s.lastFigurePointCount))&&(m=ge.Transparent);const a=o&&s.figureCount>0?s.figureCount-1:0,c=[];for(let e=a;e<i.incrementalPath.figures.length;e++){const t=i.incrementalPath.figures[e],r=o&&e==a&&s.lastFigurePointCount>0?s.lastFigurePointCount-1:0,n=t.getPointCount();c.push(new V(t.data.slice(r*i.incrementalPath.pointDataSize,n*i.incrementalPath.pointDataSize),!1,i.incrementalPath.format))}f.tag={incrementalPathTrackerId:i.incrementalPath.changeTracker.trackerId,figureCount:i.incrementalPath.figures.length,lastFigurePointCount:i.incrementalPath.figures.length>0?i.incrementalPath.figures[i.incrementalPath.figures.length-1].getPointCount():0},g=$r(e,t,[new O({figures:c,fillMode:0})],i.style.hasLine?i.style.pen:void 0,!1,1!=l,2==l,i.transform.scale,n,u,d,!!r.isGlyphCache,!!r.isGlyphCacheDisabled)}if(!g)return L.Error(592525084,"Nothing to render"),!1;const y=e.activateShaderProgram(0);y.begin(f.tryGetBabylonTextureForRenderToTexture(e),m,!1);const _=y.getBabylonEffect();_.setVector2("u_0",s.center.multiply(i.transform.scale)),_.setVector2("u_1",i.transform.scale),_.setVector2("u_2",o),_.setFloat("u_3",c),_.setFloat("ufrag_10",i.style&&i.style.pen?2*c/(i.style.pen.adjustedLineWidthForArrowHead+1):0),_.setFloat("ufrag_11",i.transform.scale.x*i.transform.scale.y),_.setInt("ufrag_7",ae),_.setInt("u_13",ae),_.setInt("u_15",0==i.style.pen.compoundType?0:1),_.setVector2("u_17",i.style.pen.tipScale?i.style.pen.tipScale:x.One),_.setInt("u_18",i.style.pen.tipType?i.style.pen.tipType:0);const v=(i.style.pen.adjustedLineWidth/2+1/r.contentQuality)/(2*c);_.setFloat("ufrag_15",0==i.style.pen.alignment?v:2*v);for(const e of g.transformedPaths){const r=qr(a);if(r)for(let n=r.start;n<=r.last;n++)Xr(n,!0,e,a,u)&&(Yr(y,n,!0,i),2==n?y.drawQuads(1):Jr(y,n,!0,i,[e],a,l,u,t.getCurrentFramePerformanceSummary(),c,null!=i.shape3D))}const b=function(e){return 1==e?Le.FromFirstLast(0,0):Le.FromFirstLast(0,1==ae||2==ae?0:2)}(a);if(b)for(let e=b.start;e<=b.last;e++)Yr(y,e,!1,i),2==e?y.drawQuads(1):Jr(y,e,!1,i,g.transformedPaths,a,l,u,t.getCurrentFramePerformanceSummary(),c,null!=i.shape3D);if(y.end(),er&&Lr&&g.cachedGlyphsPages.length>0){const t=e.activateShaderProgram(5);if(t.begin(f.tryGetBabylonTextureForRenderToTexture(e),void 0,!1),Kr(t,0,0),r.localBounds&&r.uvScale)for(const i of g.cachedGlyphsPages)if(i.cachedGlyphInstances.length>0){const n=new Array(i.cachedGlyphInstances.length),s=new Array(i.cachedGlyphInstances.length);for(let e=0;e<i.cachedGlyphInstances.length;e++){const t=i.cachedGlyphInstances[e];n[e]=t.srcRect,s[e]=t.dstRect.translate(r.localBounds.center.negate()).multiply(f.size.multiply(r.uvScale).multiply(r.localBounds.size.inverse())).translate(f.size.scale(.5))}const o=Lr[i.page].texture;o?cr(e,t,o,n,s,f.size,0,Lr[i.page].distRangeSize/r.distRangeSize*(i.cachedGlyphInstances[0].dstRect.size.y/i.cachedGlyphInstances[0].srcRect.size.y)):L.Error(572867297,"glyphPageTexture missing")}t.end()}return f.renderCost=performance.now()-p,!0}(this.texture.graphicsProcessor,this.m_renderer,this,e,this.pathIndexRange,this.localBounds,this.renderScale,this.mergeMode,this.distanceFieldMode,this.distRangeSize,t,1==this.generateDrawFadeMask,this.isDisplacementMap)&&(this.geometryUniqueId=e.geometryTracker.currentUniqueId,this.lastKnownQualitySetting=$t,this.lastKnownLineWidth=e.style.pen.adjustedLineWidth,this.lastKnownLineWidthForArrowHead=e.style.pen.adjustedLineWidthForArrowHead,this.lastKnownHitTestSlop=te,this.enableMipMap&&this.texture.generateMipMap()),!1}}function Dr(e){return e?e.fontId+":"+e.glyphId:void 0}let Lr,kr={},Or=[],Ur=0;function Nr(){for(let e of Lr||[])e.texture&&e.texture.release();Lr=void 0,kr={},Or=[]}function Vr(){return Ur-16}function Gr(){return Vr()/16}function zr(){return 7*Gr()/8}function Hr(){return Gr()/16}const Wr=[{attributeName:"a_p0",attributeSize:4,offset:0},{attributeName:"a_p1",attributeSize:4,offset:16},{attributeName:"a_p2",attributeSize:4,offset:32},{attributeName:"a_p3",attributeSize:4,offset:48},{attributeName:"a_p4",attributeSize:4,offset:64}],jr=[{attributeName:"a_d1",attributeSize:1,offset:4},{attributeName:"a_d2",attributeSize:1,offset:8}];function qr(e){if(1==e)return Le.FromFirstLast(0,3)}function Xr(e,t,r,i,n){return!(n&&0!=e||1!=i&&t||0!=e&&0==r.fillMode)}function $r(e,t,r,i,n,s,o,a,l,c,h,u,d){const p=4096,f=[],g=[];if(0==r.length)return{transformedPaths:f,cachedGlyphsPages:g};l&&(l.start<0||l.last>=r.length)&&L.Error(592525078,"pathIndexRange out of range");const m=l?Math.max(l.start,0):0,y=l?Math.min(l.last,r.length-1):r.length-1,_=i&&(K(i.headEnd,i.adjustedLineWidthForArrowHead)>0||K(i.tailEnd,i.adjustedLineWidthForArrowHead)>0),v=c||!!i&&0!=i.dashType||_,b=er&&!i;for(let l=m;l<=y;l++){const c=r[l];if(h&&!c.extrusionEnabled)continue;const m=c.transform.scale.x>=zr()/4096;c.glyphCacheId?u?t.getCurrentFramePerformanceSummary().glyphCountAddedToCache++:(t.getCurrentFramePerformanceSummary().glyphCount++,m&&t.getCurrentFramePerformanceSummary().glyphCountLargeText++,null!=i&&t.getCurrentFramePerformanceSummary().glyphCountTextOutline++):t.getCurrentFramePerformanceSummary().pathCount++;let y=!1;const _=Dr(c.glyphCacheId);if(!d&&_&&b&&Lr&&0==c.transform.rotation&&Math.abs(c.transform.scale.x-c.transform.scale.y)<T&&!m&&kr[_]){const e=kr[_];if(e.page<0||e.page>=Lr.length)L.Error(592525079,"Invalid glyph page");else{const r=Lr[e.page];if(r.texture){const i=r.localBounds?r.localBounds.center:void 0,n=r.localBounds&&i&&r.uvScale?r.localBounds.translate(i.negate()).multiply(r.uvScale.inverse()).translate(i):void 0,s=r.localBounds&&n&&r.uvScale?e.bounds.multiply(r.uvScale).translate(n.leftTop.negate()):void 0,o=e.bounds.translate(e.offset.negate()).multiply(new x(1/e.scale,1/e.scale)).transformedBounds(c.transform);if(s)if(o)if(s.right<0||s.bottom<0||s.left>=Vr()||s.top>=Vr())L.Error(592525082,"Cached glyph src rect out of bounds");else{const r={srcRect:s,dstRect:o,distanceScale:1};let i;for(let t=0;t<g.length&&!i;t++)g[t].page==e.page&&(i=g[t]);i||(i={page:e.page,cachedGlyphInstances:[]},g.push(i)),i.cachedGlyphInstances.push(r),y=!0,t.getCurrentFramePerformanceSummary().glyphCountReadFromCache++}else L.Error(592525081,"Cached glyph dst rect undefined");else L.Error(592525080,"Cached glyph src rect undefined")}else L.Error(572867295,"Glyph page texure missing")}}if(!y){c.glyphCacheId&&!u&&t.getCurrentFramePerformanceSummary().glyphCountRenderedAsPath++;const r=t.ensurePathRenderData(c);r.refreshCachedHwTapeBuffers(c,e);let l,d=r.tapeBuffers,g=0;if(!d||v||n)if(v||n){const e=Ar(c,p,n,v,v?S.FromTransforms(c.transform,S.Scale2D(a)):void 0);d=e.buffers,l=e.distanceBuffers,g=e.endDistance}else d=r.refreshCachedTapeBuffers(c);const m=e.getBabylonEngine();let y,_=r.hwTapeBuffers;_||(_=d.map((e=>m.createVertexBuffer(e)))),l&&(y=l.map((e=>m.createVertexBuffer(e))));const b=c.transform.toMatrix3(),w={tapeBuffers:d,hwTapeBuffers:_,hwDistanceBuffers:y,fillMode:h?1:o?0:c.fillMode,lineEnabled:s&&c.lineEnabled,isArrowHead:!1,transform:b,startDistance:0,endDistance:g};if(f.push(w),o&&i&&(0!=i.headEnd.end||0!=i.tailEnd.end)){const e=i.adjustedLineWidthForArrowHead,t=b.multiply(S.Scale2D(a)),r=S.Scale2D(a.inverse());for(const n of c.figures){const s=n.isClosed||n.isLastPointDuplicated();if(i.headEnd&&0!=i.headEnd.end&&!s){const s=j(i.headEnd,e);if(s){const o=$(n,!1,i.headEnd,e,t),a=Ar(O.CreateFromFigure(s),p).buffers;f.push({tapeBuffers:a,hwTapeBuffers:a.map((e=>m.createVertexBuffer(e))),hwDistanceBuffers:void 0,fillMode:5==i.headEnd.end?0:1,lineEnabled:!0,isArrowHead:!0,transform:o?o.multiply(r):void 0,startDistance:0,endDistance:0})}}if(i.tailEnd&&0!=i.tailEnd.end&&!s){const s=j(i.tailEnd,e);if(s){const o=$(n,!0,i.tailEnd,e,t),a=Ar(O.CreateFromFigure(s),p).buffers;f.push({tapeBuffers:a,hwTapeBuffers:a.map((e=>m.createVertexBuffer(e))),hwDistanceBuffers:void 0,fillMode:5==i.tailEnd.end?0:1,lineEnabled:!0,isArrowHead:!0,transform:o?o.multiply(r):void 0,startDistance:0,endDistance:0})}}}}}}return{transformedPaths:f,cachedGlyphsPages:g}}function Kr(e,t,r){const i=e.getBabylonEngine();0==t?(i.setColorWrite(!0),i.depthCullingState.depthMask=!0,i.stencilState.stencilTest=!1,i.stencilState.stencilMask=255,i.stencilState.stencilFunc=519,i.stencilState.stencilFuncRef=0,i.stencilState.stencilFuncMask=3,i.alphaState.alphaBlend=!0,i.alphaState.setAlphaBlendFunctionParameters(1,1,1,1),i.alphaState.setAlphaEquationParameters(32776,32776),i.clear(null,!1,!1,!0)):1==t?(i.setColorWrite(!1),i.depthCullingState.depthMask=!1,i.stencilState.stencilTest=!0,i.stencilState.stencilMask=255,i.stencilState.stencilFunc=519,i.stencilState.stencilFuncRef=1,i.stencilState.stencilFuncMask=255):(i.setColorWrite(!0),i.depthCullingState.depthMask=!0,i.stencilState.stencilMask=0,2==t?(i.stencilState.stencilTest=!0,i.stencilState.stencilFunc=517,i.stencilState.stencilFuncRef=0,i.stencilState.stencilFuncMask=1==r?255:3,i.alphaState.alphaBlend=!0,i.alphaState.setAlphaBlendFunctionParameters(775,769,773,771),i.alphaState.setAlphaEquationParameters(32774,32774)):3==t&&(i.stencilState.stencilTest=!1,i.alphaState.alphaBlend=!0,i.alphaState.setAlphaBlendFunctionParameters(772,1,0,0),i.alphaState.setAlphaEquationParameters(32774,32774)))}function Yr(e,t,r,i){let n=r&&!(3==t);Kr(e,t,i.overlapMode);const s=e.getBabylonEffect();s.setInt("u_7",t),s.setInt("ufrag_0",t),s.setFloat("ufrag_8",n?1:0);let o=0;const a=Qr(i.style.pen);if(a&&a.length>0)for(let e=0;e<a.length;e++)o+=a[e];0==o&&(o=1);const l=0==i.style.pen.headEnd.cap?1:0;s.setFloat("ufrag_5",a&&a.length>0?.5-(a[0]-l)/(2*o):0),s.setFloat("ufrag_4",a&&a.length>0?1/(o*i.style.pen.adjustedLineWidth):0)}function Jr(e,t,r,i,n,s,o,a,l,c,h){if(0==t&&3==ae)return;let u=-performance.now();const d=e.getBabylonEffect(),p=e.getBabylonEngine();d.setFloat("u_12",i.style.pen.adjustedLineWidth),d.setFloat("u_5",i.style.pen.miterLimit);let f=0;const g=Qr(i.style.pen),m=g?g.length:0;if(i.style.pen&&g){for(let e=0;e<m;e++)f+=g[e];f=f>0?f:1,d.setFloat("ufrag_12",f/2),d.setFloat4("ufrag_13",m>=2?g[0]/2:f,m>=3?g[0]/2+g[1]:f,m>=4?g[0]/2+g[1]+g[2]:f,m>=5?g[0]/2+g[1]+g[2]+g[3]:f)}else d.setFloat("ufrag_12",.5),d.setFloat4("ufrag_13",1,1,1,1);d.setFloat("u_14",n.length>0&&n[0].isArrowHead||0==i.style.pen.headEnd.cap?1:0);for(const l of n){if(!Xr(t,r,l,s,a))continue;const u=(0!=l.fillMode||2==o)&&2==o==l.isArrowHead&&(0==s||1==s&&r),f=l.lineEnabled&&!l.isArrowHead,g=l.isArrowHead&&0==l.fillMode,m=g?f:u,y=g?u:f;d.setMatrix3x3("u_8",l.transform?l.transform.m:S.Identity.m),d.setInt("ufrag_17",a?1:0),a&&d.setFloat("ufrag_12",1/l.endDistance),d.setFloat("ufrag_19",l.isArrowHead&&0==l.fillMode&&c?i.style.pen.adjustedLineWidth/4/c:0);const _=n.length>0&&l.isArrowHead||h?1:i.style.pen?i.style.pen.lineJoin:0;d.setInt("u_4",_),d.setInt("ufrag_1",_);for(let r=0;r<l.tapeBuffers.length;r++){const n=l.tapeBuffers[r],s=l.hwTapeBuffers[r],o=l.hwDistanceBuffers?l.hwDistanceBuffers[r]:void 0,a=n.length/4-4;if(p.bindInstancesBuffer(s,Wr,!1),o?(d.setInt("u_19",0),p.bindInstancesBuffer(o,jr,!1)):(d.setInt("u_19",1),e.setDummyPointerAttribute("a_d1"),e.setDummyPointerAttribute("a_d2")),0==n[2]&&l.startDistance!=l.endDistance){const e=K(i.style.pen.headEnd,i.style.pen.adjustedLineWidthForArrowHead),t=K(i.style.pen.tailEnd,i.style.pen.adjustedLineWidthForArrowHead);d.setFloat2("ufrag_16",l.startDistance+e,l.endDistance-t)}else d.setFloat2("ufrag_16",0,0);d.setFloat("ufrag_2",m?1:0),d.setFloat("ufrag_3",y?1:0),d.setFloat("ufrag_18",g?1:0),1==t?(d.setFloat("ufrag_6",1),e.setDistanceFieldStencilSumIncrement(!0),e.drawQuadInstances(a),d.setFloat("ufrag_6",-1),e.setDistanceFieldStencilSumIncrement(!1),e.drawQuadInstances(a)):e.drawQuadInstances(a)}}e.disableInstanceAttribute("a_p0"),e.disableInstanceAttribute("a_p1"),e.disableInstanceAttribute("a_p2"),e.disableInstanceAttribute("a_p3"),e.disableInstanceAttribute("a_p4"),e.disableInstanceAttribute("a_d1"),e.disableInstanceAttribute("a_d2"),u+=performance.now(),l.drawTapeCostMs+=u}function Zr(e,t,r,i){const n=Or[t],s=[];for(const e of n)i&&e.ready||(s.push(e.path),e.ready=!0);if(s.length>0){const t=new yt(s);return t.style.pen.lineWidth=Hr(),t.overlapMode=1,r.refresh(e,t,i)}return!0}function Qr(e){if(1!=e.tipType)return e.dashType>=0&&e.dashType<ei.length?ei[e.dashType]:void L.Error(591192836,"unsupported dashType")}const ei=[null,new Float32Array([3,1]),new Float32Array([1,1]),new Float32Array([3,1,1,1]),new Float32Array([3,1,1,1,1,1]),new Float32Array([1,3]),new Float32Array([4,3]),new Float32Array([8,3]),new Float32Array([4,3,1,3]),new Float32Array([8,3,1,3]),new Float32Array([8,3,1,3,1,3])];class ti{constructor(){this.m_compatibleGraphicsProcessorId=0}get tapeBuffers(){return this.m_tapeBuffers}get hwTapeBuffers(){return this.m_hwTapeBuffers}releaseGeneratedResources(){if(this.m_hwTapeBuffers&&this.m_engine)for(const e of this.m_hwTapeBuffers)this.m_engine._releaseBuffer(e);this.m_hwTapeBuffers=void 0}onFinalization(){}refreshCachedTapeBuffers(e){return this.m_tapeBuffers||(this.m_tapeBuffers=Ar(e,4096).buffers),this.m_tapeBuffers}refreshCachedHwTapeBuffers(e,t){if(!this.m_hwTapeBuffers||!this.m_engine||this.m_compatibleGraphicsProcessorId!=t.getUniqueGraphicsProcessorId()){const r=Ar(e,4096,!1,!1,void 0),i=t.getBabylonEngine();this.m_hwTapeBuffers=r.buffers.map((e=>i.createVertexBuffer(e))),this.m_compatibleGraphicsProcessorId=t.getUniqueGraphicsProcessorId(),this.m_engine=t.getBabylonEngine()}return this.m_hwTapeBuffers}}class ri{constructor(e,t){this.m_state=e,this.m_texture=t}getState(){return this.m_state}getSize(){return this.m_texture?this.m_texture.size:void 0}getLogicalCenter(){return this.m_texture&&this.m_texture.contentLocation?this.m_texture.contentLocation.logicalCenter:void 0}tryConvertToBufferRGBA(){return this.m_texture instanceof nr?this.m_texture.tryConvertToBufferRGBA():void 0}}class ii{constructor(){this.m_state=0}releaseGeneratedResources(){this.m_texture&&(this.m_texture.release(),this.m_state=2)}onFinalization(){}get texture(){return this.m_texture}get loader(){return this.m_loader}set texture(e){this.m_loader&&(this.m_loader.release(),this.m_loader=void 0),this.m_texture=e,this.m_state=1}set loader(e){this.m_texture&&(this.m_texture=void 0),this.m_loader&&this.m_loader!=e&&this.m_loader.release(),this.m_loader=e,this.m_state=1}get state(){return this.m_state}}const ni=new x(1024,1024);function si(e){const t=e.gradientStops.length,r=new Float32Array(t+2),i=new Float32Array(4*(t+2));for(let n=0;n<t+2;n++){const s=Math.min(Math.max(n-1,0),t-1),o=e.gradientStops[s].color;r[n]=0==n?0:n==t+1?1:e.gradientStops[s].position,i[4*n+0]=o.r,i[4*n+1]=o.g,i[4*n+2]=o.b,i[4*n+3]=o.a}return{stops:r,colors:i}}const oi=[{attributeName:"a_p1",attributeSize:4,offset:16},{attributeName:"a_p2",attributeSize:4,offset:32}],ai=new x(8,8),li=[[255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0],[7,64,29,0,116,0,208,1,64,7,0,29,0,116,1,208],[1,208,0,116,0,29,64,7,208,1,116,0,29,0,7,64],[255,255,3,0,3,0,3,0,3,0,3,0,3,0,3,0],[7,208,29,116,116,29,208,7,208,7,116,29,29,116,7,208],[3,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[3,0,0,0,0,3,0,0,3,0,0,0,0,3,0,0],[3,3,0,0,48,48,0,0,3,3,0,0,48,48,0,0],[3,3,48,48,3,3,48,48,3,3,48,48,3,3,48,48],[51,51,12,12,51,51,192,192,51,51,12,12,51,51,192,192],[51,51,204,204,51,51,204,192,51,51,204,204,51,51,192,204],[51,51,204,204,51,51,204,204,51,51,204,204,51,51,204,204],[63,63,204,204,243,243,204,204,63,63,204,204,243,243,204,204],[252,252,207,207,252,252,207,207,252,252,207,207,252,252,207,207],[252,252,255,255,207,207,255,255,252,252,255,255,207,207,255,255],[63,255,255,255,255,63,255,255,63,255,255,255,255,63,255,255],[255,255,255,255,255,255,255,252,255,255,255,255,255,255,252,255],[3,3,12,12,48,48,192,192,3,3,12,12,48,48,192,192],[192,192,48,48,12,12,3,3,192,192,48,48,12,12,3,3],[15,15,60,60,240,240,195,195,15,15,60,60,240,240,195,195],[240,240,60,60,15,15,195,195,240,240,60,60,15,15,195,195],[15,192,63,0,252,0,240,3,192,15,0,63,0,252,3,240],[3,240,0,252,0,63,192,15,240,3,252,0,63,0,15,192],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[255,255,0,0,0,0,0,0,255,255,0,0,0,0,0,0],[204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204],[255,255,0,0,255,255,0,0,255,255,0,0,255,255,0,0],[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],[255,255,255,255,0,0,0,0,255,255,255,255,0,0,0,0],[0,0,0,0,3,3,12,12,48,48,192,192,0,0,0,0],[0,0,0,0,192,192,48,48,12,12,3,3,0,0,0,0],[255,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0],[3,0,3,0,3,0,3,0,0,3,0,3,0,3,0,3],[3,0,0,3,12,0,0,48,192,0,0,192,48,0,0,12],[243,192,240,0,0,240,192,243,207,3,15,0,0,15,3,207],[3,192,12,48,48,12,192,3,3,192,12,48,48,12,192,3],[0,0,192,3,48,204,15,0,0,0,192,3,48,204,15,0],[0,192,0,48,0,12,0,3,192,3,48,12,12,48,3,192],[255,255,3,0,3,0,3,0,255,255,0,3,0,3,0,3],[3,3,204,12,48,48,12,204,3,3,192,12,48,48,204,192],[51,51,204,204,51,51,204,204,255,0,255,0,255,0,255,0],[0,0,192,0,0,3,192,0,0,0,3,0,0,192,3,0],[51,51,0,0,3,0,0,0,3,0,0,0,3,0,0,0],[3,0,0,0,48,48,0,0,0,3,0,0,48,48,0,0],[0,240,3,12,12,3,240,0,0,15,0,48,0,192,0,192],[255,255,60,60,255,255,195,195,255,255,60,60,255,255,195,195],[252,252,3,195,3,255,3,255,252,252,195,3,255,3,255,3],[255,255,3,3,3,3,3,3,255,255,3,3,3,3,3,3],[195,195,60,60,60,60,195,195,195,195,60,60,60,60,195,195],[255,0,255,0,255,0,255,0,0,255,0,255,0,255,0,255],[3,48,12,12,48,3,192,0,48,3,12,12,3,48,0,192],[192,0,240,3,252,15,255,63,252,15,240,3,192,0,0,0]];var ci;!function(e){e[e.fromBegining=0]="fromBegining",e[e.distanceFieldsReady=1]="distanceFieldsReady",e[e.brushTexturesReady=2]="brushTexturesReady",e[e.fadeReady=3]="fadeReady",e[e.effectsReady=4]="effectsReady"}(ci||(ci={}));class hi{constructor(){this.initTextureStage=ci.fromBegining,this.fadeMode=0,this.spriteQuality=0,this.isBlankSlate=!1}get resolvedFillTexture(){var e;return this.fillTexture instanceof ir?this.fillTexture:null===(e=this.fillTexture)||void 0===e?void 0:e.loader.getTexture(this.fillTexture.wrapMode)}get resolvedLineTexture(){var e;return this.lineTexture instanceof ir?this.lineTexture:null===(e=this.lineTexture)||void 0===e?void 0:e.loader.getTexture(this.lineTexture.wrapMode)}get resolvedPictureTexture(){var e;return this.pictureTexture instanceof ir?this.pictureTexture:null===(e=this.pictureTexture)||void 0===e?void 0:e.loader.getTexture(this.pictureTexture.wrapMode)}beforeInitTextures(e,t){if(this.isBlankSlate=!1,this.clientData=e.clientData,this.hasInvalidTexture(t)&&this.clearTextures(),this.checkDistanceFields(e),this.lastKnownShapeVersion==e.version&&e.alphaTracker.version==this.lastKnownAlphaVersion||(this.clearEffectsTextures(this.lastKnownShapeVersion!=e.version,e.alphaTracker.version!=this.lastKnownAlphaVersion),this.drawDistribution=void 0),this.lastKnownShapeVersion=e.version,this.lastKnownAlphaVersion=e.alphaTracker.version,1==e.getType()){const t=e;t.geometryTracker.version!=this.lastKnownGeometryVersion&&(this.initTextureStage=ci.fromBegining,this.lastKnownGeometryVersion=t.geometryTracker.version)}}getFulltextureList(){const e=[this.resolvedFillTexture,this.resolvedLineTexture,this.resolvedPictureTexture,this.innerShadowTexture,this.softEdgesTexture,this.glowTexture,this.shadowTexture,this.reflectionTexture,this.fadeTexture,this.spriteTexture];for(let t of this.distanceFields||[])e.push(t.texture);return this.coutoutLayer&&e.push(this.coutoutLayer.texture),e}getBevelDistanceField(){for(let e of this.distanceFields||[])if(e.isDisplacementMap)return e}hasInvalidTexture(e){const t=this.getFulltextureList();for(let e of this.distanceFields||[])t.push(e.texture);for(let r of t)if(r&&!r.isValidForGraphicsProcessor(e))return!0;return!1}checkDistanceFields(e){if(1==e.getType()){const t=e;for(let e of this.distanceFields||[])if(e.geometryUniqueId!=t.geometryTracker.currentUniqueId||e.lastKnownQualitySetting!=$t||e.lastKnownLineWidth!=t.style.pen.adjustedLineWidth||e.lastKnownLineWidthForArrowHead!=t.style.pen.adjustedLineWidthForArrowHead||e.lastKnownHitTestSlop!=te)return void this.clearTextures()}}clearBounds(){this.initTextureStage=ci.fromBegining}clearEffectsTextures(e,t){this.initTextureStage=ci.fromBegining,e&&(this.reflectionTexture&&this.reflectionTexture.release(),this.fadeTexture&&this.fadeTexture.release(),this.spriteTexture&&this.spriteTexture.release(),this.reflectionTexture=this.fadeTexture=this.spriteTexture=void 0),t&&(this.innerShadowTexture&&this.innerShadowTexture.release(),this.softEdgesTexture&&this.softEdgesTexture.release(),this.glowTexture&&this.glowTexture.release(),this.shadowTexture&&this.shadowTexture.release(),this.innerShadowTexture=this.softEdgesTexture=this.glowTexture=this.shadowTexture=void 0)}clearBrushTextures(){var e,t,r,i,n,s;this.fillTexture instanceof ir&&1==this.fillTexture.releasePolicy&&(this.fillTexture.release(),this.fillTexture=void 0),this.lineTexture instanceof ir&&1==this.lineTexture.releasePolicy&&(this.lineTexture.release(),this.lineTexture=void 0),this.pictureTexture instanceof ir&&1==this.pictureTexture.releasePolicy&&(this.pictureTexture.release(),this.pictureTexture=void 0),(null===(e=this.fillLookupTableCache)||void 0===e?void 0:e.texture)&&(null===(t=this.fillLookupTableCache)||void 0===t||t.texture.release(),this.fillLookupTableCache=void 0),(null===(r=this.lineLookupTableCache)||void 0===r?void 0:r.texture)&&(null===(i=this.lineLookupTableCache)||void 0===i||i.texture.release(),this.lineLookupTableCache=void 0),(null===(n=this.pictureLookupTableCache)||void 0===n?void 0:n.texture)&&(null===(s=this.pictureLookupTableCache)||void 0===s||s.texture.release(),this.pictureLookupTableCache=void 0)}clearTextures(){this.initTextureStage=ci.fromBegining;for(let e of this.distanceFields||[])e&&e.texture&&e.texture.release();this.clearBrushTextures(),this.clearEffectsTextures(!0,!0),this.distanceFields=void 0}releaseGeneratedResources(){var e;this.clearBounds(),this.clearTextures(),this.isBlankSlate=!0,this.coutoutLayer&&(null===(e=this.coutoutLayer.texture)||void 0===e||e.release(),this.coutoutLayer=void 0)}initFadeTexture(e,t,r){if(!e.getGraphicsProcessor())return;const i=r?13==r.preset?t.changeTracker.currentUniqueId:r.param+":"+r.preset:"";if(!this.fadeTexture||r&&0!=r.preset&&this.fadeTexture.isValid(e)&&this.fadeTexture.tag==i||(this.fadeTexture.release(),this.fadeTexture=void 0),!this.fadeTexture)if(1==t.getType()&&r&&13==r.preset){const r=t,i=r.style.pictureBrush,n=i?e.getTextureFromImageBrush(i):void 0;if(i&&n){const t=nr.RecycleOrReplace("PictureDrawFade",void 0,e,n.size,!0,5,!1,1,4);t.originalSize=n.originalSize;const r=Ct(i.alignment),s=new P(r.negate(),i.scale,0,r.add(i.offset)),o=new P(new x(0,-1),new x(1,-1)),a=S.FromTransforms(o,s.toInverseMatrix3(),o);e.drawTextureToTexture(t,n,5,{textureTransform:a}),this.fadeTexture=t,this.fadeMode=3}else if(r.paths&&r.paths.length>0){const t=new Fr("FadeMask/Draw",e,void 0,1,r.mergeMode,0,1,!1);t.generateDrawFadeMask=!0,t.refresh(e,r,!1),this.fadeTexture=t.texture,this.fadeMode=2}}else r&&0!=r.preset&&13!=r.preset?(this.fadeTexture=function(e,t,r,i,n){const s=e.getGraphicsProcessor();if(!s)throw L.Error(592525321,"Graphics processor not initialized");const o=nr.RecycleOrReplace("FadeMask/Standard",t,e,ni,!1,5,!1,1);return o.tag=n,function(e,t,r,i){const n=performance.now(),s=e.activateShaderProgram(4);s.begin(t.tryGetBabylonTextureForRenderToTexture(e),ge.Black,!1);const o=s.getBabylonEffect();o.setInt("ufrag_0",r),o.setFloat("ufrag_1",i),s.drawQuads(1),s.end(),t.renderCost=performance.now()-n}(s,o,r,i),o}(e,this.fadeTexture,r.preset,r.param,i),this.fadeMode=2):this.fadeMode=r?1:0}getBrushTexture(e){switch(e){case 0:return this.fillTexture;case 1:return this.lineTexture;case 2:return this.pictureTexture}L.Error(591192833,"Invalid brush source")}setBrushTexture(e,t){switch(e){case 0:this.fillTexture=t;break;case 1:this.lineTexture=t;break;case 2:this.pictureTexture=t;break;default:L.Error(591192834,"Invalid brush source")}}initBrushTexture(e,t,r){const i=this.getBrushTexture(r),n=function(e,t,r,i){const n=e.getGraphicsProcessor();if(!n)return;const s=t instanceof ir&&!t.isValidForGraphicsProcessor(n);let o=t;const a=function(e,t){const r=e.getType();if(1==r){const r=e.style;switch(t){case 0:return r.fillBrush;case 1:return r.lineBrush;case 2:return r.pictureBrush}}if(2==r&&0==t)return e.groupFillBrush;L.Error(591192835,"Invalid item or brush")}(r,i);if(a){const n=a.getType();if(6==n){const n=a;if(n.image){const l=a.wrapMode,c=void 0!==l?l:4,h=e.ensureImageRenderData(n.image);2==h.state?L.Error(592472275,`Trying to use deleted texture id:${n.image.id}`):0==h.state&&L.Error(592472276,`Trying to use uninitialized texture id:${n.image.id}`);const u=h.texture,d=n.pictureEffects||(r instanceof yt&&2==i?r.style.pictureEffects:void 0);if(h.loader&&r instanceof yt){const e=wt(r,!1,S.Scale2D(r.transform.scale.abs()));e&&h.loader.prepareForRenderSize(e.size),o={loader:h.loader,wrapMode:c}}else!s&&t instanceof ir&&(t==u||u&&t.tag==u.changeTracker.currentUniqueId)||(o=!(null==d?void 0:d.hasImpact)&&u&&u.wrapMode!=c?u.cloneWithNewWrapMode("ImageWrapResample",e,c,1):u);if(null==d?void 0:d.hasImpact){const n=o instanceof ir?o:null==o?void 0:o.loader.getTexture(o.wrapMode);if(n){const a=n.changeTracker.currentUniqueId+"/"+d.changeTracker.currentUniqueId+"/"+c;if(t instanceof ir&&!s&&t.tag==a)o=t;else{const s=e.ensureRenderNode(r).cache.ensureLookupTableTexture(e,i,d.lookupTable);o=function(e,t,r,i,n,s){var o,a;if(!e.getGraphicsProcessor())return;const l=nr.RecycleOrReplace("PictureEffects",t,e,r.size,!1,r.format,!1,1,n);if(l.originalSize=r.originalSize,!(null===(o=null==i?void 0:i.sharpness)||void 0===o?void 0:o.hasImpact)||oe)e.drawTextureToTexture(l,r,1,{pictureEffects:i,lookupTableTexture:s});else{const t=new nr("PictureEffects/Sharpness/BlurIntermediateTexture",e,r.size,1);t.originalSize=r.originalSize,function(e,t,r,i,n){const s=t.originalSize.x/t.originalSize.y;lr(e,t,t,n,0,s,[new E(0,0,t.size.x,t.size.y)],[new E(0,0,n.size.x,n.size.y)],n.size,i),lr(e,t,n,r,1,s,[new E(0,0,n.size.x,n.size.y)],[new E(0,0,r.size.x,r.size.y)],r.size,i)}(e,r,t,i.sharpness,l),e.drawTextureToTexture(l,t,1,{pictureEffects:i,lookupTableTexture:s}),t.release()}return(2===(null===(a=e.getBabylonEngine())||void 0===a?void 0:a.webGLVersion)||ur(l.size.x)&&ur(l.size.y))&&l.generateMipMap(),l}(e,t!=u&&t instanceof nr?t:void 0,n,d,c,s),o&&(o.tag=a)}}}}else o=void 0}else if(7==n){let r=-performance.now();t&&!s&&t instanceof ir&&t.tag==a.pattern||(o=function(e,t,r){if(!e.getGraphicsProcessor())throw L.Error(592525326,"Graphics processor not initialized");if(t<0||t>53)return void L.Error(592525327,"pattern out of range");const i=new Uint8Array(64),n=li[t];for(let e=0;e<16;e++){const t=n[e];for(let r=0;r<4;r++){const n=(t&3<<2*r)>>2*r,s=0==n?255:1==n?127:0;i[4*e+r]=s}}const s=ir.CreateFromByteBuffer("Pattern",e,ai,i,1,0,!1,!1,1);return s.tag=t,s}(e,a.pattern)),r+=performance.now(),e.getCurrentFramePerformanceSummary().patternTextureCostMs+=r}else if(ye.IsGradient(n)){let i=-performance.now();if(5==n){const n=t instanceof nr?t:void 0;n&&!s&&n.tag==r.changeTracker.currentUniqueId||(r instanceof yt?o=function(e,t,r,i,n){const s=e.getGraphicsProcessor();if(!s)throw L.Error(592525324,"Graphics processor not initialized");if(5!=i.getType())throw L.Error(592525325,"This is not a path gradient");const o=wt(r,!1);if(!o||o.isEmpty()||!r.paths)return;const a=o.size.multiply(r.transform.scale.abs()),l=a.scale(Math.min(1,Yt/a.x,Yt/a.y)),c=new x(Math.floor(l.x+1),Math.floor(l.y+1)),h=nr.RecycleOrReplace("PathGradient",t,e,c,!1,5,!1,1);return h.tag=r.changeTracker.currentUniqueId,function(e,t,r,i,n,s){const o=performance.now(),a=si(r),l=a.colors,c=a.colors.length<4?ge.Transparent:new ge(l[l.length-4],l[l.length-3],l[l.length-2],l[l.length-1]),h=e.activateShaderProgram(2);h.begin(t.tryGetBabylonTextureForRenderToTexture(e),c,!1);const u=h.getBabylonEffect(),d=h.getBabylonEngine();if(u.setInt("u_0",1),u.setVector2("u_1",n),u.setVector2("u_2",s),u.setFloatArray("bfrag_0",a.stops),u.setFloatArray4("bfrag_1",a.colors),u.setInt("ufrag_0",0),u.setInt("ufrag_3",r&&r.isGammaCorrected?1:0),u.setInt("ufrag_4",r.blendBellShape?1:0),u.setVector2("ufrag_5",r.blendBellShape||x.Zero),i){const e=4096;for(const t of i){const r=t.transform.toMatrix3(),i=Ar(t,e,!0).buffers,n=i.map((e=>d.createVertexBuffer(e)));for(let e=0;e<i.length;e++){const t=i[e].length/4-4;d.bindInstancesBuffer(n[e],oi,!1),u.setMatrix3x3("u_3",r.m),h.drawQuadInstances(t),d._releaseBuffer(n[e])}}h.disableInstanceAttribute("a_p1"),h.disableInstanceAttribute("a_p2")}h.end(),t.renderCost=performance.now()-o}(s,h,i,r.paths,o.center,o.size.inverse()),h}(e,n,r,a):L.Error(592525320,"Path gradient only supported on Shape items")),i+=performance.now(),e.getCurrentFramePerformanceSummary().pathGradientTextureCostMs+=i}else{const r=t instanceof nr?t:void 0;r&&!s&&r.tag==a.changeTracker.currentUniqueId||(o=function(e,t,r,i){const n=e.getGraphicsProcessor();if(!n)throw L.Error(592525322,"Graphics processor not initialized");const s=r.getType();if(2!=s&&4!=s&&3!=s)throw L.Error(592525323,"Unsupported Gradient type");const o=new x(256,2==s||4==s?1:256),a=2==s?"LinearGradient":4==s?"RectangularGradient":"RadialGradient",l=nr.RecycleOrReplace(a,t,e,o,!1,5,!1,1);return l.tag=r.changeTracker.currentUniqueId,function(e,t,r){const i=performance.now(),n=si(r),s=e.activateShaderProgram(2);s.begin(t.tryGetBabylonTextureForRenderToTexture(e),ge.Black,!1);const o=s.getBabylonEffect();s.setDummyPointerAttribute("a_p1"),s.setDummyPointerAttribute("a_p2"),o.setFloatArray("bfrag_0",n.stops),o.setFloatArray4("bfrag_1",n.colors),o.setInt("u_0",0);const a=r&&3==r.getType();if(o.setInt("ufrag_0",a?1:0),o.setInt("ufrag_3",r&&r.isGammaCorrected?1:0),r&&a){const e=r.fillToRect?r.fillToRect.center:new x(.5,.5),t=r.fillFromRect?e.subtract(r.fillFromRect.leftTop).divide(r.fillFromRect.size):e;o.setVector2("ufrag_2",t)}o.setInt("ufrag_4",r.blendBellShape?1:0),o.setVector2("ufrag_5",r.blendBellShape||x.Zero),s.drawQuads(1),s.end(),t.renderCost=performance.now()-i}(n,l,r),l}(e,r,a)),i+=performance.now(),e.getCurrentFramePerformanceSummary().gradientTextureCostMs+=i}}}else o=void 0;return t&&t!=o&&t instanceof ir&&1==t.releasePolicy&&t.release(),o}(e,i,t,r);i!=n&&this.setBrushTexture(r,n)}initTextCutoutLayer(e,t,r){var i;if(t){this.coutoutLayer=new Fr("TextCutoutLayer",e,void 0,1,0,0,1,!1),this.coutoutLayer.isGlyphCacheDisabled=!0;const i=new yt(t,r.style);this.coutoutLayer.refresh(e,i,!1);const n=wt(i,!1);this.coutoutLayerCenter=null==n?void 0:n.center}else this.coutoutLayer&&(null===(i=this.coutoutLayer.texture)||void 0===i||i.release(),this.coutoutLayer=void 0)}updateLookupTableCache(e,t,r){let i=t;return t?t.texture&&(!r||!t.texture.isValid(e)||r&&t.lookupTable&&r!=t.lookupTable&&!r.equals(t.lookupTable))&&(t.texture.release(),t.texture=void 0):r&&(i={lookupTable:r}),i&&!i.texture&&r&&(i.texture=function(e,t,r){return ir.CreateFromByteBuffer("LookupTable",e,t.resolution,t.table,4,4,!0,!1,1,!1,1)}(e,r)),i}ensureLookupTableTexture(e,t,r){var i,n,s;switch(t){case 0:return this.fillLookupTableCache=this.updateLookupTableCache(e,this.fillLookupTableCache,r),null===(i=this.fillLookupTableCache)||void 0===i?void 0:i.texture;case 1:return this.lineLookupTableCache=this.updateLookupTableCache(e,this.lineLookupTableCache,r),null===(n=this.lineLookupTableCache)||void 0===n?void 0:n.texture;case 2:return this.pictureLookupTableCache=this.updateLookupTableCache(e,this.pictureLookupTableCache,r),null===(s=this.pictureLookupTableCache)||void 0===s?void 0:s.texture}L.Error(509728260,"Invalid brush source")}}class ui{constructor(){}releaseGeneratedResources(){this.texture&&1==this.texture.releasePolicy&&this.texture.release(),this.textureDeltaWhite&&1==this.textureDeltaWhite.releasePolicy&&this.textureDeltaWhite.release(),this.texturePicture&&1==this.texturePicture.releasePolicy&&this.texturePicture.release()}onFinalization(){}}class di{constructor(){}releaseGeneratedResources(){}onFinalization(){}}class pi{constructor(){this.renderers=[]}dumpLastScene(){console.log(this.lastRenderer&&this.lastScene?this.lastRenderer.getDebugString(this.lastScene):void 0)}static OnRender(e,t){if(!Xt.readBooleanOrDefault("debugTool",!1))return;const r=window;r.shapeBuilderDebugTool||(r.shapeBuilderDebugTool=new pi);const i=r.shapeBuilderDebugTool;if(i.lastRenderer=e,i.lastScene=1==t.length?t[0].item:void 0,t.length>1){const e=new _t;for(let r of t)e.items.push(r.item);i.lastScene=e}i.renderers.includes(e)||i.renderers.push(e)}}function fi(e,t,r,i,n){if(!r)return S.Identity;const s=r.getType();if(7==s)return S.Scale2D(n.scale(1/16));const o=ye.IsGradient(s);if(6!=s&&!o)return S.Identity;const a=r.rotateWithShape;let l=0;const c=a?S.Scale2D(t.transform.scale):t.transform.toMatrix3(),h=wt(t,i,c);let u=t.fillBoundsOverride?t.fillBoundsOverride:h;if(t.fillBoundsOverride&&u&&a&&(u=u.transformedBounds(S.FromTransforms(t.transform.toInverseMatrix3(),c))),!h||!u)return S.Identity;const d=u.size;let p=x.One,f=x.Zero,g=!0,m=4;if(6==s){const t=r;if(f=t.offset,p=t.scale.abs(),g=t.isStretched,m=t.alignment,g){if(p=p.multiply(d),t.fillToPreserveAspectRatio){const r=e.getTextureFromImageBrush(t);if(r){const e=r.originalSize.x/r.originalSize.y,t=d.x/d.y;p=p.multiply(new x(e>t?e/t:1,e<t?t/e:1))}else L.Error(524026452,"No texture")}f=f.multiply(d)}else{const r=e.getTextureFromImageBrush(t);r?p=p.multiply(r.originalSize):L.Error(590960595,"No texture")}}else if(5==s)p=d;else if(o){const e=r;if(p=e.fillFromRect?e.fillFromRect.size:x.One,f=(e.fillFromRect?e.fillFromRect.center:x.Zero).subtract(new x(.5,.5)).multiply(d),g=e.isStretched||4==s,2==s){p=p.multiply(d);const t=g?E.FromSize(x.One):E.FromSize(p),r=t.transformedBounds(S.RotationZ(e.angle));p=r?p.scale(r.width/t.width):p,l-=e.angle}else g?p=p.multiply(d):(p=p.scale(Math.max(d.x,d.y)),3==s&&(p=p.scale(Math.sqrt(d.x*d.x+d.y*d.y)/Math.max(d.x,d.y))))}else p=p.multiply(d);const y=new E(-d.x/2+p.x/2,-d.y/2+p.y/2,d.x/2-p.x/2,d.y/2-p.y/2);f=f.add(Ct(m,y)).multiply(new x(1,-1));let _=S.Identity;return _=_.multiply(S.Translation2D(h.center.subtract(u.center))),_=_.multiply(S.Scale2D(new x(1,-1))),a||(_=_.multiply(S.Scale2D(t.transform.scale.sign())),_=_.multiply(S.RotationZ(-t.transform.rotation))),_=_.multiply(S.Translation2D(f.negate())),2==s&&(_=_.multiply(S.Translation2D(u.center.subtract(h.center))),g&&(_=_.multiply(S.Scale2D(d.inverse()))),_=_.multiply(S.RotationZ(-l)),g&&(_=_.multiply(S.Scale2D(d))),_=_.multiply(S.Translation2D(h.center.subtract(u.center)))),_=_.multiply(S.Scale2D(p.inverse())),_=_.multiply(S.Scale2D(new x(1,-1))),_}function gi(e,t,r,i,n,s,o,a,l,c,h,u,d,p){const f=e.getGraphicsProcessor();if(!f)return void L.Error(572867293,"Unable to get graphicsProcessor");const g=wt(s,!1);if(!g)return void L.Error(588006215,"Unable to get bounds");const m=new Tr(r?r.texture:void 0,rr(g,s.transform),s.style);if(m.fillTexture=t.resolvedFillTexture||void 0,m.lineTexture=t.resolvedLineTexture||void 0,m.pictureTexture=t.resolvedPictureTexture||void 0,m.innerShadowTexture=t.innerShadowTexture||void 0,m.softEdgesTexture=t.softEdgesTexture||void 0,m.fillTransformUV=fi(e,s,s.style.fillBrush,!1,o),m.pictureTransformUV=fi(e,s,s.style.pictureBrush,!1,o),m.lineTransformUV=fi(e,s,s.style.lineBrush,!0,o),m.localClipRect=h,m.fillBrightness=r?r.getFillBrightness():0,m.mergeMode=s.mergeMode,m.distanceFieldMode=r?r.distanceFieldMode:2,m.distRangeSize=r?r.distRangeSize:0,m.softEdges=s.effects&&16&i?s.effects.softEdges:void 0,m.innerShadow=s.effects&&8&i?s.effects.innerShadow:void 0,m.blendingMode=s.style.blendingMode,m.fillBoundsOverride=s.fillBoundsOverride,(0==l||7==l)&&t.fade&&(m.fadeInfo={fade:t.fade,fadeTexture:t.fadeTexture,fadeMode:t.fadeMode}),m.clientObject=t,s.text&&0!=s.text.renderMode)if(s.text&&s.text.cache instanceof Qe&&t.coutoutLayer&&t.coutoutLayer.texture&&t.coutoutLayerCenter){m.textRenderMode=s.text.renderMode;const e=t.coutoutLayer.texture.contentLocation.logicalSize.scale(1/t.coutoutLayer.contentQuality),r=g.multiply(s.transform.scale.abs()),i=t.coutoutLayerCenter;m.textCutoutTransform=S.Scale2D(s.transform.scale.sign()),m.textCutoutTransform=m.textCutoutTransform.multiply(S.Translation2D(r.center)),m.textCutoutTransform=m.textCutoutTransform.multiply(s.text.frameToShape.toInverseMatrix3()),m.textCutoutTransform=m.textCutoutTransform.multiply(S.Translation2D(s.transform.preTranslation.multiply(s.transform.scale.abs()).subtract(i))),m.textCutoutTransform=m.textCutoutTransform.multiply(S.Scale2D(r.size.divide(e))),m.textCutoutTexture=t.coutoutLayer.texture}else if(2!=s.text.renderMode)return;m.overallOpacity=u,m.colorMatrix=d,m.colorOffset=p;const y=performance.now();Pr(f,m,n,o,a,5==l?ge.White:c,l),e.onLayerRendered(3==s.role?"text":"shape","SDF",y,m)}var mi=function(){function e(){}return e._AddLogEntry=function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)},e._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},r=new Date;return"["+t(r.getHours())+":"+t(r.getMinutes())+":"+t(r.getSeconds())+"]: "+e},e._LogDisabled=function(e){},e._LogEnabled=function(t){var r=e._FormatMessage(t);console.log("BJS - "+r);var i="<div style='color:white'>"+r+"</div><br>";e._AddLogEntry(i)},e._WarnDisabled=function(e){},e._WarnEnabled=function(t){var r=e._FormatMessage(t);console.warn("BJS - "+r);var i="<div style='color:orange'>"+r+"</div><br>";e._AddLogEntry(i)},e._ErrorDisabled=function(e){},e._ErrorEnabled=function(t){e.errorsCount++;var r=e._FormatMessage(t);console.error("BJS - "+r);var i="<div style='color:red'>"+r+"</div><br>";e._AddLogEntry(i)},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!1,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(t){(t&e.MessageLogLevel)===e.MessageLogLevel?e.Log=e._LogEnabled:e.Log=e._LogDisabled,(t&e.WarningLogLevel)===e.WarningLogLevel?e.Warn=e._WarnEnabled:e.Warn=e._WarnDisabled,(t&e.ErrorLogLevel)===e.ErrorLogLevel?e.Error=e._ErrorEnabled:e.Error=e._ErrorDisabled},enumerable:!1,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e._LogCache="",e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}(),yi=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e.UseFallbackTexture=!0,e.FallbackTexture="",e}(),_i=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},e.IsDocumentAvailable=function(){return"undefined"!=typeof document},e.GetDOMTextContent=function(e){for(var t="",r=e.firstChild;r;)3===r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t},e}(),vi=function(){function e(){}return e.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},e.StartsWith=function(e,t){return!!e&&0===e.indexOf(t)},e.Decode=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return t},e.EncodeArrayBufferToBase64=function(e){for(var t,r,i,n,s,o,a,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",h=0,u=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);h<u.length;)n=(t=u[h++])>>2,s=(3&t)<<4|(r=h<u.length?u[h++]:Number.NaN)>>4,o=(15&r)<<2|(i=h<u.length?u[h++]:Number.NaN)>>6,a=63&i,isNaN(r)?o=a=64:isNaN(i)&&(a=64),c+=l.charAt(n)+l.charAt(s)+l.charAt(o)+l.charAt(a);return c},e.PadNumber=function(e,t){for(var r=String(e);r.length<t;)r="0"+r;return r},e}(),bi=function(){function e(){this.children=[]}return e.prototype.isValid=function(e){return!0},e.prototype.process=function(e,t){var r="";if(this.line){var i=this.line,n=t.processor;n&&(n.lineProcessor&&(i=n.lineProcessor(i,t.isFragment)),n.attributeProcessor&&vi.StartsWith(this.line,"attribute")?i=n.attributeProcessor(this.line):n.varyingProcessor&&vi.StartsWith(this.line,"varying")?i=n.varyingProcessor(this.line,t.isFragment):(n.uniformProcessor||n.uniformBufferProcessor)&&vi.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?n.uniformProcessor&&(i=n.uniformProcessor(this.line,t.isFragment)):n.uniformBufferProcessor&&(i=n.uniformBufferProcessor(this.line,t.isFragment),t.lookForClosingBracketForUniformBuffer=!0)),n.endOfUniformBufferProcessor&&t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,i=n.endOfUniformBufferProcessor(this.line,t.isFragment))),r+=i+"\r\n"}return this.children.forEach((function(i){r+=i.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),r},e}(),wi=function(){function e(){}return Object.defineProperty(e.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,r=e;t<r.length;t++){var i=r[t];if("#"!==i[0])for(var n=i.split(";"),s=0;s<n.length;s++){var o=n[s];(o=o.trim())&&this._lines.push(o+(s!==n.length-1?";":""))}else this._lines.push(i)}},enumerable:!1,configurable:!0}),e}(),Ti=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return It(t,e),t.prototype.process=function(e,t){for(var r=0;r<this.children.length;r++){var i=this.children[r];if(i.isValid(e))return i.process(e,t)}return""},t}(bi),xi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return It(t,e),t.prototype.isValid=function(e){return this.testExpression.isTrue(e)},t}(bi),Ci=function(){function e(){}return e.prototype.isTrue=function(e){return!0},e.postfixToInfix=function(t){for(var r=[],i=0,n=t;i<n.length;i++){var s=n[i];if(void 0===e._OperatorPriority[s])r.push(s);else{var o=r[r.length-1],a=r[r.length-2];r.length-=2,r.push("("+a+s+o+")")}}return r[r.length-1]},e.infixToPostfix=function(t){for(var r=[],i=-1,n=function(){""!==(c=c.trim())&&(r.push(c),c="")},s=function(t){i<e._Stack.length-1&&(e._Stack[++i]=t)},o=function(){return e._Stack[i]},a=function(){return-1===i?"!!INVALID EXPRESSION!!":e._Stack[i--]},l=0,c="";l<t.length;){var h=t.charAt(l),u=l<t.length-1?t.substr(l,2):"";if("("===h)c="",s(h);else if(")"===h){for(n();-1!==i&&"("!==o();)r.push(a());a()}else if(e._OperatorPriority[u]>1){for(n();-1!==i&&e._OperatorPriority[o()]>=e._OperatorPriority[u];)r.push(a());s(u),l++}else c+=h;l++}for(n();-1!==i;)"("===o()?a():r.push(a());return r},e._OperatorPriority={")":0,"(":1,"||":2,"&&":3},e._Stack=["","","","","","","","","","","","","","","","","","","",""],e}(),Si=function(e){function t(t,r){void 0===r&&(r=!1);var i=e.call(this)||this;return i.define=t,i.not=r,i}return It(t,e),t.prototype.isTrue=function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t},t}(Ci),Pi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return It(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},t}(Ci),Ei=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return It(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},t}(Ci),Mi=function(e){function t(t,r,i){var n=e.call(this)||this;return n.define=t,n.operand=r,n.testValue=i,n}return It(t,e),t.prototype.isTrue=function(e){var t=e[this.define];void 0===t&&(t=this.define);var r=!1,i=parseInt(t),n=parseInt(this.testValue);switch(this.operand){case">":r=i>n;break;case"<":r=i<n;break;case"<=":r=i<=n;break;case">=":r=i>=n;break;case"==":r=i===n}return r},t}(Ci),Ri=/defined\s*?\((.+?)\)/g,Ai=/defined\s*?\[(.+?)\]/g,Bi=function(){function e(){}return e.Process=function(e,t,r,i){var n=this;this._ProcessIncludes(e,t,(function(e){var s=n._ProcessShaderConversion(e,t,i);r(s)}))},e._ProcessPrecision=function(e,t){var r=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=r?"precision highp float;\n"+e:"precision mediump float;\n"+e:r||(e=e.replace("precision highp float","precision mediump float")),e},e._ExtractOperation=function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new Si(t[1].trim(),"!"===e[0]);for(var r="",i=0,n=0,s=["==",">=","<=","<",">"];n<s.length&&(r=s[n],!((i=e.indexOf(r))>-1));n++);if(-1===i)return new Si(e);var o=e.substring(0,i).trim(),a=e.substring(i+r.length).trim();return new Mi(o,r,a)},e._BuildSubExpression=function(e){e=e.replace(Ri,"defined[$1]");for(var t=[],r=0,i=Ci.infixToPostfix(e);r<i.length;r++){var n=i[r];if("||"!==n&&"&&"!==n)t.push(n);else if(t.length>=2){var s=t[t.length-1],o=t[t.length-2];t.length-=2;var a="&&"==n?new Ei:new Pi;"string"==typeof s&&(s=s.replace(Ai,"defined($1)")),"string"==typeof o&&(o=o.replace(Ai,"defined($1)")),a.leftOperand="string"==typeof o?this._ExtractOperation(o):o,a.rightOperand="string"==typeof s?this._ExtractOperation(s):s,t.push(a)}}var l=t[t.length-1];return"string"==typeof l&&(l=l.replace(Ai,"defined($1)")),"string"==typeof l?this._ExtractOperation(l):l},e._BuildExpression=function(e,t){var r=new xi,i=e.substring(0,t),n=e.substring(t);return n=n.substring(0,(n.indexOf("//")+1||n.length+1)-1).trim(),r.testExpression="#ifdef"===i?new Si(n):"#ifndef"===i?new Si(n,!0):this._BuildSubExpression(n),r},e._MoveCursorWithinIf=function(e,t,r){for(var i=e.currentLine;this._MoveCursor(e,r);){var n=(i=e.currentLine).substring(0,5).toLowerCase();if("#else"===n){var s=new bi;return t.children.push(s),void this._MoveCursor(e,s)}if("#elif"===n){var o=this._BuildExpression(i,5);t.children.push(o),r=o}}},e._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var r=e.currentLine,i=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(r);if(i&&i.length)switch(i[0]){case"#ifdef":var n=new Ti;t.children.push(n);var s=this._BuildExpression(r,6);n.children.push(s),this._MoveCursorWithinIf(e,n,s);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":n=new Ti,t.children.push(n),s=this._BuildExpression(r,7),n.children.push(s),this._MoveCursorWithinIf(e,n,s);break;case"#if":n=new Ti,s=this._BuildExpression(r,3),t.children.push(n),n.children.push(s),this._MoveCursorWithinIf(e,n,s)}else{var o=new bi;if(o.line=r,t.children.push(o),"#"===r[0]&&"d"===r[1]){var a=r.replace(";","").split(" ");o.additionalDefineKey=a[1],3===a.length&&(o.additionalDefineValue=a[2])}}}return!1},e._EvaluatePreProcessors=function(e,t,r){var i=new bi,n=new wi;return n.lineIndex=-1,n.lines=e.split("\n"),this._MoveCursor(n,i),i.process(t,r)},e._PreparePreProcessors=function(e){for(var t={},r=0,i=e.defines;r<i.length;r++){var n=i[r].replace("#define","").replace(";","").trim().split(" ");t[n[0]]=n.length>1?n[1]:""}return t.GL_ES="true",t.__VERSION__=e.version,t[e.platformName]="true",t},e._ProcessShaderConversion=function(e,t,r){var i=this._ProcessPrecision(e,t);if(!t.processor)return i;if(-1!==i.indexOf("#version 3"))return i.replace("#version 300 es","");var n=t.defines,s=this._PreparePreProcessors(t);return t.processor.preProcessor&&(i=t.processor.preProcessor(i,n,t.isFragment)),i=this._EvaluatePreProcessors(i,s,t),t.processor.postProcessor&&(i=t.processor.postProcessor(i,n,t.isFragment,r)),i},e._ProcessIncludes=function(t,r,i){for(var n=this,s=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=s.exec(t),a=new String(t),l=!1;null!=o;){var c=o[1];if(-1!==c.indexOf("__decl__")&&(c=c.replace(/__decl__/,""),r.supportsUniformBuffers&&(c=(c=c.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),c+="Declaration"),!r.includesShadersStore[c]){var h=r.shadersRepository+"ShadersInclude/"+c+".fx";return void e._FileToolsLoadFile(h,(function(e){r.includesShadersStore[c]=e,n._ProcessIncludes(a,r,i)}))}var u=r.includesShadersStore[c];if(o[2])for(var d=o[3].split(","),p=0;p<d.length;p+=2){var f=new RegExp(d[p],"g"),g=d[p+1];u=u.replace(f,g)}if(o[4]){var m=o[5];if(-1!==m.indexOf("..")){var y=m.split(".."),_=parseInt(y[0]),v=parseInt(y[1]),b=u.slice(0);u="",isNaN(v)&&(v=r.indexParameters[y[1]]);for(var w=_;w<v;w++)r.supportsUniformBuffers||(b=b.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),u+=b.replace(/\{X\}/g,w.toString())+"\n"}else r.supportsUniformBuffers||(u=u.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),u=u.replace(/\{X\}/g,m)}a=a.replace(o[0],u),l=l||u.indexOf("#include<")>=0,o=s.exec(t)}l?this._ProcessIncludes(a.toString(),r,i):i(a)},e._FileToolsLoadFile=function(e,t,r,i,n,s){throw jt.WarnImport("FileTools")},e}(),Ii=function(){function e(t,r,i,n,s,o,a,l,c,h){var u,d=this;void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===c&&(c=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new Ht,this.onErrorObservable=new Ht,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._multiTarget=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._pipelineContext=null,this._valueCache={},this.name=t;var p,f,g=null;if(r.attributes){var m=r;if(this._engine=i,this._attributesNames=m.attributes,this._uniformsNames=m.uniformsNames.concat(m.samplers),this._samplerList=m.samplers.slice(),this.defines=m.defines,this.onError=m.onError,this.onCompiled=m.onCompiled,this._fallbacks=m.fallbacks,this._indexParameters=m.indexParameters,this._transformFeedbackVaryings=m.transformFeedbackVaryings||null,this._multiTarget=!!m.multiTarget,m.uniformBuffersNames){this._uniformBuffersNamesList=m.uniformBuffersNames.slice();for(var y=0;y<m.uniformBuffersNames.length;y++)this._uniformBuffersNames[m.uniformBuffersNames[y]]=y}g=null!==(u=m.processFinalCode)&&void 0!==u?u:null}else this._engine=s,this.defines=null==o?"":o,this._uniformsNames=i.concat(n),this._samplerList=n?n.slice():[],this._attributesNames=r,this._uniformBuffersNamesList=[],this.onError=c,this.onCompiled=l,this._indexParameters=h,this._fallbacks=a;this._attributeLocationByName={},this.uniqueId=e._uniqueIdSeed++;var _=_i.IsWindowObjectExist()?this._engine.getHostDocument():null;t.vertexSource?p="source:"+t.vertexSource:t.vertexElement?(p=_?_.getElementById(t.vertexElement):null)||(p=t.vertexElement):p=t.vertex||t,t.fragmentSource?f="source:"+t.fragmentSource:t.fragmentElement?(f=_?_.getElementById(t.fragmentElement):null)||(f=t.fragmentElement):f=t.fragment||t;var v={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:e.ShadersRepository,includesShadersStore:e.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadShader(p,"Vertex","",(function(e){d._rawVertexSourceCode=e,d._loadShader(f,"Fragment","Pixel",(function(r){d._rawFragmentSourceCode=r,Bi.Process(e,v,(function(e){g&&(e=g("vertex",e)),v.isFragment=!0,Bi.Process(r,v,(function(r){g&&(r=g("fragment",r)),d._useFinalCode(e,r,t)}),d._engine)}),d._engine)}))}))}return Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new Ht),this._onBindObservable},enumerable:!1,configurable:!0}),e.prototype._useFinalCode=function(e,t,r){if(r){var i=r.vertexElement||r.vertex||r.spectorName||r,n=r.fragmentElement||r.fragment||r.spectorName||r;this._vertexSourceCode="#define SHADER_NAME vertex:"+i+"\n"+e,this._fragmentSourceCode="#define SHADER_NAME fragment:"+n+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),e.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},e.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[e]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getUniformNames=function(){return this._uniformsNames},e.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},e.prototype.getIndexParameters=function(){return this._indexParameters},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))},e.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}setTimeout((function(){t._checkIsReady(e)}),16)},e.prototype._loadShader=function(t,r,i,n){var s;"undefined"!=typeof HTMLElement&&t instanceof HTMLElement?n(_i.GetDOMTextContent(t)):"source:"!==t.substr(0,7)?"base64:"!==t.substr(0,7)?e.ShadersStore[t+r+"Shader"]?n(e.ShadersStore[t+r+"Shader"]):i&&e.ShadersStore[t+i+"Shader"]?n(e.ShadersStore[t+i+"Shader"]):(s="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(s+"."+r.toLowerCase()+".fx",n)):n(window.atob(t.substr(7))):n(t.substr(7))},Object.defineProperty(e.prototype,"vertexSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fragmentSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),e.prototype._rebuildProgram=function(e,t,r,i){var n=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){i&&i(t)},this.onCompiled=function(){var e=n.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);n._pipelineContext._handlesSpectorRebuildCallback(r)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,r=this.defines;this._valueCache={};var i=this._pipelineContext;try{var n=this._engine;this._pipelineContext=n.createPipelineContext();var s=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?n._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,s,null,this._transformFeedbackVaryings):n._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,s,r,this._transformFeedbackVaryings),n._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(n.supportsUniformBuffers)for(var r in e._uniformBuffersNames)e.bindUniformBlock(r,e._uniformBuffersNames[r]);var s;if(n.getUniforms(e._pipelineContext,e._uniformsNames).forEach((function(t,r){e._uniforms[e._uniformsNames[r]]=t})),e._attributes=n.getAttributes(e._pipelineContext,t),t)for(var o=0;o<t.length;o++){var a=t[o];e._attributeLocationByName[a]=e._attributes[o]}for(s=0;s<e._samplerList.length;s++)null==e.getUniform(e._samplerList[s])&&(e._samplerList.splice(s,1),s--);e._samplerList.forEach((function(t,r){e._samplers[t]=r})),n.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),i&&e.getEngine()._deletePipelineContext(i)})),this._pipelineContext.isAsync&&this._checkIsReady(i)}catch(e){this._processCompilationErrors(e,i)}},e.prototype._getShaderCodeAndErrorLine=function(e,t,r){var i=r?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,n=null;if(t&&e){var s=t.match(i);if(s&&2===s.length){var o=parseInt(s[1]),a=e.split("\n",-1);a.length>=o&&(n="Offending line ["+o+"] in "+(r?"fragment":"vertex")+" code: "+a[o-1])}}return[e,n]},e.prototype._processCompilationErrors=function(t,r){var i,n,s,o,a;void 0===r&&(r=null),this._compilationError=t.message;var l=this._attributesNames,c=this._fallbacks;if(mi.Error("Unable to compile effect:"),mi.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),mi.Error("Attributes: "+l.map((function(e){return" "+e}))),mi.Error("Defines:\r\n"+this.defines),e.LogShaderCodeOnCompilationError){var h=null,u=null,d=null;(null===(s=this._pipelineContext)||void 0===s?void 0:s._getVertexShaderCode())&&(d=(i=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],h=i[1],d&&(mi.Error("Vertex code:"),mi.Error(d))),(null===(o=this._pipelineContext)||void 0===o?void 0:o._getFragmentShaderCode())&&(d=(n=this._getShaderCodeAndErrorLine(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode(),this._compilationError,!0))[0],u=n[1],d&&(mi.Error("Fragment code:"),mi.Error(d))),h&&mi.Error(h),u&&mi.Error(u)}mi.Error("Error: "+this._compilationError),r&&(this._pipelineContext=r,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),c?(this._pipelineContext=null,c.hasMoreFallbacks?(this._allFallbacksProcessed=!1,mi.Error("Trying next fallback."),this.defines=c.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!1,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureArray=function(e,t){var r=e+"Ex";if(-1===this._samplerList.indexOf(r+"0")){for(var i=this._samplerList.indexOf(e),n=1;n<t.length;n++){var s=r+(n-1).toString();this._samplerList.splice(i+n,0,s)}for(var o=0,a=0,l=this._samplerList;a<l.length;a++){var c=l[a];this._samplers[c]=o,o+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t)},e.prototype._cacheMatrix=function(e,t){var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},e.prototype._cacheFloat2=function(e,t,r){var i=this._valueCache[e];if(!i||2!==i.length)return i=[t,r],this._valueCache[e]=i,!0;var n=!1;return i[0]!==t&&(i[0]=t,n=!0),i[1]!==r&&(i[1]=r,n=!0),n},e.prototype._cacheFloat3=function(e,t,r,i){var n=this._valueCache[e];if(!n||3!==n.length)return n=[t,r,i],this._valueCache[e]=n,!0;var s=!1;return n[0]!==t&&(n[0]=t,s=!0),n[1]!==r&&(n[1]=r,s=!0),n[2]!==i&&(n[2]=i,s=!0),s},e.prototype._cacheFloat4=function(e,t,r,i,n){var s=this._valueCache[e];if(!s||4!==s.length)return s=[t,r,i,n],this._valueCache[e]=s,!0;var o=!1;return s[0]!==t&&(s[0]=t,o=!0),s[1]!==r&&(s[1]=r,o=!0),s[2]!==i&&(s[2]=i,o=!0),s[3]!==n&&(s[3]=n,o=!0),o},e.prototype.bindUniformBuffer=function(t,r){var i=this._uniformBuffersNames[r];void 0!==i&&e._baseCache[i]!==t&&(e._baseCache[i]=t,this._engine.bindUniformBufferBase(t,i))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},e.prototype.setInt=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t||this._engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t),this},e.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this._uniforms[e],t),this},e.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this._uniforms[e],t),this},e.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this._uniforms[e],t),this},e.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this._uniforms[e],t),this},e.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},e.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},e.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},e.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},e.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},e.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},e.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},e.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},e.prototype.setMatrices=function(e,t){return t?(this._valueCache[e]=null,this._engine.setMatrices(this._uniforms[e],t),this):this},e.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&(this._engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null)),this},e.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this._uniforms[e],t),this},e.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this._uniforms[e],t),this},e.prototype.setFloat=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t||this._engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t),this},e.prototype.setBool=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t||this._engine.setInt(this._uniforms[e],t?1:0)&&(this._valueCache[e]=t),this},e.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&(this._engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null)),this},e.prototype.setFloat2=function(e,t,r){return this._cacheFloat2(e,t,r)&&(this._engine.setFloat2(this._uniforms[e],t,r)||(this._valueCache[e]=null)),this},e.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&(this._engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null)),this},e.prototype.setFloat3=function(e,t,r,i){return this._cacheFloat3(e,t,r,i)&&(this._engine.setFloat3(this._uniforms[e],t,r,i)||(this._valueCache[e]=null)),this},e.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this._engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null)),this},e.prototype.setFloat4=function(e,t,r,i,n){return this._cacheFloat4(e,t,r,i,n)&&(this._engine.setFloat4(this._uniforms[e],t,r,i,n)||(this._valueCache[e]=null)),this},e.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&(this._engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null)),this},e.prototype.setColor4=function(e,t,r){return this._cacheFloat4(e,t.r,t.g,t.b,r)&&(this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,r)||(this._valueCache[e]=null)),this},e.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null)),this},e.prototype.dispose=function(){this._engine._releaseEffect(this)},e.RegisterShader=function(t,r,i){r&&(e.ShadersStore[t+"PixelShader"]=r),i&&(e.ShadersStore[t+"VertexShader"]=i)},e.ResetCache=function(){e._baseCache={}},e.ShadersRepository="src/Shaders/",e.LogShaderCodeOnCompilationError=!0,e._uniqueIdSeed=0,e._baseCache={},e.ShadersStore={},e.IncludesShadersStore={},e}(),Fi=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}(),Di=function(){function e(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=e.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=e.KEEP,this._stencilOpDepthFail=e.KEEP,this._stencilOpStencilDepthPass=e.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(e){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},e.ALWAYS=519,e.KEEP=7680,e.REPLACE=7681,e}(),Li=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,r,i){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===r&&this._blendConstants[3]===i||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=r,this._blendConstants[3]=i,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,r,i){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===r&&this._blendFunctionParameters[3]===i||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=r,this._blendFunctionParameters[3]=i,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}(),ki=function(){function e(){}return e.prototype.postProcessor=function(e,t,r,i){return i.getCaps().drawBuffersExtension||(e=e.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")),e},e}(),Oi=function(){function e(){}return e.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},e.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},e.prototype.postProcessor=function(e,t,r){var i=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(i?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e},e}(),Ui=function(e){function t(t){var r=e.call(this)||this;return r._buffer=t,r}return It(t,e),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),t}(function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),e}()),Ni=function(){function e(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},e.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},e}(),Vi=function(){function e(){}return e.CreateCanvas=function(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);var r=document.createElement("canvas");return r.width=e,r.height=t,r},e}(),Gi=function(){function e(){}return e.SetMatrixPrecision=function(t){if(e.MatrixTrackPrecisionChange=!1,t&&!e.MatrixUse64Bits&&e.MatrixTrackedMatrices)for(var r=0;r<e.MatrixTrackedMatrices.length;++r){var i=e.MatrixTrackedMatrices[r],n=i._m;i._m=new Array(16);for(var s=0;s<16;++s)i._m[s]=n[s]}e.MatrixUse64Bits=t,e.MatrixCurrentType=e.MatrixUse64Bits?Array:Float32Array,e.MatrixTrackedMatrices=null},e.MatrixUse64Bits=!1,e.MatrixTrackPrecisionChange=!0,e.MatrixCurrentType=Float32Array,e.MatrixTrackedMatrices=[],e}(),zi=function(){},Hi=function(){function e(t,r,i,n){var s=this;void 0===n&&(n=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new Ht,this.onContextRestoredObservable=new Ht,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new Fi,this._stencilState=new Di,this._alphaState=new Li,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new Ht,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(e,t,r,i,n,o){var a=s._gl,l=a.createRenderbuffer();return a.bindRenderbuffer(a.RENDERBUFFER,l),r>1&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(a.RENDERBUFFER,r,n,e,t):a.renderbufferStorage(a.RENDERBUFFER,i,e,t),a.framebufferRenderbuffer(a.FRAMEBUFFER,o,a.RENDERBUFFER,l),a.bindRenderbuffer(a.RENDERBUFFER,null),l},this._boundUniforms={};var o=null;if(t){if(i=i||{},Gi.SetMatrixPrecision(!!i.useHighPrecisionMatrix),t.getContext){if(o=t,this._renderingCanvas=o,null!=r&&(i.antialias=r),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),void 0===i.timeStep&&(i.timeStep=1/60),void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.audioEngine&&(i.audioEngine=!0),void 0===i.stencil&&(i.stencil=!0),!1===i.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===i.xrCompatible&&(i.xrCompatible=!0),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent){var a=navigator.userAgent;this.hostInformation.isMobile=-1!==a.indexOf("Mobile");for(var l=0,c=e.ExceptionList;l<c.length;l++){var h=c[l],u=h.key,d=h.targets;if(new RegExp(u).test(a)){if(h.capture&&h.captureConstraint){var p=h.capture,f=h.captureConstraint,g=new RegExp(p).exec(a);if(g&&g.length>0&&parseInt(g[g.length-1])>=f)continue}for(var m=0,y=d;m<y.length;m++)switch(y[m]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),s._contextWasLost=!0,mi.Warn("WebGL context lost."),s.onContextLostObservable.notifyObservers(s)},this._onContextRestored=function(){setTimeout((function(){s._initGLContext(),s._rebuildEffects(),s._rebuildInternalTextures(),s._rebuildBuffers(),s.wipeCaches(!0),mi.Warn("WebGL context successfully restored."),s.onContextRestoredObservable.notifyObservers(s),s._contextWasLost=!1}),0)},o.addEventListener("webglcontextlost",this._onContextLost,!1),o.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),!i.disableWebGL2Support)try{this._gl=o.getContext("webgl2",i)||o.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(e){}if(!this._gl){if(!o)throw new Error("The provided canvas is null or undefined.");try{this._gl=o.getContext("webgl",i)||o.getContext("experimental-webgl",i)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var _=this._gl.getContextAttributes();_&&(i.stencil=_.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var v=_i.IsWindowObjectExist()&&window.devicePixelRatio||1,b=i.limitDeviceRatio||v;this._hardwareScalingLevel=n?1/Math.min(b,v):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext();for(var w=0;w<this._caps.maxVertexAttribs;w++)this._currentBufferPointers[w]=new zi;this.webGLVersion>1?this._shaderProcessor=new Oi:this._shaderProcessor=new ki,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=i,console.log("Babylon.js v"+e.Version+" - "+this.description)}}return Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@4.2.2"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"4.2.2"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return Ii.ShadersRepository},set:function(e){Ii.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++)t[e]._rebuild()},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects)this._compiledEffects[e]._prepareEffect();Ii.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++)t[e]._rebuild()},e.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var i=this._gl.getExtension("WEBGL_depth_texture");null!=i&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=i.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var n=this._gl.getExtension("OES_vertex_array_object");null!=n&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=n.createVertexArrayOES.bind(n),this._gl.bindVertexArray=n.bindVertexArrayOES.bind(n),this._gl.deleteVertexArray=n.deleteVertexArrayOES.bind(n))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var s=this._gl.getExtension("ANGLE_instanced_arrays");null!=s?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=s.drawArraysInstancedANGLE.bind(s),this._gl.drawElementsInstanced=s.drawElementsInstancedANGLE.bind(s),this._gl.vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var o=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);o&&a&&(this._caps.highPrecisionShaderSupported=0!==o.precision&&0!==a.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var l=this._gl.getExtension("EXT_blend_minmax");null!=l&&(this._caps.blendMinMax=!0,this._gl.MAX=l.MAX_EXT,this._gl.MIN=l.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var c=0;c<this._maxSimultaneousTextures;c++)this._nextFreeTextureSlots.push(c)},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=Vi.CreateCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])();this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getHostWindow=function(){return _i.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},e.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},e.prototype._queueNewFrame=function(t,r){return e.QueueNewFrame(t,r)},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},e.prototype.clear=function(e,t,r,i){void 0===i&&(i=!1),this.applyStates();var n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),r&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},e.prototype._viewport=function(e,t,r,i){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=i,this._gl.viewport(e,t,r,i))},e.prototype.setViewport=function(e,t,r){var i=t||this.getRenderWidth(),n=r||this.getRenderHeight(),s=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(s*i,o*n,i*e.width,n*e.height)},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},e.prototype.resize=function(){var e,t;_i.IsWindowObjectExist()?(e=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(e=this._renderingCanvas?this._renderingCanvas.width:100,t=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},e.prototype.setSize=function(e,t){return!(!this._renderingCanvas||(e|=0,t|=0,this._renderingCanvas.width===e&&this._renderingCanvas.height===t||(this._renderingCanvas.width=e,this._renderingCanvas.height=t,0)))},e.prototype.bindFramebuffer=function(e,t,r,i,n,s,o){void 0===t&&(t=0),void 0===s&&(s=0),void 0===o&&(o=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var a=this._gl;e.is2DArray?a.framebufferTextureLayer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,e._webGLTexture,s,o):e.isCube&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,s);var l=e._depthStencilTexture;if(l){var c=l._generateStencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;e.is2DArray?a.framebufferTextureLayer(a.FRAMEBUFFER,c,l._webGLTexture,s,o):e.isCube?a.framebufferTexture2D(a.FRAMEBUFFER,c,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,l._webGLTexture,s):a.framebufferTexture2D(a.FRAMEBUFFER,c,a.TEXTURE_2D,l._webGLTexture,s)}this._cachedViewport&&!n?this.setViewport(this._cachedViewport,r,i):(r||(r=e.width,s&&(r/=Math.pow(2,s))),i||(i=e.height,s&&(i/=Math.pow(2,s))),this._viewport(0,0,r,i)),this.wipeCaches()},e.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;if(e._MSAAFramebuffer){if(e._textureArray)return void this.unBindMultiColorAttachmentFramebuffer(e._textureArray,t,r);i.bindFramebuffer(i.READ_FRAMEBUFFER,e._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e._framebuffer),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,i.COLOR_BUFFER_BIT,i.NEAREST)}!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,e,!0),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null)),r&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),r()),this._bindUnboundFramebuffer(null)},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},e.prototype._createVertexBuffer=function(e,t){var r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");var i=new Ui(r);return this.bindArrayBuffer(i),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),i.references=1,i},e.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var r=this._gl.createBuffer(),i=new Ui(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=4===n.BYTES_PER_ELEMENT,i},e.prototype._normalizeIndexData=function(e){if(e instanceof Uint16Array)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBlock=function(e,t,r){var i=e.program,n=this._gl.getUniformBlockIndex(i,t);this._gl.uniformBlockBinding(i,n,r)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,r,i,n,s,o){var a=this._currentBufferPointers[t];if(a){var l=!1;a.active?(a.buffer!==e&&(a.buffer=e,l=!0),a.size!==r&&(a.size=r,l=!0),a.type!==i&&(a.type=i,l=!0),a.normalized!==n&&(a.normalized=n,l=!0),a.stride!==s&&(a.stride=s,l=!0),a.offset!==o&&(a.offset=o,l=!0)):(l=!0,a.active=!0,a.index=t,a.size=r,a.type=i,a.normalized=n,a.stride=s,a.offset=o,a.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,i,n,s,o))}},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t){var r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var i=0;i<r.length;i++){var n=t.getAttributeLocation(i);if(n>=0){var s=e[r[i]];if(!s)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);var o=s.getBuffer();o&&(this._vertexAttribPointer(o,n,s.getSize(),s.type,s.normalized,s.byteStride,s.byteOffset),s.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,s.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(o))))}}},e.prototype.recordVertexArrayObject=function(e,t,r){var i=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(i),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),i},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,r,i,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var s=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var o=0,a=0;a<s;a++)if(a<r.length){var l=n.getAttributeLocation(a);l>=0&&(this._gl.enableVertexAttribArray(l),this._vertexAttribArraysEnabled[l]=!0,this._vertexAttribPointer(e,l,r[a],this._gl.FLOAT,!1,i,o)),o+=4*r[a]}}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,r){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},e.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},e.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index)this.bindInstancesBuffer(e,r,!0);else for(var i=0;i<4;i++){var n=r[i];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,16*i),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}},e.prototype.bindInstancesBuffer=function(e,t,r){void 0===r&&(r=!0),this.bindArrayBuffer(e);var i=0;if(r)for(var n=0;n<t.length;n++)i+=4*(s=t[n]).attributeSize;for(n=0;n<t.length;n++){var s;void 0===(s=t[n]).index&&(s.index=this._currentEffect.getAttributeLocationByName(s.attributeName)),s.index<0||(this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(e,s.index,s.attributeSize,s.attributeType||this._gl.FLOAT,s.normalized||!1,i,s.offset),this._gl.vertexAttribDivisor(s.index,void 0===s.divisor?1:s.divisor),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(e))}},e.prototype.disableInstanceAttributeByName=function(e){if(this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},e.prototype.disableInstanceAttribute=function(e){for(var t,r=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),r=!0,t=this._currentInstanceLocations.indexOf(e);r&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},e.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},e.prototype.draw=function(e,t,r,i){this.drawElementsType(e?0:1,t,r,i)},e.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(2,e,t,r)},e.prototype.drawUnIndexed=function(e,t,r,i){this.drawArraysType(e?0:1,t,r,i)},e.prototype.drawElementsType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(n,r,s,t*o,i):this._gl.drawElements(n,r,s,t*o)},e.prototype.drawArraysType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e);i?this._gl.drawArraysInstanced(n,t,r,i):this._gl.drawArrays(n,t,r)},e.prototype._drawMode=function(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}},e.prototype._reportDrawCall=function(){},e.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},e.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},e.prototype.createEffect=function(e,t,r,i,n,s,o,a,l){var c=(e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e)+"+"+(e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e)+"@"+(n||t.defines);if(this._compiledEffects[c]){var h=this._compiledEffects[c];return o&&h.isReady()&&o(h),h}var u=new Ii(e,t,r,i,this,n,s,o,a,l);return u._key=c,this._compiledEffects[c]=u,u},e._ConcatenateShader=function(e,t,r){return void 0===r&&(r=""),r+(t?t+"\n":"")+e},e.prototype._compileShader=function(t,r,i,n){return this._compileRawShader(e._ConcatenateShader(t,i,n),r)},e.prototype._compileRawShader=function(e,t){var r=this._gl,i=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!i)throw new Error("Something went wrong while compile the shader.");return r.shaderSource(i,e),r.compileShader(i),i},e.prototype._getShaderSource=function(e){return this._gl.getShaderSource(e)},e.prototype.createRawShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null),i=i||this._gl;var s=this._compileRawShader(t,"vertex"),o=this._compileRawShader(r,"fragment");return this._createShaderProgram(e,s,o,i,n)},e.prototype.createShaderProgram=function(e,t,r,i,n,s){void 0===s&&(s=null),n=n||this._gl;var o=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",a=this._compileShader(t,"vertex",i,o),l=this._compileShader(r,"fragment",i,o);return this._createShaderProgram(e,a,l,n,s)},e.prototype.createPipelineContext=function(){var e=new Ni;return e.engine=this,this._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e},e.prototype._createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null);var s=i.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");return i.attachShader(s,t),i.attachShader(s,r),i.linkProgram(s),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),s},e.prototype._finalizePipelineContext=function(e){var t=e.context,r=e.vertexShader,i=e.fragmentShader,n=e.program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var s,o;if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)&&(s=this._gl.getShaderInfoLog(r)))throw e.vertexCompilationError=s,new Error("VERTEX SHADER "+s);if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)&&(s=this._gl.getShaderInfoLog(i)))throw e.fragmentCompilationError=s,new Error("FRAGMENT SHADER "+s);if(o=t.getProgramInfoLog(n))throw e.programLinkError=o,new Error(o)}if(this.validateShaderPrograms&&(t.validateProgram(n),!t.getProgramParameter(n,t.VALIDATE_STATUS)&&(o=t.getProgramInfoLog(n))))throw e.programValidationError=o,new Error(o);t.deleteShader(r),t.deleteShader(i),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._preparePipelineContext=function(e,t,r,i,n,s,o){var a=e;a.program=i?this.createRawShaderProgram(a,t,r,void 0,o):this.createShaderProgram(a,t,r,s,void 0,o),a.program.__SPECTOR_rebuildProgram=n},e.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var r=e;if(r.isParallelCompiled){var i=r.onCompiled;r.onCompiled=i?function(){i(),t()}:t}else t()},e.prototype.getUniforms=function(e,t){for(var r=new Array,i=e,n=0;n<t.length;n++)r.push(this._gl.getUniformLocation(i.program,t[n]));return r},e.prototype.getAttributes=function(e,t){for(var r=[],i=e,n=0;n<t.length;n++)try{r.push(this._gl.getAttribLocation(i.program,t[n]))}catch(e){r.push(-1)}return r},e.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setInt=function(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)},e.prototype.setIntArray=function(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)},e.prototype.setIntArray2=function(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2iv(e,t),0))},e.prototype.setIntArray3=function(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3iv(e,t),0))},e.prototype.setIntArray4=function(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4iv(e,t),0))},e.prototype.setArray=function(e,t){return!!e&&(this._gl.uniform1fv(e,t),!0)},e.prototype.setArray2=function(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2fv(e,t),0))},e.prototype.setArray3=function(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3fv(e,t),0))},e.prototype.setArray4=function(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4fv(e,t),0))},e.prototype.setMatrices=function(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)},e.prototype.setMatrix3x3=function(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)},e.prototype.setMatrix2x2=function(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)},e.prototype.setFloat=function(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)},e.prototype.setFloat2=function(e,t,r){return!!e&&(this._gl.uniform2f(e,t,r),!0)},e.prototype.setFloat3=function(e,t,r,i){return!!e&&(this._gl.uniform3f(e,t,r,i),!0)},e.prototype.setFloat4=function(e,t,r,i,n){return!!e&&(this._gl.uniform4f(e,t,r,i,n),!0)},e.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},e.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},e.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(e.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},e.prototype._getSamplingParameters=function(e,t){var r=this._gl,i=r.NEAREST,n=r.NEAREST;switch(e){case 11:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 3:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 8:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 4:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 5:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 6:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 7:i=r.NEAREST,n=r.LINEAR;break;case 1:i=r.NEAREST,n=r.NEAREST;break;case 9:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 10:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 2:i=r.LINEAR,n=r.LINEAR;break;case 12:i=r.LINEAR,n=r.NEAREST}return{min:n,mag:i}},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},e.prototype.createTexture=function(t,r,i,n,s,o,a,l,c,h,u,d,p){var f=this;void 0===s&&(s=3),void 0===o&&(o=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===h&&(h=null),void 0===u&&(u=null);var g="data:"===(t=t||"").substr(0,5),m="blob:"===t.substr(0,5),y=g&&-1!==t.indexOf(";base64,"),_=c||new qt(this,Vt.Url),v=t;!this._transformTextureUrl||y||c||l||(t=this._transformTextureUrl(t)),v!==t&&(_._originalUrl=v);var b=t.lastIndexOf("."),w=u||(b>-1?t.substring(b).toLowerCase():""),T=null;w.indexOf("?")>-1&&(w=w.split("?")[0]);for(var x=0,C=e._TextureLoaders;x<C.length;x++){var S=C[x];if(S.canLoad(w,d)){T=S;break}}n&&n._addPendingData(_),_.url=t,_.generateMipMaps=!r,_.samplingMode=s,_.invertY=i,this._doNotHandleContextLost||(_._buffer=l);var P=null;o&&!c&&(P=_.onLoadedObservable.add(o)),c||this._internalTexturesCache.push(_);var E=function(e,i){n&&n._removePendingData(_),t===v?(P&&_.onLoadedObservable.remove(P),yi.UseFallbackTexture&&f.createTexture(yi.FallbackTexture,r,_.invertY,n,s,null,a,l,_),a&&a((e||"Unknown error")+(yi.UseFallbackTexture?" - Fallback texture was used":""),i)):(mi.Warn("Failed to load "+t+", falling back to "+v),f.createTexture(v,r,_.invertY,n,s,o,a,l,_,h,u,d,p))};if(T){var M=function(e){T.loadData(e,_,(function(e,t,r,i,o,a){a?E("TextureLoader failed to load data"):f._prepareWebGLTexture(_,n,e,t,_.invertY,!r,i,(function(){return o(),!1}),s)}),p)};l?l instanceof ArrayBuffer?M(new Uint8Array(l)):ArrayBuffer.isView(l)?M(l):a&&a("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,(function(e){return M(new Uint8Array(e))}),void 0,n?n.offlineProvider:void 0,!0,(function(e,t){E("Unable to load "+(e&&e.responseURL,t))}))}else{var R=function(e){m&&!f._doNotHandleContextLost&&(_._buffer=e),f._prepareWebGLTexture(_,n,e.width,e.height,_.invertY,r,!1,(function(t,r,i){var s=f._gl,o=e.width===t&&e.height===r,a=h?f._getInternalFormat(h):".jpg"===w?s.RGB:s.RGBA;if(o)return s.texImage2D(s.TEXTURE_2D,0,a,a,s.UNSIGNED_BYTE,e),!1;var l=f._caps.maxTextureSize;if(e.width>l||e.height>l||!f._supportsHardwareTextureRescaling)return f._prepareWorkingCanvas(),!(!f._workingCanvas||!f._workingContext||(f._workingCanvas.width=t,f._workingCanvas.height=r,f._workingContext.drawImage(e,0,0,e.width,e.height,0,0,t,r),s.texImage2D(s.TEXTURE_2D,0,a,a,s.UNSIGNED_BYTE,f._workingCanvas),_.width=t,_.height=r,1));var c=new qt(f,Vt.Temp);return f._bindTextureDirectly(s.TEXTURE_2D,c,!0),s.texImage2D(s.TEXTURE_2D,0,a,a,s.UNSIGNED_BYTE,e),f._rescaleTexture(c,_,n,a,(function(){f._releaseTexture(c),f._bindTextureDirectly(s.TEXTURE_2D,_,!0),i()})),!0}),s)};!g||y?l&&(l.decoding||l.close)?R(l):e._FileToolsLoadImage(t,R,E,n?n.offlineProvider:null,d):"string"==typeof l||l instanceof ArrayBuffer||ArrayBuffer.isView(l)||l instanceof Blob?e._FileToolsLoadImage(l,R,E,n?n.offlineProvider:null,d):l&&R(l)}return _},e._FileToolsLoadImage=function(e,t,r,i,n){throw jt.WarnImport("FileTools")},e.prototype._rescaleTexture=function(e,t,r,i,n){},e.prototype.createRawTexture=function(e,t,r,i,n,s,o,a,l){throw void 0===a&&(a=null),void 0===l&&(l=0),jt.WarnImport("Engine.RawTexture")},e.prototype.createRawCubeTexture=function(e,t,r,i,n,s,o,a){throw void 0===a&&(a=null),jt.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture3D=function(e,t,r,i,n,s,o,a,l,c){throw void 0===l&&(l=null),void 0===c&&(c=0),jt.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture2DArray=function(e,t,r,i,n,s,o,a,l,c){throw void 0===l&&(l=null),void 0===c&&(c=0),jt.WarnImport("Engine.RawTexture")},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},e.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1);var i=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.generateMipMaps||r);this._setTextureParameterInteger(i,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(i,this._gl.TEXTURE_MIN_FILTER,n.min),r&&(t.generateMipMaps=!0,this._gl.generateMipmap(i)),this._bindTextureDirectly(i,null),t.samplingMode=e},e.prototype.updateTextureWrappingMode=function(e,t,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var n=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==r&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r),e),e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==i&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(i),e),e._cachedWrapR=i),this._bindTextureDirectly(n,null)},e.prototype._setupDepthStencilTexture=function(e,t,r,i,n){var s=t.width||t,o=t.height||t,a=t.layers||0;e.baseWidth=s,e.baseHeight=o,e.width=s,e.height=o,e.is2DArray=a>0,e.depth=a,e.isReady=!0,e.samples=1,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=r,e.samplingMode=i?2:1,e.type=0,e._comparisonFunction=n;var l=this._gl,c=this._getTextureTarget(e),h=this._getSamplingParameters(e.samplingMode,!1);l.texParameteri(c,l.TEXTURE_MAG_FILTER,h.mag),l.texParameteri(c,l.TEXTURE_MIN_FILTER,h.min),l.texParameteri(c,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(c,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),0===n?(l.texParameteri(c,l.TEXTURE_COMPARE_FUNC,515),l.texParameteri(c,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(c,l.TEXTURE_COMPARE_FUNC,n),l.texParameteri(c,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE))},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,s,o){void 0===s&&(s=0),void 0===o&&(o=0);var a=this._gl,l=a.TEXTURE_2D;e.isCube&&(l=a.TEXTURE_CUBE_MAP_POSITIVE_X+s),this._gl.compressedTexImage2D(l,o,t,r,i,0,n)},e.prototype._uploadDataToTextureDirectly=function(e,t,r,i,n,s){void 0===r&&(r=0),void 0===i&&(i=0),void 0===s&&(s=!1);var o=this._gl,a=this._getWebGLTextureType(e.type),l=this._getInternalFormat(e.format),c=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,e.format):this._getInternalFormat(n);this._unpackFlipY(e.invertY);var h=o.TEXTURE_2D;e.isCube&&(h=o.TEXTURE_CUBE_MAP_POSITIVE_X+r);var u=Math.round(Math.log(e.width)*Math.LOG2E),d=Math.round(Math.log(e.height)*Math.LOG2E),p=s?e.width:Math.pow(2,Math.max(u-i,0)),f=s?e.height:Math.pow(2,Math.max(d-i,0));o.texImage2D(h,i,c,p,f,0,l,a,t)},e.prototype.updateTextureData=function(e,t,r,i,n,s,o,a){void 0===o&&(o=0),void 0===a&&(a=0);var l=this._gl,c=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var u=l.TEXTURE_2D;e.isCube&&(u=l.TEXTURE_CUBE_MAP_POSITIVE_X+o),l.texSubImage2D(u,a,r,i,n,s,h,c,t)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,r,i),this._bindTextureDirectly(s,null,!0)},e.prototype._prepareWebGLTextureContinuation=function(e,t,r,i,n){var s=this._gl;if(s){var o=this._getSamplingParameters(n,!r);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o.min),r||i||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(t,r,i,n,s,o,a,l,c){var h=this;void 0===c&&(c=3);var u=this.getCaps().maxTextureSize,d=Math.min(u,this.needPOTTextures?e.GetExponentOfTwo(i,u):i),p=Math.min(u,this.needPOTTextures?e.GetExponentOfTwo(n,u):n),f=this._gl;f&&(t._webGLTexture?(this._bindTextureDirectly(f.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===s||!!s),t.baseWidth=i,t.baseHeight=n,t.width=d,t.height=p,t.isReady=!0,l(d,p,(function(){h._prepareWebGLTextureContinuation(t,r,o,a,c)}))||this._prepareWebGLTextureContinuation(t,r,o,a,c)):r&&r._removePendingData(t))},e.prototype._setupFramebufferDepthAttachments=function(e,t,r,i,n){void 0===n&&(n=1);var s=this._gl;if(e&&t)return this._getDepthStencilBuffer(r,i,n,s.DEPTH_STENCIL,s.DEPTH24_STENCIL8,s.DEPTH_STENCIL_ATTACHMENT);if(t){var o=s.DEPTH_COMPONENT16;return this._webGLVersion>1&&(o=s.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(r,i,n,o,o,s.DEPTH_ATTACHMENT)}return e?this._getDepthStencilBuffer(r,i,n,s.STENCIL_INDEX8,s.STENCIL_INDEX8,s.STENCIL_ATTACHMENT):null},e.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},e.prototype._releaseTexture=function(e){this._releaseFramebufferObjects(e),this._deleteTexture(e._webGLTexture),this.unbindAllTextures();var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},e.prototype._deleteTexture=function(e){this._gl.deleteTexture(e)},e.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var r=e.getSamplers(),i=0;i<r.length;i++){var n=e.getUniform(r[i]);n&&(this._boundUniforms[i]=n)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1);var n=!1,s=t&&t._associatedChannel>-1;return r&&s&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||i?(this._activateCurrentTexture(),t&&t.isMultiview?this._gl.bindTexture(e,t?t._colorTextureArray:null):this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)):r&&(n=!0,this._activateCurrentTexture()),s&&!r&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),n},e.prototype._bindTexture=function(e,t){if(void 0!==e){t&&(t._associatedChannel=e),this._activeChannel=e;var r=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(r,t)}},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},e.prototype.setTexture=function(e,t,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},e.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r&&r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},e.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(e,t,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var n;n=i?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&n&&(n._associatedChannel=e);var s=!0;this._boundTexturesCache[e]===n&&(r||this._bindSamplerUniformToChannel(n._associatedChannel,e),s=!1),this._activeChannel=e;var o=this._getTextureTarget(n);if(s&&this._bindTextureDirectly(o,n,r),n&&!n.isMultiview){if(n.isCube&&n._cachedCoordinatesMode!==t.coordinatesMode){n._cachedCoordinatesMode=t.coordinatesMode;var a=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=a,t.wrapV=a}n._cachedWrapU!==t.wrapU&&(n._cachedWrapU=t.wrapU,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),n)),n._cachedWrapV!==t.wrapV&&(n._cachedWrapV=t.wrapV,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),n)),n.is3D&&n._cachedWrapR!==t.wrapR&&(n._cachedWrapR=t.wrapR,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),n)),this._setAnisotropicLevel(o,n,t.anisotropicFilteringLevel)}return!0},e.prototype.setTextureArray=function(e,t,r){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var i=0;i<r.length;i++){var n=r[i].getInternalTexture();n?(this._textureUnits[i]=e+i,n._associatedChannel=e+i):this._textureUnits[i]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var s=0;s<r.length;s++)this._setTexture(this._textureUnits[s],r[s],!0)}},e.prototype._setAnisotropicLevel=function(e,t,r){var i=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(r=1),i&&t._cachedAnisotropicFilteringLevel!==r&&(this._setTextureParameterFloat(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=r)},e.prototype._setTextureParameterFloat=function(e,t,r,i){this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameterf(e,t,r)},e.prototype._setTextureParameterInteger=function(e,t,r,i){i&&this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameteri(e,t,r)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},e.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],_i.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,Ii.ResetCache();for(var e=0,t=this._activeRequests;e<t.length;e++)t[e].abort()},e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getError=function(){return this._gl.getError()},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var s=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&s===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var o=t.RGBA,a=t.UNSIGNED_BYTE,l=new Uint8Array(4);t.readPixels(0,0,1,1,o,a,l),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(i),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},e.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case 0:t=this._gl.ALPHA;break;case 1:t=this._gl.LUMINANCE;break;case 2:t=this._gl.LUMINANCE_ALPHA;break;case 6:t=this._gl.RED;break;case 7:t=this._gl.RG;break;case 4:t=this._gl.RGB;break;case 5:t=this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:t=this._gl.RED_INTEGER;break;case 9:t=this._gl.RG_INTEGER;break;case 10:t=this._gl.RGB_INTEGER;break;case 11:t=this._gl.RGBA_INTEGER}return t},e.prototype._getRGBABufferInternalSizedFormat=function(e,t){if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return this._gl.RGB8;case 5:default:return this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(t,r,i,n,s,o){var a=this,l=e._FileToolsLoadFile(t,r,i,n,s,o);return this._activeRequests.push(l),l.onCompleteObservable.add((function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)})),l},e._FileToolsLoadFile=function(e,t,r,i,n,s){throw jt.WarnImport("FileTools")},e.prototype.readPixels=function(e,t,r,i,n){void 0===n&&(n=!0);var s=n?4:3,o=n?this._gl.RGBA:this._gl.RGB,a=new Uint8Array(i*r*s);return this._gl.readPixels(e,t,r,i,o,this._gl.UNSIGNED_BYTE,a),a},Object.defineProperty(e,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),e.isSupported=function(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{var e=Vi.CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(e,"HasMajorPerformanceCaveat",{get:function(){if(null===this._HasMajorPerformanceCaveat)try{var e=Vi.CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),e.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},e.NearestPOT=function(t){var r=e.CeilingPOT(t),i=e.FloorPOT(t);return r-t>t-i?i:r},e.GetExponentOfTwo=function(t,r,i){var n;switch(void 0===i&&(i=2),i){case 1:n=e.FloorPOT(t);break;case 2:n=e.NearestPOT(t);break;default:n=e.CeilingPOT(t)}return Math.min(n,r)},e.QueueNewFrame=function(e,t){return _i.IsWindowObjectExist()?(t||(t=window),t.requestPostAnimationFrame?t.requestPostAnimationFrame(e):t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},e.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],e._TextureLoaders=[],e.CollisionsEpsilon=.001,e._IsSupported=null,e._HasMajorPerformanceCaveat=null,e}();Hi.prototype.createRenderTargetTexture=function(e,t){var r=new Wt;void 0!==t&&"object"==typeof t?(r.generateMipMaps=t.generateMipMaps,r.generateDepthBuffer=!!t.generateDepthBuffer,r.generateStencilBuffer=!!t.generateStencilBuffer,r.type=void 0===t.type?0:t.type,r.samplingMode=void 0===t.samplingMode?3:t.samplingMode,r.format=void 0===t.format?5:t.format):(r.generateMipMaps=t,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=0,r.samplingMode=3,r.format=5),(1!==r.type||this._caps.textureFloatLinearFiltering)&&(2!==r.type||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=1),1!==r.type||this._caps.textureFloat||(r.type=0,mi.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var i=this._gl,n=new qt(this,Vt.RenderTarget),s=e.width||e,o=e.height||e,a=e.layers||0,l=this._getSamplingParameters(r.samplingMode,!!r.generateMipMaps),c=0!==a?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D,h=this._getRGBABufferInternalSizedFormat(r.type,r.format),u=this._getInternalFormat(r.format),d=this._getWebGLTextureType(r.type);this._bindTextureDirectly(c,n),0!==a?(n.is2DArray=!0,i.texImage3D(c,0,h,s,o,a,0,u,d,null)):i.texImage2D(c,0,h,s,o,0,u,d,null),i.texParameteri(c,i.TEXTURE_MAG_FILTER,l.mag),i.texParameteri(c,i.TEXTURE_MIN_FILTER,l.min),i.texParameteri(c,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(c,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),r.generateMipMaps&&this._gl.generateMipmap(c),this._bindTextureDirectly(c,null);var p=this._currentFramebuffer,f=i.createFramebuffer();return this._bindUnboundFramebuffer(f),n._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!r.generateStencilBuffer,r.generateDepthBuffer,s,o),n.is2DArray||i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n._webGLTexture,0),this._bindUnboundFramebuffer(p),n._framebuffer=f,n.baseWidth=s,n.baseHeight=o,n.width=s,n.height=o,n.depth=a,n.isReady=!0,n.samples=1,n.generateMipMaps=!!r.generateMipMaps,n.samplingMode=r.samplingMode,n.type=r.type,n.format=r.format,n._generateDepthBuffer=r.generateDepthBuffer,n._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(n),n},Hi.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var r=e.width||e;return this._createDepthStencilCubeTexture(r,t)}return this._createDepthStencilTexture(e,t)},Hi.prototype._createDepthStencilTexture=function(e,t){var r=this._gl,i=e.layers||0,n=0!==i?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D,s=new qt(this,Vt.Depth);if(!this._caps.depthTextureExtension)return mi.Error("Depth texture is not supported by your browser or hardware."),s;var o=Ft({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t);this._bindTextureDirectly(n,s,!0),this._setupDepthStencilTexture(s,e,o.generateStencil,o.bilinearFiltering,o.comparisonFunction);var a=o.generateStencil?r.UNSIGNED_INT_24_8:r.UNSIGNED_INT,l=o.generateStencil?r.DEPTH_STENCIL:r.DEPTH_COMPONENT,c=l;return this.webGLVersion>1&&(c=o.generateStencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24),s.is2DArray?r.texImage3D(n,0,c,s.width,s.height,i,0,l,a,null):r.texImage2D(n,0,c,s.width,s.height,0,l,a,null),this._bindTextureDirectly(n,null),s};let Wi=1;const ji=[{v:"precision highp float;const int pc=0,qc=1,rc=2,sc=3,tc=-1;const int k=0,l=1,m=2,n=3;const int uc=0,vc=1,wc=2;uniform vec2 u_0;uniform vec2 u_1;uniform vec2 u_2;uniform float u_3;uniform int u_4;uniform float u_5;uniform int u_6;uniform int u_7;uniform mat3 u_8;uniform float u_12;uniform int u_13;uniform float u_14;uniform int u_15;uniform vec2 u_17;uniform int u_18;uniform int u_19;attribute vec2 a_v;attribute vec4 a_p0;attribute vec4 a_p1;attribute vec4 a_p2;attribute vec4 a_p3;attribute vec4 a_p4;attribute float a_d1;attribute float a_d2;const float o=0.0,p=1.0,q=3.0,s=4.0,t=5.0,u=6.0,v=7.0;const float xc=0.001;const float yc=0.001;varying float frag_type;varying vec3 frag_geoUVS;varying vec2 frag_geoRange;varying vec4 frag_specialParam1;varying vec4 frag_specialParam2;varying vec4 frag_specialParam3;varying vec3 frag_specialParam4;varying vec2 frag_specialParam5;const int zc=2,Ac=5;const int Bc=0,Cc=1,Dc=2,Ec=3;vec2 Fc(vec4 Gc){mat3 Hc=u_8;vec2 Ic=u_0;vec2 Jc=u_1;vec2 Kc=u_17;return((Hc*vec3(Gc.xy,1.0)).xy*Jc-Ic)/Kc;}vec2 Lc(vec2 wb){return vec2(-wb.y,wb.x);}void main(){vec2 Mc=a_v;int Y=u_7;vec2 Nc=u_2;float Oc=u_3;int Z=u_4;float Pc=u_5;float Qc=u_12;int fb=u_13;float Rc=u_14;int Sc=u_15;vec2 Kc=u_17;bool Tc=u_18 !=0;bool Uc=u_19 !=0;frag_type=0.0;frag_geoRange=frag_specialParam5=vec2(0.0,0.0);frag_geoUVS=frag_specialParam4=vec3(0.0,0.0,0.0);frag_specialParam1=frag_specialParam2=frag_specialParam3=vec4(0.0,0.0,0.0,0.0);if(Y==rc || Y==sc){gl_Position=vec4(Mc,0.0,1.0);frag_type=p;}else{vec2 Vc=Fc(a_p0),Wc=Fc(a_p1),Xc=Fc(a_p2),Yc=Fc(a_p3),Zc=Fc(a_p4);int ad=int(a_p0.z),bd=int(a_p1.z),cd=int(a_p2.z),dd=int(a_p3.z),ed=int(a_p4.z);float fd=Uc ? 0.0 : a_d1,gd=Uc ? 0.0 : a_d2;float hd=a_p1.w,id=a_p2.w,jd=a_p3.w;bool kd=bd==wc;bool ld=cd==wc;vec2 md,nd,od;int pd,qd;if(ld){md=Wc;nd=Xc;od=Yc;pd=bd;qd=dd;}else if(kd){md=Vc;nd=Wc;od=Xc;pd=ad;qd=cd;}else{md=Wc;nd=(Wc+Xc)*0.5;od=Xc;pd=bd;qd=cd;}vec2 rd=od-md,sd=nd-md,td=od-nd;float ud=length(rd),vd=length(sd),wd=length(td);vec2 xd=rd/ud,yd=sd/vd,zd=td/wd;vec2 Ad=Lc(xd),Bd=Lc(yd),Cd=Lc(zd);float Dd=dot(Bd,zd);mat2 Ed;vec2 Fd,Gd;float Hd;bool Id=false;vec2 Jd;if(ld || kd){vec2 Kd=td-sd;float Ld=(dot(-sd,td)+dot(-sd,-sd))/dot(Kd,Kd);vec2 Md=mix(md,nd,Ld),Nd=mix(nd,od,Ld),Od=normalize(Nd-Md);float Pd=sign(Dd);mat2 Qd=mat2(Od,vec2(-Od.y,Od.x)*Pd);vec2 Rd=mix(Md,Nd,Ld);vec2 Sd=(md-Rd)*Qd,Td=(od-Rd)*Qd;float Ud=abs(Sd.x)> abs(Td.x)?(Sd.x*Sd.x)/Sd.y :(Td.x*Td.x)/Td.y;Ed=Qd/Ud;Fd=Rd;Gd=vec2(Sd.x,Td.x)/Ud;Hd=Ud*Pd;Id=Tc || abs(Dd)< xc || min(abs(ud),min(abs(vd/ud),abs(wd/ud)))< Oc*yc;if(Id){nd=(md+od)*0.5;sd=nd-md;td=od-nd;vd=wd=ud*0.5;yd=zd=xd;Bd=Cd=Ad;Dd=1.0;}}bool Vd=ld || kd;vec2 Wd=Vc;int Xd=ad;vec2 Yd=Vd ? Zc : Yc;int Zd=Vd ? ed : dd;bool ae=(Xd==0),be=(Zd==0),ce=(qd==0);if(Xd==0)Wd=md-(nd-md);if(Zd==0)Yd=od-(od-nd);vec2 de=md-Wd,ee=-de,fe=Yd-od,ge=-fe;float he=length(de),ie=length(fe);vec2 je=de/he,ke=fe/ie;vec2 le=Lc(je),me=Lc(ke);if(! Vd || Id){if(vd < yc){yd=je;Bd=le;}if(wd < yc){zd=ke;Cd=me;}if(ud < yc){xd=normalize(Yd-Wd);Ad=Lc(xd);}if(ud < yc){xd=vec2(1.0,0.0);Ad=vec2(0.0,-1.0);ud=yc;}if(vd < yc){yd=xd;Bd=Ad;}if(wd < yc){zd=xd;Cd=Ad;}if(he < yc){je=yd;le=Bd;}if(ie < yc){ke=zd;me=Cd;}Ed=mat2(xd/ud,Ad/ud);Fd=md;Gd=vec2(0.0,1.0);Hd=ud;}vec2 ne=vec2(0.0,0.0);if(Y==pc &&(! Vd || ld)){if(Tc){bool ce=(qd==0);if(ce || abs(ud)< Oc*yc)frag_type=o;else{float oe=clamp(hd,0.0,1.0);float pe=clamp((Vd ? jd : id),0.0,1.0);float qe=Vd ? fd+(gd-fd)*2.0 : gd;float re=Qc*0.5;vec4 se=vec4(min(md.x,od.x)-Oc*Kc.x,min(md.y,od.y)-Oc*Kc.y,max(md.x,od.x)+Oc*Kc.x,max(md.y,od.y)+Oc*Kc.y);ne=Mc*vec2(se [ 2 ]-se [ 0 ],se [ 3 ]-se [ 1 ])/2.0+vec2(se [ 2 ]+se [ 0 ],se [ 3 ]+se [ 1 ])/2.0;vec2 te=vec2(xd.x==0.0 ? 1.0 : sign(xd.x),xd.y==0.0 ? 1.0 : sign(xd.y));float ue=re*(1.0-oe),ve=re*(1.0-pe);float we=re*oe,xe=re*pe;vec2 ye=md-te*we,ze=od+te*xe;vec2 Ae=ye+vec2(te.x*2.0*we,0.0),Be=ze-vec2(te.x*2.0*xe,0.0);vec2 Ce=ye+vec2(0.0,te.y*2.0*we),De=ze-vec2(0.0,te.y*2.0*xe);bool Ee=dot(Ad,Ae-md)>=0.0,Fe=dot(Ad,Be-md)>=0.0;vec2 Ge=Ee ? Ae : Ce,He=Fe ? Be : De;vec2 Ie=Ee ? Ce : Ae,Je=Fe ? De : Be;float Ke=max(abs(xd.x),abs(xd.y));float Le=dot(ne-Ge,Lc(normalize(He-Ge)))*Ke+re;float Me=dot(ne-Ie,-Lc(normalize(Je-Ie)))*Ke+re;float Ne=dot(ne-md,Ad);float Oe=dot(ne-md,(oe > xc)? Lc(Ie-Ge): xd);float Pe=dot(ne-od,(pe > xc)? Lc(He-Je):-xd);frag_specialParam1=vec4(ne-md,ne-od)*0.5/Oc;frag_specialParam2=vec4(Le,Me,ue,ve)*0.5/Oc;frag_specialParam3=vec4(gd-fd,fd,0.0,0.0);frag_specialParam4=vec3(Ne,Oe,Pe);frag_type=v;}}else{float Qe=dot(le,yd),Re=dot(Cd,ke),Se=dot(le,xd),Te=dot(Ad,ke);bool Ue=abs(Qe)< xc,Ve=abs(Re)< xc;bool We=Ue && dot(je,yd)< 0.0,Xe=Ve && dot(zd,ke)< 0.0;float Ye=(! Ue)? sign(Qe):(Se !=0.0)? sign(Se): sign(Te);float Ze=(! Ve)? sign(Re):(Te !=0.0)? sign(Te): sign(Se);vec2 af=normalize(le+Bd)*-Ye;float bf=abs(dot(af,Bd));float cf=(Z==k)? bf :(Z==l)? 1.0/max(bf,xc): 1.0;vec2 df=We ? yd*Ye : af*cf;vec2 ef=normalize(Cd+me)*-Ze;float ff=abs(dot(ef,Cd));float gf=(Z==k)? ff :(Z==l)? 1.0/max(ff,xc): 1.0;vec2 hf=Xe ?-zd*Ze : ef*gf;vec4 se=vec4(min(min(min(min(md.x,od.x),nd.x),md.x+df.x*Oc),od.x+hf.x*Oc)-Oc,min(min(min(min(md.y,od.y),nd.y),md.y+df.y*Oc),od.y+hf.y*Oc)-Oc,max(max(max(max(md.x,od.x),nd.x),md.x+df.x*Oc),od.x+hf.x*Oc)+Oc,max(max(max(max(md.y,od.y),nd.y),md.y+df.y*Oc),od.y+hf.y*Oc)+Oc);ne=Mc*vec2(se [ 2 ]-se [ 0 ],se [ 3 ]-se [ 1 ])/2.0+vec2(se [ 2 ]+se [ 0 ],se [ 3 ]+se [ 1 ])/2.0;vec2 jf=normalize(Bd+df*Ye);vec2 kf=-normalize(le+df*Ye);bool lf=ce || We || Ue || cf > vd*10.0 || cf > he*10.0;vec2 mf=ne-md;vec2 nf=normalize(df);float Cb=-dot(mf,(vd < xc || We)? xd : yd);float Db=lf ? Cb :-dot(mf,Lc(nf))*Ye;float Eb=lf ?-dot(mf,Bd)*Ye : dot(mf,Lc(jf))/(2.0*Oc*length(df+jf*dot(-df,jf)));float Fb=lf ? 0.5 :(dot(mf,nf)/Oc-Pc)/abs(dot(nf,Bd));float Gb=lf ? 1.0 : dot(mf,Lc(kf))/(2.0*Oc*length(df+kf*dot(-df,kf)));vec2 of=-normalize(Cd+hf*Ze);vec2 pf=normalize(me+hf*Ze);bool qf=ce || Xe || Ve || gf > wd*10.0 || gf > ie*10.0;vec2 rf=ne-od;vec2 sf=normalize(hf);float Hb=dot(rf,(wd < xc || Xe)? xd : zd);float Ib=qf ? Hb : dot(rf,Lc(sf))*Ze;float Jb=qf ?-dot(rf,Cd)*Ze : dot(rf,Lc(of))/(2.0*Oc*length(hf+of*dot(-hf,of)));float Kb=qf ? 0.5 :(dot(rf,sf)/Oc-Pc)/abs(dot(sf,Cd));float Lb=qf ? 1.0 : dot(rf,Lc(pf))/(2.0*Oc*length(hf+pf*dot(-hf,pf)));float tf=(1.0-Rc)*Qc/(4.0*Oc);if(ae)Gb=-dot(mf,yd)/(2.0*Oc)+tf;if(be)Lb=dot(rf,zd)/(2.0*Oc)+tf;float uf,vf;if(Vd && ! Id){float wf=fd,qe=fd+(gd-fd)*2.0;float xf=sqrt(1.0+4.0*Gd [ 0 ]*Gd [ 0 ]),yf=sqrt(1.0+4.0*Gd [ 1 ]*Gd [ 1 ]);float zf=sign(Gd [ 0 ])*0.5*(abs(Gd [ 0 ])*xf+0.5*log(2.0*abs(Gd [ 0 ])+xf));float Af=sign(Gd [ 1 ])*0.5*(abs(Gd [ 1 ])*yf+0.5*log(2.0*abs(Gd [ 1 ])+yf));uf=(qe-wf)/abs(Af-zf);vf=wf-zf*uf;}else{float wf=fd;float qe=gd;uf=qe-wf;vf=wf;}float oe=hd;float pe=Vd ? jd : id;vec2 Bf=(vec2(1.0,1.0)-clamp(vec2(oe,pe),0.0,1.0))*Qc/(4.0*Oc);frag_specialParam1=vec4(vec2(Cb,Db)/Qc,Eb,Fb);frag_specialParam2=vec4(vec2(Hb,Ib)/Qc,Jb,Kb);frag_specialParam3=vec4(uf,vf,Bf.x,Bf.y);if(Sc==0 || Rc > 0.0)frag_specialParam4=vec3(ae ? 0.0 : 1.0,be ? 0.0 : 1.0,ce ? 0.0 : 1.0);else frag_specialParam4=vec3(1.0,1.0,ce ? 0.0 : 1.0);frag_specialParam5=vec2(Gb,Lb);frag_type=(Vd && ! Id)? s : q;}}else if(Y==qc &&(! Id || ld)){float Cf=(Mc.y)/(Kc.x*Nc.x);if(! Vd || Id){vec2 Df=(Mc.x < 0.0)? md : od;ne=Df+vec2(Cf,0.0);frag_type=t;}else{float Ef=clamp((md.y-nd.y)/(md.y+od.y-2.0*nd.y),0.0,1.0);vec2 Ff=mix(mix(md,nd,Ef),mix(nd,od,Ef),Ef);vec2 Gf=ld ? md : Ff;vec2 Hf=ld ? Ff : od;vec2 Df=(Mc.x < 0.0)? Gf : Hf;vec2 If=(Ff-Fd)*Ed;vec2 Jf=(Df+vec2(Cf,0.0)-Fd)*Ed;vec2 Kf=((ld ? md : od)-Fd)*Ed;float Lf=Jf.x-If.x;float Mf=sign(Kf.x-If.x);float fc=Lf*Mf;float gc=sign(dot(Bd,zd));ne=Df+vec2(Cf,0.0);frag_specialParam1.x=dot(ne-md,Bd*sign(dot(Bd,xd)));frag_specialParam1.y=dot(ne-nd,Cd*sign(dot(Cd,-yd)));frag_specialParam1.z=dot(ne-od,Ad*sign(dot(Ad,-zd)));frag_specialParam1.w=dot(ne-Gf,vec2(Gf.y-Hf.y,Hf.x-Gf.x));frag_specialParam2.x=fc;frag_specialParam2.y=gc;frag_type=u;}}else{gl_Position=vec4(0.0,0.0,0.0,0.0);frag_type=o;}gl_Position=vec4(ne.x*Nc.x*2.0*Kc.x,-ne.y*Nc.y*2.0*Kc.y,0.0,1.0);frag_geoRange=Gd;frag_geoUVS.xy=(ne-Fd)*Ed;frag_geoUVS.z=Hd*0.5/Oc;if(fb==2)frag_specialParam3=vec4(Mc.x*0.5+0.5,Mc.y*0.5+0.5,rd.x+rd.y,0.0);}}",f:"precision highp float;const int c=0,d=1,e=2,f=3,h=4,i=5,j=6;const int k=0,l=1,m=2,n=3;uniform int ufrag_0;uniform int ufrag_1;uniform float ufrag_2;uniform float ufrag_3;uniform float ufrag_4;uniform float ufrag_5;uniform float ufrag_6;uniform int ufrag_7;uniform float ufrag_8;uniform float ufrag_10;uniform float ufrag_11;uniform float ufrag_12;uniform vec4 ufrag_13;uniform float ufrag_15;uniform vec2 ufrag_16;uniform int ufrag_17;uniform float ufrag_18;uniform float ufrag_19;varying float frag_type;const float o=0.0,p=1.0,q=3.0,s=4.0,t=5.0,u=6.0,v=7.0;varying vec3 frag_geoUVS;varying vec2 frag_geoRange;varying vec4 frag_specialParam1;varying vec4 frag_specialParam2;varying vec4 frag_specialParam3;varying vec3 frag_specialParam4;varying vec2 frag_specialParam5;float A(vec2 B,vec2 C){float a=0.5-B.y;float b=-0.5*B.x;float D=b*0.5;float E=(b*b)*0.25;float F=(a*a*a)/27.0;if(E+F > 0.0){float G=sqrt(E+F);float H=G-D;float I=sign(H)*pow(abs(H),1.0/3.0);float J=G+D;float K=-sign(J)*pow(abs(J),1.0/3.0);float x=I+K;return clamp(x,C [ 0 ],C [ 1 ]);}else{const float L=0.333333333;const vec3 M=vec3(0.0,2.094395102,4.188790205);float N=1.0/a;vec3 O=2.0*sqrt(-a*L)*cos(L*acos(sqrt(-6.75*N)*b*N)-M);vec3 x=clamp(O,C [ 0 ],C [ 1 ]);vec3 P=B.x-x,Q=B.y-x*x,R=P*P+Q*Q;return(R [ 0 ] < R [ 1 ] && R [ 0 ] < R [ 2 ])? x [ 0 ] :(R [ 1 ] < R [ 2 ])? x [ 1 ] : x [ 2 ];}}bool S(float T){return T-0.4 < frag_type && frag_type < T+0.4;}float U(float V,float a,float b,float W,float X){return clamp((abs(V*2.0-a-b)+a-b)*W*0.5+X,0.0,1.0);}void main(){int Y=ufrag_0;int Z=ufrag_1;float ab=ufrag_2;float bb=ufrag_3;float cb=ufrag_4;float db=ufrag_5;float eb=ufrag_6;int fb=ufrag_7;float gb=ufrag_8;float hb=ufrag_10;float ib=ufrag_11;float jb=ufrag_12;vec4 kb=ufrag_13;float lb=ufrag_15;vec2 mb=ufrag_16;bool nb=(ufrag_17==1);float ob=ufrag_18;float pb=ufrag_19;const float qb=1.0;float F=qb;float rb;float sb=0.0;float tb=0.0;if(Y==0 && ! S(v)){float V=0.0;float ub=0.0;vec2 vb;if(S(s)){float x=A(frag_geoUVS.xy,frag_geoRange);vb=frag_geoUVS.xy-vec2(x,x*x);vec2 wb=normalize(vec2(1.0,2.0*x));sb=dot(vb,vec2(-wb.y,wb.x))*frag_geoUVS.z;float xb=2.0*abs(x),yb=sqrt(1.0+xb*xb);float zb=sign(x)*(xb*yb+log(xb+yb))*0.25;float Ab=1.0-abs(sign((x-frag_geoRange [ 0 ])*(x-frag_geoRange [ 1 ])));V=zb+Ab*dot(vb,wb);ub=(x-frag_geoRange [ 0 ])/(frag_geoRange [ 1 ]-frag_geoRange [ 0 ]);}else{vb=frag_geoUVS.xy-vec2(clamp(frag_geoUVS.x,0.0,1.0),0.0);V=ub=frag_geoUVS.x;sb=frag_geoUVS.y;}F=length(vb)*abs(frag_geoUVS.z);ub=clamp(ub,0.0,1.0);const float Bb=0.01;float Cb=frag_specialParam1 [ 0 ],Db=frag_specialParam1 [ 1 ],Eb=frag_specialParam1 [ 2 ],Fb=frag_specialParam1 [ 3 ],Gb=frag_specialParam5 [ 0 ];float Hb=frag_specialParam2 [ 0 ],Ib=frag_specialParam2 [ 1 ],Jb=frag_specialParam2 [ 2 ],Kb=frag_specialParam2 [ 3 ],Lb=frag_specialParam5 [ 1 ];float Mb=frag_specialParam4.x,Nb=frag_specialParam4.y,Ob=frag_specialParam4.z;bool Pb=ub < 0.5 ?(Mb !=0.0 &&(Db > Bb || Fb > 1.0)):(Nb !=0.0 &&(Ib > Bb || Kb > 1.0));if(Z !=m){if(Pb)F=qb;else{const float Qb=0.001;if(ub < 0.5 && Cb > Bb && Mb !=0.0)F=(Db <=Qb)? Eb :(Fb >=0.0)? Gb : qb;if(ub > 0.5 && Hb > Bb && Nb !=0.0)F=(Ib <=Qb)? Jb :(Kb >=0.0)? Lb : qb;}}float Rb=F;if(Mb==0.0)Rb=max(Rb,Gb);if(Nb==0.0)Rb=max(Rb,Lb);tb=V*frag_specialParam3.x+frag_specialParam3.y;bool Sb=(mb==vec2(0.0,0.0))||(mb [ 0 ] <=tb && tb <=mb [ 1 ]);bb=Sb ? bb*Ob : 0.0;float Tb=(F <=lb && Sb)? bb : 0.0;float Ub=Pb ? 0.0 : Tb;const float Vb=0.2;const float Wb=(1.0-2.0*Vb)*2.0;float Xb=abs(fract(db+tb*cb)*2.0-1.0)*jb;float Yb=U(Xb,kb [ 0 ],kb [ 1 ],Wb,Vb)*U(Xb,kb [ 2 ],kb [ 3 ],Wb,Vb)*Tb;float Zb=clamp(0.5-F*sign(sb)*ib,0.0,1.0)*Ub;rb=sign(Rb)*max(0.0,abs(Rb)+mix(frag_specialParam3.z,frag_specialParam3.w,ub));float ac=(0.5-rb+pb)*bb;float bc=(0.5-F)*ab;vec4 cc=vec4(bc,ac,Zb,Yb);vec4 dc=vec4(ac,bc,0.0,0.0);vec4 ec=mix(cc,dc,ob);gl_FragColor=clamp(ec,0.0,1.0);}else if(S(t)){gl_FragColor=vec4(0.0,0.0,0.0,1.0);if(eb==sign(frag_geoUVS.y))discard;}else if(S(u)){gl_FragColor=vec4(0.0,0.0,0.0,0.0);if(frag_specialParam1.x > 0.0 && frag_specialParam1.y > 0.0 && frag_specialParam1.z > 0.0){float fc=frag_specialParam2.x,gc=frag_specialParam2.y;float hc=((fc >=0.0)? sign((frag_geoUVS.y-frag_geoUVS.x*frag_geoUVS.x)): 1.0)*gc;if(eb==hc)discard;}else if(eb==sign(frag_specialParam1.w))discard;}else if(S(v)){tb=frag_geoUVS.x*frag_specialParam3.x+frag_specialParam3.y;float ic=max(abs(frag_specialParam1.x),abs(frag_specialParam1.y))+frag_specialParam2.z;float jc=max(abs(frag_specialParam1.z),abs(frag_specialParam1.w))+frag_specialParam2.w;rb=min(ic,jc);if(frag_specialParam4.y >=0.0 && frag_specialParam4.z >=0.0)rb=min(rb,frag_specialParam4.x >=0.0 ? frag_specialParam2.x : frag_specialParam2.y);float kc=0.5-clamp(rb,0.0,0.5);gl_FragColor=vec4(kc*ab,kc*bb,0.0,1.0);}else gl_FragColor=vec4(frag_type*(1.0-gb),0.0,0.0,frag_type*gb);if(Y==0 && nb){float lc=smoothstep(lb,lb*1.5,rb);float mc=(tb+32.0*rb/lb)*jb;float nc=1.0-(mc+lc);gl_FragColor=vec4(nc,nc,nc,1.0);}if(fb==e){gl_FragColor.rgb=clamp(vec3(1.0-F*2.0,1.0-F*4.0,1.0-F*8.0),0.0,1.0);float oc=0.25+clamp((abs(frag_specialParam3.x+frag_specialParam3.y-1.0)+abs(frag_specialParam3.x-frag_specialParam3.y))*4.0-2.75,0.0,1.0);gl_FragColor+=vec4(oc*(1.0+sin(frag_specialParam3.z))/2.0,oc*(1.0+cos(frag_specialParam3.z))/2.0,oc*frag_specialParam3.z/18.0,1.0);}}",a:["a_v","a_p0","a_p1","a_p2","a_p3","a_p4","a_d1","a_d2"],u:["ufrag_0","ufrag_1","ufrag_2","ufrag_3","ufrag_4","ufrag_5","ufrag_6","ufrag_7","ufrag_8","ufrag_10","ufrag_11","ufrag_12","ufrag_13","ufrag_15","ufrag_16","ufrag_17","ufrag_18","ufrag_19","u_0","u_1","u_2","u_3","u_4","u_5","u_6","u_7","u_8","u_12","u_13","u_14","u_15","u_17","u_18","u_19"],s:[]},{v:"precision highp float;uniform mat3 u_0;uniform mat3 u_1;uniform vec2 u_2;uniform mat3 u_3;uniform mat3 u_4;uniform mat3 u_5;uniform mat3 u_6;uniform mat3 u_7;uniform mat3 u_8;uniform mat3 u_10;uniform mat3 u_11;uniform int u_13;uniform int u_14;uniform vec2 u_15;uniform int u_16;uniform float u_17;uniform float u_18;uniform float u_19;uniform vec2 u_20;uniform vec2 u_21;attribute vec2 a_v;attribute vec2 a_0;attribute vec2 a_1;varying vec2 l,m,n,o,p,q,s,t;varying float u;mat2 dd(float ed){return mat2(cos(ed),-sin(ed),sin(ed),cos(ed));}vec2 fd(vec2 gd){return vec2(gd.x/2.0,gd.y/-2.0)+vec2(0.5,0.5);}vec2 hd(vec2 gd,mat3 id){return(id*vec3(vec2(gd.x/2.0,gd.y/2.0),1.0)).xy*vec2(1.0,-1.0)+vec2(0.5,0.5);}mat4 jd(float kd,float ld,float md,float nd){float a=1.0/tan(kd*0.5),b=1.0/(md-nd);return mat4(a/ld,0.0,0.0,0.0,0.0,-a,0.0,0.0,0.0,0.0,(md+nd)*b,-1.0,0.0,0.0,2.0*md*nd*b,0.0);}mat4 od(float ed){float pd=cos(ed),qd=sin(ed);return mat4(1.0,0.0,0.0,0.0,0.0,pd,-qd,0.0,0.0,qd,pd,0.0,0.0,0.0,0.0,1.0);}mat4 rd(float ed){float pd=cos(ed),qd=sin(ed);return mat4(pd,0.0,qd,0.0,0.0,1.0,0.0,0.0,-qd,0.0,pd,0.0,0.0,0.0,0.0,1.0);}void main(){vec2 sd=a_v;mat3 td=u_0;vec2 ud=u_15;mat3 vd=u_1;vec2 wd=u_2;mat3 xd=u_3;mat3 yd=u_4;mat3 zd=u_5;mat3 Ad=u_6;mat3 Bd=u_7;mat3 Cd=u_8;mat3 Dd=u_10;mat3 Ed=u_11;vec2 Fd=u_20;vec2 Gd=u_21;int Hd=u_13;int Id=u_14;float Jd=u_18;float Kd=u_19;vec2 Ld=sd;vec2 Md=sd;if(u_16 !=0){Ld=sd+a_0*2.0;Md=sd+a_1*2.0;sd=mix(Ld,Md,u_17);}vec2 Nd=(td*vec3(sd.xy/2.0,1.0)).xy;vec2 Od;if(ud !=vec2(1.0,1.0)){const float Pd=1.57079632679;mat4 Qd=rd((1.0-ud.x)*Pd),Rd=od((1.0-ud.y)*Pd);mat4 Sd=mat4(mat2(vd));Sd [ 3 ] [ 0 ]=vd [ 2 ] [ 0 ];Sd [ 3 ] [ 1 ]=vd [ 2 ] [ 1 ];vec4 Td=Sd*Rd*Qd*vec4(Nd,0.0,1.0)-vec4(wd*0.5,0.0,0.0);gl_Position=vec4((Td.xy/wd)*vec2(2.0,-2.0),0.0,1.0);const float Ud=0.78539816339;float Vd=wd.y/(2.0*tan(Ud*0.5));Td.z-=Vd;vec4 Wd=jd(Ud,wd.x/wd.y,Vd/2.0,Vd*2.0)*Td;gl_Position=Wd/Wd.w;}else{vec2 Od=(vd*vec3(Nd,1.0)).xy;gl_Position=vec4((Od/wd-vec2(0.5,0.5))*vec2(2.0,-2.0),0.0,1.0);}gl_Position.z=mix(Jd,Kd,sd.y*0.5+0.5);l=hd(Ld.xy,xd);t=hd(Ld.xy,Ed);m=hd((Hd !=0)? gl_Position.xy : Md.xy,yd);o=hd((Id !=0)? gl_Position.xy : sd.xy,Ad);n=hd(sd.xy,zd);q=hd(sd.xy,Bd);s=hd(sd.xy,Cd);p=hd(sd.xy,Dd);if(Fd==Gd){u=1.0;}else{vec2 Xd=Gd-Fd;u=dot(Nd-Fd,Xd)/dot(Xd,Xd);}}",f:"precision highp float;uniform sampler2D t_0;uniform sampler2D t_1;uniform sampler2D t_2;uniform sampler2D t_3;uniform sampler2D t_4;uniform sampler2D t_5;uniform sampler2D t_6;uniform sampler2D t_7;uniform float ufrag_0;uniform float ufrag_1;uniform float ufrag_2;uniform vec4 ufrag_3;uniform vec4 ufrag_4;uniform float ufrag_6;uniform vec3 ufrag_8;uniform vec3 ufrag_9;uniform int ufrag_10;uniform int ufrag_11;uniform vec2 ufrag_12;uniform vec4 ufrag_13;uniform int ufrag_14;uniform int ufrag_15;uniform int ufrag_16;uniform vec2 ufrag_17;uniform int ufrag_18;uniform int ufrag_19;uniform float ufrag_20;uniform float ufrag_21;uniform vec4 ufrag_22;uniform vec4 ufrag_23;uniform int ufrag_24;uniform int ufrag_25;uniform vec4 ufrag_26;uniform float ufrag_27;uniform float ufrag_28;uniform float ufrag_29;uniform int ufrag_30;uniform int ufrag_31;uniform float ufrag_32;uniform int ufrag_34;uniform int ufrag_35;uniform float ufrag_36;uniform int ufrag_37;uniform int ufrag_38;uniform int ufrag_39;uniform float ufrag_40;uniform float ufrag_41;uniform mat3 ufrag_42;uniform vec3 ufrag_43;const int c=0,d=1,e=2,f=3,h=10,i=11,j=14,k=16;varying vec2 l,m,n,o,p,q,s,t;varying float u;float v(float A){return clamp(A,0.0,1.0);}const vec2 B=vec2(.5,.5);vec4 C(vec4 D,vec4 E){float F=E.a+D.a*(1.0-E.a);return vec4((E.rgb*E.a+D.rgb*D.a*(1.0-E.a))/F,F);}float G(float H,vec3 I,vec3 J){float K=clamp(H,I [ 0 ],I [ 2 ]);vec3 L=abs((K-I)*J);return min(L [ 0 ],min(L [ 1 ],L [ 2 ]));}float M(vec2 N){vec2 O=sign(B-abs(N-B));return max(0.0,O.x+O.y)*.5;}float P(float Q,float R,float S){const float T=-0.5;const float U=0.16;const float V=0.5;float W=mix(U,T,v(S*V));float X=min(S,R);float Y=1.0-v((Q-W)/X);return Y*Y;}vec2 Z(vec4 ab,float bb,float cb,float db,vec3 eb,vec3 fb,float S,float gb){bool hb=ufrag_38 !=0;float ib=max(cb,S)*0.5;float jb=ab.r-0.5;float kb=P(-jb/bb,0.5/bb,S);float lb=clamp(0.5-mix(ab.g,min(1.0-ab.r,ab.g),ufrag_29),0.0,0.5);float mb=(hb && gb==0.0)? lb : 0.5-ab.b;float H=lb*sign(mb)/bb;bool nb=fb [ 0 ]==fb [ 2 ];if(! nb && abs(H)< cb*0.5-S*2.0)H=mb/bb;H+=gb;const float ob=0.2;const float pb=1.0/(1.0-ob*2.0);const float qb=0.5-0.5*pb;float rb=ab.a;float sb=rb*pb+qb;float tb=(1.0-sb)*ib;float ub=abs(H);if(rb <(1.0-ob)&& ! hb)ub=mix(max(tb,ub),length(vec2(tb,ub)),db);const float vb=0.49;float wb=min(ib,vb/bb);float xb=P(ub-wb,0.5/bb-wb,S);if(rb < ob && ! hb){xb=0.0;}if(sb >=db && ! hb){float yb=G(H,eb*ib,fb);float zb=min(min(fb [ 0 ],fb [ 1 ]),fb [ 2 ]);float Ab=S*zb;float Bb=P(yb-wb,0.5/bb-wb,Ab);xb=min(xb,Bb);}if(ufrag_37==0)return vec2(clamp(kb,0.0,1.0),clamp(xb,0.0,1.0));else return vec2(0.0,clamp(max(kb,xb),0.0,1.0));}const int Cb=0,Db=1,Eb=2,Fb=3,Gb=4,Hb=5,Ib=6,Jb=7,Kb=8,Lb=9;vec2 Mb(int Nb,vec4 Ob,vec2 N,float bb){if(Nb==Gb)return vec2(1.0-min(min(Ob [ 0 ]*N.x,Ob [ 3 ]*N.y),min(Ob [ 2 ]*(1.0-N.x),Ob [ 1 ]*(1.0-N.y))),0.0);if(Nb==Eb){float Pb=N.x,Qb=floor(Pb),K=Pb-Qb;Pb=(fract(Qb*0.5)==0.0)? K : 1.0-K;return vec2(Pb,0.0);}else return N;}vec4 Rb(int Nb,vec4 Ob,vec4 Sb,vec2 N,sampler2D Tb,int Ub,vec4 ab,float bb){if(Nb==Cb)return vec4(0.0,0.0,0.0,0.0);if(Nb==Db)return Ob;if(Ub !=0 && Nb !=0 && Nb > 1 &&(N.x < 0.0 || N.x > 1.0 || N.y < 0.0 || N.y > 1.0))return vec4(0.0,0.0,0.0,0.0);vec4 Y=texture2D(Tb,Mb(Nb,Ob,N,bb));if(Nb==Jb)return mix(Ob,Sb,Y.r);else{if(Nb==Ib && Y.a > 0.0)Y.rgb/=Y.a;return Y;}}void main(){float bb=ufrag_0;float cb=ufrag_1;float Vb=ufrag_2;vec4 Wb=ufrag_3;vec4 Xb=ufrag_4;float db=ufrag_6;vec3 eb=ufrag_8;vec3 fb=ufrag_9;int Yb=ufrag_10;int Zb=ufrag_11;vec2 ac=ufrag_12;vec4 bc=ufrag_13;int cc=ufrag_15;int dc=ufrag_16;vec2 ec=ufrag_17;int fc=ufrag_18;int gc=ufrag_19;float hc=ufrag_20;float ic=ufrag_21;vec4 jc=ufrag_22;vec4 kc=ufrag_23;int lc=ufrag_24;int mc=ufrag_25;vec4 nc=ufrag_26;float gb=ufrag_27;float oc=ufrag_28;int pc=ufrag_30;int qc=ufrag_31;float rc=ufrag_32;bool sc=ufrag_34 !=0;float tc=ufrag_36;int uc=ufrag_39;float vc=ufrag_40;float wc=ufrag_41;mat3 xc=ufrag_42;vec3 yc=ufrag_43;vec4 zc=sc ? vec4(0.0,0.0,0.0,0.0): texture2D(t_0,l);if(cc==e || cc==f){float Ac=M(l);float Bc=M(m);zc*=Ac;if(tc > 0.0){vec4 Cc=texture2D(t_1,m)*Bc;zc=mix(zc,Cc,v(tc));}if(cc==f){vec4 Dc=texture2D(t_2,l)*Ac;vec4 Ec=texture2D(t_4,m)*Bc;vec4 Fc=mix(Dc,Ec,v(tc));vec4 Gc=vec4(0.0,0.0,0.0,0.0);if(n.x >=0.0 && n.x <=1.0 && n.y >=0.0 && n.y <=1.0){Gc=mix(texture2D(t_5,n),texture2D(t_6,n),tc);}float Hc=Fc.a > 0.0 ? Fc.r/Fc.a : 0.0;float Ic=zc.a > 0.0 ? zc.r/zc.a : 0.0;float Jc=abs(Hc-Ic);zc=mix(zc*0.5+Fc*0.5,Gc,Jc);}gl_FragColor=zc;if(gl_FragColor.a > 0.0){gl_FragColor.rgb/=gl_FragColor.a;}}else if(cc <=d){vec2 Kc=sc ? vec2(1.0,0.0): Z(zc,bb,cb,db,eb,fb,Vb,gb);if(uc !=0 && ufrag_37==0){vec4 Lc=texture2D(t_7,t)*M(t);vec2 Mc=Z(Lc,bb,cb,db,eb,fb,Vb,gb);Kc=(uc==2)? vec2(v(Kc.x-Mc.x),v(Kc.y*(1.0-Mc.x)+Kc.x*Mc.y)):(uc==1)? vec2(Mc.x*Kc.x,v(Mc.y*Kc.x+Kc.y*Mc.x)): Mc;}vec4 Nc=Rb(Yb,Wb,jc,m,t_1,fc,zc,bb);Nc.a*=hc;vec4 Oc=vec4(Nc.rgb,0.0);if(pc !=0){vec4 Pc=Rb(Ib,vec4(0.0,0.0,0.0,0.0),vec4(0.0,0.0,0.0,0.0),n,t_6,qc,zc,bb);Pc.a*=rc;if(Pc.a > 0.0)Nc=C(Nc,Pc);Oc=vec4(Pc.rgb,Pc.a*vc*M(n));}Nc.rgb=clamp(mix(Nc.rgb,vec3(0.5)*sign(oc)+0.5,abs(oc)),0.0,1.0);if(mc !=0){float Qc=texture2D(t_5,s).a;Nc.rgb=mix(Nc.rgb,nc.rgb,(1.0-Qc)*nc.a);}vec4 Rc=mix(Oc,Nc,Kc [ 0 ]);vec4 Sc=Rb(Zb,Xb,kc,o,t_2,gc,zc,bb);vec4 Tc=vec4(Sc.rgb,Sc.a*Kc [ 1 ]*ic);gl_FragColor=C(Rc,Tc);}else if(cc==h){float Uc=(zc.r-0.5);float Vc=v(1.0-2.0*abs(sin(Uc*64.0)))*0.5;if(Uc < 0.0)gl_FragColor=vec4(0.0,Vc*(1.0+Uc),1.0+Uc,1.0+Uc);else gl_FragColor=vec4(1.0-Uc,Vc*(1.0-Uc),0.0,1.0);}else{if(cc==i)gl_FragColor=vec4(zc.r,zc.g*2.0,0.0,1.0);else if(cc==j)gl_FragColor=vec4(zc.r,0.0,0.0,1.0);else if(cc==k)gl_FragColor=vec4(zc.b,zc.b > 0.95 ?(zc.b-0.95)*20.0 : 0.0,zc.a,1.0);else gl_FragColor=vec4(zc.r,zc.g,zc.b,1.0);}float Wc=ac [ 0 ]+(ac [ 1 ]-ac [ 0 ])*v(u);if(lc !=0)Wc-=1.0-texture2D(t_4,q).a;if(dc !=0 &&(cc==0 || cc==2)){if(dc==1){Wc-=1.0-ec [ 1 ];}else{vec4 Xc=texture2D(t_3,p);if(dc==2){float Yc=1.0-Xc.r;Wc-=1.0-v(Yc*ec [ 0 ]+ec [ 1 ]);}else if(dc==3){float Zc=1.0-ec [ 0 ];float ad=ec [ 1 ]/Zc;if(Xc.r > 0.0){Wc-=1.0-v(6.0*ad);vec3 bd=clamp(vec3((1.0-Xc.a)*ec [ 0 ]+ec [ 1 ]*3.0)-vec3(0.0,1.0-Xc.b,2.0-Xc.b)*(1.0-ec [ 0 ]),0.0,1.0);gl_FragColor.rgb=mix(mix(vec3(Xc.r),vec3(Xc.g),bd [ 1 ]),mix(vec3(Xc.g),gl_FragColor.rgb,ad),bd [ 2 ]);}else{Wc-=1.0-v(2.0*ad-1.0);}}}}gl_FragColor.rgb=xc*gl_FragColor.rgb+yc;gl_FragColor.a=v(gl_FragColor.a)*v(Wc)*wc;if(cc !=d && bc.a > 0.0)gl_FragColor.rgb=bc.rgb;gl_FragColor.rgb*=gl_FragColor.a;gl_FragColor.rgb=clamp(gl_FragColor.rgb,0.0,1.0);if(cc==d){if(gl_FragColor.a > 0.0)gl_FragColor=bc;else gl_FragColor=vec4(0.0,0.0,0.0,0.0);}if(ufrag_35==1){float cd=1.0-gl_FragColor.a;gl_FragColor=vec4(cd+gl_FragColor.rgb,gl_FragColor.a);}else if(gl_FragColor.a==0.0){gl_FragColor=vec4(0.0,0.0,0.0,0.0);}}",a:["a_v","a_0","a_1"],u:["ufrag_0","ufrag_1","ufrag_2","ufrag_3","ufrag_4","ufrag_6","ufrag_8","ufrag_9","ufrag_10","ufrag_11","ufrag_12","ufrag_13","ufrag_14","ufrag_15","ufrag_16","ufrag_17","ufrag_18","ufrag_19","ufrag_20","ufrag_21","ufrag_22","ufrag_23","ufrag_24","ufrag_25","ufrag_26","ufrag_27","ufrag_28","ufrag_29","ufrag_30","ufrag_31","ufrag_32","ufrag_34","ufrag_35","ufrag_36","ufrag_37","ufrag_38","ufrag_39","ufrag_40","ufrag_41","ufrag_42","ufrag_43","u_0","u_1","u_2","u_3","u_4","u_5","u_6","u_7","u_8","u_10","u_11","u_13","u_14","u_15","u_16","u_17","u_18","u_19","u_20","u_21"],s:["t_0","t_1","t_2","t_3","t_4","t_5","t_6","t_7"]},{v:"precision highp float;uniform int u_0;uniform vec2 u_1;uniform vec2 u_2;uniform mat3 u_3;attribute vec2 a_v;attribute vec4 a_p1;attribute vec4 a_p2;varying vec2 c;void main(){if(u_0==0){gl_Position=vec4(a_v,0.0,1.0);}else{vec2 p;if(a_v.x > 0.0){vec2 L=(a_v.y < 0.0)? a_p1.xy : a_p2.xy;gl_Position=vec4((((u_3*vec3(L,1.0)).xy-u_1)*u_2)*vec2(2.0,-2.0),0.0,1.0);}else gl_Position=vec4(0.0,0.0,0.0,1.0);}c=a_v*vec2(0.5,-0.5)+vec2(0.5,0.5);}",f:"precision highp float;uniform float bfrag_0 [ 11 ];uniform vec4 bfrag_1 [ 11 ];uniform int ufrag_0;uniform vec2 ufrag_2;uniform int ufrag_3;uniform int ufrag_4;uniform vec2 ufrag_5;varying vec2 c;const float d=2.2;const float e=1.0/2.2;vec4 f(vec4 h,float i){if(ufrag_3==1)return vec4(pow(h.r,i),pow(h.g,i),pow(h.b,i),h.a);else return h;}vec4 j(float k){for(int l=0;l < 10;l++){if(k <=bfrag_0 [ l+1 ]){vec4 m=f(bfrag_1 [ l ],d);vec4 n=f(bfrag_1 [ l+1 ],d);return f(mix(m,n,(k-bfrag_0 [ l ])/(bfrag_0 [ l+1 ]-bfrag_0 [ l ])),e);}}return bfrag_1 [ 10 ];}float o(vec2 p,vec2 q){vec2 s=p-q;float t=dot(s,s);float u=q.x*p.y-p.x*q.y;vec2 v=s*u;float A=sqrt(t-u*u);vec2 B=s*A;vec2 C=vec2((v.y+sign(B.y)*B.x),(-v.x+abs(B.y)))/t;vec2 D=vec2((v.y-sign(B.y)*B.x),(-v.x-abs(B.y)))/t;vec2 E=sign(length(C-q)-length(D-q))==sign(dot(q-p,q))? C : D;float k=length(p-q)/length(E-q);return clamp(k,0.0,1.0);}float F(float x){return x < 0.5 ? 2.0*x*x : 2.0*x*(2.0-x)-1.0;}float G(float x,float H){return x < H ? F(x/H): F((1.0-x)/(1.0-H));}float I(float x,float H){return x < H ? x/H :(1.0-x)/(1.0-H);}void main(){float k=c.x;if(ufrag_0==1){vec2 q=ufrag_2;k=o(c*2.0-1.0,q*2.0-1.0);}if(ufrag_4 !=0){float J=G(k,ufrag_5.x)*ufrag_5.y;float K=I(k,ufrag_5.x)*ufrag_5.y;gl_FragColor=vec4(j(J).rgb,j(K).a);}else{gl_FragColor=j(k);}}",a:["a_v","a_p1","a_p2"],u:["bfrag_0","bfrag_1","ufrag_0","ufrag_2","ufrag_3","ufrag_4","ufrag_5","u_0","u_1","u_2","u_3"],s:[]},{v:"precision highp float;uniform float u_0;uniform vec2 u_1;uniform vec2 u_2;uniform vec2 u_3;uniform int u_4;attribute vec2 a_v;varying vec2 c,d,e,f,h,i,j,k,l;void main(){vec2 G=a_v;float H=u_0;vec2 I=u_1;vec2 J=u_2;vec2 K=u_3;int p=u_4;gl_Position=vec4(G.x,-G.y,0.0,1.0);vec2 L=(vec2(G.x,-G.y)*I/2.0)+vec2(0.5,0.5);if(p==1){vec2 M=J*vec2(2.0*H/(K.x*8.0),2.0*H/(K.y*8.0));vec2 N=L-J*vec2(H/K.x,H/K.y);c=N;d=N+M;e=N+M*2.0;f=N+M*3.0;h=N+M*4.0;i=N+M*5.0;j=N+M*6.0;k=N+M*7.0;l=N+M*8.0;}else{vec2 r=vec2(H/K.x,H/K.y);c=L+r*vec2(-0.7,-0.7);d=L+r*vec2(0.0,-1.0);e=L+r*vec2(0.7,-0.7);f=L+r*vec2(-1.0,0.0);h=L;i=L+r*vec2(1.0,0.0);j=L+r*vec2(-0.7,0.7);k=L+r*vec2(0.0,1.0);l=L+r*vec2(0.7,0.7);}}",f:"precision highp float;uniform sampler2D tex_0;uniform vec4 ufrag_0;uniform float ufrag_2;uniform int ufrag_3;uniform int ufrag_4;varying vec2 c,d,e,f,h,i,j,k,l;void main(){vec4 m=ufrag_0;int n=ufrag_3;float o=ufrag_2;int p=ufrag_4;vec4 q=p==1 ? vec4(1.20,1.15,1.10,1.05)*o : vec4(1.20,1.20,1.20,1.20)*o;vec4 s=texture2D(tex_0,c,q [ 0 ]);vec4 t=texture2D(tex_0,d,q [ 1 ]);vec4 u=texture2D(tex_0,e,q [ 2 ]);vec4 v=texture2D(tex_0,f,q [ 3 ]);vec4 A=texture2D(tex_0,h,o);vec4 B=texture2D(tex_0,i,q [ 3 ]);vec4 C=texture2D(tex_0,j,q [ 2 ]);vec4 D=texture2D(tex_0,k,q [ 1 ]);vec4 E=texture2D(tex_0,l,q [ 0 ]);if(n==0){vec4 F=s*0.000229+t*0.005977+u*0.060598+v*0.241732+A*0.382928+B*0.241732+C*0.060598+D*0.005977+E*0.000229;gl_FragColor=clamp(F,0.0,1.0);}else if(n==1){float F=s.a*0.000229+t.a*0.005977+u.a*0.060598+v.a*0.241732+A.a*0.382928+B.a*0.241732+C.a*0.060598+D.a*0.005977+E.a*0.000229;gl_FragColor=vec4(m.rgb,1.0)*m.a*F;}else if(n==2){float F=min(min(min(min(s.a,t.a),min(u.a,v.a)),min(min(A.a,B.a),min(C.a,D.a))),E.a);gl_FragColor=vec4(m.rgb,1.0)*m.a*F;}else if(n==3){float F=max(max(max(max(s.a,t.a),max(u.a,v.a)),max(max(A.a,B.a),max(C.a,D.a))),E.a);gl_FragColor=vec4(m.rgb,1.0)*m.a*F;}}",a:["a_v"],u:["ufrag_0","ufrag_2","ufrag_3","ufrag_4","u_0","u_1","u_2","u_3","u_4"],s:["tex_0"]},{v:"precision highp float;attribute vec2 a_v;varying vec2 c;void main(){vec2 v=a_v;gl_Position=vec4(v.x,-v.y,0.0,1.0);c=(vec2(v.x,v.y)/2.0)+vec2(0.5,0.5);}",f:"precision highp float;varying vec2 c;const int d=1,e=2,f=3,h=4,i=5,j=6,k=7,l=8,m=9,n=10,o=11,p=12;uniform int ufrag_0;uniform float ufrag_1;void main(){const float PI=3.141592653;const float q=0.707106781;int s=ufrag_0;float t=ufrag_1;float u=0.0,x=c.x,y=c.y;if(s==d)u=1.0-x*t;else if(s==e)u=max(abs(x*2.0-1.0),abs(y*2.0-1.0));else if(s==f)u=1.0-(x*t+floor(y*t)/2.0);else if(s==h)u=length(c*2.0-vec2(1.0,1.0))*q;else if(s==i)u=(abs(x*2.0-1.0)+abs(y*2.0-1.0))*0.5;else if(s==j)u=fract(sin(dot(c,vec2(12.9898,78.233)))*43758.5453);else if(s==k)u=min(abs(x*2.0-1.0),abs(y*2.0-1.0));else if(s==l)u=fract(sin(x*12.9898)*43758.5453);else if(s==m)u=abs(x*2.0-1.0);else if(s==n)u=1.0-(ceil(x*t)+ceil(y*t))/(2.0*t);else if(s==o)u=1.0-atan(abs(x-0.5),0.5-y)/PI;else if(s==p)u=1.0-atan(x-0.5,0.5-y)*t/(2.0*PI);gl_FragColor=vec4(mod(u,1.0),0.0,0.0,1.0);}",a:["a_v"],u:["ufrag_0","ufrag_1"],s:[]},{v:"precision highp float;attribute vec2 a_v;attribute vec4 a_0;attribute vec4 a_1;varying vec2 c;const int i=0,j=1,k=2,l=3;void main(){vec2 m=a_v;vec4 n=a_0,o=a_1;vec2 p=m*0.5+0.5;c=vec2(n [ i ]+(n [ k ]-n [ i ])*p.x,1.0-(n [ j ]+(n [ l ]-n [ j ])*p.y));gl_Position=vec4((o [ i ]+(o [ k ]-o [ i ])*p.x)*2.0-1.0,1.0-((o [ j ]+(o [ l ]-o [ j ])*p.y)*2.0),0.0,1.0);}",f:"precision highp float;uniform sampler2D t_0;uniform float ufrag_0;varying vec2 c;float d(float e){return clamp(e,0.0,1.0);}void main(){float f=ufrag_0;vec4 h=texture2D(t_0,c);h.rgb=(h.rgb-0.5)*f+0.5;gl_FragColor=h;}",a:["a_v","a_0","a_1"],u:["ufrag_0"],s:["t_0"]},{v:"precision highp float;attribute vec2 a_v;attribute vec4 a_0;attribute vec4 a_1;varying vec2 c;const int Ab=0,Bb=1,Cb=2,Db=3;void main(){vec2 Eb=a_v;vec4 Fb=a_0,Gb=a_1;vec2 Hb=Eb*0.5+0.5;c=vec2(Fb [ Ab ]+(Fb [ Cb ]-Fb [ Ab ])*Hb.x,1.0-(Fb [ Bb ]+(Fb [ Db ]-Fb [ Bb ])*Hb.y));gl_Position=vec4((Gb [ Ab ]+(Gb [ Cb ]-Gb [ Ab ])*Hb.x)*2.0-1.0,1.0-((Gb [ Bb ]+(Gb [ Db ]-Gb [ Bb ])*Hb.y)*2.0),0.0,1.0);}",f:"precision highp float;uniform sampler2D t_0;uniform sampler2D t_1;uniform sampler2D t_2;uniform float ufrag_0;uniform int ufrag_1;varying vec2 c;uniform int ufrag_3;uniform vec2 ufrag_4;uniform vec4 ufrag_5;uniform int ufrag_6;uniform float ufrag_7;uniform float ufrag_8;uniform float ufrag_9;uniform int ufrag_10;uniform float ufrag_11;uniform float ufrag_12;uniform vec3 ufrag_13;uniform vec3 ufrag_14;uniform int ufrag_15;uniform float ufrag_16;uniform float ufrag_17;uniform float ufrag_18;uniform vec4 ufrag_19;uniform int ufrag_20;uniform float ufrag_21;uniform vec2 ufrag_22;uniform vec4 ufrag_23;const int d=0;const int e=1;const int f=2;const int h=3;const int i=4;float j(float k){return clamp(k,0.0,1.0);}vec3 l(vec3 rgb){float m=max(rgb.r,max(rgb.g,rgb.b));float n=min(rgb.r,min(rgb.g,rgb.b));float o=(m+n)*0.5;if(m==n)return vec3(0.0,0.0,o);float p=(m-n)*2.0;float q=m+n;float s=0.5*p/((o <=0.5)? q : 2.0-q);float t=(rgb.r==m)?((rgb.g-rgb.b)/p)/3.0 :(rgb.g==m)?(1.0+(rgb.b-rgb.r)/p)/3.0 :(2.0+(rgb.r-rgb.g)/p)/3.0;return vec3(fract(t),s,o);}float u(float v,float A,float B){return(B*6.0 < 1.0)? v+(A-v)*B*6.0 :(B*2.0 < 1.0)? A :(B*3.0 < 2.0)? v+(A-v)*(4.0-B*6.0): v;}vec3 C(vec3 D){float A=(D.z <=0.5)? D.z+D.z*D.y : D.z+D.y-D.z*D.y;float v=2.0*D.z-A;return vec3(u(v,A,fract(D.x+1.0/3.0)),u(v,A,fract(D.x)),u(v,A,fract(D.x-1.0/3.0)));}const vec3 E=vec3(2.2,2.2,2.2);const vec3 F=vec3(1.0/2.2,1.0/2.2,1.0/2.2);const vec2 G=vec2(.5,.5);vec4 H(vec4 I,vec3 J){return vec4(pow(I.rgb,J),I.a);}vec4 K(vec4 L){const int M=7;const int N=(M-1)/2;float O [ M ];float P=ufrag_21 < 0.0 ?-1.0*ufrag_21*5.0 : 5.0;float Q=1.0/P;float R=Q*Q;float S=0.0;for(int T=0;T < N;T++){float U=float(T);float V=0.39894*Q*exp(-0.5*U*U*R);O [ N+T ]=V;O [ N-T ]=V;S+=2.0*V;}S-=O [ N ];vec4 W=vec4(0.0);for(int T=-N;T <=N;T++){for(int X=-N;X <=N;X++){vec4 Y=texture2D(t_0,c+3.0*vec2(float(T),float(X))/ufrag_22);W+=O [ N+X ]*O [ N+T ]*Y;}}W/=S*S;if(ufrag_21 < 0.0){return W;}else{vec4 Z=L-W;vec4 ab=L+Z*ufrag_21*4.0;return clamp(ab,0.0,1.0);}}vec3 bb(vec3 rgb,vec4 q){return clamp(q [ 0 ]*rgb*rgb*rgb+q [ 1 ]*rgb*rgb+q [ 2 ]*rgb+q [ 3 ],0.0,1.0);}vec2 cb(float db,vec3 eb,float fb,vec2 gb){float hb=floor(db/fb);float ib=db-hb*fb;return vec2(ib,hb)*eb.rg+gb;}vec3 jb(vec3 I,vec3 eb,float fb){vec2 kb=eb.rg*vec2(fb,ceil(eb.b/fb));vec3 lb=clamp(I,0.0,1.0)*(eb-vec3(1.0));vec2 gb=lb.rg+vec2(0.5);float mb=floor(lb.b);float nb=min(mb+1.0,eb.b-1.0);vec3 a=texture2D(t_2,cb(mb,eb,fb,gb)/kb).rgb;vec3 b=texture2D(t_2,cb(nb,eb,fb,gb)/kb).rgb;return mix(a,b,lb.b-mb);}vec4 ob(vec4 L){if(ufrag_3+ufrag_6+ufrag_10+ufrag_15+ufrag_20==0 &&(ufrag_23.x <=1.0)){return L;}vec4 pb=vec4(L);if(ufrag_20==1){pb=K(pb);}pb.rgb=pb.a==0.0 ? vec3(0.0,0.0,0.0): pb.rgb/pb.a;if(ufrag_15==1){pb.r*=ufrag_16;pb.b*=ufrag_17;pb.g*=ufrag_18;}if(ufrag_6==1){vec3 D=l(pb.rgb);D=vec3(fract(D.x+ufrag_7),D.yz*vec2(ufrag_8,ufrag_9));pb.rgb=clamp(C(D),0.0,1.0);}if(ufrag_3==1){pb.rgb=ufrag_4 [ 0 ]*pb.rgb+ufrag_4 [ 1 ];if(ufrag_5 [ 0 ] < 0.0){pb.rgb=clamp(pb.rgb,0.0,1.0);}pb.rgb=bb(pb.rgb,ufrag_5);}if(ufrag_10==1){const vec3 qb=vec3(0.2125,0.7154,0.0721);float rb=clamp(dot(pb.rgb,qb)*ufrag_11+ufrag_12,0.0,1.0);pb.rgb=mix(ufrag_13,ufrag_14,rb);}if(ufrag_23.x > 1.0){pb.rgb=jb(pb.rgb,ufrag_23.xyz,ufrag_23.w);}pb.rgb*=pb.a;return pb;}void main(){float sb=ufrag_0;int tb=ufrag_1;vec4 ub=ufrag_19;vec4 vb=texture2D(t_0,c);vb.rgb=(vb.rgb-0.5)*sb+0.5;vb.rgb=(tb==f)? vec3(vb.b,vb.g,vb.r): vb.rgb;if(tb==h || tb==i){vec4 wb=texture2D(t_1,c);if(tb==h){vec4 xb=wb;vec3 yb=vec3(vb.r,xb.r,xb.a)*255.0-vec3(16.0,128.0,128.0);vec3 rgb=yb*mat3(1.164383,0.0,1.596027,1.164383,-0.391762,-0.812968,1.164383,2.017232,0.0);vb.rgb=clamp(rgb/255.0,0.0,1.0);}else if(tb==i){vb*=wb.r;}}else if(tb==e){vb=ob(vb);}if(ub.a !=0.0){float zb=ub.a*vb.a;vb=vec4(ub.rgb*zb,zb);}gl_FragColor=vb;}",a:["a_v","a_0","a_1"],u:["ufrag_0","ufrag_1","ufrag_3","ufrag_4","ufrag_5","ufrag_6","ufrag_7","ufrag_8","ufrag_9","ufrag_10","ufrag_11","ufrag_12","ufrag_13","ufrag_14","ufrag_15","ufrag_16","ufrag_17","ufrag_18","ufrag_19","ufrag_20","ufrag_21","ufrag_22","ufrag_23"],s:["t_0","t_1","t_2"]},{v:"precision highp float;uniform mat3 u_0;uniform mat3 u_1;uniform mat3 u_2;uniform mat3 u_3;uniform vec2 u_4;attribute vec2 a_v;varying vec2 c;varying vec2 d;vec2 Kb(vec2 Lb,mat3 Mb){return(Mb*vec3(vec2(Lb.x/2.0,Lb.y/2.0),1.0)).xy*vec2(1.0,-1.0)+vec2(0.5,0.5);}void main(){vec2 Nb=a_v;mat3 Ob=u_0;mat3 Pb=u_1;mat3 Qb=u_2;mat3 Rb=u_3;vec2 Sb=u_4;c=Kb(Nb.xy,Qb);d=Kb(Nb.xy,Rb);vec2 Tb=(Ob*vec3(Nb.xy/2.0,1.0)).xy;vec2 Ub=(Pb*vec3(Tb,1.0)).xy;gl_Position=vec4((Ub/Sb-vec2(0.5,0.5))*vec2(2.0,-2.0),0.0,1.0);}",f:"precision highp float;uniform sampler2D t_0;uniform sampler2D t_1;uniform sampler2D t_2;varying vec2 c;varying vec2 d;uniform int ufrag_0;uniform vec2 ufrag_1;uniform float ufrag_2;uniform float ufrag_3;uniform vec2 ufrag_4;uniform vec4 ufrag_5;uniform vec4 ufrag_6 [ 4 ];uniform vec3 ufrag_7 [ 4 ];uniform vec4 ufrag_8 [ 4 ];uniform vec4 ufrag_9;uniform vec4 ufrag_10;uniform vec4 ufrag_11;uniform vec4 ufrag_12;uniform vec4 ufrag_13;uniform int ufrag_14;uniform float ufrag_15;uniform vec4 ufrag_16;uniform float ufrag_17;const int e=0;const int f=1;const int h=2;float i(vec2 j,float k,float l){vec2 m=ufrag_1;float n=ufrag_2;float o=ufrag_3;vec2 p=ufrag_4;float q=texture2D(t_1,j+m*vec2(k,l)).r;float s=clamp((q*n+o)/p.x,0.0,1.0);return texture2D(t_2,vec2(s,1.0)).r*p.y;}vec3 t(vec2 j){float u=i(j,-1.0,-1.0);float v=i(j,0.0,-1.0);float A=i(j,1.0,-1.0);float B=i(j,-1.0,0.0);float C=i(j,0.0,0.0);float D=i(j,1.0,0.0);float E=i(j,-1.0,1.0);float F=i(j,0.0,1.0);float G=i(j,1.0,1.0);vec3 H=normalize(vec3(1.0,0.0,v-u));vec3 I=normalize(vec3(1.0,0.0,A-v));vec3 J=normalize(vec3(1.0,0.0,C-B));vec3 K=normalize(vec3(1.0,0.0,D-C));vec3 L=normalize(vec3(1.0,0.0,F-E));vec3 M=normalize(vec3(1.0,0.0,G-F));vec3 N=normalize(vec3(0.0,1.0,B-u));vec3 O=normalize(vec3(0.0,1.0,C-v));vec3 P=normalize(vec3(0.0,1.0,D-A));vec3 Q=normalize(vec3(0.0,1.0,E-B));vec3 R=normalize(vec3(0.0,1.0,F-C));vec3 S=normalize(vec3(0.0,1.0,G-D));return normalize(cross(H,N)+cross(H,O)+cross(I,O)+cross(I,P)+cross(J,N)+cross(J,O)+cross(K,O)+cross(K,P)+cross(J,Q)+cross(J,R)+cross(K,R)+cross(K,S)+cross(L,Q)+cross(L,R)+cross(M,R)+cross(M,S));}vec4 T(vec4 U,vec4 V){float W=V.a+U.a*(1.0-V.a);return vec4((V.rgb*V.a+U.rgb*U.a*(1.0-V.a))/W,W);}void main(){int X=ufrag_0;vec4 Y=texture2D(t_0,c);if(X !=0){vec4 Z=vec4(Y.rgb/Y.a,Y.a);int ab=ufrag_14;if(ab==f){Z=vec4(0.0,0.0,0.0,0.0);}else{vec3 bb=t(d);vec4 cb=ufrag_5;vec4 db=ufrag_9;vec4 eb=ufrag_10;vec4 fb=ufrag_11;vec4 gb=ufrag_12;vec4 hb=ufrag_13;vec3 ib=gb.rgb+cb.rgb*fb.rgb;vec3 jb=vec3(0.0,0.0,-1.0);float kb=hb.x;bool lb=hb.y !=0.0;;vec3 mb=vec3(0.0,0.0,0.0);vec3 nb=vec3(0.0,0.0,0.0);for(int ob=0;ob < 4;ob++){vec3 pb=ufrag_6 [ ob ].rgb;vec3 qb=ufrag_7 [ ob ];float rb=ufrag_8 [ ob ].x;float sb=ufrag_8 [ ob ].y;float tb=ufrag_8 [ ob ].z;float ub=ufrag_8 [ ob ].w;float vb=-dot(bb,qb);vb=vb*rb+sb;mb+=clamp(vb,0.0,1.0)*tb*pb;float wb=0.0;if(lb){vec3 xb=-normalize(jb+qb);wb=dot(xb,bb);}else{vec3 yb=jb-2.0*bb*dot(bb,jb);wb=-dot(yb,qb);}wb=pow(max(0.0,wb),kb);nb+=clamp(wb,0.0,1.0)*ub*pb;}mb*=db.rgb;nb*=eb.rgb;float zb=Z.a*db.a;float Ab=hb.z;float Bb=hb.w;float Cb=1.0-abs(dot(jb,bb));if(Bb > 0.0){zb+=(1.0-zb)*pow(Cb,Bb);}else if(Bb < 0.0){zb-=zb*pow(Cb,-Bb);}if(Ab > 0.0){mb+=(vec3(1.0,1.0,1.0)-mb)*pow(Cb,Ab);}else if(Ab < 0.0){mb-=mb*pow(Cb,-Ab);}if(ab==h){const float Db=0.5;mb+=nb*Db;nb*=(1.0-Db);}Z.rgb=clamp(Z.rgb*(ib+mb)+nb,0.0,1.0);Z.a=clamp(zb,0.0,1.0);}float Eb=ufrag_15;if(Eb > 0.0){float n=ufrag_2;float o=ufrag_3;vec4 Fb=ufrag_16;float Gb=ufrag_17;float Hb=max(Eb,Gb)*0.5;float Ib=abs(texture2D(t_1,d).r*n+o);float Jb=clamp(Hb-Ib,0.0,1.0);Z=T(Z,Fb*vec4(1.0,1.0,1.0,Jb));}Y=vec4(Z.rgb*Z.a,Z.a);}gl_FragColor=Y;}",a:["a_v"],u:["ufrag_0","ufrag_1","ufrag_2","ufrag_3","ufrag_4","ufrag_5","ufrag_6","ufrag_7","ufrag_8","ufrag_9","ufrag_10","ufrag_11","ufrag_12","ufrag_13","ufrag_14","ufrag_15","ufrag_16","ufrag_17","u_0","u_1","u_2","u_3","u_4"],s:["t_0","t_1","t_2"]},{v:"precision highp float;attribute vec2 a_v;attribute vec4 a_0;attribute vec4 a_1;varying vec2 c;uniform mat3 u_1;const int cb=0,db=1,eb=2,fb=3;void main(){vec2 gb=a_v;vec4 hb=a_0,ib=a_1;vec2 jb=gb*0.5+0.5;c=vec2(hb [ cb ]+(hb [ eb ]-hb [ cb ])*jb.x,1.0-(hb [ db ]+(hb [ fb ]-hb [ db ])*jb.y));c=(u_1*vec3(c.x,c.y,1.0)).xy;gl_Position=vec4((ib [ cb ]+(ib [ eb ]-ib [ cb ])*jb.x)*2.0-1.0,1.0-((ib [ db ]+(ib [ fb ]-ib [ db ])*jb.y)*2.0),0.0,1.0);}",f:"precision highp float;uniform sampler2D t_0;uniform float ufrag_0;varying vec2 c;uniform vec2 ufrag_22;float d(float e){return clamp(e,0.0,1.0);}vec3 f(vec3 rgb){float h=max(rgb.r,max(rgb.g,rgb.b));float i=min(rgb.r,min(rgb.g,rgb.b));float j=(h+i)*0.5;if(h==i)return vec3(0.0,0.0,j);float k=(h-i)*2.0;float l=h+i;float m=0.5*k/((j <=0.5)? l : 2.0-l);float n=(rgb.r==h)?((rgb.g-rgb.b)/k)/3.0 :(rgb.g==h)?(1.0+(rgb.b-rgb.r)/k)/3.0 :(2.0+(rgb.r-rgb.g)/k)/3.0;return vec3(fract(n),m,j);}void main(){const int o=2;const float p=float((o*2+1)*(o*2+1));const float q=0.7;const float s=1.0;const float t=3.0;const float u=16.0;const float v=1.0;const vec2 A=vec2(1.0,1.0);const float B=1.0;const float C=1.0;const vec3 D=vec3(0.0,0.0,-1.0);bool E=c.x < 0.0 || c.y < 0.0 || c.x > 1.0 || c.y > 1.0;vec4 F=texture2D(t_0,c);float G=0.0;float H=0.0;float I=0.0;for(int J=-o;J <=o;J++){for(int K=-o;K <=o;K++){vec2 L=c+vec2(float(K),float(J))*s/ufrag_22;vec4 M=texture2D(t_0,L);G+=abs(F.r-M.r)+abs(F.g-M.g)+abs(F.b-M.b);float N=A.x > 0.0 ? L.x : 1.0-L.x;float O=A.y > 0.0 ? L.y : 1.0-L.y;vec2 P=vec2(N,(1.0-O-(1.0-cos(N*3.14/4.0))*v)*(1.0+v*0.5));float Q=(P.x+P.y)*0.5;float R=d(((P.x-P.y)*0.5)/(1.0-abs(Q-0.5)*2.0)*q+0.5);float S=floor(Q*u);float T=d(1.0-1.0*(fract(S/2.0)==0.0 ?(S+R)/u :(S+1.0-R)/u));H+=T;vec3 U=f(F.rgb);I+=1.0-smoothstep(0.4,0.6,U [ 2 ]);}}G=B*t*G/p;H=C*H/p;I=I/p;vec3 V=f(F.rgb);vec3 W=vec3(D.x < 0.0 ? 1.0 : 0.0,D.y < 0.0 ? 1.0 : 0.0,D.z < 0.0 ? 1.0 : 0.0)+f(F.rgb)*D;float X=d((G+H+W.x+W.y+W.z)/(B+C+abs(D.x)+abs(D.y)+abs(D.z)));float Y=fract(sin(dot(c,vec2(12.9898,78.233)))*43758.5453);float Z=1.0-Y*0.2;float ab=d(min(d((G-0.5)*1.5+0.5)*Y,0.5));float bb=d(min((G-0.75)*4.0+0.5,0.5));if(E){gl_FragColor=vec4(0.0,Z,0.0,H);}else{gl_FragColor=vec4(Z,Z-ab-bb,I,H);}}",a:["a_v","a_0","a_1"],u:["ufrag_0","ufrag_22","u_1"],s:["t_0"]},{v:"precision highp float;attribute vec2 a_v;attribute vec4 a_0;attribute vec4 a_1;varying vec2 d;const int u=0,v=1,A=2,B=3;void main(){vec2 C=a_v;vec4 D=a_0,E=a_1;vec2 F=C*0.5+0.5;d=vec2(D [ u ]+(D [ A ]-D [ u ])*F.x,1.0-(D [ v ]+(D [ B ]-D [ v ])*F.y));gl_Position=vec4((E [ u ]+(E [ A ]-E [ u ])*F.x)*2.0-1.0,1.0-((E [ v ]+(E [ B ]-E [ v ])*F.y)*2.0),0.0,1.0);}",f:"precision highp float;uniform sampler2D t_0;uniform sampler2D t_1;uniform float ufrag_0;uniform float ufrag_1;uniform float ufrag_2;uniform int ufrag_3;uniform bool ufrag_4;const int c=22;varying vec2 d;void main(){vec2 e=ufrag_3==0 ? vec2(1.0/512.0,0.0): vec2(0.0,1.0/512.0);e*=ufrag_1;if(ufrag_2 > 1.0 && ufrag_3==0){e/=ufrag_2;}else if(ufrag_2 < 1.0 && ufrag_3==1){e*=ufrag_2;}float f=1.0/ufrag_0;float h=f*f;float i=-0.5*h;float j=0.39894*f;float k=j;vec4 l=k*texture2D(t_0,d);float m=0.0;m+=k;for(int n=1;n < c;n++){float o=float(n);float p=j*exp(o*o*i);l+=p*texture2D(t_0,d+(o*e));l+=p*texture2D(t_0,d+(-o*e));m+=2.0*p;}vec4 q=l/m;if(ufrag_4){vec4 s=texture2D(t_1,d);vec4 t=s-q;q=s+t*ufrag_0*9.0;q=clamp(q,0.0,1.0);}gl_FragColor=q;}",a:["a_v","a_0","a_1"],u:["ufrag_0","ufrag_1","ufrag_2","ufrag_3","ufrag_4"],s:["t_0","t_1"]}],qi={x:0,y:0,width:1,height:1},Xi=[{attributeName:"",index:0,attributeSize:2,offset:0,divisor:0}];class $i{constructor(e,t,r,i){this.m_shaderPrograms=new Array(10),this.m_isInitializeReady=!0,this.m_isInScope=!1,this.m_stateRestorer=i,this.m_wipeStateBetweenScopes=t,this.m_disableParallelShaderCompile=r,this.setWebGLContextOrBabylonEngine(e)}getBabylonEngine(){return this.m_engine}get quadMesh(){return this.m_quadMesh}get emptyTexture(){return this.m_emptyTexture}needPowerOf2TexturesForTilingOrMipMap(){return this.m_needPowerOf2TexturesForTilingOrMipMap}isCurrentWebGLContext(e){return this.m_gl==e}isValid(){return this.m_gl&&!this.m_gl.isContextLost()}setWebGLContextOrBabylonEngine(e){const t=e instanceof WebGLRenderingContext||e instanceof WebGL2RenderingContext?e:e._gl;if(this.m_gl!=t){this.m_engine&&(this.m_emptyTexture&&this.m_engine._releaseTexture(this.m_emptyTexture),this.m_quadMesh&&this.m_quadMesh.discard()),this.m_gl=t;const r=t.canvas.width,i=t.canvas.height;this.m_canvasRenderSize=new x(r,i),e instanceof Hi?this.m_engine=e:(this.m_engine=new Hi(t),this.m_engine.preventCacheWipeBetweenFrames=!0,this.m_engine.doNotHandleContextLost=!0,this.m_engine.setSize(r,i),this.m_engine.setViewport(qi));const n=this.m_engine.getCaps();this.m_parallelShaderCompilationExtension=n.parallelShaderCompile,n.parallelShaderCompile=void 0,this.m_renderToFilteredFloat=n.textureFloatRender&&n.textureFloatLinearFiltering,this.m_renderToFilteredHalfFloat=n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering,this.m_needPowerOf2TexturesForTilingOrMipMap=this.m_engine.needPOTTextures,this.m_uniqueGraphicsProcessorId=Wi,Wi++;for(let e=0;e<10;e++)this.m_shaderPrograms[e]=void 0}}updateViewportSize(){const e=this.m_gl.canvas.width,t=this.m_gl.canvas.height;this.m_canvasRenderSize=new x(e,t),this.m_engine.setSize(e,t),this.m_engine.setViewport(qi)}onWebGLContextLost(){for(let e=0;e<10;e++)this.m_shaderPrograms[e]=void 0}initializeProgramsAsync(){return Dt(this,void 0,void 0,(function*(){this.m_isInitializeReady=!1;const e=this.m_engine.getCaps();this.m_disableParallelShaderCompile||(e.parallelShaderCompile=this.m_parallelShaderCompilationExtension);const t=[];if(!this.beginRenderScopeInternal(!1))throw L.Error(592328457,"Failed to enter render scope.");for(let e=0;e<10;e++){const r=this.getProgramInWebGlScope(e);t.push(r.enureDoneAsync())}this.endRenderScopeInternal(!1),yield Promise.all(t),this.m_isInitializeReady=!0}))}isInRenderScope(){return this.m_isInScope}beginRenderScope(){if(!this.m_isInitializeReady)throw L.Error(592525269,"Please, wait for onDone to be called in initialize.");return this.beginRenderScopeInternal(!0)}endRenderScope(){this.endRenderScopeInternal(!0)}beginRenderScopeInternal(e){const t=this.m_gl.isContextLost();return this.m_isInScope&&L.Error(592525270,"already in glContext scope"),t&&L.Error(592525271,"Invalnew glContext context is lostid"),!this.m_gl||t?this.m_isInScope=!1:(this.m_isInScope=!0,e&&(this.m_stateRestorer?(this.m_stateRestorer.init(this.m_gl),this.m_stateRestorer.setDefaults(),this.m_engine.wipeCaches(!0),this.m_engine.depthCullingState.cull=!1):this.m_wipeStateBetweenScopes&&(this.m_engine.wipeCaches(!0),this.m_engine.depthCullingState.cull=!1)),this.ensureVertexBufferAndMaxTapeInitialized()),this.m_isInScope}endRenderScopeInternal(e){this.m_isInScope?this.m_gl.isContextLost()?L.Error(592525273,"leaving glContext context is lost"):this.m_stateRestorer&&e&&this.m_stateRestorer.restore():L.Error(592525272,"leaving glContext not in scope"),this.m_isInScope=!1}ensureVertexBufferAndMaxTapeInitialized(){this.m_emptyTexture||(this.m_emptyTexture=this.createTextureGraphicsResource(x.One,new Uint8Array([0,0,0,0]),5,!1,!1,!1,4,!1,!1)),this.m_quadMesh||(this.m_quadMesh=dr.CreateGridXY(this,2,2,new E(-1,-1,1,1)))}getProgramInWebGlScope(e){let t=this.m_shaderPrograms[e];return t||(t=this.m_shaderPrograms[e]=new Ki(this,e)),t}createTextureGraphicsResourceFromExternalWebGLTexture(e,t,r,i){let n=r instanceof WebGLTexture?r:null;if(r instanceof qt&&(n=r._webGLTexture),!n)throw L.Error(592525275,"wrong texture type");const s=new qt(this.m_engine,0);return s._webGLTexture=n,i&&(s._framebuffer=i),s.width=e.x,s.height=e.y,s.baseWidth=e.x,s.baseHeight=e.y,s.type=0,s.format=t,s}updateTextureGraphicsResourceFromHTMLElement(e,t,r){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement){const i=this.m_gl,n=e._webGLTexture;n&&(i.bindTexture(i.TEXTURE_2D,n),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),i.bindTexture(i.TEXTURE_2D,null))}}updateTextureGraphicsResourceFromByteBuffer(e,t,r,i){const n=this.m_engine;if(t instanceof Uint8Array||t instanceof Float32Array){let s=t,o=this.getTypeFromData(t,r);if(!(t instanceof Uint8Array&&0==o||t instanceof Float32Array&&1==o)){L.Error(572867294,"Wrong buffer data type: needs conversion");const e=0==o?new Uint8Array(t.length):new Float32Array(t.length),r=0==o?255:1/255;for(let i=0;i<t.length;i++)e[i]=t[i]*r;s=e}n._bindTextureDirectly(3553,e,!0,!0),this.m_gl.pixelStorei(this.m_gl.UNPACK_ALIGNMENT,i),n._uploadDataToTextureDirectly(e,s,0,0,void 0,!0),this.m_gl.pixelStorei(this.m_gl.UNPACK_ALIGNMENT,4),n._bindTextureDirectly(3553,null,!0,!0)}}createTextureGraphicsResource(e,t,r,i,n,s,o,a,l,c){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement){const i=this.m_gl;let n;if(n=i.createTexture(),n){i.bindTexture(i.TEXTURE_2D,n),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,l),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindTexture(i.TEXTURE_2D,null);const s=this.createTextureGraphicsResourceFromExternalWebGLTexture(e,r,n,void 0);return s&&this.setWrapMode(s,o),s}}const h=this.m_engine;let u,d=this.getTypeFromData(t,i);const p=a?2:1;if(n)u=h.createRenderTargetTexture({width:e.x,height:e.y},{generateDepthBuffer:!1,generateStencilBuffer:s,format:r,type:d,samplingMode:p,generateMipMaps:!1});else{const n=new qt(h,Vt.Unknown);n.updateSize(e.x,e.y),n.type=d,n.format=r,n.invertY=l,h.updateTextureSamplingMode(p,n),(t instanceof Uint8Array||t instanceof Float32Array)&&this.updateTextureGraphicsResourceFromByteBuffer(n,t,i,c||4),u=n}return this.setWrapMode(u,o),u}getTypeFromData(e,t){let r=0;return t&&(e instanceof Float32Array&&this.m_renderToFilteredFloat?r=1:e||(this.m_renderToFilteredHalfFloat?r=2:this.m_renderToFilteredFloat&&(r=1))),r}setRenderTarget(e){e?(this.m_engine.bindFramebuffer(e),this.m_currentRenderTarget=e):(this.m_engine.restoreDefaultFramebuffer(),this.m_currentRenderTarget=void 0)}generateMipMap(e){this.m_engine.updateTextureSamplingMode(3,e,!0)}setWrapMode(e,t){const r=4==t?0:1==t||3==t?2:1,i=4==t?0:2==t||3==t?2:1;this.m_engine.updateTextureWrappingMode(e,r,i)}copyTexturePixelsToArray(e,t,r){const i=Math.floor(t.left),n=Math.floor(t.top),s=Math.floor(t.width),o=Math.floor(t.height);this.setRenderTarget(e);const a=this.m_engine.readPixels(i,n,s,o,r);return this.setRenderTarget(void 0),a}getCurrentViewportSize(){return this.m_currentRenderTarget?new x(this.m_currentRenderTarget.width,this.m_currentRenderTarget.height):this.m_canvasRenderSize}setScissorRect(e,t){if(t||!D(e,this.m_currentScissorRect)){const t=this.m_gl,r=this.getCurrentViewportSize();e?(t.enable(t.SCISSOR_TEST),t.scissor(e.left,r.y-e.bottom,e.width,e.height)):(t.disable(t.SCISSOR_TEST),t.scissor(0,0,r.x,r.y))}this.m_currentScissorRect=e}getUniqueGraphicsProcessorId(){return this.m_uniqueGraphicsProcessorId}isFloatTextureSupported(){return this.m_renderToFilteredFloat||this.m_renderToFilteredHalfFloat}activateShaderProgram(e){const t=this.getProgramInWebGlScope(e);return t.activate(),t}preCompileShaderAsync(e){this.beginRenderScopeInternal(!1)&&(this.getProgramInWebGlScope(e),this.endRenderScopeInternal(!1))}preLinkShaderAsync(e){this.preCompileShaderAsync(e)}tryPrepareProgramResourcesInWebGlScope(e){for(let e=0;e<2;e++)this.m_shaderPrograms[e]||this.getProgramInWebGlScope(e);return!0}}class Ki{constructor(e,t){this.graphicsProcessor=e,this.m_engine=e.getBabylonEngine(),this.programId=t,this.m_effect=this.createEffect()}getBabylonEngine(){return this.m_engine}getBabylonEffect(){return this.m_effect}done(){return void 0!==this.effectErrors||this.m_effect.isReady()}enureDoneAsync(){return new Promise(((e,t)=>{this.done()?e(void 0):(this.m_effect.onCompileObservable.add((()=>e(void 0))),this.m_effect.onErrorObservable.add(t))}))}createEffect(){return L.Message(592525280,"Compiling shader "+this.programId),new Ii({vertexSource:ji[this.programId].v,fragmentSource:ji[this.programId].f,spectorName:this.programId},ji[this.programId].a,ji[this.programId].u,ji[this.programId].s,this.m_engine,void 0,void 0,void 0,((e,t)=>{this.effectErrors=t}))}activate(){this.handleActivationErrors(),this.m_engine.enableEffect(this.m_effect),this.m_currentMesh=void 0,this.bindMesh(void 0)}bindMesh(e){const t=e||this.graphicsProcessor.quadMesh;t&&t.isValid(this.graphicsProcessor)?this.m_currentMesh!=t&&(t.vertexBuffer&&t.indexBuffer&&t.isValid(this.graphicsProcessor)&&(this.m_engine._bindIndexBufferWithCache(t.indexBuffer),Xi[0].index=this.m_effect.getAttributeLocationByName("a_v"),this.m_engine.bindInstancesBuffer(t.vertexBuffer,Xi,!1)),this.m_currentMesh=t):L.Error(592525281,"Invalid Mesh")}handleActivationErrors(){if(!this.effectErrors&&this.m_effect.isReady())return;const e="Program "+this.programId+" ";if(this.effectErrors){const t=this.m_effect.getPipelineContext();if(t.vertexCompilationError)throw L.Error(592525282,e+"V compile failed: "+t.vertexCompilationError);if(t.fragmentCompilationError)throw L.Error(592525283,e+"V compile failed: "+t.fragmentCompilationError);if(t.programLinkError)throw L.Error(592525312,e+"link failed: "+t.programLinkError);if(t.programValidationError)throw L.Error(592525313,e+"validation failed: "+t.programValidationError);throw L.Error(592525314,e+"preparation failed:"+this.effectErrors)}if(!this.m_effect.isReady())throw L.Error(592525315,e+"Effect not ready yet.")}setTexture(e,t){const r=t||this.graphicsProcessor.emptyTexture;this.m_effect._bindTexture(e,r||null)}clearAndEnbaleDepthBuffer(){this.m_engine.depthCullingState.depthFunc=513,this.m_engine.depthCullingState.depthMask=!0,this.m_engine.depthCullingState.depthTest=!0,this.m_engine.clear(null,!1,!0,!1)}setDistanceFieldStencilSumIncrement(e){const t=e?34055:34056,r=this.m_engine;r.stencilState.stencilOpStencilFail=t,r.stencilState.stencilOpDepthFail=t,r.stencilState.stencilOpStencilDepthPass=t}setBlendingMode(e){const t=this.m_engine;t.alphaState.alphaBlend=!0,0==e?(t.alphaState.setAlphaBlendFunctionParameters(1,771,1,771),t.alphaState.setAlphaEquationParameters(32774,32774)):1==e?(t.alphaState.setAlphaBlendFunctionParameters(1,1,0,1),t.alphaState.setAlphaEquationParameters(32775,32774)):2==e?(t.alphaState.setAlphaBlendFunctionParameters(775,769,0,1),t.alphaState.setAlphaEquationParameters(32774,32774)):3==e?(t.alphaState.setAlphaBlendFunctionParameters(1,1,1,1),t.alphaState.setAlphaEquationParameters(32779,32779)):4==e?(t.alphaState.setAlphaBlendFunctionParameters(1,1,1,1),t.alphaState.setAlphaEquationParameters(32774,32774)):5==e?(t.alphaState.setAlphaBlendFunctionParameters(774,0,0,1),t.alphaState.setAlphaEquationParameters(32774,32774)):L.Error(592525318,"Wrong blending mode")}begin(e,t,r){const i=this.m_engine;this.graphicsProcessor.setRenderTarget(e),this.m_engine.setViewport(qi),t&&i.clear(t,!0,!1,!1),r?this.setBlendingMode(0):i.alphaState.alphaBlend=!1,i.depthCullingState.depthTest=!1,i.depthCullingState.depthMask=!0,i.stencilState.stencilTest=!1,i.stencilState.stencilMask=255,i.setColorWrite(!0)}end(){this.graphicsProcessor.setRenderTarget(void 0),this.m_engine.unbindInstanceAttributes(),this.m_engine.setViewport(qi)}drawQuads(e){this.bindMesh(void 0),this.m_engine.drawElementsType(0,0,6*e)}drawQuadInstances(e){this.bindMesh(void 0),this.m_engine.drawElementsType(0,0,6,e)}drawMesh(e){this.bindMesh(e),this.m_engine.drawElementsType(0,0,3*e.triangleCount)}setDummyPointerAttribute(e){if(this.graphicsProcessor.quadMesh&&this.graphicsProcessor.quadMesh.vertexBuffer){const t=this.graphicsProcessor.quadMesh.vertexBuffer,r=this.m_engine,i=[{attributeName:e,attributeSize:1,offset:0,divisor:0,index:this.m_effect.getAttributeLocationByName(e)}];r.bindInstancesBuffer(t,i,!1)}else L.Error(592525319,"Quad not initialized")}disableInstanceAttribute(e){this.m_engine.disableInstanceAttributeByName(e)}}const Yi={itemHit:void 0,itemStack:void 0,textHit:void 0};let Ji=0;class Zi{constructor(e){this.cache=new hi,this.isGroup=e}releaseGeneratedResources(){this.cache.releaseGeneratedResources()}onFinalization(){false}}class Qi{constructor(){this.index=0}get color(){const e=this.index%256,t=(this.index-e)/256%256,r=(this.index-e-256*t)/65536%256;return new ge(e/255,t/255,r/255,1)}next(){this.index++}}class en{constructor(e,t,r,i){var n,s;this.scene3D=null!==(n=null==e?void 0:e.scene3D)&&void 0!==n?n:t.scene3D;const o=null!==(s=null==e?void 0:e.fade)&&void 0!==s?s:t.fade;if(o){if(this.fade=o.clone(),o.isDistributedByLength&&(null==e?void 0:e.drawDistribution)&&i+1<e.drawDistribution.length){const t=e.drawDistribution[i],r=e.drawDistribution[i+1];this.fade.progress=(o.progress-t)/(r-t)}else o.isDistributedByLength&&e&&L.Error(592525086,"Unable to distribute by length"),this.fade.progress=o.progress;if(2==t.getType()&&o.isDistributedByLength){if(!r.cache.drawDistribution){let e=0;const i=t=>{for(const r of t.paths||[])e+=r.measureLength(S.FromTransforms(r.transform,t.transform));return!0};vt(t,i);const n=e;let s=0;const o=t;r.cache.drawDistribution=[];for(let t=0;t<o.items.length;t++)r.cache.drawDistribution.push(s/n),e=0,vt(o.items.getAt(t),i),s+=e;r.cache.drawDistribution.push(1)}this.drawDistribution=r.cache.drawDistribution}}}}let tn=1;class rn{constructor(e){this.m_babylonWipeStateBetweenScopes=!0,this.m_babylonDisableParallelShaderCompile=!1,this.m_currentFramePerformanceSummary=new Ot,this.m_textureManager=new Zt,this.m_glyphCachePreviouslyFailed=!1,this.m_verboseRenderLogging=!1,this.fixedMemoryLeakAmounts=new Nt,this.m_babylonWipeStateBetweenScopes=!!e.stateRestorer,this.m_babylonDisableParallelShaderCompile=1==e.babylonDisableParallelShaderCompile,this.m_stateRestorer=e.stateRestorer,this.m_morphPlayer=e.morphPlayer,this.m_debugStringProvider=e.debugStringProvider,this.m_perfSummary=new Ut,this.m_rendererId="🦆"+tn++}getTextureManager(){return this.m_textureManager}hasMorphPlayer(){return!!this.m_morphPlayer}setMorphPlayer(e){this.m_morphPlayer=e}hasDebugStringProvider(){return!!this.m_debugStringProvider}setDebugStringProvider(e){this.m_debugStringProvider=e}initializeAsync(e){return Dt(this,void 0,void 0,(function*(){if(this.setWebGLContextOrBabylonEngine(e),!this.m_graphicsProcessor)throw L.Error(592328459,"Failed to initialize graphics processor.");yield this.m_graphicsProcessor.initializeProgramsAsync()}))}setBabylonEngine(e){this.setWebGLContextOrBabylonEngine(e)}setWebGLContext(e){this.setWebGLContextOrBabylonEngine(e)}setWebGLContextOrBabylonEngine(e){const t=e instanceof WebGLRenderingContext||e instanceof WebGL2RenderingContext?e:e._gl;this.m_graphicsProcessor&&!this.m_graphicsProcessor.isCurrentWebGLContext(t)&&this.onWebGLContextLost(),this.m_graphicsProcessor?this.m_graphicsProcessor.setWebGLContextOrBabylonEngine(e):this.m_graphicsProcessor=new $i(e,this.m_babylonWipeStateBetweenScopes,this.m_babylonDisableParallelShaderCompile,this.m_stateRestorer)}onWebGLContextLost(){if(this.m_scratchBuffers){for(let e of this.m_scratchBuffers)e.release();this.m_scratchBuffers=void 0}Nr(),this.m_graphicsProcessor&&(this.m_graphicsProcessor.onWebGLContextLost(),this.m_graphicsProcessor=void 0)}verifyGlyphCacheIntegrityAndTryRecover(){return!function(){let e=0,t=0,r=0,i=0,n=0,s=0;for(let o=0;o<Or.length;o++){let a=0,l=0;const c=Lr&&o<Lr.length?Lr[o].texture:void 0,h=c?c.tryConvertToBufferRGBA():void 0;for(let n=0;n<Or[o].length;n++){const u=Or[o][n];if(u.ready){if(!c||!h)return L.Error(555782370,"Glyph ready but texture missing"),!0;{let n=0;for(let e=Math.ceil(u.bounds.top);e<u.bounds.bottom;e++){const t=c.size.y-1-e;for(let e=Math.ceil(u.bounds.left);e<u.bounds.right;e++)n+=h[4*(e+t*c.size.x)]}if(void 0===u.checksum){if(0==n&&u.path.figures.length>0){const t=H(u.path.figures);t&&t.isValid()&&!t.isEmpty()&&e++}}else a+=n,l+=u.checksum,n>u.checksum&&t++,n<u.checksum&&(0==n?r++:(L.Error(555782402,`Glyph was ready but got partially erased (-${100*(u.checksum-n)/u.checksum}%)`),i++));u.checksum=n}s++}}0==a&&l>0&&n++}return e>0&&L.Error(555782371,`Glyph(s) with figures look empty: glyphCount=${e}, totalGlyphCount=${s}`),t>0&&L.Error(555782400,`Glyph(s) ready but additional pixels rendered on top: glyphCount=${t}, totalGlyphCount=${s}`),(r>0||i>0)&&L.Error(555782401,`Glyph(s) ready but erased from cache: glyphCountErased=${r}, glyphCountPartiallyErased=${i}, totalGlyphCount=${s}, pageCountErased=${n}, totalPageCount=${Or.length}`),e>0||r>0||i>0}()||(this.m_glyphCachePreviouslyFailed?(L.Error(555782369,"GlyphCache failed for the second time: disable glyph cache"),tr(!1)):this.m_glyphCachePreviouslyFailed=!0,Nr(),!1)}isValid(){return!!this.m_graphicsProcessor&&this.m_graphicsProcessor.isValid()}getGraphicsProcessor(){return this.m_graphicsProcessor}getBabylonEngine(){return this.m_graphicsProcessor?this.m_graphicsProcessor.getBabylonEngine():void 0}getPerformanceSummary(){const e=e=>{if(!e)return;const t=e;for(const e in t)e.endsWith("Ms")&&(t[e]=un(t[e]))};return this.m_perfSummary.averageFrameCost&&(this.m_perfSummary.averageFrameCost=un(this.m_perfSummary.averageFrameCost)),e(this.m_perfSummary.perfInfoCurrentFrame),e(this.m_perfSummary.perfInfoFirstFrame),e(this.m_perfSummary.perfInfoSumOfAllFrames),this.m_perfSummary}resetPerformanceSummary(){this.m_perfSummary=new Ut}getCurrentFramePerformanceSummary(){return this.m_currentFramePerformanceSummary}getDebugStringProvider(){return this.m_debugStringProvider}ensureScratchBuffers(){if(!this.m_scratchBuffers){this.m_scratchBuffers=[];for(let e=0;e<2;e++)this.m_scratchBuffers.push(new nr("ScratchBuffer",this,new x(Jt,Jt),0))}return this.m_scratchBuffers}ensureRenderNode(e){let t=e.renderDataMap[this.m_rendererId];return t||(t=new Zi(2==e.getType()),e.renderDataMap[this.m_rendererId]=t),t}ensurePathRenderData(e){let t=e.renderDataMap[this.m_rendererId];return t||(t=new ti,e.renderDataMap[this.m_rendererId]=t),t}ensureImageRenderData(e){let t=e.renderDataMap[this.m_rendererId];return t||(t=new ii,e.renderDataMap[this.m_rendererId]=t),t}ensureMorphKeyFrameRenderData(e){let t=e.renderDataMap[this.m_rendererId];return t||(t=new ui,e.renderDataMap[this.m_rendererId]=t),t}ensureMorphElementRenderData(e){let t=e.renderDataMap[this.m_rendererId];return t||(t=new di,e.renderDataMap[this.m_rendererId]=t),t}attachTextureToImage(e,t){const r=this.ensureImageRenderData(e);e.changeTracker.replaceListener(r.texture,t),r.texture=t}attachLoaderToImage(e,t){const r=this.ensureImageRenderData(e);e.changeTracker.replaceListener(r.texture,t),r.loader=t}getTextureFromImage(e){if(!e)return;const t=this.ensureImageRenderData(e);return t.loader?(L.Error(520663959,"getTextureFromImage may return the wrong wrap mode for ImageTextureLoader"),t.loader.getTexture(4)):t.texture}getTextureFromImageBrush(e){var t;if(!e.image)return;const r=this.ensureImageRenderData(e.image);return r.loader?r.loader.getTexture(null!==(t=e.wrapMode)&&void 0!==t?t:4):r.texture}deleteAllTextures(e){e.releaseGeneratedResources()}tryGetImageDebugData(e){const t=this.ensureImageRenderData(e);return new ri(t.state,t.texture)}getDebugGlyphCacheInfo(e){return function(e){const t=Dr(e);if(t){const e=kr[t];if(e)return e.page}}(e)}generateTextureMemoryReport(e,t){let r={externalImages:0,managedImages:0,scratchBuffers:this.hasHitTestTexture()?4:0,glyphPages:0,shapeDistanceFields:0,textDistanceFields:0,otherBrushes:0,effects:0,rasterizedItems:0,fadeMasks:0,morphTextures:0,totalTarget:0,totalTargetExpected:this.getTextureManager().textureMemoryAllocated};for(let e of this.m_scratchBuffers||[])r.scratchBuffers+=e.memoryUsage;for(let e of Lr||[])r.glyphPages+=e.texture?e.texture.memoryUsage:0;for(let t of e)ln(this,t,r);for(let e of t||[])cn(this,e,r);return r.totalTarget=r.scratchBuffers+r.glyphPages+r.shapeDistanceFields+r.textDistanceFields+r.otherBrushes+r.effects+r.rasterizedItems+r.fadeMasks+r.morphTextures,r}initOutOfTime(){return this.m_initDeadline&&this.m_initDeadline<performance.now()}updateSettingsBeforeRender(){const e=Xt.readNumberOrDefault("debugMode",-1);-1!=e&&(ae=e);const t=Xt.readBooleanOrDefault("debugTextLines",!1);t&&(le=t);const r=Xt.readNumberOrDefault("quality",0);0!=r&&Qt(r),Xt.readBooleanOrDefault("disableGlyphTable",!1)&&tr(!1);const i=Xt.readNumberOrDefault("hitTestSlop",0);0!=i&&function(e){te=e}(i);const n=Xt.readNumberOrDefault("minLineWidth",0),s=Xt.readNumberOrDefault("minLineWidthForArrowHead",0);0==n&&0==s||ie(n||Q,s||ee);const o=Xt.readNumberOrDefault("hitTestCache",0);var a,l,c;0!=o&&function(e){re=e}(o),a=Xt.readBooleanOrDefault("useLegacyBrightness",ne),ne=a,l=Xt.readBooleanOrDefault("useLegacyContrast",se),se=l,c=Xt.readBooleanOrDefault("useLegacySharpness",oe),oe=c;const h=Xt.readNumberOrDefault("glyphCacheTextureResolution",0);0!=h&&(ce=h)}fillRenderRectMap(e,t,r,i,n,s,o,a,l){const c=t.changeTracker.currentUniqueId+","+t.animationChangeTracker.currentUniqueId+","+s.index+(o?"+"+o:"")+(l?"*":""),h=t.instances?t.instances.length:1;for(let u=0;u<h;u++){const h=t.instances?t.instances[u].transform.toMatrix3().multiply(i):i,d=t.instances?c+","+u:c;if(t instanceof yt||t.effects.hasEffects){let i=t.getBounds(!a,!0,!0,h);if(t instanceof yt&&t.style.pictureOverflow&&t.style.pictureBrush){const e=t.fillBoundsOverride?t.fillBoundsOverride:wt(t,!1),r=this.getTextureFromImageBrush(t.style.pictureBrush);if(e&&r){const n=t.animationTransform?S.FromTransforms(t.transform,h,t.animationTransform):S.FromTransforms(t.transform,h),s=Sr(e,t.style.pictureBrush,r,n);s&&(i=E.UnionRect(i,s))}}a&&(i=i?i.transformedBounds(a):i),i=i?i.transformedBounds(n):i,i=r?E.IntersectRect(r,i):i,i&&(e[d]=i)}if(t instanceof _t){const i=(t.animationTransform||t.fade?t.animationChangeTracker.currentUniqueId:"")+":"+t.opacity+"/"+o,c=a||t.animationTransform;for(let o of t.items.elements)s.next(),this.fillRenderRectMap(e,o,r,t.transform.toMatrix3().multiply(h),n,s,i,c,l||t.isHidden)}}}calculateDirtyRect(e,t){let r,i=i=>{const n=e[i],s=t[i];D(n,s)||(r=E.UnionRect(r,n),r=E.UnionRect(r,s))};for(let t in e)i(t);for(let e in t)i(e);return r?r.inflate(2):void 0}getLastRenderRectMap(){return this.m_lastRenderRectMap}render(e,t,r,i){this.renderBatch([{item:e,eraseBackground:t,options:r}],i)}renderBatch(e,t){var r,i,n,s,o,a;if(!this.isValid())return void L.Message(512297154,"renderer context not valid in renderBatch");this.m_lastRenderRectMap=void 0,this.m_verboseRenderLogging&&L.Message(538208403,"RenderBatch begin");const l=null===(r=t)||void 0===r?void 0:r.enableDirtyRect,c=null===(i=t)||void 0===i?void 0:i.previousRenderRectMap;let h,u;const d=this.m_graphicsProcessor;if(!d)return void L.Error(592525091,"glContext must be provided");this.updateSettingsBeforeRender();const p=performance.now();if(l){h={};for(let t of e){const e=new Qi;this.fillRenderRectMap(h,t.item,null===(n=t.options)||void 0===n?void 0:n.scissor,S.Identity,(null===(o=null===(s=t.options)||void 0===s?void 0:s.transform)||void 0===o?void 0:o.toMatrix3())||S.Identity,e,void 0,void 0,!1)}c&&(u=this.calculateDirtyRect(c,h))}if(this.m_verboseRenderLogging&&L.Message(525960788,"RenderBatch computed RenderRectMap"),!d.beginRenderScope())return;this.m_verboseRenderLogging&&L.Message(538208404,"RenderBatch entered render scope");const f=new Ot;f.glResetCostMs+=performance.now()-p,f.beginTime=(new Date).getTime(),this.m_currentFramePerformanceSummary=f,f.totalCostMs=-performance.now();for(let t of e)this.tryPrepareItemInWebGlScope(t.item,d,!0,void 0)||L.Error(592525120,"could not fully prepare scene");if(f.shapeRenderCostMs=-performance.now(),this.m_verboseRenderLogging&&L.Message(538208405,"RenderBatch Items prepared"),u||!l||!c)for(let t of e)this.renderItemInWebGLRenderScope(t.item,t.eraseBackground,t.options,u);this.m_verboseRenderLogging&&L.Message(538208406,"RenderBatch Items rendered");const g=e.length>0&&(null===(a=e[0].options)||void 0===a?void 0:a.target)instanceof nr?e[0].options.target.size:d.getCurrentViewportSize();if(f.shapeRenderCostMs+=performance.now(),f.glRestoreCostMs=-performance.now(),u&&Xt.readBooleanOrDefault("debugDirtyRects",!1)){const e=yt.CreateRectangle(u,new Se(new _e(new ge(Math.random(),Math.random(),Math.random(),.25))));this.renderItemInWebGLRenderScope(e,void 0)}if(d.endRenderScope(),f.glRestoreCostMs+=performance.now(),f.totalCostMs+=performance.now(),f.endTime=(new Date).getTime(),this.m_perfSummary.perfInfoCurrentFrame=f,this.m_perfSummary.perfInfoFirstFrame||(this.m_perfSummary.perfInfoFirstFrame=f),this.m_perfSummary.perfInfoSumOfAllFrames||(this.m_perfSummary.perfInfoSumOfAllFrames=new Ot),this.m_perfSummary.perfInfoSumOfAllFrames.add(f),this.m_perfSummary.frameCount++,this.m_perfSummary.averageFrameCost=this.m_perfSummary.perfInfoSumOfAllFrames.totalCostMs/this.m_perfSummary.frameCount,this.m_perfSummary.viewWidth=g.x,this.m_perfSummary.viewHeight=g.y,this.m_perfSummary.frameCount>1){const e=(this.m_perfSummary.perfInfoSumOfAllFrames.totalCostMs-this.m_perfSummary.perfInfoFirstFrame.totalCostMs)/(this.m_perfSummary.frameCount-1);this.m_perfSummary.estimatedFps=Math.floor(Math.min(1e3/e,60))}else this.m_perfSummary.estimatedFps=Math.floor(Math.min(1e3/this.m_perfSummary.perfInfoCurrentFrame.shapeRenderCostMs,60));this.m_currentFramePerformanceSummary=new Ot,pi.OnRender(this,e),this.m_verboseRenderLogging&&L.Message(538208407,"RenderBatch finished"),this.m_lastRenderRectMap=h}renderItemInWebGLRenderScope(e,t,r,i){const n=this.m_graphicsProcessor;if(!n)return void L.Error(592525121,"glContext must be provided");n.updateViewportSize();const s=r?r.target:void 0,o=s?s.size:n.getCurrentViewportSize(),a=r?r.transform:void 0,l=(null==r?void 0:r.scissor)&&i?E.IntersectRect(null==r?void 0:r.scissor,i):(null==r?void 0:r.scissor)||i;if(((null==r?void 0:r.scissor)||i)&&!l)return;n.setScissorRect(null==l?void 0:l.inflateToInteger(),!0);const c=performance.now(),h=n.activateShaderProgram(1);if(this.isVerboseRenderLoggingEnabled()){const e=un(performance.now()-c);L.Message(529077967,`RenderBatch shapeRender shader activation cost ${e}ms`)}h.begin(s?s.tryGetBabylonTextureForRenderToTexture(n):void 0,t,!0),this.drawItem(31,h,e,o,S.Identity,void 0,a?a.toMatrix3():S.Identity,0,void 0,!1,r,l,void 0),h.end(),n.setScissorRect(void 0)}renderMorph(e,t,r,i){if(!this.m_morphPlayer)throw L.Error(591667344,"Morph not available for this renderer");this.m_morphPlayer.renderMorph(this,e,t,r,i)}tryPrepareMorph(e,t){if(!this.m_morphPlayer)throw L.Error(591667345,"Morph not available for this renderer");return this.m_morphPlayer.tryPrepareMorph(this,e,t)}tryGetImageDebugDataForMorphKeyFrame(e){const t=this.ensureMorphKeyFrameRenderData(e);return t.texture?new ri(1,t.texture):void 0}renderLayers(e,t,r){const i=this.m_graphicsProcessor;if(!i)return void L.Error(592525125,"glContext must be provided");if(i&&!i.beginRenderScope())return;const n=this.m_targetTexture?this.m_targetTexture.size:i.getCurrentViewportSize(),s=i.activateShaderProgram(1);s.begin(this.m_targetTexture?this.m_targetTexture.tryGetBabylonTextureForRenderToTexture(i):void 0,t,!0);for(let t=0;t<e.length;t++)Pr(i,e[t],s,n,r?r.toMatrix3():void 0,void 0);s.end(),i.endRenderScope()}retrieveHitTestResult(e,t,r,i){if(t==r.index){const t={itemHit:e,itemStack:[e],textHit:void 0};if(e instanceof yt){const r=e.text;if(r){const n=i.transformPoint(S.FromTransforms(new P(e.transform.translation.negate()),r.frameToShape.toInverseMatrix3(),r.layoutToFrame.toInverseMatrix3()));t.textHit=r.hitTest(n)?r.getSelectionFromLayoutPosition(n):void 0}}return t}if(e instanceof _t)for(const n of e.items.elements){r.next();const s=this.retrieveHitTestResult(n,t,r,i.transformPoint(e.transform.toInverseMatrix3()));if(null==s?void 0:s.itemStack)return s.itemStack.splice(0,0,e),s}}renderHitTestBuffer(e,t,r,i,n){const s=performance.now();this.m_hitTestCache=void 0;const o=this.m_graphicsProcessor;if(!o)return void L.Error(592525129,"glContext must be provided");if(!o.beginRenderScope())return;this.tryPrepareItemInWebGlScope(e,o,!0,void 0)||L.Error(592525131,"could not fully prepare"),this.m_hitTestTexture&&this.m_hitTestTexture.isValid(this)&&this.m_hitTestTexture.size.equals(r)||(this.m_hitTestTexture&&this.m_hitTestTexture.release(),this.m_hitTestTexture=new nr("HitTestPixel",this,r,0));const a=new Qi,l=o.activateShaderProgram(1);l.begin(this.m_hitTestTexture.tryGetBabylonTextureForRenderToTexture(o),ge.Transparent,!0);const c=t.negate(),h=i?i.toMatrix3().multiply(S.Translation2D(c)):S.Translation2D(c);this.drawItem(0,l,e,this.m_hitTestTexture.size,S.Identity,void 0,h,7,a,!1,{filter:n},void 0,void 0),l.end(),this.m_hitTestTexture.renderCost=performance.now()-s;const u=this.m_hitTestTexture.tryUseBabylonTexture(o,void 0,"hitTest"),d=u?o.copyTexturePixelsToArray(u,new E(0,0,this.m_hitTestTexture.size.x,this.m_hitTestTexture.size.y),!0):void 0;o.endRenderScope(),d&&(this.m_hitTestCache={buffer:d,uniqueId:e.changeTracker.currentUniqueId,origin:t,renderTransform:i})}isHitTestBufferValid(e,t,r,i,n){if(n||0==re||!this.m_hitTestCache||this.m_hitTestCache.uniqueId!=e.changeTracker.currentUniqueId)return!1;if(!this.m_hitTestCache.renderTransform&&!i||this.m_hitTestCache.renderTransform&&i&&!this.m_hitTestCache.renderTransform.toMatrix3().equals(i.toMatrix3()))return!1;const s=this.m_hitTestCache.origin?new E(this.m_hitTestCache.origin.x,this.m_hitTestCache.origin.y,this.m_hitTestCache.origin.x+r.x-1,this.m_hitTestCache.origin.y+r.y-1):void 0;return!(!s||!s.isPointInRect(t))}hitTestScene(e,t,r,i){if(!this.isValid())return L.Message(512297153,"renderer context not valid in hitTestScene"),Yi;const n=re&&!i?new x(re,re):x.One;if(!this.isHitTestBufferValid(e,t,n,r,i)){const s=t.floor().subtract(new x(Math.floor(n.x/2),Math.floor(n.y/2)));this.renderHitTestBuffer(e,s,n,r,i)}if(!this.m_hitTestCache)return Yi;const s=t.subtract(this.m_hitTestCache.origin).floor(),o=4*(s.x+(n.y-1-s.y)*n.x);if(o<0||o+3>=this.m_hitTestCache.buffer.length||0==this.m_hitTestCache.buffer[o+3])return Yi;const a=this.m_hitTestCache.buffer[o+0]+256*this.m_hitTestCache.buffer[o+1]+65536*this.m_hitTestCache.buffer[o+2],l=new Qi,c=r instanceof S?r.tryGetTransform(x.Zero):r,h=c?c.toInverseMatrix3():void 0;return this.retrieveHitTestResult(e,a,l,h?t.transformPoint(h):t)||(Ji++,Ji<=100&&L.Error(592525132,`Unable to retrieve hit shape ${a}`),100==Ji&&L.Error(520119570,"Hit test failed too many times, not reporting anymore"),Yi)}hasHitTestTexture(){return null!=this.m_hitTestTexture}tryInitTextures(e,t,r,i,n){var s,o,a;if(t.isHidden)return!0;const l=this.ensureRenderNode(t);l.cache.beforeInitTextures(t,e);const c=new en(i,t,l,n),h=t instanceof yt&&t.shape3D;if(t instanceof yt){const i=t;if(i.incrementalPath&&(l.cache.initTextureStage=ci.fromBegining),l.cache.initTextureStage<ci.distanceFieldsReady){if(i.incrementalPath)l.cache.distanceFields&&1==l.cache.distanceFields.length||(l.cache.distanceFields=[new Fr("DistanceField/incremental",this,void 0,0,0,0,1,!1)]);else if(i.paths&&!l.cache.distanceFields&&!i.isSolidRect()){let e=-performance.now();if(l.cache.distanceFields=[],(null===(s=i.paths)||void 0===s?void 0:s.length)>0){let e=0,t=0,r=i.paths[0].fillMode;for(let n=0;n<i.paths.length;n++){const s=n==i.paths.length-1,o=s?0:i.paths[n+1].fillMode;(s||o!=r)&&(!i.style.hasLine||0==i.style.pen.headEnd.end&&0==i.style.pen.tailEnd.end?l.cache.distanceFields.push(new Fr("DistanceField/fillAndLine",this,Le.FromFirstLast(e,t),r,i.mergeMode,0,1,!1)):(0!=r&&null!=i.style.fillBrush&&l.cache.distanceFields.push(new Fr("DistanceField/fillOnly",this,Le.FromFirstLast(e,t),r,i.mergeMode,1,1,!1)),l.cache.distanceFields.push(new Fr("DistanceField/arrowAndLine",this,Le.FromFirstLast(e,t),r,i.mergeMode,2,1,!1))),r=o,e=n+1),t=n+1}h&&l.cache.distanceFields.push(new Fr("DistanceField/displacement",this,void 0,r,i.mergeMode,0,1,!0))}if(e+=performance.now(),3==i.role?this.m_currentFramePerformanceSummary.distanceFieldForTextCostMs+=e:this.m_currentFramePerformanceSummary.distanceFieldForShapeCostMs+=e,this.initOutOfTime())return!1}for(const e of l.cache.distanceFields||[]){let t=-performance.now();const r=null!=i.incrementalPath;let n=e.refresh(this,i,r);if(!n&&r&&(n=e.refresh(this,i,!1)),n||L.Error(592525133,"error in distanceField refresh"),t+=performance.now(),3==i.role?this.m_currentFramePerformanceSummary.distanceFieldForTextCostMs+=t:this.m_currentFramePerformanceSummary.distanceFieldForShapeCostMs+=t,this.initOutOfTime())return!1}l.cache.initTextureStage=ci.distanceFieldsReady}if(l.cache.initTextureStage<ci.brushTexturesReady){if(l.cache.initBrushTexture(this,t,0),this.initOutOfTime())return!1;if(l.cache.initBrushTexture(this,t,1),this.initOutOfTime())return!1;if(l.cache.initBrushTexture(this,t,2),this.initOutOfTime())return!1;l.cache.initTextureStage=ci.brushTexturesReady}if(i.text&&i.text.cache)if(0==i.text.renderMode){let t=0;for(const n of i.text.cache.textShapes||[]){if(i.text.animationProps)if(n.textRange){const e=i.text.animationProps.getAt(n.textRange.start);n.fade=e.fade,n.animationTransform=e.animationTransform,n.isHidden=e.isHidden}else L.Error(592525134,"no range");else n.fade=void 0,n.animationTransform=S.Identity,n.isHidden=!1;if(!this.tryInitTextures(e,n,r,c,t))return!1;t++}for(const t of i.text.cache.selectionShapes||[])if(!this.tryInitTextures(e,t,r,c,0))return!1}else l.cache.initTextCutoutLayer(this,i.text.cache.cutoutLayerPaths,i)}else{if(!(t instanceof _t))throw L.Error(592525135,"Unknown Item type");{l.cache.initTextureStage<ci.brushTexturesReady&&(l.cache.initBrushTexture(this,t,0),l.cache.initTextureStage=ci.brushTexturesReady);const i=t;for(let t=0;t<i.items.length;t++){const n=i.items.getAt(t);if(n&&!this.tryInitTextures(e,n,r,c,t))return!1;if(this.initOutOfTime())return!1}}}let u=-performance.now();if(l.cache.fade=c.fade,l.cache.initFadeTexture(this,t,c.fade),u+=performance.now(),t.fade&&(this.m_currentFramePerformanceSummary.fadeTextureCostMs+=u),this.initOutOfTime())return!1;if(r&&l.cache.initTextureStage<ci.effectsReady){if(t.effects){if(t.effects.innerShadow&&t.effects.innerShadow.color.a>0&&!l.cache.innerShadowTexture&&(l.cache.innerShadowTexture=this.createTextureRasterizedItem("Effect/InnerShadow",t,0,l.cache.innerShadowTexture,ge.Black,t.effects.innerShadow.radius,8,2,Kt,1),this.initOutOfTime()))return!1;if(t.effects.softEdges&&t.effects.softEdges.radius>0&&!l.cache.softEdgesTexture&&(l.cache.softEdgesTexture=this.createTextureRasterizedItem("Effect/SoftEdges",t,0,l.cache.softEdgesTexture,ge.Black,t.effects.softEdges.radius,16,5,Kt,1),this.initOutOfTime()))return!1;if(t.effects.glow&&t.effects.glow.radius>0&&t.effects.glow.color.a>0&&!l.cache.glowTexture&&(l.cache.glowTexture=this.createTextureRasterizedItem("Effect/Glow",t,16,l.cache.glowTexture,t.effects.glow.color,t.effects.glow.radius?2*t.effects.glow.radius:0,1,t.effects.glow.isSharp?4:3,Kt,1),this.initOutOfTime()))return!1;if(t.effects.shadow&&t.effects.shadow.color.a>0&&!l.cache.shadowTexture&&(l.cache.shadowTexture=this.createTextureRasterizedItem("Effect/Shadow",t,17,l.cache.shadowTexture,t.effects.shadow.color,t.effects.shadow.radius?t.effects.shadow.radius:0,2,6,Kt,1),this.initOutOfTime()))return!1;if(t.effects.reflection&&!l.cache.reflectionTexture&&(l.cache.reflectionTexture=this.createTextureRasterizedItem("Effect/Reflection",t,27,l.cache.reflectionTexture,void 0,t.effects.reflection.radius,4,6,Kt,1),this.initOutOfTime()))return!1}l.cache.initTextureStage=ci.effectsReady}if(r)if(h||t.fade&&13!=t.fade.preset||t instanceof _t&&t.opacity<1){const e=t.animationTransform?t.animationTransform.transformVector(x.One.scale(Math.sqrt(2)/2)).length():1,r=Math.max(.1,$t*e);if((!l.cache.spriteTexture||l.cache.spriteTexture.tag!=t.changeTracker.currentUniqueId||l.cache.spriteQuality<r)&&(l.cache.spriteTexture&&(this.fixedMemoryLeakAmounts.recreatingSprites+=l.cache.spriteTexture.memoryUsage),null===(a=l.cache.spriteTexture)||void 0===a||a.release(),l.cache.spriteTexture=h?function(e,t,r,i){const n=e.getGraphicsProcessor();if(!n)return void L.Error(572867290,"failed to get graphicsProcessor");const s=e.ensureRenderNode(t),o=Tt(t,!0,31,31,t.transform.toInverseMatrix3().multiply(S.Scale2D(t.transform.scale))),a=sn(t),l=e.createTextureRasterizedItem("RasterizeFor3D/Item",t,24,s.cache.spriteTexture,void 0,0,0,1,i,1),c=s.cache.glowTexture||s.cache.shadowTexture||s.cache.reflectionTexture?e.createTextureRasterizedItem("RasterizeFor3D/Effects",t,31,s.cache.spriteTexture,void 0,0,0,8,i,1):void 0,h=s.cache.getBevelDistanceField();let u;if(o&&a&&l&&(null==h?void 0:h.texture)){const s=Math.min(i,Yt/o.size.x,Yt/o.size.y),d=new x(Math.min(Yt,Math.ceil(o.size.x*s)),Math.min(Yt,Math.ceil(o.size.y*s)));u=new nr("rasterized3D",e,d,1),u.tag=t.changeTracker.currentUniqueId,u.contentLocation={logicalCenter:a.center.subtract(o.leftTop).scale(s),logicalSize:a.size.scale(s),physicalCenter:u.size.scale(.5),physicalSize:u.size,rotation:0,flipX:!1,flipY:!1};const p=u.tryGetBabylonTextureForRenderToTexture(n);if(p){let i,s=x.Zero;t instanceof yt&&t.shape3D&&t.shape3D.topBevel&&(i=function(e,t,r,i){function n(e,t,r){for(let i=Math.floor(t.x);i<=Math.floor(r.x);i++)i>=0&&i<e.length&&(e[i]=Math.max(e[i],t.y+(i-t.x)*(r.y-t.y)/(r.x-t.x)))}const s=new Array(t);s.fill(0),r.forEachSegment(((e,t,r)=>{if(t){const i=Math.max(8,r.x-e.x);for(let o=0;o<i;o++)n(s,x.InterpolateQuadratic(e,t,r,o/i),x.InterpolateQuadratic(e,t,r,(o+1)/i))}else n(s,e,r);return!0}),S.Scale2D(i));const o=new Float32Array(768);for(let e=0;e<t;e++)o[3*e]=o[3*e+1]=o[3*e+2]=s[e];return ir.CreateFromByteBuffer("PathProfile",e,new x(t,1),o,4,4,!0)}(e,256,t.shape3D.topBevel.profile,new x(255,1)),s=t.shape3D.topBevel.size);const o=n.activateShaderProgram(7);o.begin(p,ge.Transparent,!0),c&&hn(n,o,c,void 0,void 0,u.size,u.contentLocation.logicalSize,u.contentLocation.logicalCenter,x.Zero,0,void 0,void 0,ge.Transparent,0),hn(n,o,l,h,i,u.size,u.contentLocation.logicalSize,u.contentLocation.logicalCenter,s,t instanceof yt?t.style.pen.lineWidth:0,r,t instanceof yt&&t.shape3D?t.shape3D.material:void 0,t instanceof yt&&t.shape3D&&t.shape3D.contourColor?t.shape3D.contourColor:ge.Transparent,t instanceof yt&&t.shape3D?t.shape3D.adjustedContourWidth:0),o.end(),i&&i.release()}else L.Error(572867291,"failed to get textureTarget")}else L.Error(572867292,"failed to get textures for 3D rendering");return l&&l.release(),c&&c.release(),u}(this,t,c.scene3D,r):this.createTextureRasterizedItem("SpriteCache",t,31,l.cache.spriteTexture,void 0,0,0,1,r,1),l.cache.spriteTexture&&(l.cache.spriteTexture.tag=t.changeTracker.currentUniqueId,l.cache.spriteQuality=r),this.initOutOfTime()))return!1}else null===(o=l.cache.spriteTexture)||void 0===o||o.release(),l.cache.spriteTexture=void 0,l.cache.spriteQuality=0;return!0}tryPreparePaths(e){for(const t of e)if(this.ensurePathRenderData(t).refreshCachedTapeBuffers(t),this.initOutOfTime())return!1;return!0}tryPrepareGeneratedShapes(e){const t=this;return vt(e,(e=>(Pt(e),!t.initOutOfTime())))}tryPrepareTapes(e){const t=this;return vt(e,(e=>{if(e.paths){if(!t.tryPreparePaths(e.paths))return!1;if(e.shapeBoundsCache&&e.shapeBoundsCache.geometryVersion==e.geometryTracker.version||(e.shapeBoundsCache={geometryVersion:e.geometryTracker.version}),e.shapeBoundsCache.pathsBounds||e.style.hasLine||(e.shapeBoundsCache.pathsBounds=Z(e.paths)),t.initOutOfTime())return!1}return!0}))}tryPrepareItemInWebGlScope(e,t,r,i){const n=performance.now();if(this.m_initDeadline=i?n+i:void 0,t&&!t.tryPrepareProgramResourcesInWebGlScope(this.m_initDeadline))return!1;if(!this.tryPrepareGeneratedShapes(e))return!1;if(!this.tryPrepareTapes(e))return!1;if(t){let i=!1;return function(e,t){if(!er)return;if(!e.getGraphicsProcessor())return;const r=performance.now();Ur!=ce&&(Nr(),Ur=ce);let i=Lr;var n;Lr=void 0,i||(i=[]),n=e=>(function(e){const t=Dr(e.glyphCacheId);if(!t||null!=kr[t])return;const r=new O(e,P.Identity),i=Z([r]);if(!i)return;0!=Or.length&&256!=Or[Or.length-1].length||Or.push([]);const n=Or.length-1,s=Or[n],o=i.size,a=zr()/Math.max(4096,Math.max(o.x,o.y)),l=new x(a,a),c=s.length,h=.5+c%16,u=.5+(c-h)/16,d=i.center.scale(-a).add(new x(h*Gr(),u*Gr())),p=P.fromScaleAndTranslation(l,d),f={page:n,scale:a,offset:d,bounds:i.multiply(l).translate(d).inflate(Hr()),path:new O(r,p),ready:!1};s.push(f),kr[t]=f}(e),!0),vt(t,(e=>{for(const t of e.paths||[])if(!n(t))return!1;return!0}));for(let t=0;t<Or.length;t++){let r=!0,n=t<i.length?i[t]:void 0;if(n)n.texture&&n.texture.isValid(e)||(L.Error(592525085,"invalid glyph table texture. recreating."),r=!1);else{for(;i.length<t+1;)i.push(new Fr("DistanceField/glyphPage",e,void 0,1,0,0,1,!1));n=i[t],n.contentBoundsOverride=new E(0,0,Vr(),Vr()),n.paddingOverride=8,n.qualityOverride=1,n.isGlyphCache=!0,r=!1}let s=!1;r&&(s=Zr(e,t,n,!0)),s||Zr(e,t,n,!1)}Lr=i,e.getCurrentFramePerformanceSummary().distanceFieldForGlyphTableCostMs+=performance.now()-r}(this,e),this.initOutOfTime()||(i=this.tryInitTextures(t,e,r,void 0,0)),i}return!0}tryPrepareItem(e,t,r){if(!this.isValid())return L.Message(512297152,"renderer context not valid in tryPrepareItem"),!1;const i=this.m_graphicsProcessor;if(!i)return L.Error(592525136,"glContext must be provided"),!1;if(this.updateSettingsBeforeRender(),!i.beginRenderScope())return!1;const n=this.tryPrepareItemInWebGlScope(e,i,t,r);return i.endRenderScope(),n}drawItem(e,t,r,i,n,s,o,a,l,c,h,u,d){var p,f,g,m,y,_,v;const b=r.instances||gt.DefaultArray;for(let w of b){let b=r;if(r instanceof _t&&void 0!==w.groupIndex&&r.items.length>0){const e=w.groupIndex;e>=0&&e<r.items.length?b=r.items.getAt(e):(b=void 0,L.Error(509617671,`Instance index out of range: ${e}, count: ${r.items.length}`))}if(b){const r=null!==(p=w.transform.toMatrix3().multiply(n))&&void 0!==p?p:n,T={opacity:null!==(g=null!==(f=w.opacity)&&void 0!==f?f:null==d?void 0:d.opacity)&&void 0!==g?g:1,colorMatrix:null!==(y=null!==(m=w.colorMatrix)&&void 0!==m?m:null==d?void 0:d.colorMatrix)&&void 0!==y?y:void 0,colorOffset:null!==(v=null!==(_=w.colorOffset)&&void 0!==_?_:null==d?void 0:d.colorOffset)&&void 0!==v?v:void 0};this.drawItemOnce(e,t,b,i,r,s,o,a,l,c,h,u,T)}}}drawItemOnce(e,t,r,i,n,s,o,a,l,c,h,u,d){var p,f,g,m;const y=0==a||7==a,_=s||r.animationTransform,v=r instanceof yt?3==r.role?"text":"shape":"group",b=y&&_?n.multiply(_.multiply(o)):n.multiply(o);if(!this.m_graphicsProcessor||r.isHidden||h&&h.filter&&!h.filter(r))return;this.m_graphicsProcessor.setScissorRect(null==u?void 0:u.inflateToInteger(),!0);const w=this.ensureRenderNode(r);let T=null===(p=w.cache)||void 0===p?void 0:p.fade,C=null!==(g=null===(f=w.cache)||void 0===f?void 0:f.fadeMode)&&void 0!==g?g:0;const M=(null!==(m=null==d?void 0:d.opacity)&&void 0!==m?m:1)*(r instanceof _t?r.opacity:1),R=sn(r);let A;if(r instanceof yt&&r.clipBounds&&R&&(A=r.getBounds(),A=A?A.transformedBounds(r.transform.toInverseMatrix3()):void 0,A=A?r.clipBounds.clip(A):void 0,A=A?A.translate(R.center.negate()):void 0),y&&w.cache.spriteTexture){if(R){const e=new vr(w.cache.spriteTexture,rr(R,r.transform));e.fadeInfo=y&&T?{fade:T,fadeTexture:w.cache.fadeTexture,fadeMode:C}:void 0,e.localClipRect=A,e.clientObject=w.cache,e.overallOpacity=M,e.colorMatrix=null==d?void 0:d.colorMatrix,e.colorOffset=null==d?void 0:d.colorOffset;const n=performance.now();Pr(this.m_graphicsProcessor,e,t,i,b,l?l.color:void 0),this.onLayerRendered(v,"SpriteCache",n,e)}}else{if(0!=e&&r.effects&&(r.effects.glow||r.effects.shadow||r.effects.reflection)&&0==ae&&7!=a&&(!h||!h.textRange)&&R){const n=R.center.transformPoint(r.transform);let s;if(4&e&&r.effects.reflection||2&e&&r.effects.shadow){const e=new P(n.negate(),x.One,r.effects.direction,n);s=r.effectsBoundsOverride?r.effectsBoundsOverride.transformedBounds(e):Tt(r,!1,0,1,e.toMatrix3())}const o=R?rr(R,r.transform):void 0,a=o?new P(x.Zero,x.Flip(o.flipX,o.flipY),o.rotation+r.effects.direction,o.center):void 0,c=a?a.toInverseMatrix3():void 0;if(4&e&&r.effects.reflection&&w.cache.reflectionTexture&&s&&R&&o&&a&&c){let e=r.effects.reflection,n=s.bottom+e.distance/2;r instanceof yt&&r.textEffectMetrics&&(n-=r.textEffectMetrics.descent);const h=S.Translation2D(new x(0,-n)).multiply(S.Scale2D(new x(1,-1))).multiply(S.Translation2D(new x(0,n)));let u=new x(s.center.x,n),p=new x(s.center.x,n+s.height);const f={opacity0:e.startAlpha,opacity1:e.endAlpha,pos0:x.InterpolateLinear(u,p,e.startPosition).transformPoint(c),pos1:x.InterpolateLinear(u,p,e.endPosition).transformPoint(c)},g=new vr(w.cache.reflectionTexture,o);g.fadeInfo=y&&T?{fade:T,fadeTexture:w.cache.fadeTexture,fadeMode:C}:void 0,g.effectTransform=S.FromTransforms(a,h,c),g.localClipRect=A,g.reflectionGradient=f,g.clientObject=w.cache,g.overallOpacity=M,g.colorMatrix=null==d?void 0:d.colorMatrix,g.colorOffset=null==d?void 0:d.colorOffset;const m=performance.now();Pr(this.m_graphicsProcessor,g,t,i,b,l?l.color:void 0),this.onLayerRendered(v,"Reflection",m,g)}if(2&e&&r.effects.shadow&&w.cache.shadowTexture&&s&&R&&o&&a&&c){const e=Ct(r.effects.shadow.alignment,s),n=St(r.effects.shadow.angle,r.effects.shadow.distance,r.effects.shadow.scale,r.effects.shadow.skew,e),h=new vr(w.cache.shadowTexture,o);h.fadeInfo=y&&T?{fade:T,fadeTexture:w.cache.fadeTexture,fadeMode:C}:void 0,h.effectTransform=S.FromTransforms(a,n,c),h.localClipRect=A,h.clientObject=w.cache,h.overallOpacity=M,h.colorMatrix=null==d?void 0:d.colorMatrix,h.colorOffset=null==d?void 0:d.colorOffset;const u=performance.now();Pr(this.m_graphicsProcessor,h,t,i,b,l?l.color:void 0),this.onLayerRendered(v,"Shadow",u,h)}if(1&e&&r.effects.glow&&w.cache.glowTexture&&R&&o&&a&&c){const e=new vr(w.cache.glowTexture,o);e.fadeInfo=y&&T?{fade:T,fadeTexture:w.cache.fadeTexture,fadeMode:C}:void 0,e.localClipRect=A,e.clientObject=w.cache,e.overallOpacity=M,e.colorMatrix=null==d?void 0:d.colorMatrix,e.colorOffset=null==d?void 0:d.colorOffset;const r=performance.now();Pr(this.m_graphicsProcessor,e,t,i,b,l?l.color:void 0),this.onLayerRendered(v,"Glow",r,e)}}if(8!=a)if(1==r.getType()){const s=r;if(!h||!h.textRange)if(s.isSolidRect())gi(this,w.cache,void 0,e,t,s,i,b,a,l?l.color:void 0,A,M,null==d?void 0:d.colorMatrix,null==d?void 0:d.colorOffset);else for(const r of w.cache.distanceFields||[])r.isDisplacementMap||gi(this,w.cache,r,e,t,s,i,b,a,l?l.color:void 0,A,M,null==d?void 0:d.colorMatrix,null==d?void 0:d.colorOffset);if(s.text&&s.text.cache&&(!h||!h.noSubtree||h.textRange)){const e=new P(x.Zero,x.One,s.transform.rotation,s.transform.translation),r=e.toMatrix3().multiply(n),p=s.text.animationProps?void 0:_,f=o;if(l)for(const e of s.text.cache.hitTestLineShapes||[])(!h||!h.textRange||e.textRange&&h.textRange.includes(e.textRange.start))&&this.drawItem(31,t,e,i,r,p,f,a,l,c,void 0,u,d);else if(0==s.text.renderMode){for(const e of s.text.cache.textShapes||[])(!h||!h.textRange||e.textRange&&h.textRange.includes(e.textRange.start))&&this.drawItem(31,t,e,i,r,p,f,a,l,c,void 0,u,d);if(0==a)for(const e of s.text.cache.selectionShapes||[])this.drawItem(31,t,e,i,r,p,f,a,l,c,void 0,u,d)}}}else if(2==r.getType()&&(!h||!h.noSubtree&&!h.textRange)){const e=r;if(e)for(let r=0;r<e.items.length;r++){const s=e.items.getAt(r);{l&&l.next();const r=e.transform.toMatrix3().multiply(n),p=_,f=o;let g=u,m=!1;if(e.clipBounds){let t=u||new E(0,0,i.x,i.y);const n=p?S.FromTransforms(r,p,f):r.multiply(f),s=null==n?void 0:n.inverse(),o=s?t.transformedBounds(s):void 0,a=o?e.clipBounds.clip(o):void 0,l=null==a?void 0:a.transformedBounds(n);g=l?E.IntersectRect(l,t):void 0,m=null==g}m||this.drawItem(31,t,s,i,r,p,f,a,l,c,h,g,d)}}}}}renderToTexture(e,t,r,i,n,s,o,a,l){n&&n.size.equals(s)||(n=new nr(e,this,s,l));const c=t.activateShaderProgram(1);c.begin(n.tryGetBabylonTextureForRenderToTexture(t),ge.Transparent,!0);const h={noSubtree:(3==a||4==a)&&r instanceof yt};return this.drawItemOnce(i,c,r,s,S.Identity,void 0,o.toMatrix3(),a,void 0,!1,h,void 0,void 0),c.end(),n}drawTextureToTexture(e,t,r,i){const n=this.m_graphicsProcessor;if(!n)throw L.Error(592525137,"No Graphics Processor");const s=0==r?5:5==r?8:6,o=n.isInRenderScope();if(!o&&!n.beginRenderScope())throw L.Error(591541203,"Failed to begin RenderScope");{const a=n.activateShaderProgram(s);a.begin(e.tryGetBabylonTextureForRenderToTexture(n),ge.Transparent,!0),cr(n,a,t,[new E(0,0,t.size.x,t.size.y)],[new E(0,0,e.size.x,e.size.y)],e.size,r,1,void 0,i),a.end(),o||n.endRenderScope()}}createTextureRasterizedItem(e,t,r,i,n,s,o,a,l,c){const h=this.m_graphicsProcessor;if(!h)throw L.Error(591541204,"No Graphics Processor");l<=0&&L.Error(509698625,`Quality is ${l}`);const u=performance.now(),d=4==a,p=!d&&s?l*Math.min(1,4/Math.sqrt(s)):l,f=!!(4&o),g=!!(24&o),m=!(2==t.getType()&&t.isDocumentShape);let y=Tt(t,f||m&&!g,r,31,t.transform.toInverseMatrix3().multiply(S.Scale2D(t.transform.scale)));if(!y)return;y=y.inflate(Math.max(2/p,s));const _=y.size,v=y.center.divide(t.transform.scale).transformPoint(t.transform);if(!_||!v)return;const b=Math.min(p,Jt/Math.max(_.x,_.y)),w=_.scale(b),T=s||n,C=new x(B(T?R(w.x):w.x,16,Jt),B(T?R(w.y):w.y,16,Jt)),M=Math.min(b,Math.min(C.x/_.x,C.y/_.y)),A=new P(v.negate(),new x(M,M),-t.transform.rotation,new x(C.x/2,C.y/2)),I=sn(t);if(!I)return;if(d){const o=this.renderToTexture(e,h,t,r,void 0,C,A,a,0);i=function(e,t,r,i,n,s){const o=r.size,a=new Array(32),l=new Array(32);for(let e=0;e<32;e++){const t=2*Math.PI*e/32,r=new x(Math.cos(t)*i,Math.sin(t)*i);a[e]=new E(0,0,o.x,o.y),l[e]=new E(0+r.x,r.y,o.x+r.x,o.y+r.y)}const c=new nr("SharpGlow",e,o,s),h=t.activateShaderProgram(6);return h.begin(c.tryGetBabylonTextureForRenderToTexture(t),ge.Transparent,!0),cr(t,h,r,a,l,o,0,1,n),h.end(),c}(this,h,o,s*M,n||ge.Black,c),o.release()}else i=this.renderToTexture(e,h,t,r,i,C,A,a,c),T&&(i.generateMipMap(),function(e,t,r,i,n,s){const o=e.getGraphicsProcessor();if(!o)return void L.Error(592525249,"No GraphicsProcessor");const a=e.ensureScratchBuffers(),l=a[0],c=a[1],h=1==i?.12*r:16==i?.47*r:r,u=1==i?.3*r:r,d=1==i?3:16==i?2:n?1:0,p=n?1:0,f=1!=i&&16!=i;gr(o,c.size.divide(t.size),t,c,n?ge.Black:void 0,h,d,new x(1,0),f,s),gr(o,x.One,c,l,n?ge.Black:void 0,h,d,new x(0,1),f,void 0),gr(o,x.One,l,c,n?ge.Black:void 0,u,p,new x(1,0),!0,void 0),gr(o,t.size.divide(l.size),c,t,n,u,p,new x(0,1),!0,void 0)}(this,i,s*M,o,n,this.ensureRenderNode(t).cache));i.contentLocation={logicalCenter:I.center.transformPoint(t.transform).transformPoint(A),logicalSize:I.size.multiply(t.transform.scale).scale(M),physicalCenter:i.size.scale(.5),physicalSize:_.scale(M),rotation:0,flipX:!1,flipY:!1};const F=performance.now()-u;return 6==a||3==a||4==a||2==a||5==a?this.m_currentFramePerformanceSummary.effectsCostMs+=F:1==a&&(this.m_currentFramePerformanceSummary.cacheToSpriteCostMs+=F),i.renderCost=F,i}preCompileShaderAsync(e){this.m_graphicsProcessor?this.m_graphicsProcessor.preCompileShaderAsync(e):L.Error(592525138,"Graphics Processor not initialized")}preLinkShaderAsync(e){this.m_graphicsProcessor?this.m_graphicsProcessor.preLinkShaderAsync(e):L.Error(592525139,"Graphics Processor not initialized")}getDebugString(e){return this.m_debugStringProvider?e instanceof mt?this.m_debugStringProvider.getDebugStringForItem(e,this):e instanceof Lt?this.m_debugStringProvider.getDebugStringForMorph(e,this):"unsupported object":"no debug string provider"}getTexturesUsedByObject(e,t){if(e instanceof ir&&t.push(e),e instanceof mt){const r=e.getBrushImages();t.push(...r.map((e=>this.ensureImageRenderData(e).texture))),this.getTexturesUsedItemCacheGL(e,t)}if(e instanceof Lt)for(let r of e.elements)for(let e of r.keyFrames)if(e){const r=this.ensureMorphKeyFrameRenderData(e);r.texture&&t.push(r.texture),r.textureDeltaWhite&&t.push(r.textureDeltaWhite),r.texturePicture&&t.push(r.texturePicture)}}getTexturesUsedItemCacheGL(e,t){const r=this.ensureRenderNode(e).cache;if(t.push(...r.getFulltextureList()),e instanceof _t)for(let r of e.items.elements)this.getTexturesUsedItemCacheGL(r,t);if(e instanceof yt&&e.text&&e.text.cache){for(const r of e.text.cache.getTextShapes())this.getTexturesUsedItemCacheGL(r,t);for(const r of e.text.cache.getSelectionShapes())this.getTexturesUsedItemCacheGL(r,t)}}getAllocatedTextures(e){const t=new Array;for(let r of e||[])this.getTexturesUsedByObject(r,t);return this.getTextureManager().allocatedTextures.filter((e=>!t.includes(e)))}getAllocatedTexturesDebugTable(e,t){const r=this.getAllocatedTextures(t),i=[],n=["✅ Valid","❌ Empty","⚠️ Sneaky","⁉️ WrongR","⁉️ WrongC"],s=["Keep","Dispose","External"];for(let t of r){const r=t.lastUsage?performance.now()-t.lastUsage:void 0,o=t.lastRenderTime?performance.now()-t.lastRenderTime:void 0,a=t.scenario,l=n[t.getState(this)],c=s[t.releasePolicy],h=t.size.x,u=t.size.y,d=t.memoryUsage,p=t.renderCost;let f="[ ";if(t.usageRecord.length>0)for(let r=0;r<t.usageRecord.length;r++){const i=t.usageRecord[r];f+=0==r?"":", ",f+='{"id":"'+nn(i.clientObject,e)+'", "scenario":"'+i.lastScenario+'", "lastRead":'+(performance.now()-i.lastUsage)+"}"}f+="]",i.push({lastRead:r,lastWrite:o,scenario:a,state:l,policy:c,width:h,height:u,memory:d,cost:p,clients:f})}return i}enableVerboseRenderLogging(e){this.m_verboseRenderLogging=e}isVerboseRenderLoggingEnabled(){return this.m_verboseRenderLogging}onLayerRendered(e,t,r,i){const n=Math.ceil(i.contentSize.x)*Math.ceil(i.contentSize.y);if(this.getCurrentFramePerformanceSummary().pixelCountShapeRender+=n,"text"==e&&this.getCurrentFramePerformanceSummary().shapeLayerCountText++,this.isVerboseRenderLoggingEnabled()){const i=un(performance.now()-r);L.Message(529077968,`RenderBatch ${e} layer ${t} rendered ${n} pixels, cost ${i}ms`)}}testRenderFidelity(){const e=new yt([O.CreateFromFigure(new V([0,10,1,10,0,1,10,10,1]))],new Se(new _e(ge.Blue))),t=new yt([O.CreateFromFigure(new V([0,0,1,0,10,1,10,10,1]))],new Se(new _e(ge.Red))),r=new yt([O.CreateFromFigure(new V([0,10,1,5,5,1,10,10,1]))],new Se(new _e(new ge(1,1,0,.5)))),i=new _t([e,t,r]),n=new nr("RenderTest",this,new x(9,9),0);this.render(i,ge.Green,{target:n});const s=n.tryConvertToBufferRGBA();if(n.release(),s){const e=[{x:1,y:4,r:255,g:0,b:0,a:255,tolerence:1},{x:4,y:1,r:0,g:255,b:0,a:255,tolerence:1},{x:7,y:4,r:0,g:0,b:255,a:255,tolerence:1},{x:4,y:7,r:255,g:128,b:0,a:255,tolerence:2}];for(let t of e){const e=4*(t.x+9*(8-t.y));if(Math.abs(s[e]-t.r)>t.tolerence||Math.abs(s[e+1]-t.g)>t.tolerence||Math.abs(s[e+2]-t.b)>t.tolerence||Math.abs(s[e+3]-t.a)>t.tolerence)return!1}}return!0}}function nn(e,t){if(!e)return;const r=e&&e.constructor?e.constructor.name:void 0,i=t.split(".");let n=e;for(let e of i)n=n?n[e]:void 0;return(r||"")+(n?" "+n:"")}function sn(e){return 1==e.getType()?wt(e,!1):Tt(e,!1,0,0,e.transform.toInverseMatrix3())}function on(e){return e?e.memoryUsage:0}function an(e,t){e&&(e instanceof nr&&e.tag?t.otherBrushes+=on(e):2!=e.releasePolicy?t.managedImages+=on(e):t.externalImages+=on(e))}function ln(e,t,r,i=!1){var n;const s=e.ensureRenderNode(t);if(s.cache){for(let e of s.cache.distanceFields||[])e.texture&&(i?r.textDistanceFields+=on(e.texture):r.shapeDistanceFields+=on(e.texture));an(s.cache.resolvedFillTexture,r),an(s.cache.resolvedLineTexture,r),an(s.cache.resolvedPictureTexture,r),r.effects+=on(s.cache.innerShadowTexture),r.effects+=on(s.cache.softEdgesTexture),r.effects+=on(s.cache.glowTexture),r.effects+=on(s.cache.shadowTexture),r.effects+=on(s.cache.reflectionTexture),r.fadeMasks+=on(s.cache.fadeTexture),r.rasterizedItems+=on(s.cache.spriteTexture)}if(t instanceof yt&&(null===(n=t.text)||void 0===n?void 0:n.cache)){const i=t.text.cache;i.textShapes.forEach((t=>{ln(e,t,r,!0)})),i.hitTestLineShapes.forEach((t=>{ln(e,t,r,!0)})),i.selectionShapes&&i.selectionShapes.forEach((t=>{ln(e,t,r,!0)}))}t instanceof _t&&t.items.elements.forEach((t=>{ln(e,t,r)}))}function cn(e,t,r){for(let i of t.elements)for(let t of i.keyFrames)if(t){const i=e.ensureMorphKeyFrameRenderData(t);i.texture&&(r.morphTextures+=on(i.texture))}}function hn(e,t,r,i,n,s,o,a,l,c,h,u,d,p){const f=i?i.texture:void 0,g=S.ScaleTranslation2D(s,s.scale(.5).subtract(a)),m=g,y=S.Translation2D(a),_=g.multiply(mr(r,o)),v=f?g.multiply(mr(f,o)):S.Identity,b=t.getBabylonEffect();b.setMatrix3x3("u_0",m.m),b.setMatrix3x3("u_1",y.m),b.setMatrix3x3("u_2",_.m),b.setMatrix3x3("u_3",v.m),b.setVector2("u_4",s),b.setInt("ufrag_0",i?1:0),b.setVector2("ufrag_1",i?i.size.inverse().scale(i.contentQuality):x.Zero),b.setFloat("ufrag_2",i?2*i.distRangeSize:0),b.setFloat("ufrag_3",i?-i.distRangeSize+.5*c:0),b.setVector2("ufrag_4",l);const w=new Array(16);w.fill(0);const T=new Array(12);T.fill(0);const C=new Array(16);if(C.fill(0),h)for(let e=0;e<Math.min(h.lights.length,4);e++){const t=h.lights[e],r=Math.sqrt(t.direction.x*t.direction.x+t.direction.y*t.direction.y+t.direction.z*t.direction.z);w[4*e]=Math.abs(t.color.r),w[4*e+1]=Math.abs(t.color.g),w[4*e+2]=Math.abs(t.color.b),w[4*e+3]=Math.abs(t.color.a),T[3*e]=t.direction.x/r,T[3*e+1]=t.direction.y/r,T[3*e+2]=t.direction.z/r,C[4*e]=t.wrapScale,C[4*e+1]=t.wrapOffset,C[4*e+2]=t.diffuse,C[4*e+3]=t.specular}b.setDirectColor4("ufrag_5",h?h.ambientColor:ge.Black),b.setArray4("ufrag_6",w),b.setArray3("ufrag_7",T),b.setArray4("ufrag_8",C),b.setDirectColor4("ufrag_9",u?u.diffuseColor:ge.Black),b.setDirectColor4("ufrag_10",u?u.specularColor:ge.Black),b.setDirectColor4("ufrag_11",u?u.ambientColor:ge.Black),b.setDirectColor4("ufrag_12",u?u.emissiveColor:ge.Black),u?b.setFloat4("ufrag_13",u.specularPower,u.useBlinnHighlight?1:0,u.diffuseFresnel,u.alphaFresnel):b.setFloat4("ufrag_13",0,0,0,0),b.setInt("ufrag_14",u?u.materialType:0),b.setFloat("ufrag_15",p),b.setDirectColor4("ufrag_16",d);const P=y?y.transformVector(x.One.scale(Math.sqrt(2)/2)).length():1;b.setFloat("ufrag_17",1/P),t.setTexture("t_0",r.tryUseBabylonTexture(e,void 0,"draw3D:T")),t.setTexture("t_1",f?f.tryUseBabylonTexture(e,void 0,"draw3D:D"):void 0),t.setTexture("t_2",n?n.tryUseBabylonTexture(e,void 0,"draw3D:P"):void 0),t.drawQuadInstances(1)}function un(e){return Math.round(1e3*(e+100*Number.EPSILON))/1e3}class dn{constructor(e){this.webGLRestoreToDefault=!1,this.old=new Array(57),this.old_VERTEX_ATTRIB_ARRAY_ENABLED=new Array(2),this.webGLRestoreToDefault=e}init(e){this.gl&&L.Error(591663577,"Previous Init has not been Restored");const t=[e.ACTIVE_TEXTURE,e.ARRAY_BUFFER_BINDING,e.BLEND,e.BLEND_COLOR,e.BLEND_DST_ALPHA,e.BLEND_DST_RGB,e.BLEND_EQUATION_ALPHA,e.BLEND_EQUATION_RGB,e.BLEND_SRC_ALPHA,e.BLEND_SRC_RGB,e.COLOR_CLEAR_VALUE,e.COLOR_WRITEMASK,e.CULL_FACE,e.CULL_FACE_MODE,e.CURRENT_PROGRAM,e.DEPTH_CLEAR_VALUE,e.DEPTH_FUNC,e.DEPTH_RANGE,e.DEPTH_TEST,e.DEPTH_WRITEMASK,e.DITHER,e.ELEMENT_ARRAY_BUFFER_BINDING,e.FRAMEBUFFER_BINDING,e.FRONT_FACE,e.GENERATE_MIPMAP_HINT,e.LINE_WIDTH,e.PACK_ALIGNMENT,e.POLYGON_OFFSET_FACTOR,e.POLYGON_OFFSET_FILL,e.POLYGON_OFFSET_UNITS,e.RENDERBUFFER_BINDING,e.SAMPLE_COVERAGE_INVERT,e.SAMPLE_COVERAGE_VALUE,e.SCISSOR_BOX,e.SCISSOR_TEST,e.STENCIL_BACK_FAIL,e.STENCIL_BACK_FUNC,e.STENCIL_BACK_PASS_DEPTH_FAIL,e.STENCIL_BACK_PASS_DEPTH_PASS,e.STENCIL_BACK_REF,e.STENCIL_BACK_VALUE_MASK,e.STENCIL_BACK_WRITEMASK,e.STENCIL_CLEAR_VALUE,e.STENCIL_FAIL,e.STENCIL_FUNC,e.STENCIL_PASS_DEPTH_FAIL,e.STENCIL_PASS_DEPTH_PASS,e.STENCIL_REF,e.STENCIL_TEST,e.STENCIL_VALUE_MASK,e.STENCIL_WRITEMASK,e.TEXTURE_BINDING_2D,e.TEXTURE_BINDING_CUBE_MAP,e.UNPACK_ALIGNMENT,e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.UNPACK_FLIP_Y_WEBGL,e.UNPACK_PREMULTIPLY_ALPHA_WEBGL];if(this.gl=e,this.old_VIEWPORT=e.getParameter(e.VIEWPORT),!this.webGLRestoreToDefault){for(let r=0;r<57;r++)this.old[r]=e.getParameter(t[r]);for(let t=0;t<2;t++)this.old_VERTEX_ATTRIB_ARRAY_ENABLED[t]=e.getVertexAttrib(t,e.VERTEX_ATTRIB_ARRAY_ENABLED)}}setDefaults(){const e=this.gl;if(e){e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.disable(e.CULL_FACE),e.cullFace(e.BACK),e.useProgram(null),e.clearDepth(1),e.depthFunc(e.LESS),e.depthRange(0,1),e.disable(e.DEPTH_TEST),e.depthMask(!0),e.disable(e.DITHER),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.polygonOffset(0,0),e.disable(e.POLYGON_OFFSET_FILL),e.bindRenderbuffer(e.RENDERBUFFER,null),e.sampleCoverage(1,!1),e.scissor(0,0,this.old_VIEWPORT[2],this.old_VIEWPORT[3]),e.disable(e.SCISSOR_TEST),e.stencilFunc(e.ALWAYS,0,1),e.stencilMask(255),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.disable(e.STENCIL_TEST),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.viewport(this.old_VIEWPORT[0],this.old_VIEWPORT[1],this.old_VIEWPORT[2],this.old_VIEWPORT[3]);for(let t=0;t<2;t++)e.disableVertexAttribArray(t)}else L.Error(591663578,"Trying to set default without Init")}restore(){const e=this.gl;if(!e)return void L.Error(591663579,"Trying to Restore without Init");const t=this.old;if(this.webGLRestoreToDefault)this.setDefaults();else{e.activeTexture(t[0]),e.bindBuffer(e.ARRAY_BUFFER,t[1]),t[2]?e.enable(e.BLEND):e.disable(e.BLEND);const r=t[3];e.blendColor(r[0],r[1],r[2],r[3]),e.blendEquationSeparate(t[7],t[6]),e.blendFuncSeparate(t[9],t[5],t[8],t[4]);const i=t[10];e.clearColor(i[0],i[1],i[2],i[3]);const n=t[11];e.colorMask(n[0],n[1],n[2],n[3]),t[12]?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.cullFace(t[13]),e.useProgram(t[14]),e.clearDepth(t[15]),e.depthFunc(t[16]),e.depthRange(t[17][0],t[17][1]),t[18]?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(t[19]),t[20]?e.enable(e.DITHER):e.disable(e.DITHER),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t[21]),e.bindFramebuffer(e.FRAMEBUFFER,t[22]),e.frontFace(t[23]),e.hint(e.GENERATE_MIPMAP_HINT,t[24]),e.lineWidth(t[25]),e.pixelStorei(e.PACK_ALIGNMENT,t[26]),e.polygonOffset(t[27],t[29]),t[28]?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.bindRenderbuffer(e.RENDERBUFFER,t[30]),e.sampleCoverage(t[32],t[31]);const s=t[33];e.scissor(s[0],s[1],s[2],s[3]),t[34]?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFuncSeparate(e.FRONT,t[44],t[47],t[49]),e.stencilFuncSeparate(e.BACK,t[36],t[39],t[40]),e.stencilMaskSeparate(e.FRONT,t[50]),e.stencilMaskSeparate(e.BACK,t[41]),e.stencilOpSeparate(e.FRONT,t[43],t[45],t[46]),e.stencilOpSeparate(e.BACK,t[35],t[37],t[38]),e.clearStencil(t[42]),t[48]?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.bindTexture(e.TEXTURE_2D,t[51]),e.bindTexture(e.TEXTURE_CUBE_MAP,t[52]),e.pixelStorei(e.UNPACK_ALIGNMENT,t[53]),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,t[54]),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t[55]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t[56]),e.viewport(this.old_VIEWPORT[0],this.old_VIEWPORT[1],this.old_VIEWPORT[2],this.old_VIEWPORT[3]);for(let t=0;t<2;t++)this.old_VERTEX_ATTRIB_ARRAY_ENABLED[t]?e.enableVertexAttribArray(t):e.disableVertexAttribArray(t)}this.gl=void 0}}class pn{sendTraceTag(e,t,r,i){10===r?(0,b.H)(e,2503,i):(0,b.PN)(e,2503,i)}shipAssertTag(e,t,r,i){r&&(0,b.H)(e,2503,i)}debugAssertTag(e,t,r,i){r&&(0,b.H)(e,2503,i)}}class fn{get webGLContext(){return this._webGLContext}constructor(e){var t;this._isRendererReady=!1,this._webGLContextRestoredStartTime=0,this._webGLContextLostStartTime=0,this.handleContextNotRestored=()=>{this._webGLContextLostStartTime>this._webGLContextRestoredStartTime&&(0,b.H)(0,2503,"webglcontext not restored after 3seconds")},(0,b.PN)(0,2503,"ShapeBuilderContext ctor"),t=new pn,L.setLogger(t),this._shapeBuilderConfig=e,this._renderer=function(e={}){return function(e={}){return new rn(e)}(e)}({stateRestorer:(!0,new dn(!0))})}async setupWebGLContext(){const e=this.shapeBuilderConfig.webGLCanvas,t={preserveDrawingBuffer:this.shapeBuilderConfig.preserveDrawingBuffer};let r=e.getContext("webgl",t);return r=void 0!==r?r:e.getContext("experimental-webgl",t),this._webGLContext=r,this._webGLContextRestoredStartTime=performance.now(),this.preloadShaders(r)}handleContextLost(){this._webGLContextLostStartTime=performance.now(),(0,b.PN)(0,2503,"webgl context is lost."),this._isRendererReady=!1,this._renderer.onWebGLContextLost(),this._webGLContext=void 0,window.setTimeout(this.handleContextNotRestored,3e3),this._shapeBuilderConfig.webGLContextLostHandler.onWebGLContextLost()}async handleContextRestored(){this._webGLContextRestoredStartTime=performance.now();const e=this._webGLContextRestoredStartTime-this._webGLContextLostStartTime;(0,b.PN)(0,2503,`webgl context is being restored. ${e}MS`),await this.setupWebGLContext(),void 0===this._webGLContext?(0,b.H)(0,2503,"unable to restore webGLContext"):this._shapeBuilderConfig.webGLContextLostHandler.onWebGLContextRestored();const t=performance.now();(0,b.PN)(0,2503,`webglcontext restored successfully. ${t-this._webGLContextRestoredStartTime}MS`)}getScenePerformanceSummaryAsMap(){var e;const t=(null===(e=this.renderer)||void 0===e?void 0:e.getPerformanceSummary()).perfInfoCurrentFrame;return new Map(Object.entries(null!=t?t:{}))}async preloadShaders(e){void 0===e&&(0,b.H)(0,2503,"webglcontext is undefined");const t=new w("ShapeBuilderContext.preloadShaders"),r=performance.now();try{await this._renderer.initializeAsync(e),this._isRendererReady=!0}catch(e){(0,b.H)(0,2503,`exception in preloadshaders: ${e.message}`)}finally{t.setProp("shaderCompilationDurationMilliseconds",performance.now()-r),t.complete()}}get shapeBuilderConfig(){return this._shapeBuilderConfig}get renderer(){return this._renderer}get isRendererReady(){return this._isRendererReady}get activeMultiplexRenderTarget(){return this._activeMultiplexRenderTarget}set activeMultiplexRenderTarget(e){if(void 0===e)throw new Error("Cannot set an undefined render target");this._activeMultiplexRenderTarget=e}}var gn=n(4874);let mn={logKpiUsage(){},logKpiSuccess(){},logKpiFailure(){}};function yn(e){mn=e}function _n(e,t=new Map,r="gc2kpi"){mn.logKpiUsage(e,0,t,r)}var vn=n(3849);class bn{constructor(e){this.pptLogger=e}logKpiUsage(e,t,r,i){this.pptLogger.recordKpiUsage(e,t,i,r)}logKpiSuccess(e,t){this.pptLogger.recordKpiSuccess(e,t)}logKpiFailure(e,t,r,i,n){this.pptLogger.recordKpiFailure(e,t,r,i,n)}}var wn=n(4016),Tn=n(3331),xn=n(4591);class Cn{constructor(e){this.pptLogger=e}logOperation(e){this.pptLogger.logTrace(0,wn.r.Operation,Tn.G.Info,function(e){const t={name:e.name,durationMs:e.durationMs.toString()};if(void 0!==e.props)for(const r of e.props)t[r[0]]=r[1];return JSON.stringify(t)}(e))}logTrace(e){this.pptLogger.logTrace(e.id,function(e){switch(e){case 55002:default:return wn.r.General;case 55e3:return wn.r.GraphicHost;case 55001:return wn.r.Operation}}(e.category),function(e){switch(e){case 0:return Tn.G.Error;case 1:return Tn.G.Warning;case 2:return Tn.G.Info;case 3:return Tn.G.Verbose;default:(0,xn.t)(e)}}(e.level),e.message)}}let Sn=[],Pn=[];var En=n(6334),Mn=n(4952),Rn=n(1161);function An(){return[En.ACSBackgroundRemovalAnnotation.getTypeName(),Mn.CsSmartCropAnnotation.getTypeName(),Rn.ImageTransformAnnotation.getTypeName()]}class Bn{constructor(e,t,r){this.succeeded=e,this.result=t,this.error=r}}class In{constructor(e){this.supportedOpTypes=e.supportedOpTypes,this.client=e}async executeOp(e){if(!this.supportedOpTypes.includes(e.opType))return new Bn(!1,void 0,{message:`Operation ${e.opType} not supported by client`});try{return await this.client.execute(e)}catch(e){return new Bn(!1,void 0,{message:e.message})}}}function Fn(e){return new In(e)}let Dn;var Ln;!function(e){e.BlobDataUndefined="BLOB_DATA_UNDEFINED",e.GetBlobFailed="GET_BLOB_FAILED",e.SessionMangerUndefined="SESSION_MANAGER_UNDEFINED",e.SubmitSignalFailed="SUBMIT_SIGNAL_FAILED"}(Ln||(Ln={}));class kn extends Error{constructor(e,t,r){super(e),this.message=e,this.errorType=t,this.httpStatusCode=r}}function On(e,t,r){return i=>{const n=i,s=n.errorDetails;if(void 0!==s)return void t(new kn(s.message,s.errorType,s.httpStatusCode));if(void 0===n.blob||void 0===n.blob.dataPointer)return void t(new kn("Blob data is undefined",Ln.BlobDataUndefined));const o=n.blob.dataPointer.value;r.getBlob(o).then((t=>{const r=new FileReader;r.readAsDataURL(t),r.onloadend=()=>{const t=r.result;e(t)}})).catch((e=>{t(new kn(e.message,Ln.GetBlobFailed))}))}}var Un,Nn=n(5670);class Vn{constructor(e){Nn._.assign(Vn,this,e)}static getTypeName(){return"AugLoop_Image_ImageTileMetadata"}static getBaseTypes(){return[]}static typeGuard(e){return Nn._.matchesTypesFor(e,[Vn.getTypeName()])}}Vn.H_={T_:Vn.getTypeName(),B_:Vn.getBaseTypes()};class Gn{constructor(e){Nn._.assign(Gn,this,e)}static getTypeName(){return"AugLoop_Image_ImageContent"}static getBaseTypes(){return["AugLoop_Core_Blob"]}static typeGuard(e){return Nn._.matchesTypesFor(e,[Gn.getTypeName()])}}Gn.H_={T_:Gn.getTypeName(),B_:Gn.getBaseTypes()};class zn{constructor(e){Nn._.assign(zn,this,e)}static getTypeName(){return"AugLoop_Image_ImageTile"}static getBaseTypes(){return["AugLoop_Image_ImageTileMetadata"]}static typeGuard(e){return Nn._.matchesTypesFor(e,[zn.getTypeName()])}}function Hn(e){return function(e){return"image/gif"===(null==e?void 0:e.toLowerCase())}(e)||function(e){return"image/apng"===(null==e?void 0:e.toLowerCase())}(e)}function Wn(e){return"image/svg+xml"===(null==e?void 0:e.toLowerCase())}function jn(e){let t="";if("data:"===e.protocol){const r=/.*:(.*);.*/,i=e.href.substring(0,50).match(r);null!==i&&i.length>=2&&(t=i[1])}else t=e.pathname.substring(e.pathname.lastIndexOf(".")+1);return qn(t)}function qn(e){switch(null==e?void 0:e.toLowerCase()){case"image/bmp":case"bmp":return"image/bmp";case"image/gif":case"gif":return"image/gif";case"image/jpeg":case"image/jpg":case"jpeg":case"jpg":return"image/jpeg";case"image/png":case"png":return"image/png";case"image/apng":case"apng":return"image/apng";case"image/svg+xml":case"svg":return"image/svg+xml";case"image/tiff":case"tiff":return"image/tiff";default:return void(0,b.PN)(0,7,`Unknown extension or mimeType ${e}`)}}zn.H_={T_:zn.getTypeName(),B_:zn.getBaseTypes()};var Xn=new Uint8Array(16);function $n(){if(!Un&&!(Un="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Un(Xn)}const Kn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Yn=function(e){return"string"==typeof e&&Kn.test(e)};for(var Jn=[],Zn=0;Zn<256;++Zn)Jn.push((Zn+256).toString(16).substr(1));const Qn=function(e,t,r){var i=(e=e||{}).random||(e.rng||$n)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=i[n];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(Jn[e[t+0]]+Jn[e[t+1]]+Jn[e[t+2]]+Jn[e[t+3]]+"-"+Jn[e[t+4]]+Jn[e[t+5]]+"-"+Jn[e[t+6]]+Jn[e[t+7]]+"-"+Jn[e[t+8]]+Jn[e[t+9]]+"-"+Jn[e[t+10]]+Jn[e[t+11]]+Jn[e[t+12]]+Jn[e[t+13]]+Jn[e[t+14]]+Jn[e[t+15]]).toLowerCase();if(!Yn(r))throw TypeError("Stringified UUID is invalid");return r}(i)};var es,ts;!function(e){e[e.Unspecified=0]="Unspecified",e[e.Other=1]="Other",e[e.Jpg=2]="Jpg",e[e.Png=3]="Png",e[e.Bmp=4]="Bmp"}(es||(es={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.Other=1]="Other",e[e.Small=2]="Small",e[e.Medium=3]="Medium",e[e.Large=4]="Large"}(ts||(ts={}));const rs=new Map([["image/bmp",es.Bmp],["image/jpeg",es.Jpg],["image/png",es.Png]]);function is(e){var t;return void 0===e?es.Unspecified:null!==(t=rs.get(e))&&void 0!==t?t:es.Other}function ns(e,t,r){const i=e.split(",")[1],n=Uint8Array.from(atob(i),(e=>e.charCodeAt(0))),s=jn(new URL(e));return new zn({widthPx:null!=t?t:0,heightPx:null!=r?r:0,contents:[{format:is(s),size:0,id:Qn(),sizeBytes:n.length,data:n}]})}async function ss(e,t,r,i){return new Promise(((n,s)=>{e.submitBinarySignal(t,r,i(n,s,e),Qn()).catch((e=>{s(e)}))}))}function os(e,t){return r=>{const i=r,n=i.SmartCropResult,s=i.imageMetaData;void 0===i.errorDetails?void 0===n||void 0===s||void 0===n.x||void 0===n.y||void 0===n.h||void 0===n.w||void 0===s.height||void 0===s.width?t(new Error("Smart Crop Result is not valid")):e({left:n.x/s.width*100,top:n.y/s.height*100,right:(s.width-n.x-n.w)/s.width*100,bottom:(s.height-n.y-n.h)/s.height*100}):t(new Error(i.errorDetails.message))}}function as(e){return new d(e.pos.x,e.pos.y,e.pos.x+e.size.width,e.pos.y+e.size.height)}class ls{constructor(e,t,r){this.leftTop=new u(e.left,e.top),this.leftTop.rotate(t,r),this.rightBottom=new u(e.right,e.bottom),this.rightBottom.rotate(t,r),this.rotInDegrees=t}getUnRotatedAtCenterRect(){const{x:e,y:t}=this.leftTop,{x:r,y:i}=this.rightBottom,n=new u((e+r)/2,(t+i)/2),s=new u(e,t);s.rotate(-this.rotInDegrees,n);const o=new u(r,i);return o.rotate(-this.rotInDegrees,n),new d(s.x,s.y,o.x,o.y)}getRotatedRectAtPoint(e,t){return new ls(this.getUnRotatedAtCenterRect(),e,t)}}class cs{constructor(e,t,r,i){this.left=e,this.top=t,this.right=r,this.bottom=i}equals(e){return us(this.left,e.left)&&us(this.top,e.top)&&us(this.right,e.right)&&us(this.bottom,e.bottom)}getSrcRectTransformFromParent(e){const t=e.clone(),r=as(e),i=r.center(),n=this.getFlipAdjustedNormalizedSrcRect(e.flip,r),s=new ls(n,t.rot,i).getUnRotatedAtCenterRect();return t.pos.x=s.left,t.pos.y=s.top,t.size.width=s.width(),t.size.height=s.height(),t}getParentTransform(e){const t=e.clone(),r=as(e),i=this.getFlipAdjustedNormalizedParentRect(e.flip,r),n=new ls(i,t.rot,r.center()).getUnRotatedAtCenterRect();return t.pos.x=n.left,t.pos.y=n.top,t.size.width=n.width(),t.size.height=n.height(),t}isDefault(){return 0===this.left&&0===this.top&&0===this.right&&0===this.bottom}getFlipAdjustedNormalizedSrcRect(e,t){const r=t.left+t.width()*(e.x?this.right:this.left)/100,i=t.top+t.height()*(e.y?this.bottom:this.top)/100,n=t.right-t.width()*(e.x?this.left:this.right)/100,s=t.bottom-t.height()*(e.y?this.top:this.bottom)/100;return new d(r,i,n,s)}getFlipAdjustedNormalizedParentRect(e,t){const r=100*t.width()/(100-this.left-this.right),i=100*t.height()/(100-this.top-this.bottom),n=t.left-r*(e.x?this.right:this.left)/100,s=t.top-i*(e.y?this.bottom:this.top)/100,o=t.right+r*(e.x?this.left:this.right)/100,a=t.bottom+i*(e.y?this.top:this.bottom)/100;return new d(n,s,o,a)}}function hs(e,t){return void 0===t?e:t.getParentTransform(e)}function us(e,t){return Math.abs(e-t)<.01}class ds{constructor(e){this.kind=0,this.url=e}async toDataURL(){return async function(e){if("data:"===e.protocol)return e;const t=await fetch(e.href);return t.ok||(0,y._)(7,`urlToDataURL: Failed to fetch url. Response status [${t.status}] | Protocol [${e.protocol}] `),async function(e){return new Promise(((t,r)=>{const i=new FileReader;i.onload=()=>{t(new URL(i.result))},i.onerror=()=>{r(new Error("FileReader failed to read blob"))},i.readAsDataURL(e)}))}(await t.blob())}(this.url)}}class ps{constructor(e,t,r,i){this.opType=e,this.params=t,this.opParamsProcessor=r,this.opResultProcessor=i}}async function fs(e,t){return new Promise(((r,i)=>{e.onload=r,e.onerror=()=>{i("image.onerror")},e.src=t}))}async function gs(e,t,r,i,n){try{const s=document.createElement("img");await fs(s,e.href);const[o,a]=function(e,t,r){let i,n;if(t>0){if(!r)return[t,t];const s=e.naturalWidth/e.naturalHeight;[i,n]=s>1?[t,t/s]:[t*s,t]}else[i,n]=[e.naturalWidth,e.naturalHeight];return[i,n]}(s,t,r),l=function(e,t,r){const i=document.createElement("canvas");[i.width,i.height]=[t,r];const n=i.getContext("2d");return null==n||n.drawImage(e,0,0,t,r),i}(s,o,a);return ms(l,i,n)}catch(e){(0,y._)(0,`downsampleImage: Error - ${e.message}`)}}async function ms(e,t,r){return new Promise(((i,n)=>{switch(t){case 0:return void e.toBlob((e=>{null===e?n("no blob received"):i(e)}),r);case 1:const s=e.toDataURL(r);return void i(new URL(s));default:(0,y._)(0,`renderCanvasToBlob: Error - unknown outputResultRepresentation: ${t}`)}}))}async function ys(e){const t=document.createElement("canvas"),r=t.getContext("2d");if(null===r)throw new Error("getImageData: canvas context is null");const i=new Image;i.crossOrigin="",await fs(i,e.href),t.height=i.height,t.width=i.width,r.drawImage(i,0,0);const n=r.getImageData(0,0,i.width,i.height),s=n.data,o=s.length;for(let e=0;e<o;e+=4)s[e+3]=s[e];return r.putImageData(n,0,0),t}const _s="BackgroundRemoval",vs="SmartCrop",bs="SuperResolution";function ws(e){return e.opType===_s}async function Ts(e,t,r,i){let n,s;const o=await e.toDataURL();return r&&(n=async e=>Object.assign(Object.assign({},e),{picture:new ds(await gs(o,512,!1,1,"image/png"))})),i&&"RemoveBackground"===t&&(s=async e=>{const t=await async function(e,t,r,i="image/jpeg"){try{const n=document.createElement("canvas"),s=n.getContext("2d");if(null===s)throw new Error("applyBackgroudRemovedMaskToImage: canvas context is null");const o=new Image;await fs(o,e.href),n.width=o.width,n.height=o.height,s.drawImage(o,0,0,n.width,n.height);const a=await ys(t);return s.globalCompositeOperation="destination-in",s.drawImage(a,0,0,n.width,n.height),ms(n,r,i)}catch(e){(0,y._)(0,`applyBackgroudRemovedMaskToImage: Error -  ${e.message}`)}}(o,await e.picture.toDataURL(),1,"image/png");return Object.assign(Object.assign({},e),{picture:new ds(t)})}),i&&"BlurBackground"===t&&(s=async e=>{const t=await async function(e,t,r,i="image/jpeg"){try{const n=document.createElement("canvas"),s=n.getContext("2d");if(null===s)throw new Error("applyBackgroundRemovedMaskAndBlurredImageToImage: canvas context is null");const o=new Image;await fs(o,e.href),n.width=o.width,n.height=o.height,s.drawImage(o,0,0,n.width,n.height);const a=await ys(t);s.globalCompositeOperation="destination-in",s.drawImage(a,0,0,n.width,n.height);const l=function(e){const t=document.createElement("canvas"),r=t.getContext("2d");if(null===r)throw new Error("getImageData: canvas context is null");return t.width=e.width,t.height=e.height,r.filter="blur(8px)",r.drawImage(e,0,0,t.width,t.height),t}(o);return s.globalCompositeOperation="destination-over",s.drawImage(l,0,0,n.width,n.height),ms(n,r,i)}catch(e){(0,y._)(0,`applyBackgroundRemovedMaskAndBlurredImageToImage: Error -  ${e.message}`)}}(o,await e.picture.toDataURL(),1,"image/png");return Object.assign(Object.assign({},e),{picture:new ds(t)})}),new ps(_s,{picture:e,useMask:i},n,s)}class xs{constructor(){this.name="AugloopACSClient",this.supportedOpTypes=[_s,vs]}static getInstance(){return void 0===xs.instance&&(xs.instance=new xs),xs.instance}async execute(e){if(ws(e))return this.getBGRResult(e);if(function(e){return e.opType===vs}(e))return this.getSmartCropResult(e);throw new Error("Not yet implemented")}async getBGRResult(e){const r=void 0!==e.opParamsProcessor?await e.opParamsProcessor(e.params):e.params,i=await async function(e,r,i,n){const s=t();void 0===s&&(0,y._)(0,"Augloop session manager undefined");const o=ns(e,void 0,void 0);return ss(s,new En.ACSBackgroundRemovalSignal({image:o,mode:En.ModeOptions.ForegroundMatting,apiVersion:"2023-02-01-preview"}),En.ACSBackgroundRemovalAnnotation.getTypeName(),On)}((await r.picture.toDataURL()).href);return void 0===e.opResultProcessor?{succeeded:!0,result:{picture:new ds(new URL(i))}}:{succeeded:!0,result:await e.opResultProcessor({picture:new ds(new URL(i))})}}async getSmartCropResult(e){const r=void 0!==e.opParamsProcessor?await e.opParamsProcessor(e.params):e.params,i=await async function(e){const r=t();return void 0===r&&(0,y._)(0,"Augloop session manager undefined"),ss(r,ns(e),Mn.CsSmartCropAnnotation.getTypeName(),os)}((await r.picture.toDataURL()).href);return{succeeded:!0,result:{srcRect:new cs(i.left,i.top,i.right,i.bottom)}}}}function Cs(e,t,r){return i=>{const n=i;if(void 0!==n.error)return void t(new Error(n.error));if(void 0===n.blob.dataPointer)return void t(new Error("Blob data pointer is undefined"));const s=n.blob.dataPointer.value;r.getBlob(s).then((t=>{const r=new FileReader;r.readAsDataURL(t),r.onloadend=()=>{const t=r.result;e(t)}})).catch((e=>{t(e)}))}}class Ss{constructor(){this.name="AugloopIASClient",this.supportedOpTypes=[_s,bs]}static getInstance(){return void 0===Ss.instance&&(Ss.instance=new Ss),Ss.instance}async execute(e){if(ws(e))return this.getBGRResult(e);if(function(e){return e.opType===bs}(e))return this.getSuperResolutionResult(e);throw new Error("Not yet implemented")}async getBGRResult(e){const r=void 0!==e.opParamsProcessor?await e.opParamsProcessor(e.params):e.params,i=await async function(e,r=!0,i,n){const s=t();void 0===s&&(0,y._)(0,"Augloop session manager undefined");const o=ns(e,i,n);return ss(s,new Rn.ImageTransformSignal({sourceCorrelationId:Qn(),imageTile:o,scenario:Rn.ImageTransformScenario.BackgroundRemover,endpointName:"GC2",sendMaskAsResponse:r}),Rn.ImageTransformAnnotation.getTypeName(),Cs)}((await r.picture.toDataURL()).href);return void 0===e.opResultProcessor?{succeeded:!0,result:{picture:new ds(new URL(i))}}:{succeeded:!0,result:await e.opResultProcessor({picture:new ds(new URL(i))})}}async getSuperResolutionResult(e){const r=void 0!==e.opParamsProcessor?await e.opParamsProcessor(e.params):e.params,i=await async function(e,r,i){const n=t();void 0===n&&(0,y._)(0,"Augloop session manager undefined");const s=ns(e,void 0,void 0);return ss(n,new Rn.ImageTransformSignal({sourceCorrelationId:Qn(),imageTile:s,scenario:Rn.ImageTransformScenario.SuperResolution,endpointName:"GC2",sendMaskAsResponse:!1}),Rn.ImageTransformAnnotation.getTypeName(),Cs)}((await r.picture.toDataURL()).href);return void 0===e.opResultProcessor?{succeeded:!0,result:{picture:new ds(new URL(i))}}:{succeeded:!0,result:await e.opResultProcessor({picture:new ds(new URL(i))})}}}class Ps{constructor(){this.useAugloopCogSciForBGR=!0}static getInstance(){return void 0===Ps.instance&&(Ps.instance=new Ps),Ps.instance}}const Es=[[_s,()=>Fn(Ps.getInstance().useAugloopCogSciForBGR?xs.getInstance():Ss.getInstance())],[vs,()=>Fn(xs.getInstance())],[bs,()=>Fn(Ss.getInstance())]];function Ms(){var e;e=Es,void 0!==Dn?e.forEach((e=>null==Dn?void 0:Dn.set(e[0],e[1]))):Dn=new Map(e)}async function Rs(){await async function(){const e=t();if(void 0===e)throw new Error("Augloop session manager is undefined.");await Promise.all(An().map((t=>e.activateAnnotation(t))))}(),Ms()}async function As(){await async function(){const e=t();if(void 0===e)throw new Error("Augloop session manager is undefined.");await Promise.all(An().map((t=>e.deactivateAnnotation(t))))}(),Ms()}class Bs{}class Is{constructor(e=[],t=[],r=[]){this.type=Bs,this.added=e,this.removed=t,this.changed=r}}class Fs{}class Ds{constructor(e){this.type=Fs,this.modelUpdated=new l,this.graphics=[],this._backIndex=0,this.idToGraphic=new Map,this.hostContext=e}get length(){return this.graphics.length}get backIndex(){return this._backIndex}set backIndex(e){this._backIndex=e}getGraphic(e){return this.idToGraphic.get(e)}getGraphicAt(e){return this.graphics[e]}addGraphicsAt(e){const t=[];for(const[r,i]of e)this.idToGraphic.has(r.id)||(this.graphics.splice(i,0,r),this.idToGraphic.set(r.id,r),t.push(r));this.modelUpdated.emit(new Is(t))}addGraphics(e){const t=e.filter((e=>!this.idToGraphic.has(e.id)));if(!(t.length<=0)){for(const e of t)this.graphics.push(e),this.idToGraphic.set(e.id,e);this.modelUpdated.emit(new Is(t))}}removeGraphics(e){const t=e.filter((e=>this.idToGraphic.delete(e.id)));if(t.length<=0)return;const r=new Set(t);this.graphics=this.graphics.filter((e=>!r.has(e))),this.modelUpdated.emit(new Is([],t))}setGraphics(e){const t=this.graphics;this.graphics=[],this.idToGraphic.clear();for(const t of e)this.graphics.push(t),this.idToGraphic.set(t.id,t);return(t.length>0||e.length>0)&&this.modelUpdated.emit(new Is([...e],t)),t}changeGraphicOrder(e,t){const r=this.getGraphicOrder(e);if(void 0===r)return;let i;switch(t){case 0:i=Math.min(r+1,this.graphics.length-1);break;case 1:i=this.graphics.length-1;break;case 2:i=Math.max(r-1,this._backIndex);break;case 3:i=this._backIndex;break;default:(0,xn.t)(t)}return r!==i&&(this.graphics.splice(r,1),this.graphics.splice(i,0,e),this.modelUpdated.emit(new Is([],[],[e]))),r}getGraphicOrder(e){if(this.idToGraphic.has(e.id))return this.graphics.indexOf(e)}setGraphicOrder(e,t){const r=this.getGraphicOrder(e);if(void 0!==r)return r!==t&&(this.graphics.splice(r,1),this.graphics.splice(t,0,e),this.modelUpdated.emit(new Is([],[],[e]))),r}[Symbol.iterator](){return this.graphics[Symbol.iterator]()}clone(e=(e=>e.id)){const t=new Ds(this.hostContext);return t.graphics=this.graphics.map((t=>t.clone(e(t)))),t._backIndex=this._backIndex,t.graphics.forEach((e=>{t.idToGraphic.set(e.id,e)})),t}}var Ls,ks=n(2082);!function(e){e[e.Base64Image=0]="Base64Image",e[e.ShapeBuilderJson=1]="ShapeBuilderJson",e[e.ChartPlayerJson=2]="ChartPlayerJson"}(Ls||(Ls={}));class Os{get themeInfo(){return this._themeInfo}set themeInfo(e){this._themeInfo=e,this.modelHostContextUpdated.emit([0])}constructor(e){this.modelHostContextUpdated=new l,this.themeInfo=e}}class Us{}class Ns{constructor(e=new m){this.type=Us,this.anchorUpdated=new l,this._transform=e}get transform(){return this._transform}set transform(e){this._transform=e,this.anchorUpdated.emit()}setTransform(e,t){this._transform=e,this.anchorUpdated.emit(t)}clone(){const e=new Ns(this._transform.clone());return e.locks=void 0!==this.locks?Object.assign({},this.locks):void 0,e}}class Vs{constructor(){this.combinedScaleChanged=new l,this.viewTransformChanged=new l,this._zoomFactor=1,this._lastCombinedScale=1,this._lastViewTransform=new m}set zoomFactor(e){const t=e*this.deviceScaleFactor;this._zoomFactor=e,this._lastCombinedScale!==t&&(this._lastCombinedScale=t,this.combinedScaleChanged.emit())}get zoomFactor(){return this._zoomFactor}get combinedScale(){return this.zoomFactor*this.deviceScaleFactor}get deviceScaleFactor(){return 1/window.devicePixelRatio}get viewTransform(){return this._lastViewTransform}set viewTransform(e){this._lastViewTransform.equals(e)||(this._lastViewTransform=e.clone(),this.viewTransformChanged.emit())}}var Gs=n(2661);class zs extends Gs.B{createRenderDataPresenter(e,t,r){void 0===e.model.fallbackRenderData&&(0,y._)(3,"Trying to create RenderDataPresenter without fallback RenderData.");const i=this.get(e.model.fallbackRenderData.type);return void 0===i&&(0,y._)(3,`No RenderDataPresenterCreator for render data type: ${e.model.fallbackRenderData.type}`),i(e,t,r)}}class Hs{constructor(){this.viewReady=new l,this.pendingPresenters=new Set}addPending(e){const t=0===this.pendingPresenters.size;this.pendingPresenters.add(e),t&&this.viewReady.emit(!1)}removePending(e){this.pendingPresenters.delete(e),0===this.pendingPresenters.size&&this.viewReady.emit(!0)}teardown(){this.pendingPresenters.clear()}}class Ws extends Gs.B{createPresenter(e,t,r){const i=this.get(e.model.type);return void 0===i&&(0,y._)(3,`No PresenterCreator for modeltype: ${e.model.type}`),i(e,t,r)}}class js extends Gs.B{createAnchorPresenter(e){const t=this.get(e.anchor.type);return void 0===t&&(0,y._)(3,`No AnchorPresenterCreator for AnchorType: ${e.anchor.type}`),t(e)}}class qs extends Gs.o{beginRender(){for(const e of this)e.beginRender()}endRender(){for(const e of this)e.endRender()}addViewModel(e,t){var r;if(null===(r=this.filter)||void 0===r?void 0:r.filter(e))return;const i=this.get(e.type);void 0===i&&(0,y._)(3,`No registered RenderTarget for ViewModel type: ${e.type}`),i.addViewModel(e,t)}beginGroup(e){for(const t of this)t.beginGroup(e)}endGroup(){for(const e of this)e.endGroup()}hitTest(e){for(const t of this){const r=t.hitTest(e);if(void 0!==r)return r}}}class Xs extends Gs.B{createSelection(e){const t=this.get(e.model.type);if(void 0===t)throw new Error(`Can't create selection for graphic: ${e.model.type}`);return t(e)}registerForType(e,t){this.register(e,t)}}class $s extends Gs.B{createSelectionPresenter(e,t,r){const i=this.get(e.type);if(void 0===i)throw new Error(`Can't create presenter for selection: ${e.type}`);return i(e,t,r)}}class Ks{constructor(e,t=[]){this.performed=e,this.editOps=t}}class Ys extends Gs.B{constructor(){super(...arguments),this.defaultDispatcher=new Js}register(e,t){return super.register(e,t)}processKeyboardEvent(e,t,r){var i;const n=this.get(t.type);return void 0===n?{isHandled:!1}:(null!==(i=n.dispatcher)&&void 0!==i?i:this.defaultDispatcher).dispatchKeyboardEvent(e,t,r,n.keyboardShortcuts)}performAction(e,t,r){var i;const n=this.get(t.type);return void 0===n?new Ks(!1):(null!==(i=n.dispatcher)&&void 0!==i?i:this.defaultDispatcher).dispatchAction(e,t,r,n.actions)}}class Js{dispatchAction(e,t,r,i){return i.performAction(e,t,r)}dispatchKeyboardEvent(e,t,r,i){return"keydown"===e.type?i.performShortcut(e,t,r):{isHandled:!1}}}class Zs extends Gs.B{createAriaLabel(e){const t=this.get(e.model.type);if(void 0!==t)return t(e)}}class Qs{constructor(e,t,r){this.id=e,this.model=t,this.anchor=r}clone(e){return new Qs(e,this.model.clone(),this.anchor.clone())}}function eo(e){const t=[];for(const r of e){const e=r.perform().undoOp;void 0!==e&&t.push(e)}return t.reverse()}class to{}class ro{constructor(){this.type=to}}class io{constructor(e,t,r){this.onKeyboardEvent=(e,t)=>{let r=this.editContext.editorRegistry.processKeyboardEvent(e,this.selection,this.editContext).isHandled;r||void 0===this.keyboardEventProcessor||(r=this.keyboardEventProcessor(e,this.selection,this.editContext).isHandled),t.isHandled=r,t.isHandled&&(e.preventDefault(),e.stopPropagation())},this.editContext=e,this.keyboardEventProcessor=r,this.keyboardEventNotifiers=t,this.keyboardEventNotifiers.keydown.on(this.onKeyboardEvent),this.keyboardEventNotifiers.keyup.on(this.onKeyboardEvent)}teardown(){this.selection.teardown(),this.keyboardEventNotifiers.keydown.off(this.onKeyboardEvent),this.keyboardEventNotifiers.keyup.off(this.onKeyboardEvent)}performAction(e){return function(e,t,r,i){var n;const s=t.save(),o=function(e){return"acLst"===e.actionType}(e)?e.actions:[e],a=[];for(const e of o)a.push(...i(e,t,r).editOps);const l=eo(a),c=t.save();return{editOps:l,savedSelectionBefore:null!=s?s:new ro,savedSelectionAfter:null!=c?c:new ro,mergePolicy:null===(n=a[0])||void 0===n?void 0:n.mergePolicy}}(e,this.selection,this.editContext,this.editContext.editorRegistry.performAction.bind(this.editContext.editorRegistry))}performUndoEntry(e){const t={editOps:eo(e.editOps),savedSelectionBefore:e.savedSelectionAfter,savedSelectionAfter:e.savedSelectionBefore};return this.selection.restore(e.savedSelectionBefore),t}resetSelection(e){this.selection=e}}function no(e,t){e.forEach((e=>{e.addTimePoint(t)}))}class so{constructor(e,t){this.startTimeMs=0,this.causation=e,this.trackers=t,this.startTimeMs=performance.now()}complete(){const e=Math.max(performance.now()-this.startTimeMs,0);this.trackers.forEach((t=>{t.addEventContext(this.causation,e)}))}}const oo="View.Render";class ao{constructor(){this.looping=!1,this.loopingId=-1,this.onceId=-1}start(e){const t=()=>{e(),this.looping?this.loopingId=window.requestAnimationFrame(t):this.loopingId=-1};this.looping=!0,-1!==this.loopingId&&window.cancelAnimationFrame(this.loopingId),this.loopingId=window.requestAnimationFrame(t)}stop(){this.looping=!1}runOnce(e){-1!==this.onceId||this.looping||(this.onceId=window.requestAnimationFrame((()=>{e(),this.onceId=-1})))}stopOnce(){-1!==this.onceId&&(window.cancelAnimationFrame(this.onceId),this.onceId=-1)}}class lo{constructor(e,t,r,i,n,s,o,a,l,c,h={createAriaLabel:()=>{}},u){this.renderLoop=new ao,this.eventChainTrackersList=[],this.viewScale=new Vs,this.onViewModelUpdated=e=>{null==e||e.addTimePoint("ViewModelUpdatedEventReceivedTime"),this.invalidate((()=>{this.render()}),e)},this.renderTargetRegistry=n,this.viewScale=s,this.viewReadyTracker=o,this.frameRendered=a,this.registerViewModelUpdatedListener=l,this.graphic=e,this.anchorPresenter=i.createAnchorPresenter(this.graphic),this.presenterContext={anchorPresenter:this.anchorPresenter,viewScale:this.viewScale,viewReadyTracker:this.viewReadyTracker,renderDataPresenterCreator:r,ariaLabelCreator:h,highContrastModeInfo:u},this.presenterCreator=t,this.editContext=c,this.presenter=this.presenterCreator.createPresenter(this.graphic,this.presenterContext,this.editContext),this.registerViewModelUpdatedListener&&this.presenter.viewModelUpdated.on(this.onViewModelUpdated)}start(){this.renderLoop.runOnce((()=>{this.render()}))}teardown(){this.renderLoop.stopOnce(),this.registerViewModelUpdatedListener&&this.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.presenter.teardown(),this.anchorPresenter.teardown(),this.clear()}render(e){void 0!==e&&(this.eventChainTrackersList.push(e),e.addTimePoint("ViewControllerRenderStartTime")),this.renderViewModels((()=>{const e=this.presenter.viewModel;this.renderTargetRegistry.addViewModel(e)})),null==e||e.addTimePoint("ViewControllerRenderEndTime")}clear(){this.renderViewModels((()=>{}))}invalidate(e,t){this.renderLoop.runOnce(e),void 0!==t&&this.eventChainTrackersList.push(t)}recreatePresenter(e){this.graphic=e,this.presenter=this.presenterCreator.createPresenter(this.graphic,this.presenterContext,this.editContext)}resetPresenter(e,t){this.graphic=e,this.presenter=t}renderViewModels(e){no(this.eventChainTrackersList,"ViewControllerRenderViewModelsStartTime");const t=new w(oo);try{const r=new so("ViewController_Render",this.eventChainTrackersList);try{this.renderTargetRegistry.beginRender(),e(),this.renderTargetRegistry.endRender()}catch(e){throw(0,b.H)(0,5e4,`Exception: ${e.message}`),e}finally{r.complete()}no(this.eventChainTrackersList,"FrameRenderedEventEmittedTime"),this.frameRendered.emit(this.eventChainTrackersList.slice()),no(this.eventChainTrackersList,"ViewControllerRenderViewModelsEndTime"),this.eventChainTrackersList.splice(0)}finally{t.complete()}}}class co{constructor(){this.viewModels=[]}filter(e){return-1!==this.viewModels.indexOf(e)}}class ho{constructor(e,t,r,i,n,s,o,a,l,c,h,u,d,p){this.viewDirty=!0,this.onViewModelUpdated=e=>{null==e||e.addTimePoint("ViewModelUpdatedEventReceivedTime"),this.invalidate(e)},this.onEditPreviewEvent=e=>{0===e?(this.editPreviewFilter.viewModels.push(this.selectionPresenter.viewModel),this.viewController.renderLoop.start((()=>{this.render()}))):(this.editPreviewFilter.viewModels.splice(0),this.viewController.renderLoop.stop())},this.frameRendered=l,this.viewController=new lo(e,t,r,i,n,s,o,l,!1,a.editContext,u,d),this.viewController.presenter.viewModelUpdated.on(this.onViewModelUpdated),this.editController=a,this.renderOnlyWhenDirty=!0===p,this.editPreviewFilter=new co,this.viewController.renderTargetRegistry.filter=this.editPreviewFilter,this.editController.selection=c.createSelection(e),this.selectionPresenter=h.createSelectionPresenter(this.editController.selection,{anchorPresenter:this.viewController.anchorPresenter,viewScale:this.viewController.viewScale,viewReadyTracker:this.viewController.viewReadyTracker,renderDataPresenterCreator:r,ariaLabelCreator:u,modelPresenter:this.viewController.presenter,selectionPresenterCreator:h},this.editController.editContext),this.selectionPresenter.viewModelUpdated.on(this.onViewModelUpdated),void 0!==this.editController.editContext.previewInfo?(this.editController.editContext.previewInfo.presenter.notifier.on(this.onEditPreviewEvent),this.renderOnlyWhenDirty&&this.editController.editContext.previewInfo.presenter.viewModelUpdated.on(this.onViewModelUpdated),this.editPreviewRenderTargetRegistry=this.editController.editContext.previewInfo.renderTargetRegistry):this.editPreviewRenderTargetRegistry=new qs([])}start(){this.viewController.renderLoop.runOnce((()=>{this.render()}))}teardown(){this.viewController.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.selectionPresenter.viewModelUpdated.off(this.onViewModelUpdated),this.selectionPresenter.teardown(),void 0!==this.editController.editContext.previewInfo&&(this.renderOnlyWhenDirty&&this.editController.editContext.previewInfo.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.editController.editContext.previewInfo.presenter.notifier.off(this.onEditPreviewEvent)),this.viewController.renderTargetRegistry.filter=void 0,this.viewController.teardown(),this.clear(),this.editController.teardown()}render(e){this.renderOnlyWhenDirty&&!this.viewDirty||(void 0!==e&&(this.viewController.eventChainTrackersList.push(e),e.addTimePoint("EditViewControllerRenderStartTime")),this.renderViewModels((()=>{const e=this.viewController.presenter.viewModel;if(this.viewController.renderTargetRegistry.addViewModel(e,1),!this.editController.editContext.isInLivePreview){const e=this.selectionPresenter.viewModel;this.viewController.renderTargetRegistry.addViewModel(e,0);const t=this.editController.editContext.previewInfo;void 0!==t&&this.editPreviewRenderTargetRegistry.addViewModel(t.presenter.viewModel,2)}})),void 0!==e&&e.addTimePoint("EditViewControllerRenderEndTime"),this.viewDirty=!1)}invalidate(e){this.viewDirty=!0,this.viewController.invalidate((()=>{this.render()}),e)}prepareForLivePreview(){this.savedRootInfo={graphic:this.viewController.graphic,presenter:this.viewController.presenter,selection:this.editController.selection};const e=this.savedRootInfo.graphic.clone(this.savedRootInfo.graphic.id);this.editController.resetSelection(this.editController.selection.clone(e)),this.viewController.recreatePresenter(e),this.viewController.presenter.viewModelUpdated.on(this.onViewModelUpdated),this.invalidate()}restoreFromLivePreview(){void 0!==this.savedRootInfo&&(this.viewController.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.viewController.presenter.teardown(),this.editController.selection.teardown(),this.editController.resetSelection(this.savedRootInfo.selection),this.viewController.resetPresenter(this.savedRootInfo.graphic,this.savedRootInfo.presenter),this.invalidate(),this.savedRootInfo=void 0)}renderViewModels(e){const t=new w(oo);try{no(this.viewController.eventChainTrackersList,"EditViewControllerRenderViewModelsStartTime");const r=new so("EditViewController_Render",this.viewController.eventChainTrackersList);try{this.viewController.renderTargetRegistry.beginRender(),this.editPreviewRenderTargetRegistry.beginRender(),e(),this.viewController.renderTargetRegistry.endRender(),this.editPreviewRenderTargetRegistry.endRender()}catch(e){throw(0,b.H)(0,5e4,`Exception: ${e.message}`),e}finally{r.complete()}no(this.viewController.eventChainTrackersList,"FrameRenderedEventEmittedTime"),this.frameRendered.emit(this.viewController.eventChainTrackersList.slice()),no(this.viewController.eventChainTrackersList,"EditViewControllerRenderViewModelsEndTime"),this.viewController.eventChainTrackersList.splice(0)}finally{t.complete()}}clear(){this.renderViewModels((()=>{}))}}class uo{get presenter(){return this.editViewController.viewController.presenter}get editContext(){return this.editController.editContext}get selection(){return this.editController.selection}get selectionPresenter(){return this.editViewController.selectionPresenter}get isInLivePreview(){return!0===this.editContext.isInLivePreview}constructor(e){this.frameRendered=new l,this.viewScale=new Vs,this.renderDataPresenterCreatorRegistry=new zs([]),this.viewReadyTracker=new Hs,this.presenterCreatorRegistry=new Ws(e.presenterCreatorEntries),this.anchorPresenterCreatorRegistry=new js(e.anchorPresenterCreatorEntries),this.renderTargetRegistry=new qs([]),this.editPreviewInfo=e.editPreviewInfo,this.actionInvoker=e.actionInvoker,this.selectionCreatorRegistry=new Xs([]),e.selectionCreatorRegistrars.forEach((e=>{e(this.selectionCreatorRegistry)})),this.selectionPresenterCreatorRegistry=new $s(e.selectionPresenterCreatorEntries),this.editorRegistry=new Ys([]),this.keyboardEventNotifiers=e.keyboardEventNotifiers,this.keyboardEventProcessor=e.keyboardEventProcessor,this.ariaLabelCreatorRegistry=new Zs([]),this.highContrastModeInfo=e.highContrastModeInfo,this.renderOnlyWhenDirty=e.renderOnlyWhenDirty}start(e,t){const r=new Qs("root",e,t);this.editController=new io({editorRegistry:this.editorRegistry,actionInvoker:this.actionInvoker,previewInfo:this.editPreviewInfo},this.keyboardEventNotifiers,this.keyboardEventProcessor),this.editViewController=new ho(r,this.presenterCreatorRegistry,this.renderDataPresenterCreatorRegistry,this.anchorPresenterCreatorRegistry,this.renderTargetRegistry,this.viewScale,this.viewReadyTracker,this.editController,this.frameRendered,this.selectionCreatorRegistry,this.selectionPresenterCreatorRegistry,this.ariaLabelCreatorRegistry,this.highContrastModeInfo,this.renderOnlyWhenDirty),this.editViewController.start()}teardown(){void 0!==this.editViewController&&this.editViewController.teardown()}performAction(e){return this.editController.performAction(e)}performUndoEntry(e){return this.editController.performUndoEntry(e)}invalidate(e){this.editViewController.invalidate(e)}startLivePreview(){}endLivePreview(){}}class po{constructor(e){this.endTimeMs=0,this.startTimeMs=0,this.durationMs=0,this.eventContextHistoryMap=new Map,this.timePoints=[],this.name=e}start(){this.startTimeMs=performance.now()}end(){this.endTimeMs=performance.now(),this.durationMs=Math.max(this.endTimeMs-this.startTimeMs,0)}addEventContext(e,t){this.eventContextHistoryMap.set(e,t)}addTimePoint(e){this.timePoints.push({name:e,timestamp:performance.now()})}addEventToContextHistoryMap(e,t){void 0!==t?this.eventContextHistoryMap.set(e,t):this.eventContextHistoryMap.set(e,NaN)}getEventDurationStringsMap(e){const t=new Map;return this.eventContextHistoryMap.set(`${this.name}DurationMs`,this.durationMs),this.eventContextHistoryMap.forEach(((r,i)=>{t.set(i,r.toFixed(e))})),t}getTimePointCollectionString(e){if(this.timePoints.length>0){const t=this.timePoints[0].timestamp;this.timePoints.forEach((r=>{r.timestamp-=t,r.timestamp=parseFloat(r.timestamp.toFixed(e))}))}return JSON.stringify(this.timePoints)}}class fo{constructor(){this.totalCount=0,this.countDownloadNotStarted=0,this.countDownloadInProgress=0,this.countDownloadSucceeded=0,this.countDownloadFailed=0}}class go{constructor(){this.onDataStoreChange=new l,this.dataStore=new Map}static getInstance(){return void 0===go.instance&&(go.instance=new go),go.instance}add(e){var t;const r=e.downloadDetails.id,i=null===(t=this.dataStore.get(r))||void 0===t?void 0:t.downloader;return void 0===i?(this.enforceSizeContraintForEntriesToAdd(1),this.dataStore.set(r,{lastAccessed:performance.now(),downloader:e}),this.onDataStoreChange.emit(this.stats),e):(i.downloadDetails.originalUrl.href!==e.downloadDetails.originalUrl.href&&(0,y._)(8,`DataStore: Found conflicting entry with id - ${r}`),this.onDataStoreChange.emit(this.stats),e)}get(e){const t=this.dataStore.get(e);return void 0!==t&&(t.lastAccessed=performance.now()),null==t?void 0:t.downloader}getDownloadDetails(e){var t;const r=null===(t=this.dataStore.get(e))||void 0===t?void 0:t.downloader;return null==r?void 0:r.downloadDetails}clearEntry(e){var t;const r=null===(t=this.dataStore.get(e))||void 0===t?void 0:t.downloader;void 0!==r&&(r.teardown(),this.dataStore.delete(e)),this.onDataStoreChange.emit(this.stats)}clear(){const e=this.dataStore;this.dataStore=new Map;for(const[t,r]of e)r.downloader.teardown();e.clear(),this.onDataStoreChange.emit(this.stats)}get size(){return this.dataStore.size}get stats(){return this.makeStats()}setConfigAndEnforce(e){this.config=e,this.enforceSizeContraintForEntriesToAdd(0)}makeStats(){const e=new fo;e.totalCount=this.dataStore.size;for(const[t,r]of this.dataStore){const t=r.downloader.downloadDetails.stats;if(void 0===t)e.countDownloadNotStarted+=1;else switch(t.downloadState){case 0:e.countDownloadNotStarted+=1;break;case 1:e.countDownloadInProgress+=1;break;case 2:e.countDownloadSucceeded+=1;break;case 3:e.countDownloadFailed+=1;break;default:(0,xn.t)(t.downloadState)}}return e}enforceSizeContraintForEntriesToAdd(e){var t;if(void 0===(null===(t=this.config)||void 0===t?void 0:t.sizeConstraint))return;const r=this.dataStore.size+e-this.config.sizeConstraint.maxLimit;r>0&&this.config.sizeConstraint.evict(r,Array.from(this.dataStore.entries())).forEach((e=>{this.clearEntry(e)}))}}class mo{constructor(e,t,r,i,n){this.downloadCompleted=new l,this.id=e,this.originalUrl=t,this.isUrlFinal=r,this.downloadPlaceholder=n,this.pictureProvider=i,this.isUrlFinal&&(this._mimeType=jn(this.originalUrl))}get mimeType(){var e;return void 0!==this._mimeType||(this._mimeType=null===(e=go.getInstance().getDownloadDetails(this.id))||void 0===e?void 0:e.mimeType),this._mimeType}set mimeType(e){this._mimeType=e}equals(e){return this.id===e.id&&this.originalUrl===e.originalUrl}}function yo(e,t,r){return new mo(`${_o+=1,_o}`,e,!0,t,r)}let _o=0;class vo{constructor(e,t){this.canvasElement=e,this.renderer=t;const r=this.canvasElement.getContext("2d");null===r&&(0,y._)(4,"No 2D context"),this.renderingContext=r}beginRender(){this.renderingContext.clearRect(0,0,this.canvasElement.width,this.canvasElement.height)}addViewModel(e){this.displayCanvasElement(),this.renderer.renderViewModel(e,this)}endRender(){}hitTest(e){}beginGroup(e){}endGroup(){}displayCanvasElement(){this.canvasElement.style.display=""}}function bo(e,t,r,i,n){const s=r.size.width/e.width(),o=r.size.height/e.height(),a=t.width()*s*i,l=t.height()*o*i,c=(t.left-e.left)*s,h=(t.top-e.top)*o,u=(c+r.pos.x)*i,p=(h+r.pos.y)*i;return void 0!==n&&(n.setProp("left",u),n.setProp("top",p),n.setProp("width",a),n.setProp("height",l),n.setProp("scaleFactor",i),n.setProp("scaleX",s),n.setProp("scaleY",o)),new d(u,p,u+a,p+l)}function wo(e,t,r){const i=t.getContext("2d");null===i&&(0,y._)(4,"No 2D context"),t.width=To(e.width),t.height=To(e.height),t.style.position="relative";let n="",s="",o="",a="";if(void 0!==r)n=`${r.width()}px`,s=`${r.height()}px`,o=`${r.left}px`,a=`${r.top}px`;else{const t=e;n=t.style.width,s=t.style.height,o=t.style.left,a=t.style.top}t.style.width=n,t.style.height=s,t.style.left=o,t.style.top=a,0!==t.width&&0!==t.height&&(i.drawImage(e,0,0),(0,b._v)(0,4,"drawCanvasImageSourceToCanvas: Image drawn"))}function To(e){if("number"==typeof e)return e;(0,y._)(4,"SVGAnimatedLength not supported")}var xo=n(1459);function Co(e,t,r,i,n,s){let o=e.transform.size.width/e.sourceAnchorBounds.width();o=isNaN(o)?1:o;let a=e.transform.size.height/e.sourceAnchorBounds.height();a=isNaN(a)?1:a;const l=new x(o,a).scale(e.scaleFactor*window.devicePixelRatio),c=t.size.multiply(l),h=new x(Math.min(c.x,r),Math.min(c.y,r)),u=l.multiply(new x(h.x/c.x,h.y/c.y));i.width=Math.ceil(h.x),i.height=Math.ceil(h.y);const d=new P(t.center.negate(),u,void 0,h.divide(new x(2,2))),p=window.screen.width*devicePixelRatio*window.screen.height*devicePixelRatio;return function(e,t=2073600,r=2){Qt(function(e,t=2073600,r=2){if(0===e)return 1;let i=Math.sqrt(t/e);return e>t&&(i=Math.sqrt(i)),i=Math.min(i,r),0!==window.devicePixelRatio&&(i*=window.devicePixelRatio),i}(e,t,r))}(p),f=e.emuToSourceScale,ie(function(e){const t=0===e.x?1:1/e.x,r=0===e.y?1:1/e.y;return Math.max(t,r)}(u),function(e){return 2*xo.AF*e}(f)),n.render(e.scene,ge.Transparent,{transform:d}),function(e,t,r,i,n,s,o,a,l,c,h,u){void 0!==u&&(u.setProp("anchorScaleX",e),u.setProp("anchorScaleY",t),u.setProp("scaleFactor",r),u.setProp("devicePixelRatio",window.devicePixelRatio),u.setProp("sceneWidth",n.x),u.setProp("sceneHeight",n.y),u.setProp("maxCanvasDimensionPhyPx",i),u.setProp("cappedSceneWidth",s.x),u.setProp("cappedSceneHeight",s.y),u.setProp("combinedScaleX",o.x),u.setProp("combinedScaleY",o.y),u.setProp("cappedCombinedScaleX",a.x),u.setProp("cappedCombinedScaleY",a.y),u.setProp("totalPhysicalPixels",l),u.setProp("emuToSourceScale",c),u.setProp("renderTransformPreTranslationX",h.preTranslation.x),u.setProp("renderTransformPreTranslationY",h.preTranslation.y),u.setProp("renderTransformRotation",h.rotation),u.setProp("renderTransformScaleX",h.scale.x),u.setProp("renderTransformScaleY",h.scale.y),u.setProp("renderTransformTranslationX",h.translation.x),u.setProp("renderTransformTranslationY",h.translation.y))}(o,a,e.scaleFactor,r,c,h,l,u,p,e.emuToSourceScale,d,s),new x(Math.ceil(c.x)/window.devicePixelRatio,Math.ceil(c.y)/window.devicePixelRatio);var f}class So{constructor(){this.elementToViewModel=new Map}setViewModel(e,t){this.elementToViewModel.set(e,t)}getViewModel(e){return this.elementToViewModel.get(e)}clear(){this.elementToViewModel.clear()}}function Po(e,t){e.target.style.cursor=t}class Eo{constructor(e,t){this.onPointerDown=(e,t)=>{if(void 0!==this.inDrag)return;const r=this.viewModelHitTester.hitTest(e);void 0!==r?(this.inDrag={viewModel:r},r.pointerEventNotifiers.pointerdown.value.emit(e,t)):(this.inDrag={},Po(e,"auto"),this.unHitPointerEventNotifiers.pointerdown.value.emit(e,t))},this.onPointerMove=(e,t)=>{const r=void 0!==this.inDrag?this.inDrag.viewModel:this.viewModelHitTester.hitTest(e);this.generateOverOutEvent(e,r),void 0!==r?r.pointerEventNotifiers.pointermove.value.emit(e,t):(Po(e,"auto"),this.unHitPointerEventNotifiers.pointermove.value.emit(e,t))},this.onPointerUp=(e,t)=>{const r=void 0!==this.inDrag?this.inDrag.viewModel:this.viewModelHitTester.hitTest(e);void 0!==r?r.pointerEventNotifiers.pointerup.value.emit(e,t):(Po(e,"auto"),this.unHitPointerEventNotifiers.pointerup.value.emit(e,t)),this.inDrag=void 0},this.onPointerCancel=(e,t)=>{const r=void 0!==this.inDrag?this.inDrag.viewModel:this.viewModelHitTester.hitTest(e);void 0!==r?r.pointerEventNotifiers.pointercancel.value.emit(e,t):(Po(e,"auto"),this.unHitPointerEventNotifiers.pointercancel.value.emit(e,t)),this.inDrag=void 0},this.viewModelHitTester=e,this.unHitPointerEventNotifiers=t}addEventListeners(e){e.pointerdown.value.on(this.onPointerDown),e.pointermove.value.on(this.onPointerMove),e.pointerup.value.on(this.onPointerUp),e.pointercancel.value.on(this.onPointerCancel)}removeEventListeners(e){e.pointerdown.value.off(this.onPointerDown),e.pointermove.value.off(this.onPointerMove),e.pointerup.value.off(this.onPointerUp),e.pointercancel.value.off(this.onPointerCancel)}generateOverOutEvent(e,t){var r,i,n;if(this.lastPointerMoveViewModel===t)return;const s=null!==(i=null===(r=this.lastPointerMoveViewModel)||void 0===r?void 0:r.pointerEventNotifiers)&&void 0!==i?i:this.unHitPointerEventNotifiers;s.pointerout.valid&&s.pointerout.value.emit(e,{isHandled:!1});const o=null!==(n=null==t?void 0:t.pointerEventNotifiers)&&void 0!==n?n:this.unHitPointerEventNotifiers;o.pointerover.valid&&o.pointerover.value.emit(e,{isHandled:!1}),this.lastPointerMoveViewModel=t}}function Mo(e,t,r){return Math.min(Math.max(e,t),r)}class Ro{constructor(e){this.pointerEventNotifiers=c(),this.imageViewModelUpdated=new l,this.hitTestSlop=0,this.bounds=new d(0,0,0,0),this.sourceAnchorBounds=new d(0,0,0,0),this.scaleFactor=1/window.devicePixelRatio,this.transform=new m,this.topLeftOffset=new u(0,0),this.scaleVector=new u(1,1),this.inCropMode=!1,this._data=e}get imageData(){return this._data}async setImageData(e){this._data=e}get opacity(){return this._opacity}set opacity(e){this._opacity=void 0===e?e:Mo(e,0,100)}}class Ao{constructor(e,t,r,i,n){this.hitTestMap=new So,this.shapeBuilderVM=new Rt,this.renderers=new Gs.B([]),this.renderScope=0,this.groupRenderers=new Gs.B([]),this.groupScope=[],this.animations=[],this.animateLoopId=-1,this.animationLoop=()=>{if(this.animateLoopId=-1,0!==this.animations.length){for(const e of this.animations)e();this.shapeBuilderRenderer.renderViewModel(this.shapeBuilderVM,this),this.animateLoopId=window.requestAnimationFrame(this.animationLoop)}},this.hitTestViewModel=e=>this.shapeBuilderRenderer.hitTest(e,this,this.shapeBuilderVM.scaleFactor),this.canvas=e,this.shapeBuilderRenderer=t,this.webglRenderingContext=function(e){let t=e.getContext("webgl2");if(null!==t)return t;if(t=e.getContext("webgl"),null===t)throw new Error("No WebGL Rendering Context");return t}(e),this.scene=new _t,this.graphicsScene=new _t,this.selectionScene=new _t,this.previewScene=new _t,this.rootScene=new _t([this.graphicsScene,this.selectionScene,this.previewScene]),this.pointerEventNotifiers=r,this.separateSelectionSceneFromGraphic=n,t.setWebGLContext(this.webglRenderingContext),new Eo({hitTest:this.hitTestViewModel},i).addEventListeners(this.pointerEventNotifiers)}registerRenderer(e,t){return this.renderers.register(e,t),this}registerGroupRenderer(e,t){return this.groupRenderers.register(e,t),this}beginRender(){0===this.renderScope&&(this.shapeBuilderVM.clear(),this.hitTestMap.clear(),this.selectionScene.items.removeAll(),this.previewScene.items.removeAll(),this.animations=[]),this.renderScope+=1}addViewModel(e,t=1){const r=this.renderers.get(e.type);void 0!==r?r(e,this,t):function(e){return e.type===class{}}(e)?this.addShapeBuilderShapeViewModel(e,t):At(e)?this.addShapeBuilderViewModel(e,t):function(e){return e.type===class{}}(e)?this.addShapeBuilderGeometryViewModel(e):e instanceof Ro&&this.addImageViewModel(e)}addItem(e){0===this.groupScope.length?this.shapeBuilderVM.addItem(e):this.groupScope[this.groupScope.length-1].items.push(e)}endRender(){if(this.renderScope-=1,0===this.renderScope){const e=new w("ShapeBuilderRenderTarget.Render");try{this.shapeBuilderRenderer.renderViewModel(this.shapeBuilderVM,this),this.animations.length>0&&-1===this.animateLoopId&&(this.animateLoopId=window.requestAnimationFrame(this.animationLoop))}finally{e.complete()}}}hitTestText(e,t){return this.shapeBuilderRenderer.hitTestText(e,this,this.shapeBuilderVM.scaleFactor,t)}hitTest(e){return this.shapeBuilderRenderer.hitTest(e,this,this.shapeBuilderVM.scaleFactor)}beginGroup(e){const t=this.groupRenderers.get(e.type);if(void 0===t)throw new Error("Failed to find GroupRenderer to render group");const r=t(e,this);this.shapeBuilderRenderer.registerItem(e,r),this.groupScope.length>0&&this.groupScope[this.groupScope.length-1].items.push(r),this.groupScope.push(r)}endGroup(){const e=this.groupScope.pop();if(void 0===e)throw new Error("Mismatched begin/end group");0===this.groupScope.length&&this.addItem(e)}getScene(){return this.separateSelectionSceneFromGraphic?this.rootScene:this.scene}getGraphicsScene(){return this.graphicsScene}getSelectionScene(){return this.selectionScene}getPreviewScene(){return this.previewScene}getWebGLContext(){return this.webglRenderingContext}addAnimation(e){this.animations.push(e)}addShapeBuilderShapeViewModel(e,t){if(this.shapeBuilderRenderer.registerItem(e,e.shape),this.hitTestMap.setViewModel(e.shape,e),this.separateSelectionSceneFromGraphic)switch(t){case 1:this.addItem(e.shape);break;case 0:this.selectionScene.items.push(e.shape);break;case 2:this.previewScene.items.push(e.shape);break;default:(0,xn.t)(t)}else this.addItem(e.shape),0===t?this.selectionScene.items.push(e.shape):2===t&&this.previewScene.items.push(e.shape)}addShapeBuilderViewModel(e,t){const r=new _t;if(e.isHitTestOnly)e.scene.items.elements.forEach((t=>{this.shapeBuilderRenderer.registerItem(e,t),this.hitTestMap.setViewModel(t,e)}));else{if(e.scene.items.elements.forEach((t=>{this.shapeBuilderRenderer.registerItem(e,t),this.hitTestMap.setViewModel(t,e),r.items.push(t)})),r.transform=function(e){const t=e.sourceAnchorBounds.center(),r=new x(-t.x,-t.y);let i=1,n=0;0!==e.sourceAnchorBounds.width()&&(i=e.transform.size.width/e.sourceAnchorBounds.width(),n=e.transform.size.width/2);let s=1,o=0;return 0!==e.sourceAnchorBounds.height()&&(s=e.transform.size.height/e.sourceAnchorBounds.height(),o=e.transform.size.height/2),new P(r,new x(i,s),void 0,new x(n,o))}(e),this.separateSelectionSceneFromGraphic)switch(t){case 1:this.addItem(r),this.shapeBuilderVM.addTeardown((()=>{Et(r)}));break;case 0:this.selectionScene.items.push(e.scene);break;case 2:this.previewScene.items.push(e.scene);break;default:(0,xn.t)(t)}else this.addItem(r),this.shapeBuilderVM.addTeardown((()=>{Et(r)})),0===t?this.selectionScene.items.push(e.scene):2===t&&this.previewScene.items.push(e.scene);this.shapeBuilderVM.transform=e.transform,this.shapeBuilderVM.sourceAnchorBounds=new d(0,0,e.transform.size.width,e.transform.size.height),this.shapeBuilderVM.scaleFactor=e.scaleFactor,0!==e.emuToSourceScale&&(this.shapeBuilderVM.emuToSourceScale=e.emuToSourceScale)}this.shapeBuilderRenderer.registerItem(e,r)}addShapeBuilderGeometryViewModel(e){var t;this.shapeBuilderRenderer.registerItem(e,e.shape),this.hitTestMap.setViewModel(e.shape,e),this.addItem(e.shape);for(const{pictureDataViewModel:r,imageBrush:i}of e.pictureFillImageData){const e=null!==(t=r.imageData)&&void 0!==t?t:"";this.shapeBuilderRenderer.getOrGenerateImageTexture(e,(e=>{i.image=e}))}}addImageViewModel(e){const t=as(e.transform),r=yt.CreateRectangle(new E(t.left,t.top,t.right,t.bottom));this.shapeBuilderRenderer.registerItem(e,r),this.shapeBuilderRenderer.attachImageViewModelTextureToItem(e,r),this.hitTestMap.setViewModel(r,e),this.addItem(r),this.shapeBuilderVM.addTeardown((()=>{r.clearCache()}))}}class Bo{get webGLCanvas(){return this.shapeBuilderContext.shapeBuilderConfig.webGLCanvas}constructor(e){this.shapeBuilderContext=e}renderViewModel(e,t){var r;const i=new w("ShapeBuilderCanvas2DRenderer.renderViewModel");try{if(i.setProp("isRendererReady",`${this.shapeBuilderContext.isRendererReady}`),!this.shapeBuilderContext.isRendererReady)return;!function(e){if(!At(e))throw new Error(`Expected ShapeBuilderViewModel but received type:${e.type}`)}(e);const n=e.scene.getBounds();if(void 0===n||n.isEmpty())return;t instanceof Ao&&(t.separateSelectionSceneFromGraphic?t.getGraphicsScene().setItems(e.scene.items):t.getScene().setItems(e.scene.items));const s=Co(e,n,null!==(r=this.shapeBuilderContext.shapeBuilderConfig.maxWebGLCanvasDimensionPhyPx)&&void 0!==r?r:4096,this.webGLCanvas,this.shapeBuilderContext.renderer,i),o=function(e,t,r){const i=bo(e.sourceAnchorBounds,void 0===(n=e.scene.getBounds())?new d(0,0,0,0):new d(n.left,n.top,n.right,n.bottom),e.transform,e.scaleFactor,r);var n;return i.right=i.left+t.width/window.devicePixelRatio,i.bottom=i.top+t.height/window.devicePixelRatio,i}(e,this.webGLCanvas,i);o.right=o.left+s.x,o.bottom=o.top+s.y,this.webGLCanvas.style.position="relative",this.webGLCanvas.style.width=`${o.width()}px`,this.webGLCanvas.style.height=`${o.height()}px`,this.webGLCanvas.style.left=`${o.left}px`,this.webGLCanvas.style.top=`${o.top}px`,t instanceof vo&&wo(this.webGLCanvas,t.canvasElement,o)}finally{i.complete()}}hitTestText(e,t,r){}hitTest(e,t,r){if(t instanceof Ao){const i=new x(e.offsetX,e.offsetY);let n;void 0!==r&&(n=new P(void 0,new x(r,r)));const s=this.shapeBuilderContext.renderer.hitTestScene(t.getScene(),i,n);if(void 0===s.itemHit)return;let o=t.hitTestMap.getViewModel(s.itemHit);if(void 0===o&&void 0!==s.itemStack)for(const e of s.itemStack.reverse())if(o=t.hitTestMap.getViewModel(e),void 0!==o)break;return o}}registerItem(){}attachImageViewModelTextureToItem(){}getOrGenerateImageTexture(){}setWebGLContext(e){this.shapeBuilderContext.renderer.setWebGLContext(e)}updateTextureFromHTMLElement(){}}class Io{constructor(e,t,r,i,n,s,o){this._renderTargetMode=0,this._skipPrepareWebGLCanvas=!0,this.shouldInvokeRenderTargetChangedCallback=!0,this.modeToRenderTargetMap=new Map,this.shapeBuilderContext=e,this.viewCanvas2D=i,this.pointerEventNotifiers=n,this.viewDiv=t,this.editDiv=r,this.shapeBuilderCanvas2DRenderer=new Bo(e),this.modeToRenderTargetMap.set(0,new vo(this.viewCanvas2D,this.shapeBuilderCanvas2DRenderer)),this.modeToRenderTargetMap.set(1,new Ao(this.shapeBuilderContext.shapeBuilderConfig.webGLCanvas,this.shapeBuilderCanvas2DRenderer,this.pointerEventNotifiers,s,o))}get renderTargetMode(){return this._renderTargetMode}set renderTargetMode(e){this._renderTargetMode!==e&&(this._renderTargetMode=e,this.shouldInvokeRenderTargetChangedCallback=!0)}get skipPrepareWebGLCanvas(){return this._skipPrepareWebGLCanvas}set skipPrepareWebGLCanvas(e){this._skipPrepareWebGLCanvas!==e&&(this._skipPrepareWebGLCanvas=e)}beginRender(){this.prepareWebGLCanvas();const e=this.modeToRenderTargetMap.get(this.renderTargetMode);void 0!==e&&e.beginRender()}addViewModel(e){if(!At(e))return;const t=this.modeToRenderTargetMap.get(this.renderTargetMode);void 0!==t&&t.addViewModel(e)}endRender(){const e=this.modeToRenderTargetMap.get(this.renderTargetMode);void 0!==e&&e.endRender(),this.renderTargetChangedCallback()}hitTest(e){}beginGroup(e){}endGroup(){}renderTargetChangedCallback(){var e;this.shouldInvokeRenderTargetChangedCallback&&(0===this.renderTargetMode?this.showViewDivOnly():1===this.renderTargetMode&&(this.editDiv.appendChild(null===(e=this.shapeBuilderContext)||void 0===e?void 0:e.shapeBuilderConfig.webGLCanvas),this.showEditDivOnly(),this.shapeBuilderContext.activeMultiplexRenderTarget=this),this.shouldInvokeRenderTargetChangedCallback=!1)}getEditDivGraphicIdAttribute(){return this.editDiv.getAttribute("graphicId")}prepareWebGLCanvas(){if(this.skipPrepareWebGLCanvas)return;this.renderTargetMode=1;const e=this.shapeBuilderContext.activeMultiplexRenderTarget;void 0!==e&&e!==this&&e.tryChangeToCanvas2DRenderTargetMode(this.getEditDivGraphicIdAttribute())}tryChangeToCanvas2DRenderTargetMode(e){if(0===this.renderTargetMode)return;const t=new w("ShapeBuilderMultiplexRenderTarget.tryChangeToCanvas2DRenderTargetMode");try{null!==e&&t.setProp("pendingEditDivGraphicId",e);const r=this.getEditDivGraphicIdAttribute();null!==r&&t.setProp("editDivGraphicId",r);const i=this.modeToRenderTargetMap.get(1),n=this.modeToRenderTargetMap.get(0);i instanceof Ao&&n instanceof vo&&(this.renderTargetMode=0,wo(i.canvas,n.canvasElement),this.renderTargetChangedCallback())}finally{t.complete()}}showViewDivOnly(){this.viewDiv.style.display="inherit",this.editDiv.style.display="none"}showEditDivOnly(){this.editDiv.style.display="inherit",this.viewDiv.style.display="none"}}class Fo{get length(){return this.idCollection.length}constructor(e,t){this.idCollection=e,this.readOnlyItemCollection=t}addItems(e){return this.idCollection.addIds(this.getIds(e))}removeItems(e){return this.idCollection.removeIds(e.map((e=>e.id)))}removeItemIds(e){return this.idCollection.removeIds(e)}setItems(e){return this.idCollection.setIds(this.getIds(e))}clear(){return this.idCollection.clear()}getItemById(e){if(this.idCollection.has(e))return this.readOnlyItemCollection.getItemById(e)}getItemByIndex(e){if(e>=this.idCollection.length)return;const t=this.idCollection.getIdByIndex(e);return this.readOnlyItemCollection.getItemById(t)}[Symbol.iterator](){const e=this.idCollection[Symbol.iterator]();return{next:()=>{const t=e.next();if(void 0!==t.done&&!t.done){const e=this.getItemById(t.value);if(void 0!==e)return{done:!1,value:e}}return{done:!0,value:void 0}}}}getIds(e){return e.map((e=>e.id)).filter((e=>this.readOnlyItemCollection.getIndexById(e)>-1))}}class Do{constructor(e){this.elementList=e}get length(){return this.elementList.elementCount}getItemById(e){return this.elementList.getElementById(e)}getIndexById(e){return this.elementList.getIndexById(e)}getItemByIndex(e){return this.elementList.getElementByIndex(e)}[Symbol.iterator](){return this.elementList[Symbol.iterator]()}}function Lo(e){return new Do(e)}class ko{constructor(){this.ids=[]}addId(e){return!this.has(e)&&(this.ids.push(e),!0)}addIds(e){return e.reduce(((e,t)=>this.addId(t)||e),!1)}removeId(e){const t=this.getIndexById(e);return t>-1&&(this.ids.splice(t,1),!0)}removeIds(e){return e.reduce(((e,t)=>this.removeId(t)||e),!1)}setIds(e){return!this.sameIds(e)&&(this.ids=e,!0)}clone(){const e=new ko;return e.ids=[...this.ids],e}clear(){return 0!==this.ids.length&&(this.ids.length=0,!0)}has(e){return this.getIndexById(e)>-1}hasAll(e){return!e.some((e=>!this.has(e)))}sameIds(e){return this.ids.length===e.length&&!e.some(((e,t)=>e!==this.getIdByIndex(t)))}get length(){return this.ids.length}getIdByIndex(e){if(e>=this.ids.length)throw new RangeError(`Invalid index: ${e}, len: ${this.ids.length}`);return this.ids[e]}getIndexById(e){return this.ids.findIndex((t=>e===t))}[Symbol.iterator](){let e=0;const t=this.ids;return{next(){if(e<t.length){const r={done:!1,value:t[e]};return e+=1,r}return{done:!0,value:void 0}}}}}class Oo{}function Uo(e,t){return t.reduce(((e,t,r)=>e.replace(`{${r}}`,t)),e)}class No{}class Vo{constructor(e,t){this.type=No,this.selectionUpdated=new l,this.graphic=e,this.filteredElementCollection=t}addElements(e){this.filteredElementCollection.addItems(e)&&this.onSelectionChanged()}removeElements(e){this.filteredElementCollection.removeItems(e)&&this.onSelectionChanged()}setElements(e){this.filteredElementCollection.setItems(e)&&this.onSelectionChanged()}clear(){this.filteredElementCollection.clear()&&this.onSelectionChanged()}hasSubSelection(){return this.length>0}get length(){return this.filteredElementCollection.length}getElementById(e){return this.filteredElementCollection.getItemById(e)}getElementByIndex(e){return this.filteredElementCollection.getItemByIndex(e)}[Symbol.iterator](){return this.filteredElementCollection[Symbol.iterator]()}teardown(){}save(){}restore(e){}clone(e){throw new Error("SmartArtSelection clone not implemented")}getAriaMessageForSelection(e){let t="";const r=this.filteredElementCollection.length;let i;return 1===r?i=this.filteredElementCollection.getItemByIndex(0):r>1&&(i=this.filteredElementCollection.getItemByIndex(r-1)),void 0!==i&&(t=this.constructFullAriaMessage(i,e)),t}constructFullAriaMessage(e,t){let r=e.shapeTypeString;return""===r&&(r=t.defaultShapeType),""!==e.alt?Uo(e.hasText?t.shapeHasTextAltTemplate:t.shapeWithNoTextAltTemplate,[r,e.altTitle,e.alt]):Uo(e.hasText?t.shapeHasTextTemplate:t.shapeNoTextTemplate,[r,e.altTitle])}onSelectionChanged(){this.selectionUpdated.emit()}}function Go(e){return e.type===No}class zo{constructor(e){this.selection=e}}class Ho extends Gs.B{createAction(e,t,r){const i=this.get(e);if(void 0!==i&&void 0!==i[0])return i[0](t,r)}query(e,t){const r=this.get(e);if(void 0!==r&&void 0!==r[1])return r[1](t)}}const Wo="DeleteSelectionAction";class jo{constructor(){this.actionType=Wo}}const qo="removeBackgroundAction";class Xo{constructor(e,t,r,i,n,s,o,a,l=!0){this.actionType=qo,this.graphic=e,this.pictureContent=t,this.useMask=r,this.downsample=i,this.bgrOpType=n,this.preAction=s,this.postAction=o,this.resultHandler=a,this.updatePicture=l}}class $o{constructor(){this.cropEventNotifier=new l,this.keyboardEvent=new l,this.outCropping=!1,this._inCropMode=!1}setInCropMode(e){const t=0===e;this._inCropMode!==t&&(this._inCropMode=t,this.cropEventNotifier.emit(e))}get inCropMode(){return this._inCropMode}}function Ko(e){return Math.round(e)}function Yo(e,t){return e.equals(t)}function Jo(e,t){return void 0===e&&void 0===t||void 0!==e&&void 0!==t&&e.equals(t)}function Zo(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(!Yo(e[r],t[r]))return!1;return!0}function Qo(e){return e.map((e=>e))}class ea{constructor(e,t,r,i,n=[]){this.type=0,this.r=e,this.g=t,this.b=r,this.a=i,this.transforms=n}clone(){return new ea(this.r,this.g,this.b,this.a,Qo(this.transforms))}equals(e){return ta(e)&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a&&Zo(this.transforms,e.transforms)}}function ta(e){return 0===e.type}function ra(e){const t=function(e){if(e.startsWith("rgb(")){const[t,r,i]=e.slice(4).split(",").map(parseFloat);return new ea(t,r,i,1)}if(e.startsWith("rgba(")){const[t,r,i,n]=e.slice(5).split(",").map(parseFloat);return new ea(t,r,i,n)}if(e.startsWith("#")){const t=parseInt(e.slice(1),16);if(7===e.length)return new ea(t>>16&255,t>>8&255,255&t,1);if(9===e.length)return new ea(t>>24&255,t>>16&255,t>>8&255,(255&t)/255)}}(e);if(void 0!==t)return t;throw new Error(`Unsupported CSS color: ${e}`)}function ia(e){return 3===e.type}new ea(0,0,0,1);class na{constructor(e){this.type=1,this.color=e}}class sa{constructor(){this.stateUpdated=new l,this._mode=0,this._brush=new na(new ea(0,0,0,1)),this._size=10}get mode(){return this._mode}get brush(){return this._brush}set brush(e){this._brush!==e&&(this._brush=e,this.stateUpdated.emit())}get size(){return this._size}set size(e){this._size!==e&&(this._size=e,this.stateUpdated.emit())}start(e,t,r){this._mode=e,void 0!==t&&(this._brush=t),void 0!==r&&(this._size=r),this.stateUpdated.emit()}stop(){this._mode=0,this.stateUpdated.emit()}dispatchAction(e){this.stateUpdated.emit(e)}}class oa{}class aa{}class la{constructor(e){this.type=aa,this.selectionUpdated=new l,this.cropState=new $o,this.paintState=new sa,this.graphic=e}teardown(){}save(){}restore(e){}clone(e){return new la(e)}}function ca(e){return e.type===aa}const ha="setPicturePlaceholder";class ua{constructor(e,t,r=!1){this.actionType=ha,this.placeholder=e,this.graphic=t,this.isUndoable=r}}class da{constructor(e,t=!1,r=!1,i=!1){this.url=e,this.renderAsSvg=t,this.overlay=r,this.cropToGeometry=i}equals(e){return this.url.href===e.url.href}}const pa="SetFillColorAction";class fa{constructor(e){this.actionType=pa,this.color=e}}function ga(e){const t=e.selection.selections[0];return 1!==e.selection.selections.length||void 0===t?{enabled:!1}:{enabled:Go(t)&&t.hasSubSelection()}}const ma=new Ho([["ApplyShapeFillColor",[function(e){const t=e.color;if(void 0!==t)return new fa(t)},ga]],["ClearPlaceholders",[()=>new jo,ga]],["RemoveBackgroundAction",[function(e,t){if(!ca(t.selection.selections[0])||void 0===e)return;const r=e,i=t.selection.selections[0].graphic,n=void 0!==r.placeholder?new ua(new da(r.placeholder.url,r.placeholder.renderAsSvg,r.placeholder.overlay,r.placeholder.cropToGeometry),i):void 0,s=void 0!==r.placeholder&&r.updatePicture?new ua(void 0,i):void 0,o=void 0!==r.originalUrl?new ds(r.originalUrl):void 0;return new Xo(t.selection.selections[0].graphic,o,r.useMask,r.downsample,"RemoveBackground",n,s,r.resultHandler,r.updatePicture)},function(e){const t=e.selection.selections[0];return 1!==e.selection.selections.length||void 0===t?{enabled:!1}:{enabled:ca(t)}}]]]);class ya{}class _a{set fallbackRenderData(e){this._fallbackRenderData=e,this.modelUpdated.emit()}get fallbackRenderData(){return this._fallbackRenderData}constructor(e){this.type=ya,this.modelUpdated=new l,this.hostContext=e}clone(){throw Error("Not implemented")}}class va{}class ba{constructor(e){this.anchorUpdated=new l,this.type=va,this.graphicElement=e}get transform(){return this.getTransformInformation()}clone(){(0,y._)(55e3,"Not implemented")}getTransformInformation(){const e=new f(this.graphicElement.get_xPersisted(),this.graphicElement.get_yPersisted()),t=new g(this.graphicElement.get_widthPersisted(),this.graphicElement.get_heightPersisted()),r=new p(this.graphicElement.get_isHorizontallyFlipped(),this.graphicElement.get_isVerticallyFlipped());return new m(e,t,r,this.graphicElement.get_shapeRotation())}}var wa=n(3774);class Ta{}class xa{constructor(e){this.type=Ta,this.updates=e}}class Ca{constructor(e,t,r){this.type=oa,this.modelUpdated=new l,this.hostContext=e,this._pptPictureData=t,this._data=r}get data(){return this._data}set data(e){this._data.equals(e)||(this._data=e,this.modelUpdated.emit(new xa(1)))}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry=e,this.modelUpdated.emit(new xa(2)))}get description(){return this._pptPictureData.get_alt()}set description(e){this._description!==e&&(this._description=e,this.modelUpdated.emit(new xa(16)))}get placeholder(){return this._placeholder}set placeholder(e){Jo(this.placeholder,e)||(this._placeholder=e,this.modelUpdated.emit(new xa(256)))}clone(){const e=new Ca(this.hostContext,this._pptPictureData,this._data);return e._geometry=this._geometry,e}}class Sa{static getInstance(){return void 0===Sa.instance&&(Sa.instance=new Sa),Sa.instance}async getPictureBlobDataFromHostPictureMetadata(e){throw new Error("Method not implemented.")}isHostPictureMetadata(e){throw new Error("Method not implemented.")}getPlaceholderIcon(e){throw new Error("Method not implemented.")}createPictureData(e,t){throw new Error("Method not implemented.")}}class Pa{constructor(e,t,r){this.type=Oo,this.layoutUpdated=new l,this.onModelUpdated=()=>{this.updateLayout().catch((()=>{}))},this.hostContext=e,this.smartArtData=t,this.smartArtLayoutCreator=r,this.modelUpdated=this.smartArtData.modelUpdated,this.updateLayout().catch((()=>{})),this.modelUpdated.on(this.onModelUpdated)}teardown(){this.modelUpdated.off(this.onModelUpdated)}get layout(){return this.smartArtLayout}deleteSubShapes(e){return this.smartArtData.deleteSubShapes(e)}setSubShapeFillColor(e,t){return this.smartArtData.setSubShapeFillColor(e,t)}clone(){throw Error("Not implemented")}setLayout(e){this.smartArtLayout=e,this.layoutUpdated.emit()}async updateLayout(){return this.smartArtLayoutCreator(this.smartArtData).then((e=>{this.setLayout(e)}))}}class Ea{constructor(){this.diagramType="",this.diagramCategory="",this.styleType="",this.styleCategory="",this.colorTransformType="",this.colorTransformCategory="",this.typographicalEmphasis="",this.isPlaceholder=!1}}class Ma{constructor(e){this.text="",this.elementType=2,this.elementProps=new Ea,this._modelId=e}get modelId(){return this._modelId}get id(){return this._modelId}get hasText(){return!1}get alt(){return""}get altTitle(){return""}get shapeTypeString(){return""}}class Ra{constructor(){this.itemsMap=new Map,this.idArray=[]}addItem(e,t){this.itemsMap.has(e.id)||(this.itemsMap.set(e.id,e),this.idArray.splice(null!=t?t:this.idArray.length,0,e.id))}addItems(e){for(const t of e)this.addItem(t)}removeItem(e){this.removeItemById(e.id)}removeItems(e){for(const t of e)this.removeItem(t)}removeItemById(e){this.itemsMap.delete(e);const t=this.getIndexById(e);-1!==t&&this.idArray.splice(t,1)}removeItemsByIds(e){for(const t of e)this.removeItemById(t)}get length(){return this.itemsMap.size}getItemById(e){return this.itemsMap.get(e)}getItemByIndex(e){if(!(e<0||e>=this.idArray.length))return this.itemsMap.get(this.idArray[e])}getItemByCondition(e){for(const[,t]of this.itemsMap)if(e(t))return t}getIndexById(e){return this.idArray.indexOf(e)}changeItemIndex(e,t){if(t>=this.idArray.length||t<0)return;const r=this.getIndexById(e);return-1!==r&&r!==t?(this.idArray.splice(r,1),this.idArray.splice(t,0,e),r):void 0}[Symbol.iterator](){let e=0;return{next:()=>{if(e>=this.idArray.length)return{done:!0,value:void 0};const t=this.idArray[e];e+=1;const r=this.getItemById(t);if(void 0===r)throw new Error(`Invalid item ID ${t}`);return{done:!1,value:r}}}}}var Aa=n(943);class Ba{constructor(e){this._elementProps=new Ea,this._text="",this._smartArtElement=e}get modelId(){return(0,Aa.n)(this._smartArtElement.get_smartArtModelId())}get id(){return this.modelId}get elementType(){return this._smartArtElement.get_smartArtElementType()}get elementProps(){return this._elementProps}get text(){return this._text}get hasText(){return 3!==this.elementType||this._smartArtElement.get_associatedIds().length>0}get alt(){return this._smartArtElement.get_alt()}get altTitle(){return this._smartArtElement.get_altTitle()}get shapeTypeString(){return 3===this.elementType&&null!==this._smartArtElement.get_shapeTypeString?this._smartArtElement.get_shapeTypeString():""}}class Ia{constructor(e){this.documentElement=new Ma(""),this._elementCollection=e}get elements(){const e=new Ra;return this._elementCollection.get_items().map((t=>{t.get_isSVGBlipFilled()||e.addItem(new Ba(t))})),e}get elementCount(){return this.elements.length}getElements(e,t){const r=[];for(let i=e;i<(null!=t?t:this.elementCount);i+=1)r.push(this.getElementByIndex(i));return r}getElementById(e){return this.elements.getItemById(e)}getElementByIndex(e){return this.elements.getItemByIndex(e)}getIndexById(e){return this.elements.getIndexById(e)}[Symbol.iterator](){return this.elements[Symbol.iterator]()}addElement(e){return new Ma("")}addElementWithModelId(e,t){return new Ma(t)}deleteElement(e){}}class Fa{constructor(e){this.modelUpdated=new l,this._pptSmartArtData=e,this._elementList=new Ia(this._pptSmartArtData.get_elementCollection())}get elementList(){return this._elementList}deleteSubShapes(e){return this._pptSmartArtData.deleteSubShapes(e)}setSubShapeFillColor(e,t){return this._pptSmartArtData.setSubShapeFillColor(e,t)}}class Da{constructor(e){this._transform=e}get transform(){return this._transform}set transform(e){this._transform=e}}class La{constructor(e,t){this._pptSmartArtElement=e,this._parentSmartArt=t}get modelId(){return(0,Aa.n)(this._pptSmartArtElement.get_smartArtModelId())}get shapeProps(){return new Da(this.createSmartArtShapeTransform())}get semanticModelId(){return this._semanticModelId}createSmartArtShapeTransform(){const e=this._pptSmartArtElement.get_xPersisted()-this._parentSmartArt.get_xPersisted(),t=this._pptSmartArtElement.get_yPersisted()-this._parentSmartArt.get_yPersisted(),r=new f(e,t),i=new g(this._pptSmartArtElement.get_widthPersisted(),this._pptSmartArtElement.get_heightPersisted()),n=new p(this._pptSmartArtElement.get_isHorizontallyFlipped(),this._pptSmartArtElement.get_isVerticallyFlipped());return new m(r,i,n,this._pptSmartArtElement.get_shapeRotation())}}class ka{constructor(e){this._parentSmartArt=e}get shapes(){return this._parentSmartArt.ensureModelData().get_elementCollection().get_items().map((e=>new La(e,this._parentSmartArt)))}}class Oa{}class Ua{constructor(e,t,r,i,n=!1,s=""){this.type=Oa,this.modelUpdated=new l,this.hostContext=e,this._source=t,this._imageSource=r,this._geometry=i,this._looping=n,this._altText=s}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.modelUpdated.emit()}get source(){return this._source}set source(e){this._source=e,this.modelUpdated.emit()}get imageSource(){return this._imageSource}set imageSource(e){this._imageSource=e,this.modelUpdated.emit()}get fallbackRenderData(){return this._fallbackRenderData}set fallbackRenderData(e){this._fallbackRenderData=e,this.modelUpdated.emit()}get looping(){return this._looping}set looping(e){this._looping=e,this.modelUpdated.emit()}get altText(){return this._altText}set altText(e){this._altText=e,this.modelUpdated.emit()}clone(){throw Error("Not implemented")}}function Na(e,t){switch(e.getGraphicType()){case ks.O.SmartArt:return function(e,t){const r=e.getGraphicElement();(0,b.PN)(0,55e3,`PptGraphicElement info: sid=${r.get_sid()}, cid=${r.get_cid()}, shapeId=${r.get_shapeId()}}`);const i=r,n=new Fa(i.ensureModelData()),s=new Pa(t,n,(o=i,async e=>Promise.resolve(new ka(o))));var o;return new Qs(e.getId(),s,new ba(r))}(e,t);case ks.O.Chart:return function(e,t){return new Qs(e.getId(),new _a(t),new ba(e.getGraphicElement()))}(e,t);case ks.O.Video:return function(e,t){const r=e.getVideoData();if(null===r)throw new Error("Missing video data");const i=new Ua(t,{isNative:r.getIsNative(),url:r.getSource()},void 0,void 0,void 0!==r.getIsDesignerVideo&&r.getIsDesignerVideo(),void 0!==r.getAltText?r.getAltText():""),n=r.getShapeType();return null!==n&&(0,wa.J)(i,n),new Qs(e.getId(),i,new ba(e.getGraphicElement()))}(e,t);case ks.O.Picture:return function(e,t){const r=e.getPictureData(),i=e.getGraphicElement();if(null===r)throw new Error("Missing picture data");const n=yo(new URL(r.getPlaceholderImage()),Sa.getInstance()),s=new Ca(t,i,n),o=r.getShapeType();return null!==o&&(0,wa.J)(s,o),new Qs(e.getId(),s,new ba(e.getGraphicElement()))}(e,t);default:throw new Error("Cannot create Graphic for given IGraphicData")}}function Va(e){return(t,r,i)=>new Ks(e(t,r,i))}function Ga(e){return(t,r,i)=>new Ks(!0,e(t,r,i))}function za(e){return(t,r,i)=>new Ks(!0,[e(t,r.graphic.model,i)])}function Ha(e){return(t,r,i)=>new Ks(!0,e(t,r.graphic.model,i))}function Wa(e){var t;const r=null===(t=Dn)||void 0===t?void 0:t.get(e);if(void 0===r)throw new Error(`No executor found for operation ${e}`);return r()}class ja{constructor(e,t){this.anchor=e,this.transform=t}perform(){const e=new ja(this.anchor,this.anchor.transform);return this.anchor.transform=this.transform,{undoOp:e}}}function qa(e,t,r,i){const n=e.clone();switch(t.type){case 0:(null==i?void 0:i.move)||(n.pos.x+=t.x,n.pos.y+=t.y);break;case 1:(null==i?void 0:i.resize)||function(e,t,r){const{width:i,height:n}=e.size;let{scaleX:s,scaleY:o}=t;const{originX:a,originY:l}=t;if((r||t.lockAspectRatio)&&0!==a&&0!==l){const e=Math.max(Math.abs(s),Math.abs(o));s=Math.sign(s)*e,o=Math.sign(o)*e}const c=s*i,h=o*n;e.size.width=Math.abs(c),e.size.height=Math.abs(h);const d=new u((c-i)*a/2,(h-n)*l/2);d.rotate(e.rot),e.pos.x+=i/2+d.x-c/2,e.pos.y+=n/2+d.y-h/2,c<0&&(e.pos.x+=c,e.flip.x=!e.flip.x),h<0&&(e.pos.y+=h,e.flip.y=!e.flip.y)}(n,t,r||!0===(null==i?void 0:i.aspectRatio));break;case 2:(null==i?void 0:i.rotate)||(n.rot+=t.rotation);break;case 3:t.x&&(n.flip.x=!n.flip.x),t.y&&(n.flip.y=!n.flip.y),t.mirrorRotation&&(n.rot=(0,h.LW)(-n.rot));break;case 4:void 0!==t.offset&&n.pos.add(t.offset),void 0!==t.scale&&n.size.scale(t.scale.width,t.scale.height),void 0!==t.flip&&(t.flip.x&&(n.flip.x=!n.flip.x),t.flip.y&&(n.flip.y=!n.flip.y)),void 0!==t.rotation&&(n.rot+=t.rotation);break;default:(0,xn.t)(t)}return n}class Xa{constructor(e){this.actionType="modXfrmAct",this.transform=e}}function $a(e,t,r=!1,i){return qa(e,t.transform,r,i)}class Ka{constructor(e,t,r,i){this.type=4,this.offset=e,this.scale=t,this.flip=r,this.rotation=i}}class Ya{}class Ja{constructor(){this.type=Ya}shouldMergeWithPrevious(e){return!0}}class Za{constructor(e,t,r=!1){this.croppable=e,this.crop=t,r&&(this.mergePolicy=new Ja)}perform(){const e=new Za(this.croppable,this.croppable.crop);return this.croppable.crop=this.crop,{undoOp:e}}}const Qa="crop";class el{constructor(e,t,r){this.actionType=Qa,this.crop=e,this.transform=t,this.graphic=r}}function tl(e,t){var r;const{model:i,anchor:n}=null!==(r=e.graphic)&&void 0!==r?r:t.graphic;_n("GC2Crop");const s=new Za(i,e.crop),o=n.transform;let a=e.transform;if(void 0!==a&&a.equals(o))return[s];if(void 0===a){l=hs(o,i.crop),a=void 0===(c=e.crop)?l:c.getSrcRectTransformFromParent(l)}var l,c,h,u;return[s,new ja(n,$a(o,new Xa((h=o,u=a,new Ka(new f(u.pos.x-h.pos.x,u.pos.y-h.pos.y),new g(u.size.width/h.size.width,u.size.height/h.size.height),new p(u.flip.x!==h.flip.x,u.flip.y!==h.flip.y),u.rot-h.rot)))))]}function rl(e){const t=go.getInstance().getDownloadDetails(e.data.id),r=null==t?void 0:t.renderUrl;if(void 0!==r)return new ds(r)}function il(e,t,r){return async function(e,t,r){var i,n,s,o;const a=await(null!==(n=null===(i=e.pictureContent)||void 0===i?void 0:i.toDataURL())&&void 0!==n?n:null===(s=rl(t))||void 0===s?void 0:s.toDataURL());if(void 0===a)return void(0,b.H)(0,0,"SmartCropAction failed - Input picture is not available");void 0!==e.preAction&&r.actionInvoker.invoke(e.preAction);const l=await async function(e,t){let r;const i=await e.toDataURL();return t&&(r=async e=>Object.assign(Object.assign({},e),{picture:new ds(await gs(i,512,!0,1,"image/png"))})),new ps(vs,{picture:e},r)}(new ds(a),e.downsample),c=await Wa(l.opType).executeOp(l);if(void 0!==e.resultHandler)try{await e.resultHandler(c)}catch(e){(0,b.KE)(0,0,`SmartCropAction resultHandler failed - ${e.message}`)}void 0!==c.result?r.actionInvoker.invoke(new el(c.result.srcRect,void 0,e.graphic)):(0,b.H)(0,0,`SmartCropAction failed - ${null===(o=c.error)||void 0===o?void 0:o.message}`),void 0!==e.postAction&&r.actionInvoker.invoke(e.postAction)}(e,t,r).then((()=>{})).catch((()=>{})),[]}const nl="setPictureData";class sl{constructor(e,t){this.actionType=nl,this.data=e,this.graphic=t}}class ol{async getPictureBlobDataFromHostPictureMetadata(e){throw new Error("Method not implemented.")}isHostPictureMetadata(e){throw new Error("Method not implemented.")}getPlaceholderIcon(e){throw new Error("Method not implemented.")}createPictureData(e,t){throw new Error("Method not implemented.")}}function al(e,t,r){return async function(e,t,r){var i,n,s,o;const a=await(null!==(n=null===(i=e.pictureContent)||void 0===i?void 0:i.toDataURL())&&void 0!==n?n:null===(s=rl(t))||void 0===s?void 0:s.toDataURL());if(void 0===a)return void(0,b.H)(0,0,"RemoveBackgroundAction failed - Input picture is not available");void 0!==e.preAction&&r.actionInvoker.invoke(e.preAction);const l=await Ts(new ds(a),e.bgrOpType,e.downsample,e.useMask),c=await Wa(l.opType).executeOp(l);if(void 0!==e.resultHandler)try{await e.resultHandler(c)}catch(e){(0,b.KE)(0,0,`RemoveBackgroundAction resultHandler failed - ${e.message}`)}void 0!==c.result?e.updatePicture?r.actionInvoker.invoke(new sl(yo(await c.result.picture.toDataURL(),new ol),e.graphic)):(0,b.PN)(0,0,"RemoveBackgroundAction PictureData not updated with BGR result."):(0,b.H)(0,0,`RemoveBackgroundAction failed - ${null===(o=c.error)||void 0===o?void 0:o.message}`),void 0!==e.postAction&&r.actionInvoker.invoke(e.postAction)}(e,t,r).then((()=>{})).catch((()=>{})),[]}function ll(e,t,r){return async function(e,t,r){var i,n,s,o;const a=await(null!==(n=null===(i=e.pictureContent)||void 0===i?void 0:i.toDataURL())&&void 0!==n?n:null===(s=function(e){const t=go.getInstance().getDownloadDetails(e.data.id),r=null==t?void 0:t.renderUrl;if(void 0!==r)return new ds(r)}(t))||void 0===s?void 0:s.toDataURL());if(void 0===a)return void(0,b.H)(0,0,"SuperResolutionAction failed - Input picture is not available");void 0!==e.preAction&&r.actionInvoker.invoke(e.preAction);const l=await async function(e){return new ps(bs,{picture:e})}(new ds(a)),c=await Wa(l.opType).executeOp(l);if(void 0!==e.resultHandler)try{await e.resultHandler(c)}catch(e){(0,b.KE)(0,0,`SuperResolutionAction resultHandler failed - ${e.message}`)}void 0!==c.result?e.updatePicture?r.actionInvoker.invoke(new sl(yo(await c.result.picture.toDataURL(),new ol),e.graphic)):(0,b.PN)(0,0,"SuperResolutionAction PictureData not updated with SuperResolution result."):(0,b.H)(0,0,`SuperResolutionAction failed - ${null===(o=c.error)||void 0===o?void 0:o.message}`),void 0!==e.postAction&&r.actionInvoker.invoke(e.postAction)}(e,t,r).then((()=>{})).catch((()=>{})),[]}class cl{constructor(e){this.type=hl,this.graphics=[],this.selections=[];for(const t of e)this.graphics.push(t);for(const t of e.selections)this.selections.push(t.save())}restore(e){e.setGraphics(this.graphics);for(let t=0;t<this.selections.length;t+=1){const r=this.selections[t];void 0!==r&&e.selections[t].restore(r)}}}class hl{}class ul{get selections(){return this._selections}constructor(e,t){this.type=hl,this.selectionUpdated=new l,this.childSelectionUpdated=new l,this._selections=[],this.graphics=[],this.idsToSelections=new Map,this.onGraphicCollectionChanged=e=>{(function(e){return void 0!==e&&e.type===Bs})(e)&&this.removeGraphics(e.removed)},this.onChildSelectionUpdated=()=>{this.childSelectionUpdated.emit()},this.graphic=e,this.selectionCreator=t,this.graphic.model.modelUpdated.on(this.onGraphicCollectionChanged)}teardown(){this.graphic.model.modelUpdated.off(this.onGraphicCollectionChanged),this.clear()}hasGraphic(e){return void 0!==this.idsToSelections.get(e.id)}addGraphics(e){for(const t of e){if(this.idsToSelections.has(t.id))continue;const e=this.graphic.model.getGraphic(t.id);if(void 0===e)continue;const r=this.createSelection(e);this.graphics.push(e),this._selections.push(r),this.idsToSelections.set(e.id,r)}this.selectionUpdated.emit()}removeGraphics(e){const[t,r]=[new Set,new Set];for(const i of e){const e=i.id,n=this.idsToSelections.get(e);void 0!==n&&(t.add(e),r.add(n),this.idsToSelections.delete(e))}if(!(t.size<=0)){for(const e of r)this.removeSelection(e);this.graphics=this.graphics.filter((e=>!t.has(e.id))),this._selections=this._selections.filter((e=>!r.has(e))),this.selectionUpdated.emit()}}setGraphics(e){if(0===e.length)return void this.clear();const t=[],r=[];for(const i of e){const e=i.id,n=this.graphic.model.getGraphic(e);if(void 0===n)continue;const s=this.idsToSelections.get(e);void 0!==s?(this.idsToSelections.delete(e),t.push(s)):t.push(this.createSelection(n)),r.push(n)}this.idsToSelections.forEach((e=>{this.removeSelection(e)})),this._selections=t,this.graphics=r,this.idsToSelections.clear();for(const e of this._selections)this.idsToSelections.set(e.graphic.id,e);this.selectionUpdated.emit()}clear(){this.selections.length<=0||(this._selections.forEach((e=>{this.removeSelection(e)})),this._selections=[],this.graphics=[],this.idsToSelections.clear(),this.selectionUpdated.emit())}get length(){return this.graphics.length}[Symbol.iterator](){return this.graphics[Symbol.iterator]()}save(){return new cl(this)}restore(e){(function(e){return e.type===hl})(e)&&e.restore(this)}clone(e){const t=new ul(e,this.selectionCreator);for(const[r,i]of this.idsToSelections){const n=e.model.getGraphic(r);if(void 0!==n){const e=i.clone(n);t.graphics.push(n),t._selections.push(e),t.idsToSelections.set(n.id,e)}}return t}createSelection(e){const t=this.selectionCreator.createSelection(e);return t.selectionUpdated.on(this.onChildSelectionUpdated),t}removeSelection(e){var t;null===(t=e.deselected)||void 0===t||t.emit(),e.selectionUpdated.off(this.onChildSelectionUpdated),e.teardown()}}class dl extends Gs.B{performAction(e,t,r){const i=this.get(e.actionType);return void 0===i?new Ks(!1):i(e,t,r)}}const pl="toggleGraphicSel";class fl{constructor(e){this.actionType=pl,this.graphic=e}}const gl="clrSel";class ml{constructor(){this.actionType=gl}}const yl="selGrphAct";class _l{constructor(e,t=!1){this.actionType=yl,this.graphics=[],this.isFirstTimeSelect=!1,this.graphics=e,this.clearExisting=t}}const vl="removeGraphics";class bl{constructor(e){this.actionType=vl,this.graphics=e}}const wl="changeZOrder";class Tl{constructor(e){this.actionType=wl,this.changeOrderType=e}}class xl{perform(){return{undoOp:new xl}}}class Cl{constructor(e,t,r){this.graphicCollection=e,this.graphic=t,this.index=r}perform(){const e=this.graphicCollection.setGraphicOrder(this.graphic,this.index);return void 0===e?{undoOp:new xl}:{undoOp:new Cl(this.graphicCollection,this.graphic,e)}}}class Sl{constructor(e,t,r){this.graphicCollection=e,this.graphic=t,this.changeOrderType=r}perform(){const e=this.graphicCollection.changeGraphicOrder(this.graphic,this.changeOrderType);return void 0===e?{undoOp:new xl}:{undoOp:new Cl(this.graphicCollection,this.graphic,e)}}}class Pl{constructor(e=1,t=0,r=0,i=1,n=0,s=0){this.m11=e,this.m12=t,this.m21=r,this.m22=i,this.m31=n,this.m32=s}apply(e){const t=this.m11*e.m11+this.m12*e.m21,r=this.m11*e.m12+this.m12*e.m22,i=this.m21*e.m11+this.m22*e.m21,n=this.m21*e.m12+this.m22*e.m22,s=this.m31*e.m11+this.m32*e.m21+e.m31,o=this.m31*e.m12+this.m32*e.m22+e.m32;return this.m11=t,this.m12=r,this.m21=i,this.m22=n,this.m31=s,this.m32=o,this}translate(e,t){return this.apply(El(e,t))}scale(e,t){return this.apply(Ml(e,t))}rotate(e){return this.apply(function(e){const t=Math.cos(e),r=Math.sin(e);return new Pl(t,r,-r,t,0,0)}(e))}}function El(e,t){return new Pl(1,0,0,1,e,t)}function Ml(e,t){return new Pl(e,0,0,t,0,0)}function Rl(e){const{pos:t,size:r,flip:i,rot:n}=e;if(0===n&&!i.x&&!i.y)return new d(t.x,t.y,t.x+r.width,t.y+r.height);const s=new u(t.x,t.y),o=new u(t.x+r.width,t.y),a=new u(t.x,t.y+r.height),l=new u(t.x+r.width,t.y+r.height),c=e.getCenter(),p=El(-c.x,-c.y).scale(i.x?-1:1,i.y?-1:1).rotate((0,h.Yr)(n)).translate(c.x,c.y);s.multiply(p),o.multiply(p),a.multiply(p),l.multiply(p);const f=Math.min(s.x,o.x,a.x,l.x),g=Math.min(s.y,o.y,a.y,l.y),m=Math.max(s.x,o.x,a.x,l.x),y=Math.max(s.y,o.y,a.y,l.y);return new d(f,g,m,y)}class Al{constructor(e,t){this.type=0,this.x=e,this.y=t}}class Bl{constructor(e,t,r,i,n=!1){this.type=1,this.scaleX=e,this.scaleY=t,this.originX=r,this.originY=i,this.lockAspectRatio=n}}class Il{constructor(e){this.type=2,this.rotation=e}}function Fl(e,t){const r=[...t],i=r.map((e=>Rl(e.anchor.transform)));let n;return n=void 0!==e.alignToBounds?e.alignToBounds:i.reduce(((e,t)=>new d(Math.min(e.left,t.left),Math.min(e.top,t.top),Math.max(e.right,t.right),Math.max(e.bottom,t.bottom))),new d(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE)),_n("GC2Align",new Map([["AlignType",e.alignType.toString()]])),r.map(((t,r)=>new ja(t.anchor,qa(t.anchor.transform,function(e,t,r){switch(e){case 0:return new Al(t.left-r.left,0);case 1:return new Al(t.center().x-r.center().x,0);case 2:return new Al(t.right-r.right,0);case 3:return new Al(0,t.top-r.top);case 4:return new Al(0,t.center().y-r.center().y);case 5:return new Al(0,t.bottom-r.bottom);default:(0,xn.t)(e)}}(e.alignType,n,i[r]),!0))))}function Dl(e,t){const r=[];for(const e of t)r.push({graphic:e,bounds:Rl(e.anchor.transform)});if(r.length<3)return[];const{closestGraphicToBounds:i,furthestGraphicToBounds:n,closestBoundToOrigin:s,furthestBoundToOrigin:o}=function(e,t){let r,i,n=Number.MIN_VALUE,s=Number.MAX_VALUE;if(void 0!==t.distributeToBounds)s=0===t.distributeType?t.distributeToBounds.left:t.distributeToBounds.top,n=0===t.distributeType?t.distributeToBounds.right:t.distributeToBounds.bottom;else for(const o of e){const e=o.bounds,a=0===t.distributeType?e.right:e.bottom,l=0===t.distributeType?e.left:e.top;a<s&&(r=o.graphic,s=a),l>n&&(i=o.graphic,n=l)}return{closestGraphicToBounds:r,furthestGraphicToBounds:i,closestBoundToOrigin:s,furthestBoundToOrigin:n}}(r,e),a=r.filter((({graphic:e})=>e!==i&&e!==n)),l=function(e,t){let r=0;if(0===t)for(const t of e)r+=t.bounds.width();else for(const t of e)r+=t.bounds.height();return r}(a,e.distributeType);0===e.distributeType?a.sort(Ll):a.sort(kl);const c=void 0===e.distributeToBounds?r.length-1:r.length+1;let h=s;const u=(o-s-l)/c;return a.map((t=>{const r=h+u;return h=0===e.distributeType?r+t.bounds.width():r+t.bounds.height(),new ja(t.graphic.anchor,qa(t.graphic.anchor.transform,function(e,t,r){switch(e){case 0:return new Al(t-r.left,0);case 1:return new Al(0,t-r.top);default:(0,xn.t)(e)}}(e.distributeType,r,t.bounds),!0))}))}function Ll(e,t){return e.bounds.left+e.bounds.width()/2-(t.bounds.left+t.bounds.width()/2)}function kl(e,t){return e.bounds.top+e.bounds.height()/2-(t.bounds.top+t.bounds.height()/2)}class Ol{constructor(e,t){this.collection=e,this.graphics=t}perform(){const e=this.graphics.map((e=>[e,this.collection.getGraphicOrder(e)])).filter((e=>void 0!==e[1]));return this.collection.removeGraphics(this.graphics),{undoOp:new Ul(this.collection,e)}}}class Ul{constructor(e,t){this.collection=e,this.graphics=t}perform(){return this.collection.addGraphicsAt(this.graphics.sort(((e,t)=>e[1]-t[1]))),{undoOp:new Ol(this.collection,this.graphics.map((([e])=>e)))}}}class Nl{constructor(e,t,r){this.collection=e,this.source=t,this.target=r}perform(){const e=this.collection.getGraphicOrder(this.source);return void 0===e?{undoOp:new xl}:(this.collection.removeGraphics([this.source]),this.collection.addGraphicsAt([[this.target,e]]),{undoOp:new Nl(this.collection,this.target,this.source)})}}function Vl(e,t){return t.hasGraphic(e.graphic)?t.removeGraphics([e.graphic]):t.addGraphics([e.graphic]),!0}function Gl(e,t){const r=[];for(const e of t.graphic.model)r.push(e);return t.setGraphics(r),!0}function zl(e,t){return t.clear(),!0}function Hl(e,t,r){let i=e.clearExisting;return e.graphics.forEach((e=>{i=i||!t.hasGraphic(e)})),i&&(t.setGraphics(e.graphics),e.isFirstTimeSelect=!0,r.actionInvoker.invoke(e)),!0}function Wl(e,t){var r;return[new Ol(t.graphic.model,null!==(r=e.graphics)&&void 0!==r?r:[...t])]}function jl(e,t){return[new Nl(t.graphic.model,e.source,e.target)]}function ql(e,t){const r=[],i=e.changeOrderType,n=[];for(const e of t)n.push(e);switch(i){case 0:case 3:n.reverse().forEach((e=>{r.push(new Sl(t.graphic.model,e,i))}));break;case 1:case 2:n.forEach((e=>{r.push(new Sl(t.graphic.model,e,i))}));break;default:(0,xn.t)(i)}return r}var Xl;!function(e){e[e.None=0]="None",e[e.Alt=1]="Alt",e[e.Ctrl=2]="Ctrl",e[e.Shift=4]="Shift",e[e.CtrlAlt=3]="CtrlAlt",e[e.CtrlShift=6]="CtrlShift",e[e.CtrlAltShift=7]="CtrlAltShift"}(Xl||(Xl={}));class $l extends Gs.B{constructor(e){super([]);for(const t of e)this.registerShortcut(t)}registerShortcut(e){const t=this.get(e.key);void 0!==t?t[e.modifiers]=e.performer:this.register(e.key,{[e.modifiers]:e.performer})}performShortcut(e,t,r){const i=this.get(function(e){const t=e.key;return 1===t.length&&(e.shiftKey||e.getModifierState("CapsLock"))?t.toLocaleLowerCase():t}(e));if(void 0!==i){const n=i[function(e){let t=Xl.None;return e.altKey&&(t|=Xl.Alt),(window.navigator.userAgent.indexOf("Macintosh")>=0?e.metaKey:e.ctrlKey)&&(t|=Xl.Ctrl),e.shiftKey&&(t|=Xl.Shift),t}(e)];if(void 0!==n)return n(e,t,r)}return{isHandled:!1}}}function Kl(e,t){return Zl(new Al(e,t))}function Yl(e,t){return Zl(new Bl(e,t,0,0))}function Jl(e){return Zl(new Il(e))}function Zl(e){return(t,r,i)=>(i.actionInvoker.invoke(new Xa(e)),{isHandled:!0})}function Ql(e,t,r){return r.actionInvoker.invoke(new bl),{isHandled:!0}}function ec(e,t,r){return t.length>0?(r.actionInvoker.invoke(new ml),{isHandled:!0}):{isHandled:!1}}function tc(e,t){return function(e,t){const r=e.graphic.model,i=r.length;if(0===i)return!1;let n;if(0===e.length)n=0===t?0:i-1;else{const s=e.selections[e.length-1],o=r.getGraphicOrder(s.graphic);if(void 0===o)return!1;n=(o+(1===t?-1:1))%i}const s=r.getGraphicAt(n);void 0!==s&&e.setGraphics([s])}(t,e.shiftKey?1:0),{isHandled:!0}}function rc(e){return(t,r,i)=>(i.actionInvoker.invoke(new Tl(e)),{isHandled:!0})}class ic{dispatchAction(e,t,r,i){let n=!1;const s=[];for(const i of t.selections){const t=r.editorRegistry.performAction(e,i,r);t.performed&&(n=!0,t.editOps.length>0&&s.push(...t.editOps))}return n?new Ks(!0,s):i.performAction(e,t,r)}dispatchKeyboardEvent(e,t,r,i){if(1===t.selections.length){const i=r.editorRegistry.processKeyboardEvent(e,t.selections[0],r);if(i.isHandled)return i}return"keydown"===e.type?i.performShortcut(e,t,r):{isHandled:!1}}}function nc(e,t){const r=t.graphic.anchor;return[new Za(t.graphic.model,e.crop),new ja(r,$a(r.transform,new Xa(e.scale)))]}function sc(e,t){return t.cropState.inCropMode!==e.isCropActive()&&(t.cropState.setInCropMode(e.cropMode),!0)}class oc{constructor(e,t,r,i,n){this.glow=e,this.shadow=t,this.innerShadow=r,this.reflection=i,this.softEdges=n}clone(){var e,t,r,i,n;return new oc(null===(e=this.glow)||void 0===e?void 0:e.clone(),null===(t=this.shadow)||void 0===t?void 0:t.clone(),null===(r=this.innerShadow)||void 0===r?void 0:r.clone(),null===(i=this.reflection)||void 0===i?void 0:i.clone(),null===(n=this.softEdges)||void 0===n?void 0:n.clone())}equals(e){return Jo(this.glow,e.glow)&&Jo(this.shadow,e.shadow)&&Jo(this.innerShadow,e.innerShadow)&&Jo(this.reflection,e.reflection)&&Jo(this.softEdges,e.softEdges)}}class ac{constructor(e,t,r,i=!1){this.model=e,this.prop=t,this.value=r,i&&(this.mergePolicy=new cc(e,t))}perform(){const e=this.model[this.prop];return this.model[this.prop]=this.value,{undoOp:new ac(this.model,this.prop,e)}}}class lc{}class cc{constructor(e,t){this.type=lc,this.model=e,this.prop=t}shouldMergeWithPrevious(e){return void 0!==e&&e.type===lc&&e.model===this.model&&e.prop===this.prop}}class hc{constructor(e,t,r,i,n,s){this.hueSaturationLuminance=e,this.brightnessContrast=t,this.recolor=r,this.colorTemperature=i,this.sharpness=n,this.pictureEffectProperties=s}clone(){var e,t,r,i,n,s;return new hc(null===(e=this.hueSaturationLuminance)||void 0===e?void 0:e.clone(),null===(t=this.brightnessContrast)||void 0===t?void 0:t.clone(),null===(r=this.recolor)||void 0===r?void 0:r.clone(),null===(i=this.colorTemperature)||void 0===i?void 0:i.clone(),null===(n=this.sharpness)||void 0===n?void 0:n.clone(),null===(s=this.pictureEffectProperties)||void 0===s?void 0:s.clone())}equals(e){return Jo(this.hueSaturationLuminance,e.hueSaturationLuminance)&&Jo(this.brightnessContrast,e.brightnessContrast)&&Jo(this.recolor,e.recolor)&&Jo(this.colorTemperature,e.colorTemperature)&&Jo(this.sharpness,e.sharpness)&&Jo(this.pictureEffectProperties,e.pictureEffectProperties)}}class uc{constructor(e,t){this.brightness=e,this.contrast=t}equals(e){return this.brightness===e.brightness&&this.contrast===e.contrast}clone(){return new uc(this.brightness,this.contrast)}}class dc{constructor(e,t,r){this.hueRotation=e,this.saturationFactor=t,this.luminanceFactor=r}equals(e){return this.hueRotation===e.hueRotation&&this.saturationFactor===e.saturationFactor&&this.luminanceFactor===e.luminanceFactor}clone(){return new dc(this.hueRotation,this.saturationFactor,this.luminanceFactor)}}function pc(e){return 4===e.type}function fc(e){return e<0?0:e<=.798354?12.92*e:e<255?269.025*Math.pow(e/255,1/2.4)-14.025:255}function gc(e){return new ea(fc(e.r),fc(e.g),fc(e.b),e.a)}function mc(e,t,r){const i=yc(r);return i<60?e+(t-e)*i/60:i<180?t:i<240?e+(t-e)*(240-i)/60:e}function yc(e){return e<0?e+360:e>=360?e-360:e}function _c(e){return 1===e.type}function vc(e){return e.transforms.length>0?function(e){return new ea(Ko(e.r),Ko(e.g),Ko(e.b),e.a)}(function(e){return pc(e)?function(e){const t=e.h,r=e.s,i=e.l,n=i<=.5?i*(r+1):i+r-i*r,s=2*i-n;return new ea(255*mc(s,n,t+120),255*mc(s,n,t),255*mc(s,n,t-120),e.a)}(e):ia(e)?gc(e):e}(e.transforms.reduce(((e,t)=>t.transform(e)),e))):e}function bc(e,t){if(ta(e))return vc(e);if(_c(e)){if(void 0===t)throw new Error("ThemeInfo should be provided to resolve SchemeColors.");return vc(function(e,t){const r=e.theme.colorScheme.presets[e.schemeMapping[t.presetColorType]];return new ea(r.r,r.g,r.b,r.a,[...t.transforms])}(t,e))}throw new Error(`Unsupported color type to resolve: ${e.type}.`)}function wc(e){const t=(new DOMParser).parseFromString(e,"image/svg+xml");if(0!==t.querySelectorAll("parsererror").length)throw Error("The XML could not be read");return t.firstElementChild}new a((()=>{const e=[[0,"Background1"],[2,"Bakcground2"],[1,"Text1"],[3,"Text2"],[4,"Accent1"],[5,"Accent2"],[6,"Accent3"],[7,"Accent4"],[8,"Accent5"],[9,"Accent6"],[10,"Hyperlink"],[11,"FollowedHyperlink"],[13,"MainDark1"],[15,"MainDark2"],[14,"MainLight1"],[16,"MainLight2"]],t=new Map(e),r=new Map(e.map((([e,t])=>[t,e])));return{toString:e=>{const r=t.get(e);if(void 0===r)throw new Error("Unknown PresetSchemeColor");return r},toEnum:e=>r.get(e)}}));class Tc{constructor(e){this.type=1,this.color=e}clone(){return new Tc(this.color)}equals(e){return xc(e)&&this.color.equals(e.color)}}function xc(e){return 1===e.type}class Cc{constructor(){this.type=0}clone(){return new Cc}equals(e){return Sc(e)}}function Sc(e){return 0===e.type}function Pc(e,t){return Wn(t.data.mimeType),new ac(t,"fill",e.fill)}function Ec(e){return 2===e.type}class Mc{constructor(e,t,r,i,n,s,o,a){this.fill=e,this.weight=t,this.dash=r,this.headEnd=i,this.tailEnd=n,this.join=s,this.compound=o,this.cap=a}clone(){var e,t,r,i,n;return new Mc(null===(e=this.fill)||void 0===e?void 0:e.clone(),this.weight,null===(t=this.dash)||void 0===t?void 0:t.clone(),null===(r=this.headEnd)||void 0===r?void 0:r.clone(),null===(i=this.tailEnd)||void 0===i?void 0:i.clone(),null===(n=this.join)||void 0===n?void 0:n.clone(),this.compound,this.cap)}equals(e){return Jo(this.fill,e.fill)&&this.weight===e.weight&&Jo(this.dash,e.dash)&&Jo(this.headEnd,e.headEnd)&&Jo(this.tailEnd,e.tailEnd)&&Jo(this.join,e.join)&&this.compound===e.compound&&this.cap===e.cap}resolveFrom(e){void 0!==this.fill&&!Ec(this.fill)||void 0===e.fill||(this.fill=e.fill.clone()),void 0===this.weight&&void 0!==e.weight&&(this.weight=e.weight),void 0===this.dash&&void 0!==e.dash&&(this.dash=e.dash.clone()),void 0===this.headEnd&&void 0!==e.headEnd&&(this.headEnd=e.headEnd.clone()),void 0===this.tailEnd&&void 0!==e.tailEnd&&(this.tailEnd=e.tailEnd.clone()),void 0===this.join&&void 0!==e.join&&(this.join=e.join.clone()),void 0===this.compound&&void 0!==e.compound&&(this.compound=e.compound),void 0===this.cap&&void 0!==e.cap&&(this.cap=e.cap)}}function Rc(e){return void 0===e?"none":function(e){return`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`}(e)}function Ac(e,t){return function(e){switch(e){case 1:return[1,3];case 2:return[4,3];case 4:return[4,3,1,3];case 3:return[8,3];case 5:return[8,3,1,3];case 6:return[8,3,1,3,1,3];case 7:return[3,1];case 8:return[1,1];case 9:return[3,1,1,1];case 10:return[3,1,1,1,1,1];case 0:return[];default:(0,xn.t)(e)}}(e).map((e=>e*t)).join(" ")}function Bc(e,t){const r=function(e,t){const r=void 0!==e?e.clone():new Mc;return void 0!==t.fill&&(r.fill=t.fill),void 0!==t.weight&&(r.weight=t.weight),void 0!==t.dash&&(r.dash=t.dash),void 0!==t.headEnd&&(r.headEnd=t.headEnd),void 0!==t.tailEnd&&(r.tailEnd=t.tailEnd),void 0!==t.join&&(r.join=t.join),void 0!==t.compound&&(r.compound=t.compound),r}(t.line,e);return Wn(t.data.mimeType),new ac(t,"line",r)}class Ic{constructor(e,t,r){this.picture=e,this.placeholder=t,this.isUndoable=r}perform(){const e=this.isUndoable?new Ic(this.picture,this.picture.placeholder,this.isUndoable):void 0;return this.picture.placeholder=this.placeholder,{undoOp:e}}}const Fc="GC2PictureModification";function Dc(e,t){const r=function(e,t){var r;const i=null!==(r=null==e?void 0:e.clone())&&void 0!==r?r:new oc;return void 0!==t.glow&&(i.glow=t.glow),void 0!==t.shadow&&(i.shadow=t.shadow),void 0!==t.innerShadow&&(i.innerShadow=t.innerShadow),void 0!==t.reflection&&(i.reflection=t.reflection),void 0!==t.softEdges&&(i.softEdges=t.softEdges),i}(t.effects,e);return new ac(t,"effects",r)}function Lc(e,t){const r=function(e,t){var r;const i=null!==(r=null==e?void 0:e.clone())&&void 0!==r?r:new hc;return void 0!==t.brightnessContrast&&(i.brightnessContrast=t.brightnessContrast),void 0!==t.colorTemperature&&(i.colorTemperature=t.colorTemperature),void 0!==t.hueSaturationLuminance&&(i.hueSaturationLuminance=t.hueSaturationLuminance),void 0!==t.pictureEffectProperties&&(i.pictureEffectProperties=t.pictureEffectProperties),void 0!==t.recolor&&(i.recolor=t.recolor),void 0!==t.sharpness&&(i.sharpness=t.sharpness),i}(t.pictureEffects,e);return _n(Fc,new Map([["ActionName",e.actionType]])),new ac(t,"pictureEffects",r,e.mergeUndo)}function kc(e,t){const r=function(e,t){var r;const i=null!==(r=null==e?void 0:e.clone())&&void 0!==r?r:new hc;return void 0!==i.brightnessContrast?i.brightnessContrast.brightness=t.brightness:i.brightnessContrast=new uc(t.brightness,0),i}(t.pictureEffects,e);return _n(Fc,new Map([["ActionName",e.actionType]])),new ac(t,"pictureEffects",r,e.mergeUndo)}function Oc(e,t){const r=function(e,t){var r;const i=null!==(r=null==e?void 0:e.clone())&&void 0!==r?r:new hc;return void 0!==i.brightnessContrast?i.brightnessContrast.contrast=t.contrast:i.brightnessContrast=new uc(0,t.contrast),i}(t.pictureEffects,e);return _n(Fc,new Map([["ActionName",e.actionType]])),new ac(t,"pictureEffects",r,e.mergeUndo)}function Uc(e,t){const r=function(e,t){var r;const i=null!==(r=null==e?void 0:e.clone())&&void 0!==r?r:new hc;return void 0!==i.hueSaturationLuminance?i.hueSaturationLuminance.saturationFactor=t.saturation:i.hueSaturationLuminance=new dc(0,t.saturation,1),i}(t.pictureEffects,e);return _n(Fc,new Map([["ActionName",e.actionType]])),new ac(t,"pictureEffects",r,e.mergeUndo)}function Nc(e,t){return Wn(t.data.mimeType),new xl}function Vc(e,t){var r;return new ac(t.graphic.anchor,"locks",Object.assign(Object.assign({},null!==(r=t.graphic.anchor.locks)&&void 0!==r?r:{}),{aspectRatio:e.lockAspectRatio}))}function Gc(e,t){return new ac(t,"geometry",e.geometry)}function zc(e,t){return _n(Fc,new Map([["ActionName",e.actionType]])),new ac(t,"opacity",100-e.transparency,e.mergeUndo)}function Hc(e,t){return _n(Fc,new Map([["ActionName",e.actionType]])),new ac(t,"opacity",e.opacity,e.mergeUndo)}function Wc(e,t){var r,i;return new Ic(null!==(i=null===(r=e.graphic)||void 0===r?void 0:r.model)&&void 0!==i?i:t,e.placeholder,e.isUndoable)}function jc(e,t){var r,i;return new ac(null!==(i=null===(r=e.graphic)||void 0===r?void 0:r.model)&&void 0!==i?i:t,"data",e.data)}function qc(){const e=new dl([["changeFillColor",za(Pc)],["changeLineProps",za(Bc)],["changeEffects",za(Dc)],["changeTheme",za(Nc)],["changePictureBrightness",za(kc)],["changePictureContrast",za(Oc)],["changePictureSaturation",za(Uc)],["changePictureEffects",za(Lc)],["SetLockAspectRatio",(t=Vc,(e,r,i)=>new Ks(!0,[t(e,r,i)]))],["cropToGeometry",za(Gc)],["setOpacity",za(Hc)],["setPictureTransparency",za(zc)],[ha,za(Wc)],[nl,za(jc)]]);var t;return function(e){e.register(Qa,Ga(tl)).register("cropAndScale",Ga(nc)).register("enterExitCropMode",Va(sc))}(e),e}class Xc{dispatchAction(e,t,r,i){return i.performAction(e,t,r)}dispatchKeyboardEvent(e,t){const r={isHandled:!1};return t.cropState.keyboardEvent.emit(e,r),r}}const $c="tabSel";class Kc{constructor(e=0){this.actionType=$c,this.tabOrder=0,this.tabOrder=e}}const Yc="selectAllElements";class Jc{constructor(){this.actionType=Yc}}const Zc="setElementsToSel";class Qc{constructor(e){this.actionType=Zc,this.elementIds=e}}const eh="toggleElementsInSel";class th{constructor(e){this.actionType=eh,this.elementIds=e}}function rh(e,t){return t.clear(),!0}function ih(e,t){const r=t.graphic.model.smartArtData.elementList,i=[];for(const e of r)i.push(e);return t.setElements(i),!0}function nh(e,t){const r=[];return e.elementIds.forEach((e=>{const i=t.graphic.model.smartArtData.elementList.getElementById(e);void 0!==i&&r.push(i)})),t.setElements(r),!0}function sh(e,t){const r=[];for(const e of t)r.push(e.modelId);return t.graphic.model.deleteSubShapes(r)}function oh(e,t){const r=[];for(const e of t)r.push(e.modelId);return t.graphic.model.setSubShapeFillColor(r,e.color)}function ah(e,t){return function(e,t,r){if(0===e.length)return!1;const i=function(e,t,r){if(0===t.length)return-1;const i=0===r?0:t.length-1;if(0===e.length)return i;const n=e.getElementByIndex(e.length-1);if(void 0===n)return i;let s=t.getIndexById(n.id);return-1===s?i:(0===r?(s+=1,s>=t.length&&(s=0)):(s-=1,s<0&&(s=t.length-1)),s)}(e,t,r);if(-1===i)return!1;const n=t.getItemByIndex(i);return void 0!==n&&(e.setElements([n]),!0)}(t,Lo(t.graphic.model.smartArtData.elementList),e.tabOrder)}function lh(e,t){const r=[],i=[];return e.elementIds.forEach((e=>{const n=t.graphic.model.smartArtData.elementList.getElementById(e);void 0!==n&&(void 0!==t.getElementById(e)?i.push(n):r.push(n))})),i.length>0&&t.removeElements(i),r.length>0&&t.addElements(r),!0}function ch(e,t,r){return{isHandled:r.editorRegistry.performAction(new Jc,t,r).performed}}function hh(e,t,r){let i=!1;if(0===t.length){const e=t.graphic.model.smartArtData.elementList.getElementByIndex(0);void 0!==e&&(t.setElements([e]),i=!0)}return{isHandled:i}}function uh(e,t,r){return t.hasSubSelection()?{isHandled:r.editorRegistry.performAction(new ml,t,r).performed}:{isHandled:!1}}function dh(e,t,r){return t.hasSubSelection()?{isHandled:r.editorRegistry.performAction(new Kc(e.shiftKey?1:0),t,r).performed}:{isHandled:!1}}const ph="playVideo";class fh{constructor(){this.actionType=ph}}class gh{}class mh{constructor(e){this.type=gh,this.selectionUpdated=new l,this.graphic=e}teardown(){}save(){}restore(e){}clone(e){return new mh(e)}}function yh(e,t){return t.selectionUpdated.emit(0),new Ks(!0)}class _h{dispatchAction(e,t,r,i){return i.performAction(e,t,r)}dispatchKeyboardEvent(e,t,r){return" "===e.key?(r.actionInvoker.invoke(new fh),{isHandled:!0}):{isHandled:!1}}}class vh{}class bh extends class{constructor(e,t,r,i,n){this.data=e,this.sourceAnchorBounds=t,this.targetBounds=r,this.rotation=i,this.flip=n}}{constructor(e,t,r,i=0,n=new p){super(e,t,r,i,n),this.type=vh}}function wh(e){return e.type===vh}function Th(e){if(!wh(e))throw new Error(`Invalid renderData type: ${e.type}`)}class xh{}class Ch{constructor(e,t,r){this.type=xh,this.sceneGraphJson=e,this.interactivityJson=t,this.targetBounds=r}}class Sh{}class Ph{constructor(e,t,r,i){this.type=Sh,this.shapeBuilderRenderData=e,this.sourceAnchorBounds=t,this.targetBounds=r,this.embeddedImageList=i}}function Eh(e){return e.type===Sh}function Mh(e){return new d(e.pos.x,e.pos.y,e.pos.x+e.size.width,e.pos.y+e.size.height)}function Rh(e,t){const r=e;switch(r.renderDataType){case Ls.Base64Image:return function(e,t){return new bh(e.base64Data,Mh(t),Mh(e.targetBounds),e.rotation,new p(e.flip.x,e.flip.y))}(r,t);case Ls.ChartPlayerJson:return function(e,t){const{x:r,y:i}=t.pos,{width:n,height:s}=t.size;return new Ch(e.sceneGraphJson,e.interactivityJson,new d(r+n,i+s,n,s))}(r,t);case Ls.ShapeBuilderJson:return function(e,t){const r=function(e){let t=e;const r=t.indexOf("{");return r>0&&(t=t.substring(r)),JSON.parse(t)}(e.shapeBuilderJson);return function(e){return void 0!==e.shapeRenderData}(r)?new Ph(r.shapeRenderData,Mh(t),Mh(e.targetBounds),r.imageList):new Ph(r,Mh(t),Mh(e.targetBounds),void 0)}(r,t);default:return}}class Ah{constructor(e){this._isHandled=e}get_isHandled(){return this._isHandled}}class Bh{constructor(e){this._eventProcessResult=e}get_isHandled(){return this._eventProcessResult.isHandled}}const Ih="GC2RenderVeto";class Fh{constructor(e,t,r){this.trackerToAppInfo=new Map,this.brsConfig=e,this.shapeBuilderContext=t,this.ownerAlias=(ks.O.SmartArt,"gc2smartart")}logSetRenderData(e,t){const r=Dh(t,this.brsConfig);!function(e,t=new Map,r="gc2kpi"){mn.logKpiUsage(e,1,t,r)}(e.name,r,this.ownerAlias),_n(Ih,r,this.ownerAlias),this.trackerToAppInfo.set(e,t)}logSetTransform(e,t){this.trackerToAppInfo.set(e,t)}logFrameRendered(e){const t=this.brsConfig.gc2FidelityResponsivenessRenderVetoMs;e.forEach((e=>{var r;const i=this.trackerToAppInfo.get(e);if(void 0!==i&&i.size>0){this.trackerToAppInfo.delete(e),e.end(),i.forEach(((t,r)=>{if(r.toLowerCase().indexOf("starttime")>0){const n=r.replace(/starttime.*/gi,"DurationMs"),s=parseFloat(t),o=!isNaN(s)&&s>=0?(e.endTimeMs-s).toFixed(3):"";""!==o&&i.set(n,o),i.delete(r)}}));const n=null===(r=this.shapeBuilderContext)||void 0===r?void 0:r.getScenePerformanceSummaryAsMap();null==n||n.forEach(((t,r)=>{e.addEventToContextHistoryMap(r,t)}));const s=new Map([...i.entries(),...e.getEventDurationStringsMap(3).entries()]),o=new gn.A;o.extendedProperties=Dh(s,this.brsConfig);const a=function(e,t){const r=new Set;return e.forEach(((e,i)=>{if(i.toLowerCase().indexOf("actionname")>-1&&parseFloat(e)>t){const e=i.match(/ActionName_([a-zA-Z0-9]+)_ActionId_([a-zA-Z0-9\-]+)_([a-zA-Z]+)/),t=null!==e&&4===e.length?e[1]:"";r.add(t)}})),[...r]}(i,t);if(a.length>0){const e=new gn.A;e.extendedProperties=o.extendedProperties,e.extendedProperties.set("ActionsVetoed",a.toString()),e.extendedProperties.set("VetoCategory","Responsiveness"),function(e,t,r=!1,i=!0,n=new gn.A){mn.logKpiFailure(e,t,r,i,n)}(Ih,"FidelityResp",!1,!1,e)}e.addTimePoint("OnFrameRenderedEndTime"),o.extendedProperties.set("TimePoints",e.getTimePointCollectionString(3)),function(e,t=new gn.A){mn.logKpiSuccess(e,t)}(e.name,o),(0,b.PN)(0,55e3,`${Lh(s)}`)}}))}}function Dh(e,t){const r=new Map,i=[];let n="";try{e.set("isGC2WebGLRenderTargetEnabled",t.isGC2WebGLRenderTargetEnabled.toString()),e.forEach(((e,t)=>{if(t.toLowerCase().indexOf("actionname")>-1){const r=t.match(/ActionName_([a-zA-Z0-9]+)_ActionId_([a-zA-Z0-9\-]+)_([a-zA-Z]+)/);if(null!==r&&4===r.length){const t=new Map;t.set("ActionName",r[1]),t.set("ActionId",r[2]),n=r[3],t.set(n,e),i.push(Lh(t))}}else r.set(t,e)})),r.set(`ActionMetadataWith${n}`,i.toString())}catch(e){(0,b.PN)(0,55e3,`Exception: ${e.message}`)}return r}function Lh(e){const t={};return e.forEach(((e,r)=>{t[r]=e})),JSON.stringify(t)}class kh{get viewModel(){return void 0===this.currentPresenter&&(0,y._)(0,"CurrentPresenter not resolved."),this.currentPresenter.viewModel}constructor(e,t,r,i){this.viewModelUpdated=new l,this.isFallbackRenderDataPresenter=!1,this.onModelUpdated=(e,t)=>{this.updateViewModel(t,!1)},this.onViewModelUpdated=e=>{this.updateViewModel(e,!0)},this.graphic=e,this.context=t,this.editContext=i,this.modelPresenterCreator=r,this.graphic.model.modelUpdated.on(this.onModelUpdated),this.updateViewModel()}teardown(){this.graphic.model.modelUpdated.off(this.onModelUpdated),this.teardownCurrentPresenter()}teardownCurrentPresenter(){void 0!==this.currentPresenter&&(this.currentPresenter.viewModelUpdated.off(this.onViewModelUpdated),this.currentPresenter.teardown())}updateViewModel(e,t){this.ensureCurrentPresenter(e),this.viewModelUpdated.emit(t?e:void 0)}ensureCurrentPresenter(e){(void 0===this.currentPresenter||void 0===this.graphic.model.fallbackRenderData&&this.isFallbackRenderDataPresenter||void 0!==this.graphic.model.fallbackRenderData&&!this.isFallbackRenderDataPresenter||void 0!==this.graphic.model.fallbackRenderData&&this.isFallbackRenderDataPresenter&&this.currentPresenter.renderDataType!==this.graphic.model.fallbackRenderData.type)&&this.recreatePresenter(e)}recreatePresenter(e){if(this.teardownCurrentPresenter(),void 0!==this.graphic.model.fallbackRenderData){void 0===this.context.renderDataPresenterCreator&&(0,y._)(0,"RenderDataPresenterCreator not provided");const t=this.context.renderDataPresenterCreator.createRenderDataPresenter(this.graphic,this.context,this.editContext);this.currentPresenter=t,this.isFallbackRenderDataPresenter=!0,t.init(this.onViewModelUpdated,e)}else this.currentPresenter=this.modelPresenterCreator(this.graphic,this.context,this.editContext),this.isFallbackRenderDataPresenter=!1,this.currentPresenter.viewModelUpdated.on(this.onViewModelUpdated)}}var Oh,Uh,Nh=n(9140),Vh=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}(),Gh=new(function(){function e(){this.externalLogger=new Vh}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,r,i){this.externalLogger.sendTraceTag(e,t,r,i)},e.prototype.debugAssertTag=function(e,t,r,i){this.externalLogger.debugAssertTag(e,t,r,i)},e.prototype.shipAssertTag=function(e,t,r,i){this.externalLogger.shipAssertTag(e,t,r,i)},e}());!function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_MSOSP_FileMenuCommands=202]="msoulscat_MSOSP_FileMenuCommands",e[e.msoulscat_MSOSP_OTelJS=225]="msoulscat_MSOSP_OTelJS",e[e.msoulscat_MSOSP_OTelJSInWebWoker=227]="msoulscat_MSOSP_OTelJSInWebWoker",e[e.msoulscat_MSOSP_OTelJSWebWorkerPrototype=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_Dictation=394]="msoulscat_Wac_Dictation",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptAnimation=800]="msoulscat_Wac_PptAnimation",e[e.msoulscat_Wac_PptLive=833]="msoulscat_Wac_PptLive",e[e.msoulscat_Wac_PptMWeb=834]="msoulscat_Wac_PptMWeb",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_PptSlideshow=830]="msoulscat_Wac_PptSlideshow",e[e.msoulscat_Wac_PptView=822]="msoulscat_Wac_PptView",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard",e[e.msoulscat_Wac_CatchUpFlyout=3012]="msoulscat_Wac_CatchUpFlyout",e[e.msoulscat_Wac_WordDesigner=3016]="msoulscat_Wac_WordDesigner",e[e.msoulscat_Wac_ModernFontPicker=3021]="msoulscat_Wac_ModernFontPicker",e[e.msoulscat_Wac_UnifiedUiHost=3027]="msoulscat_Wac_UnifiedUiHost"}(Oh||(Oh={})),function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(Uh||(Uh={}));var zh={Abadi:"23643452060",Aldhabi:"35299853273","Book Antiqua":"37426579782",Aparajita:"34426069361","Arabic Typesetting":"27140849423",Arial:"44117086606","Arial Nova":"31875808322","Baskerville Old Face":"29618310377","Bell MT":"33966854762",Bembo:"20740564562","Bodoni MT":"29556528177","Bradley Hand ITC":"25733548319","Berlin Sans FB":"33676382891",Broadway:"27289878557","Bookshelf Symbol 7":"30039797956",Calibri:"44327025345","Californian FB":"29110430052","Calisto MT":"30111742330",Candara:"38835860617",Castellar:"28249279615","Century Schoolbook":"39048582419",Centaur:"41679335390",Century:"38027012730","Colonna MT":"30027433166","Comic Sans MS":"34621977852",Consolas:"33167468773",Constantia:"31448377222",Corbel:"35115404204","Courier New":"39673202522",Dante:"33833536951",DaunPenh:"29920401905",David:"28736817646",DengXian:"53665963276",DokChampa:"40540473796",Dubai:"32761028732",Ebrima:"37668183528","Eras ITC":"30212826222",Euphemia:"47320991779","Felix Titling":"30189168463",Forte:"28669186030","Franklin Gothic Book":"35148505830","Franklin Gothic":"43557860315",FrankRuehl:"32836168823","Freestyle Script":"29733748199",Gabriola:"34438341383",Gadugi:"56434144182",Garamond:"36480320667",Gautami:"39643252760",Georgia:"35602463917","Georgia Pro":"22657516329",Gigi:"34660959760","Gill Sans MT":"31805007993",Gisha:"33374253261","Century Gothic":"35046754488",Grotesque:"30685830985","Hadassah Friedlaender":"24086370297",Harrington:"22558053376",HGMaruGothicMPRO:"27788582244","Microsoft Himalaya":"29604316660","High Tower Text":"33278643157","Imprint MT Shadow":"22676891790","Ink Free":"20542252197","Iskoola Pota":"38011673001","Blackadder ITC":"35330309812","Javanese Text":"25397689379",Jokerman:"33080106939","Juice ITC":"36384807514",Kalinga:"41956811750",Kartika:"41343400187","Khmer UI":"29171977002",Kokila:"40302860138","Kunstler Script":"23730354380","Lucida Sans Unicode":"35821919345","Lao UI":"40164261239",Latha:"33890753080","Lucida Bright":"35187686457","Leelawadee UI":"31932804840",Leelawadee:"46240451791","Lucida Fax":"28107311451","Lucida Sans":"32760138905","Levenim MT":"27898460535","Maiandra GD":"28277029587","Sakkal Majalla":"33893302280","Malgun Gothic":"41226677490",Mangal:"41732083461","Matura MT Script Capitals":"29406417122","Microsoft Sans Serif":"40086055104",Mistral:"28668461660","Myanmar Text":"27700417454","Modern No. 20":"30301309713","Mongolian Baiti":"33245419878",MoolBoran:"24909662691",Miriam:"28685692097","Miriam Fixed":"25290634525","Microsoft GothicNeo":"31766265843","Microsoft Uighur":"38231195238","Microsoft Yi Baiti":"28270850659","MT Extra":"11953716540","MV Boli":"29162370688","News Gothic MT":"21498099258","Neue Haas Grotesk Text Pro":"31862445252","Nirmala UI":"32551979382",Narkisim:"33025118934","Microsoft New Tai Lue":"23961355090",Nyala:"43161688999",Onyx:"42004410731","MS Outlook":"28536695775","Palatino Linotype":"38312838300",Papyrus:"30541236361",Perpetua:"32262981054","Microsoft PhagsPa":"35191080581","Plantagenet Cherokee":"42807393920",Pristina:"35921879813",Raavi:"33085177893","MS Reference Sans Serif":"34439023310",Rockwell:"34805489950","Rockwell Nova":"20395950770",Rod:"29067043464","Sanskrit Text":"32723779410","Segoe Print":"37891634245","Segoe Script":"27513503573","Segoe UI Emoji":"37786275516","Segoe UI Historic":"42513575706","Segoe UI Symbol":"48871381854",Selawik:"22470592074","Shonar Bangla":"33615082001",Shruti:"38794912506",FangSong:"29400494812",SimHei:"32980441079",KaiTi:"28214366148","Simplified Arabic":"38146384601","Simplified Arabic Fixed":"36112958963","SimSun-ExtB":"27824684633","Snap ITC":"37617127837","Source Sans Pro":"35021733747",STCaiyun:"32670116116",STFangsong:"32515377567",STHupo:"35991369992",STKaiti:"34202148807",STXihei:"27891586950",STXingkai:"32439372444",STXinwei:"32879433410",STZhongsong:"28692380284",Sylfaen:"45112038400",Symbol:"26522609597",Tahoma:"50941620409","Microsoft Tai Le":"35423324637","Tw Cen MT":"35523432091","Tempus Sans ITC":"22990956528","TH SarabunPSK":"40796829544","Times New Roman":"39238612322","Traditional Arabic":"41360408994","Trebuchet MS":"34633337668",Tunga:"35419190202",Univers:"25504584715",DilleniaUPC:"34702376310",EucrosiaUPC:"30852963300",FreesiaUPC:"32772486316",IrisUPC:"35393526279",JasmineUPC:"32534838392",KodchiangUPC:"32774023165",LilyUPC:"34962827580","Urdu Typesetting":"26145919835",Utsaah:"42140102901",Vani:"31070026496",Verdana:"31984381249","Verdana Pro":"29856001200",Vijaya:"31573029587","Viner Hand ITC":"26032089504","Vladimir Script":"25940660647",Vrinda:"34712615977",Webdings:"33805005358",Wingdings:"37798520877","Wingdings 2":"36638629124","Wingdings 3":"32314200193","Yu Mincho":"31515951246"},Hh=function(){function e(e){this.element=e}return e.create=function(){var t,r=document.createElement("style");return r.type="text/css",document.head||Gh.sendTraceTag(594343712,Oh.msoulscat_ES_EWAJSChart,Uh.Error,"Unable to mount font service"),null===(t=document.head)||void 0===t||t.appendChild(r),new e(r)},e.prototype.load=function(e){var t=zh.hasOwnProperty(e);if(Gh.sendTraceTag(595620998,Oh.msoulscat_ES_EWAJSChart,Uh.Info,"font available on service: "+t),t){var r=zh[e];this.element.textContent+='@font-face { font-family:"'+e+'_MSFontService"; src:url("https://fs-edog.microsoft.com/fs/4.7/rawguids/'+r+'"); } \n'}return t},e}(),Wh=function(){function e(){}return e.ensureFont=function(t){if(e.fontService||(e.fontService=Hh.create()),this.installedFonts.hasOwnProperty(t))return this.installedFonts[t];0===this.defaultFontSizes.length&&this.measureDefaultFonts();for(var r=!0,i=0;i<this.defaultFonts.length;i+=1)if(this.measure(t+","+this.defaultFonts[i])!==this.defaultFontSizes[i]){r=!1;break}return this.installedFonts[t]=!r,Gh.sendTraceTag(595620999,Oh.msoulscat_ES_EWAJSChart,Uh.Info,"font available: "+this.installedFonts[t]),r&&this.fontService&&(this.installedFonts[t]=this.fontService.load(t)),this.installedFonts[t]},e.measureDefaultFonts=function(){var e=this;this.defaultFontSizes=this.defaultFonts.map((function(t){return e.measure(t)}))},e.measure=function(e){var t=this.createContentDiv(e);document.body.appendChild(t);var r=t.clientWidth+","+t.clientHeight;return document.body.removeChild(t),r},e.createContentDiv=function(e){var t=document.createElement("div");return t.style.position="absolute",t.style.display="inline",t.style.visibility="hidden",t.style.fontSize="100px",t.style.letterSpacing="normal",t.style.lineHeight="normal",t.style.whiteSpace="nowrap",t.style.fontFamily=e,t.textContent=this.testString,t},e.defaultFontSizes=[],e.defaultFonts=["monospace","sans-serif","serif"],e.testString="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890~!@#$%^&*()-+",e.installedFonts={},e}(),jh=function(){function e(e,t,r){var i,n,s=this;this.element=e,this.seenError=!1;var o=new Nh.OfficeRenderHost;try{for(var a=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),l=a.next();!l.done;l=a.next()){var c=l.value;o.setFeatureIsEnabled(c.name,c.isEnabled)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}this.chartPlayer=new Nh.ChartPlayer({renderer:Nh.IvyRenderer.Svg,disableChartElementResize:!1},this.element,o),this.chartPlayer.on("error",(function(e,t){return s.handleChartPlayerError(t)})),this.chartPlayer.on("log",(function(e,t){return s.handleChartPlayerLog(t)})),r&&(this.chartPlayer.on("select",(function(e,t,i){"select"===e&&r.onSelectionChange(t||null,i)})),this.chartPlayer.on("dblclick",(function(e,t){"dblclick"===e&&r.onDoubleClick(t||null)})))}return e.prototype.select=function(e){this.chartPlayer.select(e||void 0)},e.prototype.navigateNextSibling=function(e){e?this.chartPlayer.selectNextSibling():this.chartPlayer.selectPreviousSibling()},e.prototype.selectParent=function(){this.chartPlayer.selectParent()},e.prototype.selectFirstChild=function(){this.chartPlayer.selectFirstChild()},e.prototype.setInteractivityEnabled=function(e){this.chartPlayer.isInteractivityEnabled=e},e.prototype.getSelectionDescription=function(){return this.chartPlayer.getDescription()||""},e.prototype.renderImage=function(e){if(!e)return Gh.sendTraceTag(593512201,Oh.msoulscat_ES_EWAJSChart,Uh.Error,"Data URI must be valid"),!1;this.seenError=!1;var t={data:e,mimeType:""};try{return this.chartPlayer.setRenderer(Nh.IvyRenderer.Image),this.chartPlayer.render(t),!this.seenError}catch(e){return Gh.sendTraceTag(593515406,Oh.msoulscat_ES_EWAJSChart,Uh.Error,e.message),!1}},e.prototype.renderChart=function(e,t){if(!e)return Gh.sendTraceTag(595912482,Oh.msoulscat_ES_EWAJSChart,Uh.Error,"Scenegraph string must be valid"),!1;this.seenError=!1;try{this.chartPlayer.setRenderer(Nh.IvyRenderer.Svg);var r=JSON.parse(e),i=t?JSON.parse(t):void 0;return this.chartPlayer.render(r,i),!this.seenError}catch(e){return Gh.sendTraceTag(595912483,Oh.msoulscat_ES_EWAJSChart,Uh.Error,e.message),!1}},e.prototype.ensureFont=function(e){return!!e&&Wh.ensureFont(e)},e.prototype.handleChartPlayerError=function(e){Gh.sendTraceTag(595711620,Oh.msoulscat_ES_EWAJSChart,Uh.Error,e),this.seenError=!0},e.prototype.handleChartPlayerLog=function(e){Gh.sendTraceTag(593883464,Oh.msoulscat_ES_EWAJSChart,Uh.Info,e)},e}(),qh=n(1380),Xh=function(){function e(){this.uoMirror=new qh.VisualsMirror}return e.prototype.updateModel=function(e){try{e&&this.uoMirror.updateModel(e)}catch(e){Gh.sendTraceTag(555798675,Oh.msoulscat_ES_EWAJSChart,Uh.Error,e.message)}},e.prototype.isUOElementPathValid=function(e,t){if(e&&t)try{return void 0!==this.uoMirror.getVisualMirror(e).getRootProperty().getProperty(t)}catch(e){return!1}return!1},e.prototype.isUORibbonCommandSupported=function(e,t,r){if(!e||!t)return!1;try{var i=this.uoMirror.getVisualMirror(e).getRootProperty().getProperty(t);if(void 0===i)return!1;if(!(0,qh.isObjectProperty)(i))return!1;var n=this.getUOPropPathForUORibbonCommand(r);return null!=n&&void 0!==i.getProperty(n)}catch(e){return Gh.sendTraceTag(554558563,Oh.msoulscat_ES_EWAJSChart,Uh.Error,e.message),!1}},e.prototype.getUORibbonCommandVal=function(e,t,r){if(!e||!t)return null;try{var i=this.uoMirror.getVisualMirror(e).getRootProperty().getProperty(t);if(void 0===i)return null;if(!(0,qh.isObjectProperty)(i))return null;var n=this.getUOPropPathForUORibbonCommand(r);if(null==n)return null;var s,o=i.getProperty(n);return void 0===o?null:(0,qh.isBoolProperty)(o)||(0,qh.isIntProperty)(o)||(0,qh.isDoubleProperty)(o)?void 0===(s=o.getValueAttribute(qh.ValuePropAttributeName.Value))?null:{isValid:!0,returnVal:s.toString()}:(0,qh.isStringProperty)(o)?void 0===(s=o.getValueAttribute(qh.ValuePropAttributeName.Value))?null:{isValid:!0,returnVal:s}:(0,qh.isEnumProperty)(o)?3!==r||void 0===(s=o.getValueAttribute(qh.ValuePropAttributeName.Value))?null:{isValid:!0,returnVal:0===s?"false":"true"}:null}catch(e){return Gh.sendTraceTag(554709532,Oh.msoulscat_ES_EWAJSChart,Uh.Error,e.message),null}},e.prototype.handleUORibbonCommand=function(e,t,r,i){if(!e||!t)return null;try{var n=this.uoMirror.getVisualMirror(e).getRootProperty().getProperty(t);if(void 0===n)return null;if(!(0,qh.isObjectProperty)(n))return null;var s=this.getUOPropPathForUORibbonCommand(r);if(null==s)return null;if(void 0===n.getProperty(s))return null;var o=t+"_"+s,a=this.parseUORibbonCommandVal(r,i);return null===a?null:{propPath:o,propVal:a}}catch(e){return Gh.sendTraceTag(554709533,Oh.msoulscat_ES_EWAJSChart,Uh.Error,e.message),null}},e.prototype.getUOPropPathForUORibbonCommand=function(e){switch(e){case 0:return"FillFormat_Color";case 1:return"FontFormat_Bold";case 2:return"FontFormat_Italic";case 3:return"FontFormat_UnderlineStyle";case 4:return"FontFormat_Color";case 5:return"FontFormat_Name";case 6:return"FontFormat_Size";default:return null}},e.prototype.parseUORibbonCommandVal=function(e,t){if(!t)return null;switch(e){case 0:case 4:var r=t.substring(1,t.length);return parseInt(r,16).toString();case 1:case 2:case 6:return t;case 3:return"true"===t?'"Single"':'"None"';case 5:return'"'+t+'"';default:return null}},e}(),$h=function(){function e(){this.enabledFeatures=[]}return e.prototype.getChartPlayerWrapper=function(e,t){return e?(Gh.sendTraceTag(595912512,Oh.msoulscat_ES_EWAJSChart,Uh.Info,"New Chart Player created"),new jh(e,this.enabledFeatures,t)):(Gh.sendTraceTag(595912513,Oh.msoulscat_ES_EWAJSChart,Uh.Error,"HTMLElement must be valid"),null)},e.prototype.getUOMirrorWrapper=function(){return new Xh},e.prototype.initializeLogger=function(e){e&&function(e){if(!e)throw new Error("The 'logger' argument is missing");Gh.setLogger(e)}(e)},e.prototype.enableFeatures=function(e){var t=this;e&&0!==e.length&&e.forEach((function(e){e&&t.enabledFeatures.push({name:e,isEnabled:!0})}))},e}();new $h;class Kh{}class Yh{get scaleFactor(){return this._scaleFactor}set scaleFactor(e){this._scaleFactor=e,this.fixSVGElementTransform()}get position(){return this._position}set position(e){this._position=e,this.fixSVGElementTransform()}get size(){return this._size}set size(e){this._size=e,this.fixSVGElementTransform()}constructor(e,t){this.type=Kh,this.pointerEventNotifiers=c(),this.hitTestSlop=0,this._scaleFactor=1/window.devicePixelRatio,this._position=new f,this._size=new g,this.position=e,this.size=t,this.htmlDiv=document.createElement("div"),this.chartPlayerWrapper=(new $h).getChartPlayerWrapper(this.htmlDiv,void 0)}setLayout(e){void 0!==this.chartPlayerWrapper&&null!==this.chartPlayerWrapper&&(this.chartPlayerWrapper.renderChart(e.sceneGraphJson,e.interactivityJson),this.element=this.htmlDiv.firstChild,this.fixSVGElementTransform())}teardown(){}fixSVGElementTransform(){if(void 0===this.element||null===this.element)return;const e=`position: absolute; display: inherit; z-index: 1;left:${this.position.x*this.scaleFactor}px;top:${this.position.y*this.scaleFactor}px;width:${this.size.width*this.scaleFactor}px;height:${this.size.height*this.scaleFactor}px;`;this.element.setAttribute("style",`${e}`)}}class Jh{get viewModel(){return this.chartRenderDataPresenter.viewModel}get viewModelUpdated(){return this.chartRenderDataPresenter.viewModelUpdated}constructor(e,t){this.chartModelPresenterCreator=(e,t,r)=>this.chartInnerPresenter,this.graphic=e,this.chartInnerPresenter=new Zh(this.graphic,t),this.chartRenderDataPresenter=new kh(this.graphic,t,this.chartModelPresenterCreator,void 0)}teardown(){this.chartRenderDataPresenter.teardown(),this.chartInnerPresenter.teardown()}}class Zh{constructor(e,t){this.viewModelUpdated=new l,this.onAnchorTransformUpdated=async()=>{this.chart.modelUpdated.emit()},this.onViewTransformChanged=async()=>{this.chart.modelUpdated.emit()},this.onCombinedScaleChanged=async()=>{this.chart.modelUpdated.emit()},this.chart=e.model,this.context=t,this.chartPlayerViewModel=new Yh(t.anchorPresenter.transform.pos,t.anchorPresenter.transform.size),this.layout(),this.context.anchorPresenter.transformUpdated.on(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.on(this.onViewTransformChanged),this.context.viewScale.combinedScaleChanged.on(this.onCombinedScaleChanged)}get viewModel(){return this.chartPlayerViewModel}teardown(){this.context.anchorPresenter.transformUpdated.off(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.off(this.onViewTransformChanged),this.context.viewScale.combinedScaleChanged.off(this.onCombinedScaleChanged)}async layout(){this.viewModelUpdated.emit()}}class Qh{constructor(e,t,r){this.renderDataType=xh,this.viewModelUpdated=new l,this.onModelUpdated=async(e,t)=>{null==t||t.addTimePoint("ModelUpdatedEventReceivedTime"),await this.layout(1,t)},this.onAnchorTransformUpdated=async()=>{await this.layout(2)},this.onViewTransformChanged=async()=>{await this.layout(8)},this.onCombinedScaleChanged=async()=>{await this.layout(4)},this.chart=e.model,this.context=t,this.layoutProvider=r,this.chartPlayerViewModel=new Yh(t.anchorPresenter.transform.pos,t.anchorPresenter.transform.size),this.layout(15),this.chart.modelUpdated.on(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.on(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.on(this.onViewTransformChanged),this.context.viewScale.combinedScaleChanged.on(this.onCombinedScaleChanged)}init(e,t){void 0!==e&&this.viewModelUpdated.on(e),this.updateViewModelProperties(15,t).catch((e=>{(0,b.H)(0,14001,`${e}`)}))}get viewModel(){return this.chartPlayerViewModel}teardown(){this.chart.modelUpdated.off(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.off(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.off(this.onViewTransformChanged),this.context.viewScale.combinedScaleChanged.off(this.onCombinedScaleChanged)}async layout(e,t){let r;null==t||t.addTimePoint("ChartPlayerRenderDataPresenterStartTime"),r=new so("ChartPlayerRenderDataPresenter_Layout",void 0!==t?[t]:[]);let i=!1;try{0!=(2&e)&&(i=this.updateViewModelAnchorTransform()||i),0!=(4&e)&&(i=this.updateViewModelScaleFactor()||i),0!=(1&e)&&(i=await this.updateViewModelRenderData()||i),0!=(8&e)&&(i=this.updateViewModelViewTransform()||i)}finally{null==r||r.complete()}i&&(null==t||t.addTimePoint("ViewModelUpdatedEventEmittedTime"),this.viewModelUpdated.emit(t)),null==t||t.addTimePoint("ChartPlayerRenderDataPresenterEndTime")}async updateViewModelProperties(e,t){let r=!1;const i=new so("ChartPlayerRenderDataPresenter_UpdateViewModel",void 0!==t?[t]:[]);try{0!=(8&e)&&(r=this.updateViewModelViewTransform()||r),0!=(2&e)&&(r=this.updateViewModelAnchorTransform()||r),0!=(4&e)&&(r=this.updateViewModelScaleFactor()||r),0!=(1&e)&&(r=await this.updateViewModelRenderData()||r)}catch(e){throw(0,b.H)(0,14001,`Exception: ${e.message}`),e}finally{i.complete()}}async updateViewModelRenderData(){const e=this.context.anchorPresenter.transform;if(void 0!==this.chart.fallbackRenderData){const e=this.chart.fallbackRenderData;try{this.chartPlayerViewModel.setLayout({sceneGraphJson:e.sceneGraphJson,interactivityJson:e.interactivityJson})}catch(e){throw(0,b.H)(0,14001,`Exception: ${e.message}`),e}}else{const t=await this.layoutProvider.getLayout(this.chart,e);this.chartPlayerViewModel.setLayout(t)}return!0}updateViewModelAnchorTransform(){let e=!1;const t=this.context.anchorPresenter.transform;return this.chartPlayerViewModel.position.equals(t.pos)||(this.chartPlayerViewModel.position=t.pos.clone(),e=!0),this.chartPlayerViewModel.size.equals(t.size)||(this.chartPlayerViewModel.size=t.size.clone(),e=!0),e}updateViewModelViewTransform(){let e=!1;const t=this.context.viewScale.viewTransform;return this.chartPlayerViewModel.position.equals(t.pos)||(this.chartPlayerViewModel.position=t.pos.clone(),e=!0),this.chartPlayerViewModel.size.equals(t.size)||(this.chartPlayerViewModel.size=t.size.clone(),e=!0),e}updateViewModelScaleFactor(){return this.chartPlayerViewModel.scaleFactor!==this.context.viewScale.zoomFactor&&(this.chartPlayerViewModel.scaleFactor=this.context.viewScale.zoomFactor,!0)}}function eu(...e){return()=>{for(let t=e.pop();void 0!==t;t=e.pop())t()}}class tu{get transform(){var e;return null!==(e=this.previewTransform)&&void 0!==e?e:this.presenter.transform}constructor(e,t){this.transformUpdated=new l,this.onTransformUpdated=(...e)=>{this.previewTransform=void 0,this.transformUpdated.emit(...e)},this.anchor=e.anchor,this.presenter=t,this.teardown=eu(this.presenter.transformUpdated.use(this.onTransformUpdated))}applyTransform(e){this.previewTransform=qa(this.presenter.transform,e,!1,this.anchor.locks),this.transformUpdated.emit()}}class ru{}class iu{constructor(e=[],t){this.type=ru,this.pointerEventNotifiers=c(),this.hitTestSlop=0,this.children=e,this.nodeId=t}teardown(){}}function nu(e){return e.type===ru}class su{constructor(e,t,r,i,n,s){this.viewModelUpdated=new l,this.childPresenters=new Map,this.updateViewModel=(e,t)=>{const r=this.childPresenters;this.childPresenters=new Map;const i=[];for(const e of this.graphicCollection){const t=r.get(e);if(void 0!==t){r.delete(e),this.childPresenters.set(e,t),t.update(),i.push(t.container);continue}const n=this.createChildPresenter(e);this.childPresenters.set(e,n),i.push(n.container)}for(const[e,t]of r)t.teardown();this.viewModel.children=i,this.viewModelUpdated.emit(t)},this.graphicCollection=e.model,this.presenterCreator=t,this.anchorPresenterCreator=void 0!==(null==s?void 0:s.previewInfo)?function(e){return{createAnchorPresenter:t=>{const r=e.createAnchorPresenter(t);return new tu(t,r)}}}(r):r,this.site=i,this.presenterContext=n,this.editContext=s,this.viewModel=new iu([],{nodeType:this.site.rootNodeType}),this.updateViewModel(),this.graphicCollection.modelUpdated.on(this.updateViewModel)}getPresenters(e){const t=this.childPresenters.get(e);return void 0===t&&(0,y._)(5e3,`Child presenters not found for graphic: ${e.id}`),[t.presenter,t.anchorPresenter]}reset(){this.clearChildPresenters(),this.updateViewModel()}teardown(){this.graphicCollection.modelUpdated.off(this.updateViewModel),this.clearChildPresenters()}clearChildPresenters(){for(const[e,t]of this.childPresenters)t.teardown();this.childPresenters.clear()}createChildPresenter(e){const t=this.anchorPresenterCreator.createAnchorPresenter(e),r=this.presenterCreator.createPresenter(e,Object.assign(Object.assign({},this.presenterContext),{anchorPresenter:t}),this.editContext);return new ou(r,t,this.site.graphicNodeType,e.id,this)}}class ou{constructor(e,t,r,i,n){this.onViewModelUpdated=(...e)=>{this.update(),this.parent.viewModelUpdated.emit(...e)},this.presenter=e,this.anchorPresenter=t,this.container=new iu([e.viewModel],{nodeType:r,nodeKey:i}),this.parent=n,this.presenter.viewModelUpdated.on(this.onViewModelUpdated)}update(){this.container.children=[this.presenter.viewModel]}teardown(){this.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.presenter.teardown(),this.anchorPresenter.teardown()}}class au{constructor(){this.rootNodeType="grCollR",this.graphicNodeType="grCollCh"}}class lu{constructor(e){this.transformUpdated=new l,this.onAnchorUpdated=e=>{this.transformUpdated.emit(e)},this.anchor=e,this.anchor.anchorUpdated.on(this.onAnchorUpdated)}get transform(){return this.anchor.transform}teardown(){this.anchor.anchorUpdated.off(this.onAnchorUpdated)}}function cu(e){return new lu(e.anchor)}class hu{teardown(){}setSelected(){}setHovered(){}}class uu{constructor(e,t){this.paths=[],this.size=new g(e,t)}}const du={b:e=>e.bottom,h:e=>e.height(),hc:e=>e.left+e.width()/2,hd2:e=>e.height()/2,hd3:e=>e.height()/3,hd4:e=>e.height()/4,hd5:e=>e.height()/5,hd6:e=>e.height()/6,hd8:e=>e.height()/8,hd10:e=>e.height()/10,l:e=>e.left,ls:e=>Math.max(e.width(),e.height()),r:e=>e.right,ss:e=>Math.min(e.width(),e.height()),ssd2:e=>du.ss(e)/2,ssd4:e=>du.ss(e)/4,ssd6:e=>du.ss(e)/6,ssd8:e=>du.ss(e)/8,ssd16:e=>du.ss(e)/16,ssd32:e=>du.ss(e)/32,t:e=>e.top,vc:e=>e.top+e.height()/2,w:e=>e.width(),wd2:e=>e.width()/2,wd3:e=>e.width()/3,wd4:e=>e.width()/4,wd5:e=>e.width()/5,wd6:e=>e.width()/6,wd8:e=>e.width()/8,wd10:e=>e.width()/10,wd12:e=>e.width()/12,wd32:e=>e.width()/32};function pu(e,t,r){return"number"==typeof e?e:e in t?t[e]:function(e,t){if(e in du)return du[e](t);throw new Error(`Invalid formula: ${e}`)}(e,r)}const fu=100;function gu(e,t,r){const i=new uu(fu,fu);let n,s;if(void 0!==e.u&&e.u)n=new m(new f(0,0),new g(1,1)),s=new m(new f(0,0),new g(fu,fu));else{const e=t.size.width/t.size.height;n=new m(new f(0,0),new g(e*fu,fu)),i.size.width=e*fu}const o=function(e,t,r){const i={},n=e=>pu(e,i,r);return void 0!==e&&e.forEach((e=>{const[t,r]=e;i[t]=r})),void 0!==t&&t.forEach((e=>{const[t,...r]=e;i[t]=function(e,t){switch(e[0]){case 0:return Math.abs(t(e[1]));case 1:return Math.sqrt(Math.abs(t(e[1])));case 2:return t(e[1]);case 3:return-t(e[1]);case 4:return Math.atan2(t(e[2]),t(e[1]));case 5:return t(e[1])*Math.cos(t(e[2]));case 6:return Math.max(t(e[1]),t(e[2]));case 7:return Math.min(t(e[1]),t(e[2]));case 8:return t(e[1])*Math.sin(t(e[2]));case 9:return t(e[1])*Math.tan(t(e[2]));case 10:return t(e[1])+t(e[2]);case 11:return t(e[1])-t(e[2]);case 12:return r=t(e[1]),i=t(e[2]),Math.sqrt(r*r+i*i);case 13:return t(e[1])*t(e[2]);case 14:return function(e,t){return 0===t?e:e/t}(t(e[1]),t(e[2]));case 15:return function(e,t,r){return 0===r?e*t:e*t/r}(t(e[1]),t(e[2]),t(e[3]));case 16:return t(e[1])+(t(e[2])-t(e[3]));case 17:return function(e,t,r){return 0===r?e+t:(e+t)/r}(t(e[1]),t(e[2]),t(e[3]));case 18:return t(e[1])>0?t(e[2]):t(e[3]);case 19:return t(e[1])*Math.cos(Math.atan2(t(e[3]),t(e[2])));case 20:return Math.min(Math.max(t(e[1]),t(e[2])),t(e[3]));case 21:return t(e[1])*Math.sin(Math.atan2(t(e[3]),t(e[2])));default:(0,xn.t)(e)}var r,i}(r,n)})),i}(void 0!==r&&r.length>0?r:e.a,e.g,as(n));return e.p.forEach((e=>{i.paths.push(function(e,t,r,i){const n=as(r),s=new u(n.left+n.width()/2,n.top+n.height()/2),o=(0,h.Yr)(r.rot),a=El(-s.x,-s.y).scale(r.flip.x?-1:1,r.flip.y?-1:1).rotate(o).translate(s.x,s.y),l=(e,r)=>{const s=new u(pu(e,t,n),pu(r,t,n));if(s.multiply(a),void 0!==i){const e=Ml(i.size.width,i.size.height).translate(i.pos.x,i.pos.y);s.multiply(e)}return s},c=void 0!==i?i.size.width:1,d=void 0!==i?i.size.height:1;return{fillMode:void 0===e.f?1:e.f,lineEnabled:void 0===e.l||e.l,segments:e.s.map((e=>{switch(e[0]){case 0:return{segmentType:0,beginPoint:l(e[1],e[2])};case 1:return{segmentType:1,endPoint:l(e[1],e[2])};case 2:return{segmentType:2,xRadius:pu(e[1],t,n)*c,yRadius:pu(e[2],t,n)*d,startAngle:pu(e[3],t,n),sweepAngle:pu(e[4],t,n)};case 3:return{segmentType:3,controlPoint:l(e[1],e[2]),endPoint:l(e[3],e[4])};case 4:return{segmentType:4,controlPoint1:l(e[1],e[2]),controlPoint2:l(e[3],e[4]),endPoint:l(e[5],e[6])};case 5:return{segmentType:5};default:(0,xn.t)(e)}}))}}(e,o,n,s))})),i}var mu=n(5735);function yu(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}const _u=new ea(255,255,255,1),vu=new ea(0,0,0,0);function bu(e){return 2===e.type}class wu{constructor(e,t){this.position=e,this.color=t}clone(){return new wu(this.position,this.color)}equals(e){return this.position===e.position&&this.color.equals(e.color)}}class Tu{constructor(e,t,r,i,n,s=!0){this.type=3,this.gradientType=e,this.stops=t,this.fromRect=r,this.toRect=i,this.angle=n,this.rotateWithShape=s}clone(){var e,t;return new Tu(this.gradientType,this.stops.map((e=>e.clone())),null===(e=this.fromRect)||void 0===e?void 0:e.clone(),null===(t=this.toRect)||void 0===t?void 0:t.clone(),this.angle,this.rotateWithShape)}equals(e){return!!xu(e)&&this.gradientType===e.gradientType&&function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(!Yo(e[r],t[r]))return!1;return!0}(this.stops,e.stops)&&Jo(this.fromRect,e.fromRect)&&Jo(this.toRect,e.toRect)&&this.angle===e.angle&&this.rotateWithShape===e.rotateWithShape}}function xu(e){return 3===e.type}function Cu(e,t){if(xc(e)){if(bu(e.color)){const r=t.clone();return r.transforms.push(...Qo(e.color.transforms)),new Tc(r)}}else if(xu(e)){if(function(e){for(const t of e.stops)if(bu(t.color))return!0;return!1}(e))return function(e,t){const r=e.stops.map((e=>{if(bu(e.color)){const r=t.clone();return r.transforms.push(...Qo(e.color.transforms)),new wu(e.position,r)}return e}));return new Tu(e.gradientType,r,e.fromRect,e.toRect,e.angle,e.rotateWithShape)}(e,t)}else if(Ec(e))throw new Error("Resolve style fillprops before making a call to replace placeholder color.");return e}function Su(e,t,r){if(0===t.index)return r;const i=Math.min(t.index,e.length)-1;if(i<0)throw new Error(`StyleMatrixReference index ${t.index} is negative.`);return e[i]}const Pu=new Cc;function Eu(e,t,r){if(xc(e))return bc(e.color,r);if(Ec(e)){if(void 0===t||void 0===r)throw new Error("`Style reference and theme info needed to resolve StyleFillProps.");return Eu((i=t,Cu(Su(r.theme.styles.fills,i,Pu),i.color)),t,r)}var i}const Mu=new Mc(new Cc);function Ru(e){switch(e.segmentType){case 1:case 3:case 4:return e.endPoint;case 0:return e.beginPoint;default:throw Error("Unexpected segment type")}}class Au{constructor(e){this.path="",this.transform=e}moveTo(e){const t=e.transform(this.transform);this.path+=`M${t.x},${t.y}`,this.last=e}lineTo(e){const t=e.transform(this.transform);this.path+=`L${t.x},${t.y}`,this.last=e}arcTo(e,t,r,i){const n=0===e||0===t,s=n?r:Math.atan2(e*Math.sin(r),t*Math.cos(r)),o=i<0?-1:1;let a=Math.abs(i);if(a>=xo.uo)a=xo.uo;else{let i=r+a*o;i=n?i:Math.atan2(e*Math.sin(i),t*Math.cos(i)),a=(i-s)*o,a<0&&(a+=xo.uo)}const l=this.last.x-Math.cos(s)*e,c=this.last.y-Math.sin(s)*t,h=Math.ceil(8*Math.abs(a)/xo.uo);for(let r=0;r<h;r+=1){const i=o*xo.uo/8,n=s+r*i,d=r===h-1?o*a-r*i:i,p=n+d,f=n+d/2,g=1/Math.cos(d/2),m=new u(l+Math.cos(f)*g*e,c+Math.sin(f)*g*t),y=new u(l+Math.cos(p)*e,c+Math.sin(p)*t);Math.abs(d)>0?this.quadraticBezierTo(m,y):this.lineTo(y)}}quadraticBezierTo(e,t){const r=e.transform(this.transform),i=t.transform(this.transform);this.path+=`Q${r.x},${r.y},${i.x},${i.y}`,this.last=t}cubicBezierTo(e,t,r){const i=e.transform(this.transform),n=t.transform(this.transform),s=r.transform(this.transform);this.path+=`C${i.x},${i.y},${n.x},${n.y},${s.x},${s.y}`,this.last=r}close(){this.path+="Z"}}function Bu(e,t){e.segments.forEach((e=>{switch(e.segmentType){case 0:t.moveTo(e.beginPoint);break;case 1:t.lineTo(e.endPoint);break;case 2:t.arcTo(e.xRadius,e.yRadius,e.startAngle,e.sweepAngle);break;case 4:t.cubicBezierTo(e.controlPoint1,e.controlPoint2,e.endPoint);break;case 3:t.quadraticBezierTo(e.controlPoint,e.endPoint);break;case 5:t.close();break;default:(0,xn.t)(e)}}))}function Iu(e,t,r){const i=yu("path");return i.setAttribute("d",e),[i,t,!r]}function Fu(e,t,r,i,n,s,o){var a;const l=function(e,t){const r=new u(t*function(e,t){switch(t){case 0:return 5===e?2.5:2;case 1:return 5===e?3.5:3;case 2:return 5;default:(0,xn.t)(t)}}(e.type,e.width),t*function(e,t){switch(t){case 0:return 2;case 1:return 3;case 2:return 5===e?4.5:5;default:(0,xn.t)(t)}}(e.type,e.length));switch(e.type){case 1:case 5:const t=5===e.type,i=[{segmentType:0,beginPoint:new u(-r.x/2,-r.y)},{segmentType:1,endPoint:new u(0,0)},{segmentType:1,endPoint:new u(r.x/2,-r.y)}];return{fillMode:t?0:1,lineEnabled:t,segments:t?i:i.concat([{segmentType:5}])};case 2:return{fillMode:1,lineEnabled:!1,segments:[{segmentType:0,beginPoint:new u(-r.x/2,-r.y)},{segmentType:1,endPoint:new u(0,0)},{segmentType:1,endPoint:new u(r.x/2,-r.y)},{segmentType:1,endPoint:new u(0,-r.y/2)},{segmentType:5}]};case 3:return{fillMode:1,lineEnabled:!1,segments:[{segmentType:0,beginPoint:new u(0,r.y/2)},{segmentType:1,endPoint:new u(r.x/2,0)},{segmentType:1,endPoint:new u(0,-r.y/2)},{segmentType:1,endPoint:new u(-r.x/2,0)},{segmentType:5}]};case 4:return{fillMode:1,lineEnabled:!1,segments:[{segmentType:0,beginPoint:new u(r.x/2,0)},{segmentType:2,xRadius:r.x/2,yRadius:r.y/2,startAngle:0,sweepAngle:xo.uo},{segmentType:5}]};default:throw Error("Unexpected line end type")}}(e,(a=t,Math.max(2,a))),c=function(e,t,r){const[i,n]=function(e,t,r){const i=e.segments;let n,s;if(t)s=Ru(i[i.length-2]),n=Ru(i[i.length-1]);else{const e=i[0];if(0!==e.segmentType)throw Error("Unexpected segment type");n=e.beginPoint,s=Ru(i[1])}n=n.transform(r),s=s.transform(r);const o=new u(n.x-s.x,n.y-s.y);return o.normalize(),[n,o]}(e,t,r);return new Pl(-n.y,n.x,n.x,n.y,i.x,i.y)}(n,i,s),h=new Au(c);Bu(l,h);const d=Iu(h.path,l.fillMode,l.lineEnabled);return void 0!==r&&0!==r.dashType&&d[0].setAttribute("stroke-dasharray","none"),5===e.type&&d[0].setAttribute("stroke-linecap","round"),function(e){switch(e){case 3:case 4:case 2:case 1:return!0;case 0:case 5:return!1;default:(0,xn.t)(e)}}(e.type)&&d[0].setAttribute("fill",o),d}class Du{}class Lu{constructor(){this.type=Du,this.pointerEventNotifiers=c(),this.update=new l,this.hitTestSlop=0,this.group=yu("g"),this.paths=[]}setGeometry(e,t){this.geometry=e,this.geometryTransform=El(-e.size.width/2,-e.size.height/2).scale(t.size.width/e.size.width*(t.flip.x?-1:1),t.size.height/e.size.height*(t.flip.y?-1:1)).rotate((0,h.Yr)(t.rot)),this.paths=function(e,t){const r=[],i=new Au(t);let n=0,s=!0;return e.paths.forEach((e=>{(""!==i.path&&n!==e.fillMode||!s)&&(r.push(Iu(i.path,n,s)),i.path=""),Bu(e,i),n=e.fillMode,s=e.lineEnabled})),r.push(Iu(i.path,n,s)),r}(e,this.geometryTransform),this.setCenter(t.getCenter())}setProps(e,t,r,i,n,s,o,a){var l,c;(null==a?void 0:a.isInHighContrastMode)?this.fillColor=function(e){return void 0!==e.highContrastColors?ra(e.highContrastColors.backgroundColor):vu}(a):this.fillColor=void 0!==e?Eu(e,null==r?void 0:r.fillRef,i):void 0,this.pictureEffects=s,this.group.setAttribute("fill",Rc(this.fillColor));const h=function(e,t){if(!(null==t?void 0:t.isInHighContrastMode))return e;const r=new Tc(function(e){return void 0!==e.highContrastColors?ra(e.highContrastColors.foregroundTextColor):_u}(t));if(void 0!==e){const t=e.clone();return t.fill=r,t}return new Mc(r)}(t,a);if(void 0!==h){const e=function(e,t,r){if(void 0!==r&&void 0!==t&&void 0!==t.lineRef){const i=e.clone();return i.resolveFrom(function(e,t){var r;const i=Su(e.lines,t,Mu),n=i.clone();return n.fill=Cu(null!==(r=i.fill)&&void 0!==r?r:new Cc,t.color),n}(r.theme.styles,t.lineRef)),i}return e}(h,r,i),t=null!==(l=e.weight)&&void 0!==l?l:1,n=Rc(Eu(null!==(c=e.fill)&&void 0!==c?c:new Cc,void 0,i));this.group.setAttribute("stroke",n),this.group.setAttribute("stroke-width",`${t}pt`),void 0!==e.dash&&0!==e.dash.dashType?this.group.setAttribute("stroke-dasharray",Ac(e.dash.dashType,96*t/72)):this.group.removeAttribute("stroke-dasharray"),void 0!==e.join&&0!==e.join.joinType?this.group.setAttribute("stroke-linejoin",function(e){switch(e){case 1:return"bevel";case 0:return"miter";case 2:return"round";default:(0,xn.t)(e)}}(e.join.joinType)):(this.group.removeAttribute("stroke-linejoin"),this.group.setAttribute("stroke-miterlimit","8"));const s=e.headEnd;void 0!==s&&0!==s.type&&this.geometry.paths.forEach((r=>{0===r.fillMode&&r.lineEnabled&&this.paths.push(Fu(s,t,e.dash,!1,r,this.geometryTransform,n))}));const o=e.tailEnd;void 0!==o&&0!==o.type&&this.geometry.paths.forEach((r=>{0===r.fillMode&&r.lineEnabled&&this.paths.push(Fu(o,t,e.dash,!0,r,this.geometryTransform,n))}))}else this.group.setAttribute("stroke","none")}setCenter(e){this.group.setAttribute("transform",`translate(${e.x} ${e.y})`)}teardown(){}}function ku(e,t){if(void 0===t)return{scale:new u(1,1),offset:new u(0,0)};const{width:r,height:i}=hs(e,t).size;return{scale:new u(r/e.size.width,i/e.size.height),offset:new u(t.left*r/100,t.top*i/100)}}class Ou{constructor(e,t,r,i,n){this.fetchTimeInMs=0,this.convertToBlobUrlTimeInMs=0,this.totalTimeInMs=0,this.sizeInBytes=0,this.mimeType="",this.fetchTimeInMs=e,this.convertToBlobUrlTimeInMs=t,this.totalTimeInMs=r,this.sizeInBytes=i,this.mimeType=n}}class Uu{constructor(e,t,r,i){this.url=e,this.blobType=t,this.blob=r,this.stats=i}}async function Nu(e){if("blob:"===e.protocol)return new Uu(e);const t={},r=undefined;if(void 0!==r){const i=await r.getAdditionalRequestHeaders(e);void 0!==i&&(t.headers=i)}const i=performance.now(),n=await fetch(e.href,t),s=performance.now();n.ok||(0,y.H)("Picture","URLFetchFailed",`convertUrlToBlobUrl: Failed to fetch url. Response status [${n.status}] | Protocol [${e.protocol}] `);const o=await n.blob(),a=o.type,l=new URL(URL.createObjectURL(o)),c=performance.now();return new Uu(l,a,o,new Ou(s-i,c-s,c-i,o.size,a))}class Vu{constructor(){this.downloadState=0,this.totalTimeInMs=0}}class Gu{constructor(e,t,r,i,n,s,o,a){this.stateUpdated=new l,this._state=1,this._stats=new Vu,this.id=e,this.originalUrl=t,this.downloadPlaceholder=r,this.pictureProvider=n,this.isUrlFinal=i,this._downloadCompleted=s,this._framesProviders=o,this.storeDownloadCompletedBlobText=null!=a?a:e=>!1}get originalBlobUrl(){return this._originalBlobUrl}get providerDownloadedUrl(){return this._providerDownloadedUrl}get providerDownloadedBlobUrl(){return this._providerDownloadedBlobUrl}get isRenderUrlPlaceHolder(){return void 0!==this.placeholder}get state(){return this._state}set state(e){this.setStateAndNotify(e,!0)}get downloadDetails(){return this}async triggerDownload(){await this.triggerOriginalDownload(),await this.triggerDownloadFromProvider()}get renderUrl(){switch(this._state){case 1:case 2:if(this.isUrlFinal&&void 0===this.downloadPlaceholder)return;return this.getPlaceholderUrlOrDefault();case 4:case 6:return this.getPlaceholderUrlOrDefault();case 3:return this.isUrlFinal?(void 0===this.originalBlobUrl&&(0,y.H)("Picture","OriginalBlobUrlUndefined","renderUrl: originalBlobUrl not expected to be undefined for DownloadedOriginal state"),this.originalBlobUrl):this.getPlaceholderUrlOrDefault();case 5:return void 0===this.providerDownloadedBlobUrl&&(0,y.H)("Picture","ProviderDownloadedBlobUrlUndefined","renderUrl: providerDownloadedBlobUrl not expected to be undefined for DownloadedFromProvider state"),this.providerDownloadedBlobUrl;default:(0,y.H)("Picture","PictureDataStateInvalid",`renderUrl: Unhandled PictureDataState ${this._state}`)}}get stats(){return this._stats}get mimeType(){return this._mimeType}get downloadDone(){return 6===this.state||(this.isUrlFinal?3===this.state:5===this.state)}teardown(){void 0!==this._originalBlobUrl&&this._originalBlobUrl!==this.originalUrl&&URL.revokeObjectURL(this._originalBlobUrl.href),void 0!==this._providerDownloadedBlobUrl&&this._providerDownloadedBlobUrl!==this._providerDownloadedUrl&&URL.revokeObjectURL(this._providerDownloadedBlobUrl.href),this._originalBlobUrl=void 0,this._providerDownloadedBlobUrl=void 0,this._providerDownloadedUrl=void 0,this._start=void 0,this._stats=new Vu,this._downloadCompleted=void 0,this.frames=void 0,this.setStateAndNotify(7,!0)}get downloadCompletedBlobText(){return this._downloadCompletedBlobText}get placeholder(){let e=0;switch(this._state){case 1:case 2:if(this.isUrlFinal&&void 0===this.downloadPlaceholder)return;break;case 3:if(this.isUrlFinal)return;break;case 4:break;case 5:return;case 6:e=1;break;default:(0,y.H)("Picture","PictureDataStateInvalid",`placeholder: Unhandled PictureDataState ${this._state}`)}return 0===e&&void 0!==this.downloadPlaceholder?this.downloadPlaceholder:this.pictureProvider.getPlaceholderIcon(e)}async triggerOriginalDownload(){var e,t,r,i,n;if(void 0===this._originalBlobUrl){this.state=2;try{this._stats.downloadState=1,this._start=performance.now();const n=await Nu(this.originalUrl);this._originalBlobUrl=n.url,this._stats.originalUrlStats=n.stats,await this.setMimeType(n.blob,void 0!==(null===(e=this._framesProviders)||void 0===e?void 0:e.get("image/apng")));const s=qn(this._mimeType);void 0!==s&&(this._framesProvider=null===(t=this._framesProviders)||void 0===t?void 0:t.get(s)),Hn(this._mimeType)&&(this.frames=null===(r=this._framesProvider)||void 0===r?void 0:r.getFrames(this._originalBlobUrl.href)),void 0!==n.blobType&&this.storeDownloadCompletedBlobText(n.blobType)&&this.isUrlFinal&&(this._downloadCompletedBlobText=await(null===(i=n.blob)||void 0===i?void 0:i.text())),this._stats.totalTimeInMs=performance.now()-this._start,this.isUrlFinal&&(this._stats.downloadState=2),this.state=3}catch(e){const t=new gn.A;t.extendedProperties.set("message",`Failed to download original url. Protocol[${this.originalUrl.protocol}] Error[${JSON.stringify(e).substring(0,20)}]`),(0,vn.R)("Picture","DownloadOriginalUrlFailed",t),this._stats.downloadState=3,this.setStateAndNotify(6,this.isUrlFinal)}this.isUrlFinal&&(null===(n=this._downloadCompleted)||void 0===n||n.emit(this._stats))}}async setMimeType(e,t=!1){void 0!==e&&(this._mimeType=e.type,t&&"image/png"===e.type.toLowerCase()&&function(e){try{let t=!1,r=!1,i=!1,n="";const s=new DataView(e),o=new TextDecoder("ascii");let a=8;for(;a<s.byteLength;){const l=s.getUint32(a),c=o.decode(new DataView(e,a+4,4));switch(c){case"acTL":t=!0;break;case"IDAT":if(!t)return!1;if("fcTL"!==n&&"IDAT"!==n)return!1;r=!0;break;case"fdAT":if(!r)return!1;if("fcTL"!==n&&"fdAT"!==n)return!1;i=!0}n=c,a+=8+l+4}return t&&r&&i}catch(e){return!1}}(await e.arrayBuffer())&&(this._mimeType="image/apng"))}async triggerDownloadFromProvider(){var e,t,r,i,n;if(!this.isUrlFinal&&void 0===this._providerDownloadedUrl&&void 0===this._providerDownloadedBlobUrl&&this.pictureProvider.isHostPictureMetadata(this.id)){try{this.state=4;const n=performance.now(),s=new URL(await this.pictureProvider.getPictureBlobDataFromHostPictureMetadata(this.id));this._providerDownloadedUrl=s,void 0===this._start&&(this._start=performance.now()),this._stats.getPictureDataFromHostTimeInMs=performance.now()-n;const o=await Nu(s);this._providerDownloadedBlobUrl=o.url,this._stats.delayDownloadedUrlStats=o.stats,await this.setMimeType(o.blob,void 0!==(null===(e=this._framesProviders)||void 0===e?void 0:e.get("image/apng")));const a=qn(this._mimeType);void 0!==a&&(this._framesProvider=null===(t=this._framesProviders)||void 0===t?void 0:t.get(a)),Hn(this._mimeType)&&(this.frames=null===(r=this._framesProvider)||void 0===r?void 0:r.getFrames(this._providerDownloadedBlobUrl.href)),void 0!==o.blobType&&this.storeDownloadCompletedBlobText(o.blobType)&&(this._downloadCompletedBlobText=await(null===(i=o.blob)||void 0===i?void 0:i.text())),this._stats.downloadState=2,this._stats.totalTimeInMs=performance.now()-this._start,this.state=5}catch(e){const t=new gn.A;t.extendedProperties.set("message",`Failed to download picture from host. Protocol[${this.originalUrl.protocol}] Error[${JSON.stringify(e).substring(0,20)}]`),(0,vn.R)("Picture","DownloadPictureFromHostFailed",t),this._stats.downloadState=3,this.state=6}null===(n=this._downloadCompleted)||void 0===n||n.emit(this._stats)}}getPlaceholderUrlOrDefault(){var e,t,r;return null!==(r=null!==(t=null===(e=this.placeholder)||void 0===e?void 0:e.url)&&void 0!==t?t:this.originalBlobUrl)&&void 0!==r?r:this.originalUrl}setStateAndNotify(e,t){this.state!==e&&((0,b._v)(0,8,`setState: State change ${this.state} -> ${e} | notify ${t}`),this._state=e,t&&this.stateUpdated.emit(this.state))}}class zu{}class Hu extends Ro{constructor(e,t,r,i,n,s){super(),this.type=zu,this.geometryVM=i,this.placeholderContainer=s,this.nonCropGeometry=t,this.update(e,r,n).then((()=>{})).catch((()=>{}))}async update(e,t,r){void 0!==r&&(this.geometry=e,this.geometryVM.setGeometry(r.cropToGeometry?e:this.nonCropGeometry,t),this.transform!==t&&(this.transform=t.clone()),await this.updatePlaceholder(r))}teardown(){var e;this.geometryVM.teardown(),null===(e=this.placeholderContainer)||void 0===e||e.teardown()}async updatePlaceholder(e){Jo(e,this.placeholder)||(this.placeholder=e,await this.updateImageData())}async updateImageData(){if(void 0!==this.placeholder&&this.imageData!==this.placeholder.url.href)return await this.setImageData(this.placeholder.url.href),void this.imageViewModelUpdated.emit([0],!1)}}class Wu{}class ju extends Ro{constructor(e,t,r,i,n,s,o,a){super(),this.type=Wu,this.teardownTracker=new v("PictureViewModel"),this.onPictureDataStateUpdated=async e=>{var t;if(7===e)return await this.setPictureData(null===(t=this.model)||void 0===t?void 0:t.data),void this.imageViewModelUpdated.emit([0],!1);await this.setImageDataAndPopulateFramesIfNeeded()},this.framesProviders=o,this.pictureDataStore=go.getInstance(),this.geometryVM=s(),this.placeholderVM=new Hu(e,t,r,s(),n.placeholder,a),this.teardownTracker.onTeardown((()=>{this.placeholderVM.teardown()})),this.fallbackRenderData=n.fallbackRenderData,this.update(e,r,n,i).then((()=>{})).catch((()=>{}))}async update(e,t,r,i,n){this.geometry=e,this.model=r,this.geometryVM.setGeometry(e,t),this.geometryVM.setProps(r.fill,r.line,void 0,r.hostContext.themeInfo,r.effects,r.pictureEffects,2),this.transform!==t&&(this.transform=t.clone()),this.opacity=r.opacity,this.fallbackRenderData=r.fallbackRenderData,this.ariaLabel=n,this.setCrop(i,t),this.cachedImageData=this.imageData,await this.updatePictureData(r),await this.updatePlaceholder(r.placeholder)}setCrop(e,t){const{scale:r,offset:i}=ku(t,e);this.scaleVector=r,this.topLeftOffset=i}isPlaceHolder(){var e,t,r;if(void 0!==this.placeholder)return!0;const i=null===(r=this.pictureDataStore.getDownloadDetails(null!==(t=null===(e=this.data)||void 0===e?void 0:e.id)&&void 0!==t?t:""))||void 0===r?void 0:r.isRenderUrlPlaceHolder;return void 0!==i&&i}getPlaceHolder(){var e,t,r;return void 0!==this.placeholder?this.placeholder:null===(r=this.pictureDataStore.get(null!==(t=null===(e=this.data)||void 0===e?void 0:e.id)&&void 0!==t?t:""))||void 0===r?void 0:r.downloadDetails.placeholder}async replacePictureData(e){var t;e.id!==(null===(t=this.data)||void 0===t?void 0:t.id)&&(this.data=e,await this.setPictureData(e))}async resetPictureData(){if(void 0!==this.model){const e=this.model;await this.updatePictureData(e)}}get mimeType(){var e;return null===(e=this.data)||void 0===e?void 0:e.mimeType}get downloadedBlobText(){var e,t,r;return null===(r=this.pictureDataStore.getDownloadDetails(null!==(t=null===(e=this.data)||void 0===e?void 0:e.id)&&void 0!==t?t:""))||void 0===r?void 0:r.downloadCompletedBlobText}teardown(){this.geometryVM.teardown(),this.teardownTracker.teardown()}async updatePictureData(e){var t;(null===(t=this.data)||void 0===t?void 0:t.id)!==e.data.id&&(this.data=e.data,await this.setPictureData(e.data))}async updatePlaceholder(e){Jo(e,this.placeholder)||(this.placeholder=e,await this.setImageDataAndPopulateFramesIfNeeded()),await this.placeholderVM.update(this.geometry,this.transform,this.placeholder)}async populateFrames(e){Hn(this.mimeType)&&void 0!==this.framesProviders&&(void 0===e.frames&&(0,y.H)("Picture","AnimatedFrames","Frames not expected to be undefined"),await e.frames.populate(),this.frames=e.frames)}async setPictureData(e){var t,r;let i=this.pictureDataStore.get(null!==(r=null===(t=this.data)||void 0===t?void 0:t.id)&&void 0!==r?r:"");if(void 0!==i&&7!==i.downloadDetails.state)return await this.setImageDataAndPopulateFramesIfNeeded(),void this.teardownTracker.onTeardown(i.stateUpdated.use(this.onPictureDataStateUpdated));var n,s,o,a,l,c,h;7===(null==i?void 0:i.downloadDetails.state)&&i.stateUpdated.off(this.onPictureDataStateUpdated),n=e.id,s=e.originalUrl,o=e.downloadPlaceholder,a=e.isUrlFinal,l=e.pictureProvider,c=e.downloadCompleted,h=this.framesProviders,i=new Gu(n,s,o,a,l,c,h,Wn),this.teardownTracker.onTeardown(i.stateUpdated.use(this.onPictureDataStateUpdated)),this.pictureDataStore.add(i),await i.triggerDownload()}async setImageDataAndPopulateFramesIfNeeded(){var e,t;const r=this.getPlaceHolder();if(void 0!==r){if(r.overlay||r.renderAsSvg)return await this.placeholderVM.update(this.geometry,this.transform,r),void this.imageViewModelUpdated.emit([0],!1);if(this.imageData!==r.url.href)return await this.setImageData(r.url.href),void this.imageViewModelUpdated.emit([0],!1)}const i=this.pictureDataStore.getDownloadDetails(null!==(t=null===(e=this.data)||void 0===e?void 0:e.id)&&void 0!==t?t:""),n=null==i?void 0:i.renderUrl;void 0!==i&&void 0!==n&&n.href!==this.imageData&&(await this.setImageData(n.href),void 0===this.data&&(0,y.H)("Picture","PictureDataUndefined","Picture data not expected to be undefined"),this.data.mimeType=i.mimeType,i.downloadDone&&6!==i.state&&await this.populateFrames(i),this.imageViewModelUpdated.emit([0],null==i?void 0:i.downloadDone))}}class qu{constructor(e,t,r,i,n,s=(()=>new hu),o){this.viewModelUpdated=new l,this.onModelUpdated=async()=>{let e=this.context.anchorPresenter.transform;const t=this.context.viewScale;t.viewTransform.size.equals(new g(0,0))||(e=t.viewTransform.clone(),e.size.width*=t.zoomFactor,e.size.height*=t.zoomFactor),await this.updateViewModel(e)},this.onAnchorTransformUpdated=async()=>{let e=this.context.anchorPresenter.transform;const t=this.context.viewScale;var r,i;t.viewTransform.size.equals(new g(0,0))||(e=t.viewTransform.clone(),e.size.width*=t.zoomFactor,e.size.height*=t.zoomFactor),r=e,i=this.pictureViewModel.transform,!r.pos.equals(i.pos)&&r.size.equals(i.size)&&r.rot===i.rot&&r.flip.equals(i.flip)?(this.pictureViewModel.transform=e.clone(),this.pictureViewModel.geometryVM.setCenter(e.getCenter()),this.pictureViewModel.placeholderVM.geometryVM.setCenter(e.getCenter()),this.pictureViewModel.cachedImageData=this.pictureViewModel.imageData,this.viewModelUpdated.emit()):await this.updateViewModel(e)},this.onImageViewModelUpdated=(e,t)=>{this.viewModelUpdated.emit(),e.includes(0)&&(!0===t?this.context.viewReadyTracker.removePending(this):this.context.viewReadyTracker.addPending(this)),void 0!==this.pictureViewModel.frames&&void 0===this.animatedPicturePlayControl&&(this.animatedPicturePlayControl=this.animatedPlayControlCreator(this.pictureViewModel.frames,this.context),this.pictureViewModel.pointerEventNotifiers.pointerover.value.on(this.onPointerOver),this.pictureViewModel.pointerEventNotifiers.pointerout.value.on(this.onPointerOut))},this.onPointerOver=()=>{void 0!==this.animatedPicturePlayControl&&this.animatedPicturePlayControl.setHovered(!0)},this.onPointerOut=()=>{void 0!==this.animatedPicturePlayControl&&this.animatedPicturePlayControl.setHovered(!1)},this.graphic=e,this.pictureModel=e.model,this.context=t,this.geometryRegistry=r,this.framesProviders=n,this.context.viewReadyTracker.addPending(this),this.animatedPlayControlCreator=s;const a=this.context.anchorPresenter.transform;this.pictureViewModel=new ju(this.getGeometry(),gu(mu.D,this.context.anchorPresenter.transform),a,this.pictureModel.crop,this.pictureModel,i,this.framesProviders,void 0!==o?o():void 0),this.pictureViewModel.imageViewModelUpdated.on(this.onImageViewModelUpdated),this.pictureModel.modelUpdated.on(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.on(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.on(this.onAnchorTransformUpdated),this.context.viewScale.combinedScaleChanged.on(this.onAnchorTransformUpdated)}get viewModel(){return this.pictureViewModel}teardown(){this.context.anchorPresenter.transformUpdated.off(this.onAnchorTransformUpdated),this.pictureModel.modelUpdated.off(this.onModelUpdated),this.pictureViewModel.imageViewModelUpdated.off(this.onImageViewModelUpdated),this.pictureViewModel.teardown(),void 0!==this.animatedPicturePlayControl&&(this.pictureViewModel.pointerEventNotifiers.pointerover.value.off(this.onPointerOver),this.pictureViewModel.pointerEventNotifiers.pointerout.value.off(this.onPointerOut),this.animatedPicturePlayControl.teardown()),this.context.viewScale.viewTransformChanged.off(this.onAnchorTransformUpdated),this.context.viewScale.combinedScaleChanged.off(this.onAnchorTransformUpdated)}setCrop(e){this.pictureViewModel.setCrop(e,this.context.anchorPresenter.transform),this.viewModelUpdated.emit()}setInCropMode(e){this.pictureViewModel.inCropMode!==e&&(this.pictureViewModel.inCropMode=e,this.viewModelUpdated.emit())}setSelected(e){void 0!==this.animatedPicturePlayControl&&this.animatedPicturePlayControl.setSelected(e)}async updateViewModel(e){await this.pictureViewModel.update(this.getGeometry(),e,this.pictureModel,this.pictureModel.crop,this.context.ariaLabelCreator.createAriaLabel(this.graphic)),this.viewModelUpdated.emit()}getGeometry(){return gu(void 0!==this.pictureModel.geometry?this.geometryRegistry.getGeometry(this.pictureModel.geometry):mu.D,this.context.anchorPresenter.transform)}}class Xu extends class{constructor(e,t,r,i,n){this.viewModelUpdated=new l,this.onModelUpdated=(e,t)=>{this.refreshViewModel(1,t).catch((e=>{this.logCatchReason(e)}))},this.onAnchorTransformUpdated=e=>{this.refreshViewModel(2,e).catch((e=>{this.logCatchReason(e)}))},this.onViewTransformUpdated=e=>{this.refreshViewModel(8,e).catch((e=>{this.logCatchReason(e)}))},this.onCombinedScaleChanged=()=>{this.refreshViewModel(4).catch((e=>{this.logCatchReason(e)}))},this.graphic=e,this.context=t,this.viewModel=r(),this.imageTypeChecker=i,this.presenterTraceCategory=n,this.teardown=eu(this.graphic.model.modelUpdated.use(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.use(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.use(this.onViewTransformUpdated),this.context.viewScale.combinedScaleChanged.use(this.onCombinedScaleChanged))}init(e,t){void 0!==e&&this.viewModelUpdated.on(e),this.updateViewModelProperties(15,t).catch((e=>{this.logCatchReason(e)}))}async updateViewModelProperties(e,t){let r=!1;const i=new so(`${this.presenterClassName}_UpdateViewModel`,void 0!==t?[t]:[]);try{0!=(8&e)&&(r=this.updateViewModelViewTransform()||r),0!=(2&e)&&(r=this.updateViewModelAnchorTransform()||r),0!=(4&e)&&(r=this.updateViewModelScaleFactor()||r),0!=(1&e)&&(r=await this.updateViewModelRenderData()||r)}catch(e){throw(0,b.H)(0,this.presenterTraceCategory,`Exception: ${e.message}`),e}finally{i.complete()}r&&(this.viewModelUpdated.emit(t),this.viewModel.imageViewModelUpdated.emit(function(e){const t=[];return 0!=(1&e)&&t.push(0),0!=(6&e)&&t.push(1),t}(e)))}async updateViewModelRenderData(){const e=this.graphic.model.fallbackRenderData;return void 0!==e&&(this.imageTypeChecker(e),this.viewModel.sourceAnchorBounds=e.sourceAnchorBounds.clone(),this.viewModel.bounds=e.targetBounds.clone(),await this.viewModel.setImageData(e.data),!0)}updateViewModelAnchorTransform(){return 0!==this.context.viewScale.viewTransform.size.width||0!==this.context.viewScale.viewTransform.size.height?this.updateViewModelViewTransform():!this.viewModel.transform.equals(this.context.anchorPresenter.transform)&&(this.viewModel.transform=this.context.anchorPresenter.transform.clone(),!0)}updateViewModelViewTransform(){return!this.viewModel.transform.equals(this.context.viewScale.viewTransform)&&(this.viewModel.transform=this.context.viewScale.viewTransform.clone(),!0)}updateViewModelScaleFactor(){return this.viewModel.scaleFactor!==this.context.viewScale.zoomFactor&&(this.viewModel.scaleFactor=this.context.viewScale.zoomFactor,!0)}logCatchReason(e){(0,b.H)(0,this.presenterTraceCategory,`${e}`)}async refreshViewModel(e,t){return this.updateViewModelProperties(e,t)}}{constructor(e,t,r){super(e,t,r,Th,1),this.renderDataType=vh,this.presenterClassName="Base64ImagePresenter"}}class $u{}class Ku{get imageData(){return this._imageData}constructor(e){this.type=$u,this.imageViewModelUpdated=new l,this.pointerEventNotifiers=c(),this.sourceAnchorBounds=new d(0,0,0,0),this.bounds=new d(0,0,0,0),this.scaleFactor=1/window.devicePixelRatio,this.transform=new m,this.hitTestSlop=0,this.inCropMode=!1,this._imageData="",this.canvasImageSource=e}async setImageData(e){if(this._imageData=e,this.canvasImageSource instanceof HTMLImageElement)return fs(this.canvasImageSource,e);(0,y._)(4,"Not yet supported")}teardown(){}}const Yu="data:",Ju="text/plain",Zu="image/svg+xml";class Qu{constructor(e,t,r,i,n,s){this.color=e,this.direction=t,this.wrapScale=r,this.wrapOffset=i,this.diffuse=n,this.specular=s}}class ed{constructor(e,t){this.ambientColor=e,this.lights=t}}class td{constructor(e,t){this.profile=e,this.size=t}}class rd{constructor(e,t,r,i,n,s,o,a,l){this.materialType=e,this.diffuseColor=t,this.specularColor=r,this.ambientColor=i,this.emissiveColor=n,this.specularPower=s,this.useBlinnHighlight=o,this.diffuseFresnel=a,this.alphaFresnel=l}}class id{constructor(e,t,r,i,n,s,o,a){this.topBevel=e,this.bottomBevel=t,this.material=r,this.extrusionColor=i,this.extrusionHeight=n,this.contourColor=s,this.contourWidth=o,this.zPosition=a}get adjustedContourWidth(){return Math.max(Q,this.contourWidth)}}var nd;!function(e){function t(t,n){if(!t)return P.Identity;const s=t.pt?r(t.pt).scale(n):void 0,o=t.s?i(t.s):new x(1,1),a=t.rSpecified?t.r*e.c_internalAngleToRadianFactor:void 0,l=t.t?r(t.t).scale(n):void 0;return new P(s,o,a,l)}function r(e){return new x(e.x,e.y)}function i(e,t=0){return new x(e.x||t,e.y||t)}function n(e){return new ge(e[0]/255,e[1]/255,e[2]/255,e[3]/255)}function s(e,t=1){return new E(e.l*t,e.t*t,e.r*t,e.b*t)}function o(e){let t=[];for(let r of e){const e=r.pos,i=n(r.clr);t.push(new ve(e,i))}return t.sort(((e,t)=>e.position-t.position)),t}function a(e,t){if(e.gradientStops=t,e.isGammaCorrected=!1,2==t.length||3==t.length){const r=t[0],i=t[t.length-1];if(0==Math.min(r.position,i.position)&&1==Math.max(r.position,i.position))if(2==t.length)e.isGammaCorrected=!0,e.blendBellShape=x.One;else if(3==t.length&&r.color.equals(i.color)){const i=t[1];e.gradientStops=[new ve(0,r.color),new ve(1,i.color)],e.isGammaCorrected=!0,e.blendBellShape=new x(i.position,1)}}}function l(t,r,i){switch(t.bt){case 0:return new _e(ge.Transparent);case 1:{let e=n(t.Item.clr);return new _e(e)}case 2:{const r=t.Item;let i=new be(2);return i.isStretched=r.isStretched,i.rotateWithShape=r.rtSp,i.angle=r.ang*e.c_internalAngleToRadianFactor,r.ftrct&&(i.fillToRect=s(r.ftrct)),r.ffrct&&(i.fillFromRect=s(r.ffrct)),r.stops&&a(i,o(r.stops)),i}case 3:{const r=t.Item;let i=new be(3);return i.isStretched=r.isStretched,i.rotateWithShape=r.rtSp,i.angle=r.ang*e.c_internalAngleToRadianFactor,r.ftrct&&(i.fillToRect=s(r.ftrct)),r.ffrct&&(i.fillFromRect=s(r.ffrct)),r.stops&&a(i,o(r.stops)),i}case 4:{const r=t.Item;let i=new be(4);return i.isStretched=r.isStretched,i.rotateWithShape=r.rtSp,i.angle=r.ang*e.c_internalAngleToRadianFactor,r.ftrct&&(i.fillToRect=s(r.ftrct)),r.ffrct&&(i.fillFromRect=s(r.ffrct)),r.stops&&a(i,o(r.stops)),i}case 5:{const r=t.Item;let i=new be(5);return i.isStretched=r.isStretched,i.rotateWithShape=r.rtSp,i.angle=r.ang*e.c_internalAngleToRadianFactor,r.ftrct&&(i.fillToRect=s(r.ftrct)),r.ffrct&&(i.fillFromRect=s(r.ffrct)),r.stops&&a(i,o(r.stops)),i}case 7:{const e=t.Item;return new Te(e.type,n(e.clrFg),n(e.clrBg))}case 6:return c(t.Item,r);case 8:case 9:i.Message(39084627,`unsupported Brush ${JSON.stringify(t)}`)}return new _e(ge.Transparent)}function c(e,t){if(!e.id)return;let r=new me;r.id=e.id;let i=new we(r);return i.wrapMode=e.wrpmd,i.alignment=e.algn,i.isStretched=e.isStretched,i.offset=new x(e.off.x,e.off.y),i.scale=new x(e.scale.x,e.scale.y),i.opacity=e.opcty,i.rotateWithShape=e.rotWShp,i.isStretched||(i.scale=i.scale.divide(new x(e.dpi.x,e.dpi.y)).scale(t.fromInch),i.offset=i.offset.scale(t.fromHighPrecisionUnit)),i}function h(e){return{cap:e.capType,end:e.type,length:e.len,width:e.width,widthMin:e.widthMin}}function u(e,t,r){if(!e)return new Se;let i,n;e.fillBrsh&&(i=l(e.fillBrsh,t,r)),e.outlnBrsh&&(n=l(e.outlnBrsh,t,r));const s=function(e,t,r,i){let n=new Ce(t*i);return n.lineHeight=r*i,e?(e.dtSpecified&&(n.dashType=e.dt),e.jtSpecified&&(n.lineJoin=e.jt),e.mlSpecified&&(n.miterLimit=e.ml),e.ctSpecified&&(n.compoundType=e.ct),e.atSpecified&&(n.alignment=e.at),e.doffSpecified&&(n.dashOffset=e.doff),e.dctSpecified&&(n.useRoundDash=1==e.dct),e.headEnd&&(n.headEnd=h(e.headEnd)),e.tailEnd&&(n.tailEnd=h(e.tailEnd)),e.tip&&(n.tipType=e.tip),n):n}(e.pen,e.lnWdth,e.lnHgth,t.fromHighPrecisionUnit);let o=new Se(i,n,s);return e.pctBrush&&(o.pictureBrush=c(e.pctBrush,t)),e.blend&&(o.blendingMode=e.blend),o}function d(t,r,i){let s,o,a,l,c;if(t.glw){let e=t.glw.blrRd*r,i=n(t.glw.clr);s=new Me(i,e)}if(t.otrSdw){let s=t.otrSdw;o=new Re(n(s.clr),s.blrRd*r,s.ang*e.c_internalAngleToRadianFactor,s.dst*r,new x(s.sx*i,s.sy*i),new x(s.kx,s.ky)),o.alignment=s.algn,o.shadowType=s.tp}if(t.inrSdw){let i=t.inrSdw;a=new Ae(n(i.clr),i.blrRd*r,i.ang*e.c_internalAngleToRadianFactor,i.dst*r)}if(t.rflctn){let e=t.rflctn;l=new Be(e.blrRd*r,e.sAlph,e.sPos,e.eAlph,e.ePos,e.dst*r)}return t.sftEdg&&(c=new Ie(t.sftEdg.blrRd*r)),new Fe(s,o,a,l,c)}function p(e,r,i){let n=e.pts;if(!n)return;const s=null==(o=e.f)?1:0==o?0:2==o?2:3==o?3:4==o?4:5==o?5:1;var o;let a;if(e.h>0){let t=JSON.parse("["+n+"]");a={figures:[new V(t,!1,e.h)]}}else a={figures:z(n)};return a.fillMode=s,a.lineEnabled=e.s,e.xfrm?a.transform=t(e.xfrm,i):a.transform=P.Identity,a.transform=a.transform.applyScaleAndTranslationBefore(new x(r,r),x.Zero),a.extrusionEnabled=e.e,a}function f(e,r,n){let s=[];const o=e.xfrm?t(e.xfrm,r.fromHighPrecisionUnit):P.Identity,a=e.fontInfo;for(const t of e.glyphInstance)if(t.glyph&&n){const e=n.getGlyph(a,t.glyph);if(!e)continue;if(!e.clientData){let r=p(e.p,1,1);r&&(r.lineEnabled=!0,r.fillMode=1,r.glyphCacheId={fontId:a,glyphId:t.glyph},e.clientData=new O(r))}if(!e.clientData)continue;let l=i(t.scale,1).scale(r.fromHighPrecisionUnit);l=l.scale(.000244140625);let c=i(t.off).scale(r.fromHighPrecisionUnit);const h=new O(e.clientData,o.applyScaleAndTranslationBefore(l,c));s.push(h)}return s}function g(e){return new Le(e.cp,e.len)}function m(e,t){const r=p(e,1,1);if(r){const e=r.figures.length?r.figures[0]:void 0;if(e){const r=e instanceof V?e:e.createFigure();if(1==t)return r;{const e=r.points.slice(0);for(let i=0;i<r.getPointCount();i++)e[i*r.pointDataSize]*=t,e[i*r.pointDataSize+1]*=t;return new V(e,r.isClosed,r.format)}}}}function y(e,t){if(!e)return 0;switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;case 9:return 9;case 10:return 10;case 11:return 11;case 12:return 12;case 13:return 13;case 14:return 14;case 15:return 15;case 16:return 16}return t.Error(595637021,"Incorrect ShapeBuilder.TextStrokeType"),1}function _(e,t,r){const i=new he;for(const n of e){const e=u(n.style,t,r);i.push(new Ue(y(n.type,r),n.verticalCenter*t.fromLowPrecisionUnit,n.thickness*t.fromLowPrecisionUnit,e))}return i}function v(e,t,r,i,n,s){const o=s.getGlyph(n,e);if(o){if(!o.clientData){let t=p(o.p,1,1);t&&(t.lineEnabled=!0,t.fillMode=1,t.glyphCacheId={fontId:n,glyphId:e},o.clientData=new O(t))}if(o.clientData)return new O(o.clientData,new P(x.Zero,t,i,r))}}function b(t,r,n,s,o,a){let l=[];const c=t.fi?t.fi.v:r;for(const r of t.gi||[])if(r.g&&o){const t=r.s?i(r.s,1).scale(s.fromHighPrecisionUnit/4096):n||x.Zero;t.equals(x.Zero)&&a.Error(0,"No glyph scale");const h=i(r.o).scale(s.fromHighPrecisionUnit),u=r.r?r.r.v*e.c_internalAngleToRadianFactor:0,d=v(r.g,t,h,u,c,o);d&&l.push(d)}return l}function w(e,t,r,i,n,o,a){let l=[];for(let s of e.g||[])l=l.concat(b(s,t,r,i,n,a));for(let t of e.p||[]){const e=p(t,i.fromHighPrecisionUnit,i.fromHighPrecisionUnit);e&&l.push(new O(e))}let h,u=s(e.lb,i.fromLowPrecisionUnit);if(e.i){const t=c(e.i.i,i),r=s(e.i.b,i.fromLowPrecisionUnit);(null==t?void 0:t.image)&&r&&(h=new We(t.image,r,o))}return new je(u,l,e.f?e.f.v:void 0,e.w?e.w.v:void 0,h)}function T(e,t,r,i,n,o,a){var l;let c=g(e.rng),h=s(e.lbnd,i.fromLowPrecisionUnit),u=new $e(c,h),d=[];if(e.c)for(let s=0;s<e.c.length;s++){let l=w(e.c[s],t.getAt(u.localRange.start+s),r.getAt(u.localRange.start+s),i,n,o,a);l&&d.push(l)}else(null===(l=e.s)||void 0===l?void 0:l.v)&&(d=function(e,t,r,i,n,s,o,a){const l=[],c=e.split(";");for(let e=0;e<c.length;e++){const h=c[e].split(/([A-VXYZ])/),u=h.length>0?h[0]:void 0;let d,p;for(let e=1;e<h.length-1;e+=2){const t=h[e];"L"==t&&(d=h[e+1]),"R"==t&&(p=h[e+1])}if(u&&d&&p){const a=parseFloat(d)*o.fromLowPrecisionUnit,c=parseFloat(p)*o.fromLowPrecisionUnit,h="W"==u;let f;if(!h){const t=v(parseInt(u),n.getAt(s+e),new x(a,0),0,i.getAt(s+e),r);t&&(f=[t])}const g=new E(a,t.top,c,t.bottom);l.push(new je(g,f,!1,h))}else a.Error(0,"Wrong SimplifiedCharacterString: 0:"+u+", L:"+d+", R:"+p)}return l}(e.s.v,h,n,t,r,u.localRange.start,i,a));return u.characters=d,e.b&&(u.bender=function(e,t){return e.wenv?function(e,t){const r=m(e.tpp,t.fromLowPrecisionUnit),i=m(e.btp,t.fromLowPrecisionUnit);if(r&&i)return new He(s(e.rct,t.fromLowPrecisionUnit),r,i,e.vrt)}(e.wenv,t):e.plin?function(e,t){const r=m(e.pth,t.fromLowPrecisionUnit);if(r){const i=0==e.algn?0:2==e.algn?1:.5;return new Ge(s(e.rct,t.fromLowPrecisionUnit),r,i,e.s,e.pvt,e.vrt)}}(e.plin,t):void 0}(e.b,i)),e.o&&(u.offset=new x(e.o.x*i.fromLowPrecisionUnit,e.o.y*i.fromLowPrecisionUnit)),u.fillBounds=s(e.fb,i.fromLowPrecisionUnit),u.textEffectMetrics=new Xe(e.ea*i.fromLowPrecisionUnit,e.ed*i.fromLowPrecisionUnit,e.eh*i.fromLowPrecisionUnit),u}function R(e,t,r,n,s){let o=new Ke(g(e.gr),new Se(new Te(27,ge.Blue,ge.Yellow)));e.o&&(o.offset=new x(e.o.x*r.fromLowPrecisionUnit,e.o.y*r.fromLowPrecisionUnit));let a=new ke("");for(let t of e.fipr||[])a.set(t.fontInfo,g(t.range));let l=new ke(x.Zero);for(let t of e.gspr||[])l.set(i(t.s,1).scale(r.fromHighPrecisionUnit/4096),g(t.rng));e.blt&&(o.bullet=function(e,t,r,i,n,s){var o;if(!e.c)return;const a=w(e.c,t,void 0,r,i,n,s),l=u(e.style,r,s),c=e.fx?d(e.fx,r.fromHighPrecisionUnit,1):void 0,h=(null===(o=e.stks)||void 0===o?void 0:o.length)>0?_(e.stks,r,s):void 0;return new qe(a,l,c,h)}(e.blt,e.blt.fi,r,t,n,s));const c=new Array;for(let i of e.l||[]){const e=T(i,a,l,r,t,n,s);e&&c.push(e)}for(let t of e.spr||[]){const e=u(t.style,r,s);o.stylePerLocalRange.set(e,g(t.range))}for(let t of e.stkspr||[]){const e=_(t.textStrokeList,r,s);e?o.strokesPerLocalRange.set(e,g(t.range)):s.Error(39084627,"Unable to convert stroke")}for(let t of e.lwrng||[])o.addLocalWordRange(g(t));for(let t of e.fxpr||[])o.effectsPerLocalRange.set(d(t.fx,r.fromHighPrecisionUnit,1),g(t.range));return o.lines=c,o}function A(e,t){return e?new M(e.l?e.l.v*t:void 0,e.t?e.t.v*t:void 0,e.r?e.r.v*t:void 0,e.b?e.b.v*t:void 0):void 0}e.c_internalAngleToRadianFactor=2*Math.PI/216e5,e.getPresWidthAndHeightJson=function(e){return new x(e.w,e.h)};const B=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0];function I(e){let t=B[e];if(t)return t;const r=new G;switch(r.moveTo(0,0),e){case 0:r.cubicBezierTo(0,.367,.124605,.82,.507899,1),r.cubicBezierTo(.724115,.737,.790455,.64,1,.64);break;case 1:r.cubicBezierTo(0,.55627,.44373,1,1,1);break;case 2:r.quadBezierTo(0,.125,.025,.25),r.lineTo(.125,.75),r.cubicBezierTo(.175,1,.25,1,.375,1),r.lineTo(.5,1),r.cubicBezierTo(.625,1,.7,1,.75,.75),r.lineTo(.875,.125),r.cubicBezierTo(.9,.01,.98,.01,1,.01);break;case 3:r.cubicBezierTo(0,.05563,.04437,.1,.1,.1),r.lineTo(.4,.1),r.cubicBezierTo(.45563,.1,.5,.14437,.5,.2),r.lineTo(.5,.9),r.cubicBezierTo(.5,.95563,.54437,1,.6,1);break;case 4:r.lineTo(1,1);break;case 5:r.cubicBezierTo(0,.4775,.0968736,1,.156301,1),r.cubicBezierTo(.264179,1,.376919,.33333,1,.33333);break;case 6:r.cubicBezierTo(0,.07082,.0297458,.1,.101416,.1),r.cubicBezierTo(.501416,.1,.9,.7,.901416,.899999),r.cubicBezierTo(.9,.97167,.93343,1,1,1);break;case 7:r.cubicBezierTo(0,.138122,0,.2,.271356,.775535),r.cubicBezierTo(.377654,1,.519455,1,.583589,1);break;case 8:r.cubicBezierTo(0,.236604,.119276,.607024,.263046,.760235),r.cubicBezierTo(.361098,.864726,.457934,.909567,.537806,.925082),r.cubicBezierTo(.559245,.929246,.567625,.89793,.542066,.845567),r.cubicBezierTo(.484073,.726757,.477103,.393693,.551651,.393693),r.lineTo(.899894,.393693),r.cubicBezierTo(.99148,.393693,.958466,.746659,.907348,.779629),r.lineTo(.879394,.797658),r.cubicBezierTo(.845545,.819489,.848775,.954172,.874334,.971627),r.quadBezierTo(.915883,1,1,1);break;case 9:r.cubicBezierTo(0,.238519,.132047,.500741,.357567,.731852),r.cubicBezierTo(.513167,.891311,.563798,.912593,.735905,.912593),r.lineTo(.873887,.912593),r.cubicBezierTo(.956973,.912593,.878338,1,1,1);break;case 10:r.quadBezierTo(0,.092437,.042353,.305322),r.lineTo(.170124,.947558),r.cubicBezierTo(.177203,.983142,.2,1,.268235,.998599),r.lineTo(.614118,.998599),r.cubicBezierTo(.647059,.998599,.656471,.987395,.663529,.969188),r.cubicBezierTo(.687006,.908633,.802353,.822129,1,.822129);break;case 11:r.cubicBezierTo(0,.184095,.149238,.333333,.333333,.333333),r.cubicBezierTo(.333333,.701523,.63181,1,1,1);break;default:r.lineTo(1,0)}return t=r.createFigure(),B[e]=t,t}function F(e,r,i,n,s){const o=new Ye,a=new P(n.translation.negate(),x.One,-n.rotation,x.Zero);return o.paragraphs=function(e,t,r,i,n){let s=[];for(let o of e||[])s.push(R(o,t,r,i,n));return s}(e.p,r,i,a,s),o.layoutToFrame=t(e.ltfxfrm,i.fromHighPrecisionUnit),o.frameToShape=t(e.ftsxfrm,i.fromHighPrecisionUnit),o.clipBounds=A(e.c,i.fromLowPrecisionUnit),o.applyEffectsPerCharacter=!!e.s&&e.s.v,o}function D(e){return e.clientData||(e.clientData={}),e.clientData}function L(e,r,i,s,o){var a;if(!e)return;const l=(null===(a=e.bapi)||void 0===a?void 0:a.v)||"";let c;if(e.Items){let t=[];for(const n of e.Items){const e=L(n,r,i,s,o);e&&t.push(e)}const n=e.fx?d(e.fx,i.fromHighPrecisionUnit,.01):void 0;c=new _t(t,n)}else c=function(e,r,i,s,o){try{if(!e)return;let a=[];const l=t(e.xfrm,s.fromHighPrecisionUnit);let c=new Array;if(r)for(let e of r){if(!e)continue;let t=p(e,s.fromHighPrecisionUnit,s.fromHighPrecisionUnit);t&&c.push(new O(t))}e.tx&&function(e,{},r,i,n,s){var o;for(let a of e){if(!a.primitives)continue;let e=new Array;for(const t of a.primitives)if(null===(o=null==t?void 0:t.p)||void 0===o?void 0:o.pts.length){let r=p(t.p,i.fromHighPrecisionUnit,i.fromHighPrecisionUnit);if(!r)continue;r.lineEnabled=!0,r.fillMode=1,e.push(new O(r))}else if(t.r){const n=f(t.r,i,r);e.push(...n)}const l={fromLowPrecisionUnit:i.fromLowPrecisionUnit,fromHighPrecisionUnit:i.fromLowPrecisionUnit,fromInch:i.fromInch};let c=u(a.style,l,s);const h=t(a.xfrm,i.fromHighPrecisionUnit);let d=new yt(e,c,void 0,h);d.overlapMode=1,d.mergeMode=a.union?1:0,d.role=3,n.push(d)}}(e.tx,l,i,s,a,o);let h=u(e.style,s,o);const g=e.fx?d(e.fx,s.fromHighPrecisionUnit,.01):void 0;if(e.tx){let t=g?new Fe(void 0,void 0,g.innerShadow,void 0,g.softEdges):void 0,r=g?new Fe(g.glow,g.shadow,void 0,g.reflection,void 0):void 0;const n=new yt(c,h,t,l);return e.tl&&(n.text=F(e.tl,i,s,l,o)),new _t([n,...a],r)}const m=new yt(c,h,g,l);if(e.tl&&(m.text=F(e.tl,i,s,l,o)),void 0!==e.ioff){let t=[];for(const r of e.ioff){const e=new x(r.x*s.fromHighPrecisionUnit,r.y*s.fromHighPrecisionUnit);t.push(e)}t.length>0&&(m.instances=t.map((e=>new gt(S.Translation2D(e)))))}if(e.s3d){const t=e.s3d.tb?new td(I(e.s3d.tb.p),new x(e.s3d.tb.w*s.fromLowPrecisionUnit,e.s3d.tb.h*s.fromLowPrecisionUnit)):void 0,r=e.s3d.bb?new td(I(e.s3d.bb.p),new x(e.s3d.bb.w*s.fromLowPrecisionUnit,e.s3d.bb.h*s.fromLowPrecisionUnit)):void 0,i=function(e,t,r,i){let n=t,s=0,o=ge.Black,a=ge.Black,l=ge.Black,c=0,h=!1,u=0,d=0;switch(e){case 0:a=t,h=!0;break;case 1:o=ge.White,a=t,c=32,h=!0;break;case 2:const e=ge.InterpolateLinear(t,ge.Black,1/3);n=e,o=t,a=e,c=32,h=!0,s=2;break;case 3:s=1;break;case 4:a=t;break;case 5:o=ge.Gray(.6),a=t,c=12;break;case 6:let r=ge.InterpolateLinear(t,ge.White,.2);r=ge.InterpolateLinear(r,ge.White,1.4),o=r,a=t,c=12,u=4,s=2;break;case 7:o=ge.Gray(.3),a=t,c=8;break;case 8:{const e=new ge(t.r,t.g,t.b,.7);n=e,o=ge.Gray(.3),a=e,c=10,h=!0,u=2,d=-1;break}case 9:n=ge.InterpolateLinear(t,ge.White,.5),o=ge.Gray(.3),a=ge.InterpolateLinear(t,ge.White,.5),c=10,h=!0,u=2;break;case 10:o=ge.White,a=t,c=35,u=-2;break;case 11:o=ge.White,a=t,c=35,u=4,d=-10;break;case 12:{const e=new ge(t.r,t.g,t.b,.1);n=e,o=ge.Gray(.6),a=e,c=20,u=-8,d=1;break}case 13:n=new ge(0,0,0,t.a),o=ge.Gray(.8),l=t,c=50,u=-4,d=1;break;case 14:n=ge.InterpolateLinear(t,ge.White,.5),a=t,c=8,s=2;break;default:o=ge.White,a=t,c=40}return r||0!=e&&1!=e&&2!=e||(n=new ge(0,0,0,t.a),o=ge.Gray(.8),a=ge.Black,l=t,c=50,h=!1,u=-4,d=0),new rd(s,n,o,a,l,c,h,u,d)}(e.s3d.mt,ge.White,h.fillBrush instanceof _e&&h.lineBrush instanceof _e),o=e.s3d.cc?n(e.s3d.cc.v):1==i.materialType?ge.Black:void 0,a=e.s3d.cc?e.s3d.cw*s.fromLowPrecisionUnit:0,l=e.s3d.xc?n(e.s3d.xc.v):void 0,c=new id(t,r,i,l,e.s3d.h*s.fromLowPrecisionUnit,o,a,e.s3d.z*s.fromLowPrecisionUnit);m.shape3D=c}return e.c&&(m.clipBounds=A(e.c,s.fromLowPrecisionUnit)),m}catch(e){o.Error(595637020,"Unexpected exception parsing shape")}}(e,e.pthLst||[],r,i,s);return c&&(c.clipBounds=e.c?A(e.c,i.fromLowPrecisionUnit):void 0,c.scene3D=e.scn?function(e){const t=[];for(let r of e.l||[])t.push(new Qu(new ge(r.cr,r.cg,r.cb,1),new C(r.dx,r.dy,r.dz),r.ws,r.wo,r.d,r.s));return new ed(n(e.a),t)}(e.scn):void 0,D(c).partId=l,D(c).renderDataId=e.id,(null==o?void 0:o.defaultClientData)&&function(e,t){const r=D(e);for(const e of Object.keys(t))r[e]=t[e]}(c,o.defaultClientData)),c}e.convertDocShapeOrGroup=function(e,t,r,i,n){if(!e)return;const s=12700*r;return L(e,t,{fromLowPrecisionUnit:e.lpu?e.lpu.v*s:1,fromHighPrecisionUnit:e.hpu?e.hpu.v*s:r,fromInch:914400*r},i,n)},e.convertShapeOrGroupRenderData=L}(nd||(nd={}));const sd=new class{Error(e,t){(0,b.H)(e,2504,t)}Message(e,t){(0,b.PN)(e,2504,t)}};function od(e,t){let r=0;return 0!==t&&(r=e/t),r}class ad{constructor(e,t,r,i){this.renderDataType=Sh,this.viewModel=new iu,this.childViewModels=new Map,this.viewModelUpdated=new l,this.sbViewModel=new Rt,this.onModelUpdated=(e,t)=>{null==t||t.addTimePoint("ModelUpdatedEventReceivedTime"),this.refreshViewModel(1,t).catch((e=>{this.logCatchReason("onModelUpdated",e)}))},this.onAnchorTransformUpdated=e=>{this.refreshViewModel(2,e).catch((e=>{this.logCatchReason("onAnchorTransformUpdated",e)}))},this.onViewTransformUpdated=e=>{this.refreshViewModel(8,e).catch((e=>{this.logCatchReason("onViewTransformUpdated",e)}))},this.onCombinedScaleChanged=()=>{this.refreshViewModel(4).catch((e=>{this.logCatchReason("onCombinedScaleChanged",e)}))},this.graphic=e,this.glyphStore=t,this.context=r,this.shapeBuilderContext=i,this.viewModel.children=[this.sbViewModel],this.viewModel.model=this.graphic.model,this.graphic.model.modelUpdated.on(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.on(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.on(this.onViewTransformUpdated),this.context.viewScale.combinedScaleChanged.on(this.onCombinedScaleChanged)}init(e,t){void 0!==e&&this.viewModelUpdated.on(e),this.updateViewModelProperties(15,t).catch((e=>{this.logCatchReason("constructor",e)}))}teardown(){this.context.anchorPresenter.transformUpdated.off(this.onAnchorTransformUpdated),this.context.viewScale.viewTransformChanged.off(this.onViewTransformUpdated),this.graphic.model.modelUpdated.off(this.onModelUpdated)}async updateViewModelProperties(e,t){null==t||t.addTimePoint("ShapeBuilderRenderDataPresenterStartTime");let r=!1;const i=new so("ShapeBuilderRenderDataPresenter_UpdateViewModel",void 0!==t?[t]:[]);try{0!=(8&e)&&(r=this.updateViewModelViewTransform()||r),0!=(2&e)&&(r=this.updateViewModelAnchorTransform()||r),0!=(4&e)&&(r=this.updateViewModelZoomFactor()||r),0!=(1&e)&&(r=await this.updateViewModelRenderData(t)||r)}catch(e){throw(0,b.H)(0,2505,`Exception: ${e.message}`),e}finally{i.complete()}r&&(null==t||t.addTimePoint("ViewModelUpdatedEventEmittedTime"),this.viewModelUpdated.emit(t)),null==t||t.addTimePoint("ShapeBuilderRenderDataPresenterEndTime")}async updateViewModelRenderData(e){const t=this.graphic.model.fallbackRenderData;if(void 0===t)return!1;!function(e){if(!Eh(e))throw new Error(`Invalid renderData type: ${e.type}`)}(t);let r=1,i=1;r=0!==this.context.viewScale.viewTransform.size.width?od(this.context.viewScale.viewTransform.size.width,t.sourceAnchorBounds.width()):od(this.context.anchorPresenter.transform.size.width,t.sourceAnchorBounds.width()),i=0!==this.context.viewScale.viewTransform.size.height?od(this.context.viewScale.viewTransform.size.height,t.sourceAnchorBounds.height()):od(this.context.anchorPresenter.transform.size.height,t.sourceAnchorBounds.height());const n=Math.max(r,i),s=t.sourceAnchorBounds.clone();if(s.scale(n,n),s.isEmpty())return this.sbViewModel.setItems([]),!0;const o=nd.convertDocShapeOrGroup(t.shapeBuilderRenderData,this.glyphStore,n,sd,{});if(void 0===o)this.sbViewModel.setItems([]);else{this.createViewModelsForChild(o,s,n);const r=new so("ShapeBuilderRenderDataPresenter_SetImageList",void 0!==e?[e]:[]);try{await this.setImageListIntoShapeBuilderDataAsync(t.embeddedImageList,o)}finally{r.complete()}this.sbViewModel.setItems([o])}return this.sbViewModel.sourceAnchorBounds=s,this.sbViewModel.emuToSourceScale=n,!0}createViewModelsForChild(e,t,r){if(this.childViewModels.clear(),2===e.getType()){const i=e;if(void 0!==i.clientData.renderDataId){const e=i.items;e.length>0&&2===e.elements[0].getType()&&(e.elements[0].items.elements.forEach((e=>{const i=new Rt;i.setItems([e]),i.isHitTestOnly=!0,i.sourceAnchorBounds=t,i.emuToSourceScale=r;const n=e.clientData.renderDataId,s=this.getRenderDataIdForItemWithKey(n,"creation"),o=this.getRenderDataIdForItemWithKey(n,"type");this.childViewModels.set(s,new iu([i],{nodeType:o,nodeKey:s}))})),this.viewModel.children.push(...this.childViewModels.values()))}}}getRenderDataIdForItemWithKey(e,t){let r="";return e.forEach((e=>{e.k===t&&(r=e.v)})),r}async setImageListIntoShapeBuilderDataAsync(e,t){if(void 0===e||0===e.length)return;const r=this.attachTexturesForImagesAsync(e,t);0===this.sbViewModel.scene.items.length?r.then((()=>{this.viewModelUpdated.emit()})).catch((e=>{this.logCatchReason("attachTexturesForImagesAsync continuation",e)})):await r}async attachTexturesForImagesAsync(e,t){const r=t.getBrushImages(),i=[];for(const t of e)for(const e of r)t.imageIdField.toString()===e.id&&i.push(this.attachTextureForImageAsync(t.imageDataField,e));await Promise.all(i)}async attachTextureForImageAsync(e,t){const r=new window.Image;await fs(r,e),function(e){if(0!==e.width||0!==e.height)return;const t=function(e){try{const t=function(e){if(!e.startsWith(Yu))return;const t=e.indexOf(",",Yu.length);if(-1===t)return;const r=e.substring(Yu.length,t);if(r.length<=0)return Ju;const i=r.indexOf(";"),n=-1===i?r:r.substring(0,i);return n.length<=0?Ju:n.toLowerCase()}(e);if(t!==Zu)return;const r=e.indexOf(",",Yu.length);if(-1===r)return;const i=e.substring(r+1);if(0===i.length)return;const n=decodeURIComponent(i),s=(new DOMParser).parseFromString(n,Zu).documentElement,o=function(e,t){if(e.unitType===t.unitType)return e.value/t.value}(s.width.baseVal,s.height.baseVal);return void 0===o?new g(300,150):isFinite(o)?new g(150*o,150):new g(300,0)}catch(e){return}}(e.src);void 0!==t&&(e.width=t.width,e.height=t.height)}(r);const i=this.shapeBuilderContext.renderer,n=ir.CreateFromHTMLImageElement("ShapeBuilderRenderDataPresenter",i,r);i.attachTextureToImage(t,n)}updateViewModelAnchorTransform(){return 0!==this.context.viewScale.viewTransform.size.width||0!==this.context.viewScale.viewTransform.size.height?this.updateViewModelViewTransform():!this.sbViewModel.transform.equals(this.context.anchorPresenter.transform)&&(this.sbViewModel.transform=this.context.anchorPresenter.transform.clone(),!0)}updateViewModelViewTransform(){return!this.sbViewModel.transform.equals(this.context.viewScale.viewTransform)&&(this.sbViewModel.transform=this.context.viewScale.viewTransform.clone(),!0)}updateViewModelZoomFactor(){return this.sbViewModel.scaleFactor!==this.context.viewScale.zoomFactor&&(this.sbViewModel.scaleFactor=this.context.viewScale.zoomFactor,!0)}logCatchReason(e,t){(0,b.H)(0,2505,`ShapeBuilderRenderDataPresenter.${e}: ${t}`)}async refreshViewModel(e,t){return this.updateViewModelProperties(e,t)}}function ld(e,t){try{e.setPointerCapture(t.pointerId)}catch(e){}}class cd{constructor(){this.zoomPanUpdated=new l,this._zoom=1,this._pan=new u(0,0)}static getInstance(){return void 0===cd.instance&&(cd.instance=new cd),cd.instance}set zoom(e){this._zoom!==e&&(this._zoom=e,this.zoomPanUpdated.emit())}get zoom(){return this._zoom}set pan(e){this._pan.x===e.x&&this._pan.y===e.y||(this._pan=new u(e.x,e.y),this.zoomPanUpdated.emit())}get pan(){return new u(this._pan.x,this._pan.y)}setZoomAndPan(e,t){this._zoom===e&&this._pan.x===t.x&&this._pan.y===t.y||(this._zoom=e,this._pan=new u(t.x,t.y),this.zoomPanUpdated.emit())}getRelativePosition(e){return new u((e.x-this._pan.x)/this._zoom,(e.y-this._pan.y)/this._zoom)}getRelativeSize(e){return new g(e.width/this._zoom,e.height/this._zoom)}getAbsolutePosition(e){return new u(e.x*this._zoom+this._pan.x,e.y*this._zoom+this._pan.y)}getAbsoluteSize(e){return new g(e.width*this._zoom,e.height*this._zoom)}}function hd(e){if(null!==e.currentTarget){const t=e.currentTarget.getBoundingClientRect();return cd.getInstance().getRelativePosition(new u(e.clientX-t.left,e.clientY-t.top))}return new u(0,0)}class ud{}class dd{constructor(e,t,r){this.type=ud,this.onPointerDown=(e,t)=>{ld(e.currentTarget,e),this.dragStartPosition=hd(e),e.ctrlKey||e.shiftKey?this.editContext.actionInvoker.invoke(new th([this.elementModelId])):(this.editContext.actionInvoker.invoke(new _l([this.graphic])),this.editContext.actionInvoker.invoke(new Qc([this.elementModelId]))),t.isHandled=!0},this.onPointerMove=(e,t)=>{void 0!==this.dragStartPosition?t.isHandled=!0:t.isHandled=!1},this.onPointerUp=(e,t)=>{void 0!==this.dragStartPosition?(this.dragStartPosition=void 0,t.isHandled=!0):t.isHandled=!1},this.onPointerCancel=(e,t)=>{void 0!==this.dragStartPosition?(this.dragStartPosition=void 0,t.isHandled=!0):t.isHandled=!1},this.graphic=e,this.elementModelId=t,this.editContext=r}addEventListeners(e){e.pointerEventNotifiers.pointerdown.value.on(this.onPointerDown),e.pointerEventNotifiers.pointermove.value.on(this.onPointerMove),e.pointerEventNotifiers.pointerup.value.on(this.onPointerUp),e.pointerEventNotifiers.pointercancel.value.on(this.onPointerCancel)}removeEventListeners(e){e.pointerEventNotifiers.pointerdown.value.off(this.onPointerDown),e.pointerEventNotifiers.pointermove.value.off(this.onPointerMove),e.pointerEventNotifiers.pointerup.value.off(this.onPointerUp),e.pointerEventNotifiers.pointercancel.value.off(this.onPointerCancel)}}class pd{constructor(e,t,r){this.elements=new Map,this.updateElements=()=>{const e=this.elements;this.elements=new Map;const t=this.presenter.viewModel;nu(t)&&t.children.forEach((t=>{var r;if(nu(t)&&void 0!==(null===(r=t.nodeId)||void 0===r?void 0:r.nodeKey)&&1===t.children.length){const r=t.nodeId.nodeKey,i=e.get(r);void 0!==i?(e.delete(r),this.elements.set(r,i),i.setViewModel(t.children[0])):this.elements.set(r,new fd(new dd(this.graphic,r,this.editContext),t.children[0]))}}));for(const[t,r]of e)r.teardown()},this.graphic=e,this.presenter=t,this.editContext=r,this.updateElements(),this.presenter.viewModelUpdated.on(this.updateElements)}teardown(){this.presenter.viewModelUpdated.off(this.updateElements);for(const[e,t]of this.elements)t.teardown()}}class fd{constructor(e,t){this.element=e,this.viewModel=t,this.element.addEventListeners(this.viewModel)}teardown(){this.element.removeEventListeners(this.viewModel)}setViewModel(e){this.viewModel!==e&&(this.element.removeEventListeners(this.viewModel),this.viewModel=e,this.element.addEventListeners(this.viewModel))}}const gd={nodeType:"root"};class md{get viewModel(){return this.smartArtRenderDataPresenter.viewModel}get viewModelUpdated(){return this.smartArtRenderDataPresenter.viewModelUpdated}constructor(e,t,r,i){this.smartArtModelPresenterCreator=(e,t,r)=>this.smartArtInnerPresenter,this.graphic=e,this.smartArtInnerPresenter=new yd(this.graphic,t,r),this.smartArtRenderDataPresenter=new kh(this.graphic,t,this.smartArtModelPresenterCreator,i),void 0!==i&&(this.editElements=new pd(this.graphic,this,i))}teardown(){var e;null===(e=this.editElements)||void 0===e||e.teardown(),this.smartArtRenderDataPresenter.teardown(),this.smartArtInnerPresenter.teardown()}}class yd{constructor(e,t,r){this.viewModel=new iu([],gd),this.viewModelUpdated=new l,this.onLayoutUpdated=()=>{this.updateViewModel().catch((()=>{}))},this.onAnchorTransformUpdated=()=>{this.smartArt.modelUpdated.emit()},this.graphic=e,this.smartArt=this.graphic.model,this.anchorPresenter=t.anchorPresenter,this.presenterSite=r,this.smartArt.layoutUpdated.on(this.onLayoutUpdated),this.anchorPresenter.transformUpdated.on(this.onAnchorTransformUpdated)}teardown(){this.anchorPresenter.transformUpdated.off(this.onAnchorTransformUpdated),this.smartArt.layoutUpdated.off(this.onLayoutUpdated)}async updateViewModel(){const e=await this.presenterSite.getViewModel();this.viewModel.children=e.children,this.viewModelUpdated.emit()}}class _d{constructor(e){this.transformUpdated=new l,this.onAnchorUpdated=e=>{this.transformUpdated.emit(e)},this.anchor=e,this.anchor.anchorUpdated.on(this.onAnchorUpdated)}get transform(){return this.anchor.transform}teardown(){this.anchor.anchorUpdated.off(this.onAnchorUpdated)}}function vd(e){return new _d(e.anchor)}class bd{constructor(){this.containerViewModel=new iu}async getViewModel(){return this.containerViewModel}}function wd(){return new bd}function Td(e){for(;null!==e.firstChild;)e.removeChild(e.firstChild)}function xd(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}class Cd{constructor(e,t){this.element=e,this.name=t}set transform(e){this.element.set(this.name,e)}setRotate(e,t=0,r=0,i=2){this.transform=Sd(e,t,r,i)}setScale(e,t,r=2){this.transform=Pd(e,t,r)}setTranslate(e,t,r=2){this.transform=Ed(e,t,r)}set(e,t,r,i,n=2){var s,o;0!==r||t.x||t.y?this.transform=`${Ed(i.x,i.y,n)}${Sd(r,0,0,n)}${s=t.x,o=t.y,Pd(s?-1:1,o?-1:1,0)}${Ed(e.x,e.y,n)}`:this.transform=`${Ed(i.x+e.x,i.y+e.y,n)}`}}function Sd(e,t,r,i){return 0===e?"":0!==t||0!==r?`rotate(${e.toFixed(i)},${t.toFixed(i)},${r.toFixed(i)})`:`rotate(${e.toFixed(i)})`}function Pd(e,t,r){return 1===e&&1===t?"":`scale(${e.toFixed(r)},${t.toFixed(r)})`}function Ed(e,t,r){return 0===e&&0===t?"":`translate(${e.toFixed(r)},${t.toFixed(r)})`}class Md extends class{constructor(e){this.element=e}get id(){return this.element.id}set id(e){this.element.id=e}get style(){return this.element.style}set(e,t){this.element.setAttribute(e,`${t}`)}appendChild(e){this.element.appendChild(e.element)}}{constructor(e){super(e),this.transform=new Cd(this,"transform")}set opacity(e){this.set("opacity",e)}}class Rd extends Md{constructor(e){super(e)}set fill(e){this.set("fill",`${e}`)}set stroke(e){this.set("stroke",`${e}`)}set strokeDasharray(e){this.set("stroke-dasharray",`${e}`)}set strokeDashoffset(e){this.set("stroke-dashoffset",`${e}`)}set strokeLinecap(e){this.set("stroke-linecap",`${e}`)}set strokeLinejoin(e){this.set("stroke-linejoin",`${e}`)}set strokeMiterlimit(e){this.set("stroke-miterlimit",`${e}`)}set strokeWidth(e){this.set("stroke-width",`${e}`)}set shapeRendering(e){this.set("shape-rendering",`${e}`)}}class Ad extends Rd{constructor(e=xd("rect")){super(e)}set x(e){this.set("x",`${e}`)}set y(e){this.set("y",`${e}`)}set rx(e){this.set("rx",`${e}`)}set ry(e){this.set("ry",`${e}`)}set width(e){this.set("width",`${e}`)}set height(e){this.set("height",`${e}`)}clone(){return new Ad(this.element.cloneNode())}}function Bd(e,t,r,i,n){const s=yu("mask");if(s.id=`gc2-crop-${performance.now()}${Math.random()}`,e.forEach((([e,t])=>{if(0===t)return;const r=e.cloneNode();r.setAttribute("fill","white"),s.append(r)})),n){const{size:e,flip:n,rot:o}=t,{width:a,height:l}=e,c=new Ad;c.width=a*i.x,c.height=l*i.y,c.fill="rgba(255,255,255,0.3)",c.transform.set({x:-a/2-r.x,y:-l/2-r.y},n,o,{x:0,y:0}),s.prepend(c.element)}return s}function Id(e){const t=[];if(e.forEach((([e,r])=>{switch(r){case 4:case 5:case 2:case 3:const i=e.cloneNode();i.setAttribute("fill",function(e){switch(e){case 4:return"rgba(0,0,0,0.4)";case 5:return"rgba(0,0,0,0.2)";case 2:return"rgba(255,255,255,0.4)";case 3:return"rgba(255,255,255,0.2)";default:(0,xn.t)(e)}}(r)),t.push(i)}})),0===t.length)return;const r=yu("g");return r.setAttribute("pointer-events","none"),r.append(...t),r}const Fd=[2,1.75,1.5,1.25,1,.5],Dd='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">',Ld='<path d="M12.4014 13.2403C13.222 12.83 14.2039 12.9967 14.8536 13.6464C15.0488 13.8417 15.0488 14.1583 14.8535 14.3536C14.6583 14.5488 14.3417 14.5488 14.1464 14.3535C13.7961 14.0032 13.278 13.92 12.8486 14.1347C12.4366 14.3407 12 14.8852 12 16C12 17.1148 12.4366 17.6593 12.8486 17.8653C13.278 18.08 13.7961 17.9967 14.1464 17.6464C14.3417 17.4512 14.6583 17.4512 14.8536 17.6464C15.0488 17.8417 15.0488 18.1583 14.8536 18.3535C14.2039 19.0032 13.222 19.17 12.4014 18.7597C11.5634 18.3407 11 17.3852 11 16C11 14.6149 11.5634 13.6593 12.4014 13.2403ZM20.3536 13.6465C19.7039 12.9968 18.722 12.83 17.9014 13.2403C17.0634 13.6593 16.5 14.6149 16.5 16C16.5 17.3852 17.0634 18.3407 17.9014 18.7597C18.722 19.17 19.7039 19.0033 20.3536 18.3536C20.5488 18.1583 20.5488 17.8417 20.3536 17.6465C20.1583 17.4512 19.8417 17.4512 19.6464 17.6465C19.2961 17.9968 18.778 18.08 18.3486 17.8653C17.9366 17.6593 17.5 17.1148 17.5 16C17.5 14.8852 17.9366 14.3408 18.3486 14.1347C18.778 13.9201 19.2961 14.0033 19.6464 14.3536C19.8417 14.5488 20.1583 14.5488 20.3535 14.3536C20.5488 14.1583 20.5488 13.8417 20.3536 13.6465ZM8 13C8 11.3431 9.34315 10 11 10H21C22.6569 10 24 11.3431 24 13V19C24 20.6569 22.6569 22 21 22H11C9.34315 22 8 20.6569 8 19V13ZM11 11C9.89543 11 9 11.8954 9 13V19C9 20.1046 9.89543 21 11 21H21C22.1046 21 23 20.1046 23 19V13C23 11.8954 22.1046 11 21 11H11Z" fill="white"/>',kd=`${Dd}<path id="volume-low-icon" class="invisible" fill="#FFFFFF" fill-opacity="1.000" d="M17.9971 9.00613C17.9971 8.13311 16.9568 7.67928 16.3168 8.27313L12.4447 11.8665C12.3522 11.9523 12.2307 12 12.1046 12H9.49707C8.66864 12 7.99707 12.6716 7.99707 13.5V18.5C7.99707 19.3284 8.66864 20 9.49707 20H12.1046C12.2307 20 12.3522 20.0477 12.4447 20.1335L16.3168 23.7269C16.9568 24.3207 17.9971 23.8669 17.9971 22.9939V9.00613ZM13.1249 12.5995L16.9971 9.00613V22.9939L13.1249 19.4005C12.8475 19.1431 12.483 19 12.1046 19H9.49707C9.22093 19 8.99707 18.7761 8.99707 18.5V13.5C8.99707 13.2239 9.22093 13 9.49707 13H12.1046C12.483 13 12.8475 12.8569 13.1249 12.5995Z"/><path id="volume-medium-icon" class="invisible" fill="#FFFFFF" fill-opacity="1.000" d="M17.9971 9.00613C17.9971 8.13311 16.9568 7.67928 16.3168 8.27313L12.4447 11.8665C12.3522 11.9523 12.2307 12 12.1046 12H9.49707C8.66864 12 7.99707 12.6716 7.99707 13.5V18.5C7.99707 19.3284 8.66864 20 9.49707 20H12.1046C12.2307 20 12.3522 20.0477 12.4447 20.1335L16.3168 23.7269C16.9568 24.3207 17.9971 23.8669 17.9971 22.9939V9.00613ZM13.1249 12.5995L16.9971 9.00613V22.9939L13.1249 19.4005C12.8475 19.1431 12.483 19 12.1046 19H9.49707C9.22093 19 8.99707 18.7761 8.99707 18.5V13.5C8.99707 13.2239 9.22093 13 9.49707 13H12.1046C12.483 13 12.8475 12.8569 13.1249 12.5995ZM20.0814 18.9332C19.8421 18.7954 19.7599 18.4897 19.8977 18.2504C20.6739 16.9028 20.7294 15.1916 19.897 13.7499C19.759 13.5108 19.8409 13.205 20.08 13.0669C20.3192 12.9288 20.625 13.0108 20.7631 13.2499C21.7811 15.0132 21.7112 17.1054 20.7642 18.7495C20.6264 18.9888 20.3207 19.0711 20.0814 18.9332Z"/><path id="volume-high-icon" class="invisible" fill="#FFFFFF" fill-opacity="1.000" d="M17.9971 9.00613C17.9971 8.13311 16.9568 7.67928 16.3168 8.27313L12.4447 11.8665C12.3522 11.9523 12.2307 12 12.1046 12H9.49707C8.66864 12 7.99707 12.6716 7.99707 13.5V18.5C7.99707 19.3284 8.66864 20 9.49707 20H12.1046C12.2307 20 12.3522 20.0477 12.4447 20.1335L16.3168 23.7269C16.9568 24.3207 17.9971 23.8669 17.9971 22.9939V9.00613ZM13.1249 12.5995L16.9971 9.00613V22.9939L13.1249 19.4005C12.8475 19.1431 12.483 19 12.1046 19H9.49707C9.22093 19 8.99707 18.7761 8.99707 18.5V13.5C8.99707 13.2239 9.22093 13 9.49707 13H12.1046C12.483 13 12.8475 12.8569 13.1249 12.5995ZM22.1422 10.7746C22.3478 10.5903 22.6639 10.6076 22.8482 10.8133C25.5644 13.8449 25.5645 18.449 22.8483 21.4806C22.664 21.6863 22.3479 21.7036 22.1422 21.5194C21.9365 21.3351 21.9192 21.019 22.1035 20.8133C24.4794 18.1615 24.4794 14.1324 22.1034 11.4806C21.9192 11.2749 21.9365 10.9588 22.1422 10.7746ZM20.0814 18.9332C19.8421 18.7954 19.7599 18.4897 19.8977 18.2504C20.6739 16.9028 20.7294 15.1916 19.897 13.7499C19.759 13.5108 19.8409 13.205 20.08 13.0669C20.3192 12.9288 20.625 13.0108 20.7631 13.2499C21.7811 15.0132 21.7112 17.1054 20.7642 18.7495C20.6264 18.9888 20.3207 19.0711 20.0814 18.9332Z"/><path id="volume-muted-icon" class="invisible" fill="#FFFFFF" fill-opacity="1.000" d="M17.9971 9.00613C17.9971 8.13311 16.9568 7.67928 16.3168 8.27313L12.4447 11.8665C12.3522 11.9523 12.2307 12 12.1046 12H9.49707C8.66864 12 7.99707 12.6716 7.99707 13.5V18.5C7.99707 19.3284 8.66864 20 9.49707 20H12.1046C12.2307 20 12.3522 20.0477 12.4447 20.1335L16.3168 23.7269C16.9568 24.3207 17.9971 23.8669 17.9971 22.9939V9.00613ZM13.1249 12.5995L16.9971 9.00613V22.9939L13.1249 19.4005C12.8475 19.1431 12.483 19 12.1046 19H9.49707C9.22093 19 8.99707 18.7761 8.99707 18.5V13.5C8.99707 13.2239 9.22093 13 9.49707 13H12.1046C12.483 13 12.8475 12.8569 13.1249 12.5995ZM20.029 14.1665C20.2243 13.9712 20.5409 13.9712 20.7361 14.1665L22.3826 15.8129L24.029 14.1665C24.2243 13.9712 24.5409 13.9712 24.7361 14.1665C24.9314 14.3617 24.9314 14.6783 24.7361 14.8736L23.0897 16.52L24.7361 18.1665C24.9314 18.3617 24.9314 18.6783 24.7361 18.8736C24.5409 19.0688 24.2243 19.0688 24.029 18.8736L22.3826 17.2271L20.7361 18.8736C20.5409 19.0688 20.2243 19.0688 20.029 18.8736C19.8338 18.6783 19.8338 18.3617 20.029 18.1665L21.6755 16.52L20.029 14.8736C19.8338 14.6783 19.8338 14.3617 20.029 14.1665Z"/></svg>`,Od=`${Dd}<path id="play-icon" class="invisible" fill="#FFFFFF" fill-opacity="1.000" d="M24.1059 15.0879C25.1413 15.6575 25.1413 17.1443 24.1059 17.7139L14.1089 23.2129C13.1092 23.7628 11.8855 23.0402 11.8855 21.9L11.8855 10.9018C11.8855 9.76156 13.1092 9.03893 14.1089 9.58883L24.1059 15.0879ZM23.6236 16.8385C23.9688 16.6487 23.9688 16.1531 23.6236 15.9632L13.6266 10.4641C13.2934 10.2808 12.8855 10.5217 12.8855 10.9018L12.8855 21.9C12.8855 22.28 13.2934 22.5209 13.6266 22.3376L23.6236 16.8385Z"/><path  id="pause-icon" fill="#FFFFFF" fill-opacity="1.000" d="M11.8855 8.77393C10.7809 8.77393 9.8855 9.66936 9.8855 10.7739V22.7739C9.8855 23.8785 10.7809 24.7739 11.8855 24.7739H13.8855C14.9901 24.7739 15.8855 23.8785 15.8855 22.7739V10.7739C15.8855 9.66936 14.9901 8.77393 13.8855 8.77393H11.8855ZM10.8855 10.7739C10.8855 10.2216 11.3332 9.77393 11.8855 9.77393H13.8855C14.4378 9.77393 14.8855 10.2216 14.8855 10.7739V22.7739C14.8855 23.3262 14.4378 23.7739 13.8855 23.7739H11.8855C11.3332 23.7739 10.8855 23.3262 10.8855 22.7739V10.7739ZM19.8855 8.77393C18.7809 8.77393 17.8855 9.66936 17.8855 10.7739V22.7739C17.8855 23.8785 18.7809 24.7739 19.8855 24.7739H21.8855C22.9901 24.7739 23.8855 23.8785 23.8855 22.7739V10.7739C23.8855 9.66936 22.9901 8.77393 21.8855 8.77393H19.8855ZM18.8855 10.7739C18.8855 10.2216 19.3332 9.77393 19.8855 9.77393H21.8855C22.4378 9.77393 22.8855 10.2216 22.8855 10.7739V22.7739C22.8855 23.3262 22.4378 23.7739 21.8855 23.7739H19.8855C19.3332 23.7739 18.8855 23.3262 18.8855 22.7739V10.7739Z"/></svg>`,Ud=`${Dd}${Ld}</svg>`,Nd=`${Dd}${Ld}<rect y="31.885" width="2" height="32" transform="rotate(-90 0 31.885)" fill="white"/></svg>`;function Vd(e){let t="";switch(e){case"play-pause-icon":t=Od;break;case"volume-icon":t=kd;break;case"captions-icon":t=Ud;break;case"captions-active-icon":t=Nd;break;case"checkmark-icon":t='<svg width="14" height="10" viewBox="0 0 14 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.3516 1.35156L5 9.71094L0.648438 5.35156L1.35156 4.64844L5 8.28906L12.6484 0.648438L13.3516 1.35156Z" fill="white"/></svg>'}const r=(new DOMParser).parseFromString(t,"image/svg+xml"),i=document.importNode(r.documentElement,!0);return i.classList.add(e),i.setAttribute("aria-hidden","true"),i}let Gd={info(e,t){},warn(e,t){},error(e,t){}};const zd=new Map([["ar","Arabic"],["ar-sa","Arabic"],["bn","Bangla"],["bn-bd","Bangla"],["bn-in","Bangla"],["cs","Czech"],["cs-cz","Czech"],["da","Danish"],["da-dk","Danish"],["de","German"],["de-at","German"],["de-ch","German"],["de-de","German"],["el","Greek"],["el-gr","Greek"],["en","English"],["en-au","English"],["en-ca","English"],["en-gb","English"],["en-ie","English"],["en-in","English"],["en-nz","English"],["en-us","English"],["en-za","English"],["es","Spanish"],["es-ar","Spanish"],["es-cl","Spanish"],["es-co","Spanish"],["es-es","Spanish"],["es-mx","Spanish"],["es-us","Spanish"],["fi","Finnish"],["fi-fi","Finnish"],["fr","French"],["fr-be","French"],["fr-ca","French"],["fr-ch","French"],["fr-fr","French"],["he","Hebrew"],["he-il","Hebrew"],["hi","Hindi"],["hi-in","Hindi"],["hu","Hungarian"],["hu-hu","Hungarian"],["id","Indonesian"],["id-id","Indonesian"],["it","Italian"],["it-ch","Italian"],["it-it","Italian"],["ja","Japanese"],["jp","Japanese"],["jp-jp","Japanese"],["ko","Korean"],["ko-kr","Korean"],["nl","Dutch"],["nl-be","Dutch"],["nl-nl","Dutch"],["no","Norwegian"],["no-no","Norwegian"],["pl","Polish"],["pl-pl","Polish"],["pt","Portugese"],["pt-br","Portugese"],["pt-pt","Portugese"],["ro","Romanian"],["ro-ro","Romanian"],["ru","Russian"],["ru-ru","Russian"],["sk","Slovak"],["sk-sk","Slovak"],["sv","Swedish"],["sv-se","Swedish"],["ta","Tamil"],["ta-in","Tamil"],["ta-lk","Tamil"],["th","Thai"],["th-yh","Thai"],["tr","Turkish"],["tr-tr","Turkish"],["zh","Chinese"],["zh-cn","Chinese (Simplified)"],["zh-hant","Chinese (Traditional)"],["zh-hk","Chinese (Traditional)"],["zh-tw","Chinese (Traditional)"],["unknown","Unknown"]]);function Hd(e){const t=zd.get(e.toLowerCase());return void 0===t?e:t}class Wd{constructor(){this.cues=[],this.label="",this.language=""}}function jd(e,t){Object.assign(e.style,t)}function qd(e){return e/1e3}function Xd(e,t){const[r,i,n]=$d(e);return t.localizedTimeStr.replace("{0}",`${r>0?r.toFixed(0):""}`).replace("{1}",`${r>0?(a=r,1===a?t.localizedLabelsStr[0]:t.localizedLabelsStr[1]):""}`).replace("{2}",`${i>0?i.toFixed(0):""}`).replace("{3}",`${i>0?(o=i,1===o?t.localizedLabelsStr[2]:t.localizedLabelsStr[3]):""}`).replace("{4}",(s=n,0===e?"0":s>0?s.toFixed(0):"")).replace("{5}",(r=>e>0&&0===r?"":1===r?t.localizedLabelsStr[4]:t.localizedLabelsStr[5])(n));var s,o,a}function $d(e){const t=Math.floor(e/3600),r=Math.floor((e-3600*t)/60);return[t,r,Math.floor(e-3600*t-60*r)]}class Kd{constructor(e,t,r){this.captionsButtonVisible=!1,this.captionsButtonEnabled=!1,this.volumeSliderEnabled=!0,this.captionsMinUIDelay=250,this.speedButtonEnabled=!1,this.textTracks=[],this.captionSelection=0,this.captionFocus=0,this.speedSelection=0,this.lastToggleTime=0,this.defaultCaptionsTrackSet=!1,this.defaultSpeedSet=!1,this.videoElement=e,this.mediaControlInfo=t,this.mediaCallbacks=r,this.captionsButtonVisible=void 0!==t.captionsEnabled&&t.captionsEnabled,this.captionsButtonVisible&&this.videoElement.textTracks.length>0&&(this.captionsButtonEnabled=!0),this.captionsRenderer=t.captionsRenderer,this.volumeSliderEnabled=void 0===this.mediaControlInfo.volumeSliderEnabled||this.mediaControlInfo.volumeSliderEnabled,this.speedButtonEnabled=void 0!==t.speedEnabled&&t.speedEnabled;const i=isNaN(t.trimInfo.trimEndMs)?0:t.trimInfo.trimEndMs,n=isNaN(this.videoElement.duration)?0:1e3*this.videoElement.duration-i;this.mediaInfo={trimStartMs:isNaN(t.trimInfo.trimStartMs)?0:t.trimInfo.trimStartMs,trimEndMs:i,max:qd(n),autoplay:this.videoElement.autoplay,playbackSpeed:this.videoElement.playbackRate,screenReaderInfo:t.screenReaderInfo},this.createControls(),this.setVolumeIcon(this.videoElement.volume,this.videoElement.muted),isNaN(this.videoElement.duration)&&(Gd.warn(541882010,"PlaybackControls: Video duration not set."),void 0!==this.mediaCallbacks&&this.mediaCallbacks.logVetoCallback("IncorrectProgressAndTiming"))}show(){this.container.style.display="flex"}hide(){this.updatePopOuts(),this.container.style.display="none"}get getCaptionSelection(){return this.captionSelection}setParent(e){try{null===e.shadowRoot?this.root=e.attachShadow({mode:"open"}):this.root=e.shadowRoot,this.root.appendChild(this.container),this.addCssRef(this.root),this.setPlayPauseIcon(!this.videoElement.paused),void 0!==this.captionsRenderer&&this.captionsRenderer.updateContainer(parseInt(this.container.style.zIndex,10)-1)}catch(e){Gd.error(526485603,`Exception in setParent: ${e}`)}}get getBounds(){return this.container.getBoundingClientRect()}enableCaptionTrack(e){e<0||void 0===this.captionsMenu||void 0===this.captionsMenu.options||(this.captionSelection=e,this.captionsMenu.options[e].ariaChecked="true",0===e?this.hideCaptionsUnderlineIcon():(this.showCaptionsUnderlineIcon(),void 0!==this.captionsRenderer?this.captionsRenderer.renderCaptionTrack(this.getTextTracks[e-1],this.videoElement,this):this.videoElement.textTracks[e-1].mode="showing"),this.captionsCheckmark.style.top=`${this.captionsMenu.options[e].offsetTop+14}px`)}onProgressSliderInput(){if(this.videoElement.currentTime!==this.progressBar.valueAsNumber){void 0!==this.mediaCallbacks?this.mediaCallbacks.seekMediaCallback(this.progressBar.valueAsNumber):this.videoElement.currentTime=this.progressBar.valueAsNumber,this.progressBar.value=`${this.videoElement.currentTime}`,this.setProgressForScreenReader();const e=qd(this.mediaInfo.trimStartMs);Yd(this.progressBar,(this.progressBar.valueAsNumber-e)/(this.mediaInfo.max-e)*100,(this.videoElement.buffered.end(0)-e)/(this.mediaInfo.max-e)*100)}}onVolumeSliderInput(){this.videoElement.volume=this.volumeSlider.valueAsNumber/100,this.videoElement.volume>0&&this.videoElement.muted&&(this.videoElement.muted=!1),Jd(this.volumeSlider,this.volumeSlider.valueAsNumber)}onVolumeClick(){this.videoElement.muted=!this.videoElement.muted;const e=this.videoElement.muted,t=e?0:this.videoElement.volume;this.setVolumeIcon(t,e),this.volumeSliderEnabled&&(this.volumeSlider.value=""+100*t,Jd(this.volumeSlider,this.volumeSlider.valueAsNumber))}onPlayPauseClick(){return Dt(this,void 0,void 0,(function*(){this.updatePopOuts(),this.videoElement.paused?void 0!==this.mediaCallbacks?this.mediaCallbacks.playMediaCallback():yield this.videoElement.play():void 0!==this.mediaCallbacks?this.mediaCallbacks.pauseMediaCallback():this.videoElement.pause()}))}onPlaybackSpeedClick(){this.setDefaultPlaybackSpeed(),this.speedMenu.classList.contains("invisible")&&(this.hideCaptionsMenu(3),this.ensureMenuPosition(1)),this.speedMenu.classList.toggle("invisible"),this.speedCheckmark.classList.toggle("invisible")}hidePlaybackSpeedMenu(){this.speedButtonEnabled&&(this.speedMenu.classList.contains("invisible")||(this.speedMenu.classList.add("invisible"),this.speedCheckmark.classList.add("invisible")))}setDefaultPlaybackSpeed(){this.defaultSpeedSet||(this.defaultSpeedSet=!0,this.speedSelection=Fd.indexOf(this.mediaInfo.playbackSpeed),-1===this.speedSelection?Gd.warn(509670626,"PlaybackControls.createPlaybackSpeedControl: default video speed not in list of playback speed options"):this.setPlaybackSpeed(this.speedSelection))}setPlaybackSpeed(e){this.speedMenu.options[this.speedSelection].ariaChecked="false",this.speedSelection=e,this.mediaInfo.playbackSpeed=Fd[e],this.videoElement.playbackRate=this.mediaInfo.playbackSpeed,this.speedButton.innerText=this.mediaInfo.playbackSpeed.toString()+"x",this.speedMenu.options[this.speedSelection].ariaChecked="true",this.speedCheckmark.style.top=`${this.speedMenu.options[e].offsetTop+14}px`,this.speedMenu.classList.add("invisible"),this.speedCheckmark.classList.add("invisible")}addCssRef(e){const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",this.mediaControlInfo.cssUrl),e.appendChild(t)}createControls(){this.createContainer(),this.createTopControls(this.container),this.createBottomControls(this.container),this.speedButtonEnabled&&this.createPlaybackSpeedMenu(this.container),this.videoElement.addEventListener("timeupdate",(()=>this.onTimeUpdate())),this.videoElement.addEventListener("play",(()=>this.onPlay())),this.setTabOrder()}createContainer(){const e=Zd("div","control-container");e.id="video-controls-container",this.container=e;const t=this.mediaControlInfo;jd(e,{left:`${t.position.x}px`,top:`${t.position.y}px`,width:`${t.size.x}px`,minHeight:`${t.size.y}px`,zIndex:`${t.zIndex}`,direction:"ltr",display:"none"}),void 0!==this.mediaControlInfo.cssPositionOverride&&(e.style.position=this.mediaControlInfo.cssPositionOverride),e.addEventListener("mousedown",(()=>{e.classList.add("no-outline")})),e.addEventListener("click",(e=>{e.stopPropagation(),1===e.button&&this.updatePopOuts()})),e.addEventListener("keydown",(t=>{this.updatePopOuts(t),e.classList.remove("no-outline")}))}createTopControls(e){const t=Zd("div","controls-top");this.createProgressBar(t),e.appendChild(t)}createBottomControls(e){const t=Zd("div","controls-bottom");this.createLeftControls(t),this.createRightControls(t),e.appendChild(t)}createLeftControls(e){const t=Zd("div","controls-left");this.createPlayButton(t),this.createVolumeControls(t),this.createTimeControl(t),e.appendChild(t)}createRightControls(e){const t=Zd("div","controls-right");this.createCaptionsControls(t),this.speedButtonEnabled&&this.createPlaybackSpeedControl(t),e.appendChild(t)}setTabOrder(){this.progressBar.tabIndex=1,this.playButton.tabIndex=2,this.volumeButton.tabIndex=3;let e=this.volumeButton.tabIndex+1;if(this.volumeSliderEnabled&&(this.volumeSlider.tabIndex=e,e+=1),this.captionsButtonVisible&&(this.captionsButton.tabIndex=e,e+=1),this.captionsButtonEnabled)for(const t of this.captionsMenu.options)t.tabIndex=e,e+=1;if(this.speedButtonEnabled){this.speedButton.tabIndex=e,e+=1;for(const t of this.speedMenu.options)t.tabIndex=e,e+=1}}updatePopOuts(e){(void 0===e||"Tab"!==e.key&&"Shift"!==e.key)&&(this.handleCaptionsKeyboardEvent(e)||(this.hideCaptionsMenu(3),this.handleSpeedKeyboardEvent(e)||this.hidePlaybackSpeedMenu()))}handleCaptionsKeyboardEvent(e){if(!this.captionsButtonEnabled||void 0===e)return!1;if(this.isCaptionsMenuVisible())switch(e.key){case"ArrowUp":case"PageUp":this.captionFocus>0&&(this.captionFocus-=1,this.captionsMenu.options[this.captionFocus].focus());break;case"ArrowDown":case"PageDown":this.captionFocus>=0&&this.captionFocus<this.captionsMenu.options.length-1&&(this.captionFocus+=1,this.captionsMenu.options[this.captionFocus].focus());break;case"ArrowLeft":case"ArrowRight":break;default:return!1}else{if("c"!==e.key)return!1;"none"===this.container.style.display&&this.show(),this.toggleCaptionsMenu(2),this.showOptionFocus(this.captionsMenu.options[this.captionSelection],0)}return e.stopPropagation(),!0}handleSpeedKeyboardEvent(e){if(!this.speedButtonEnabled||void 0===e)return!1;if(!this.speedMenu.classList.contains("invisible"))switch(e.key){case"ArrowUp":case"PageUp":this.speedSelection>0&&(this.speedSelection-=1,this.speedMenu.options[this.speedSelection].focus());break;case"ArrowDown":case"PageDown":this.speedSelection>=0&&this.speedSelection<this.speedMenu.options.length-1&&(this.speedSelection+=1,this.speedMenu.options[this.speedSelection].focus());break;case"ArrowLeft":case"ArrowRight":break;default:return!1}return e.stopPropagation(),!0}getProgressStep(){const e=this.mediaInfo.max-qd(this.mediaInfo.trimStartMs);return Math.max(e/100,.1)}createProgressBar(e){const t=document.createElement("input");this.progressBar=t,t.type="range",t.classList.add("progress-slider"),t.min=`${qd(this.mediaInfo.trimStartMs)}`,t.max=`${this.mediaInfo.max}`,t.value=t.min,t.step=`${this.getProgressStep()}`,t.addEventListener("input",(()=>this.onProgressSliderInput())),void 0!==this.mediaInfo.screenReaderInfo&&t.setAttribute("aria-label",this.mediaInfo.screenReaderInfo.progressBarStr),t.addEventListener("focus",(()=>this.setProgressForScreenReader())),t.addEventListener("click",(()=>this.updatePopOuts())),!0===this.mediaControlInfo.stopPropagateMouseDownOnSlider&&t.addEventListener("mousedown",(e=>{e.stopPropagation()})),t.addEventListener("keydown",(e=>{this.updatePopOuts(e),"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowUp"!==e.key&&"ArrowRight"!==e.key&&"PageDown"!==e.key&&"PageUp"!==e.key||e.stopPropagation()})),e.appendChild(t)}createPlayButton(e){const t=Zd("button","playpause");this.playButton=t,t.type="button";const r=Vd("play-pause-icon");t.appendChild(r),void 0!==this.mediaInfo.screenReaderInfo&&t.setAttribute("aria-label",this.videoElement.paused?this.mediaInfo.screenReaderInfo.playButtonStr:this.mediaInfo.screenReaderInfo.pauseButtonStr);const i=()=>{this.setPlayPauseIcon(!this.videoElement.paused)};this.videoElement.addEventListener("play",i),this.videoElement.addEventListener("pause",i),this.videoElement.addEventListener("keydown",(e=>{this.handleCaptionsKeyboardEvent(e)})),t.addEventListener("click",(()=>this.onPlayPauseClick())),t.addEventListener("keydown",(e=>{if(this.updatePopOuts(e),void 0!==e.key)switch(e.key){case"Enter":case" ":e.preventDefault(),e.stopPropagation(),this.onPlayPauseClick().catch((e=>Gd.warn(526952129,`PlayerControls.onPlayPauseClick: unable to play/pause video - ${e}`)))}})),e.appendChild(t)}setPlayPauseIcon(e){const t=this.playButton.querySelector("#play-icon"),r=this.playButton.querySelector("#pause-icon");null!==t&&null!==r?e?(r.classList.remove("invisible"),t.classList.add("invisible"),void 0!==this.mediaInfo.screenReaderInfo&&this.playButton.setAttribute("aria-label",this.mediaInfo.screenReaderInfo.pauseButtonStr)):(t.classList.remove("invisible"),r.classList.add("invisible"),void 0!==this.mediaInfo.screenReaderInfo&&this.playButton.setAttribute("aria-label",this.mediaInfo.screenReaderInfo.playButtonStr)):(Gd.warn(541882011,"PlayerControls.setPlayPauseIcon: querySelector returned null."),void 0!==this.mediaCallbacks&&this.mediaCallbacks.logVetoCallback("IncorrectPlayPauseIcon"))}createVolumeControls(e){const t=Zd("div","volume-container");this.createVolumeButton(t),this.volumeSliderEnabled&&(this.createVolumeSlider(t),t.addEventListener("focusin",(()=>{this.volumeSlider.classList.add("visible")})),t.addEventListener("mouseleave",(()=>{this.volumeSlider.classList.remove("visible")}))),t.addEventListener("click",(()=>this.updatePopOuts())),t.addEventListener("keydown",(e=>this.updatePopOuts(e))),e.appendChild(t)}createVolumeButton(e){const t=Zd("button","volume");this.volumeButton=t,t.type="button";const r=Vd("volume-icon");t.appendChild(r),this.videoElement.addEventListener("volumechange",(()=>{const e=this.videoElement.muted?0:this.videoElement.volume;this.setVolumeIcon(e,this.videoElement.muted||0===this.videoElement.volume),this.volumeSliderEnabled&&(this.volumeSlider.value=""+100*e,Jd(this.volumeSlider,this.volumeSlider.valueAsNumber))})),void 0!==this.mediaInfo.screenReaderInfo&&(t.setAttribute("aria-label",this.videoElement.muted?this.mediaInfo.screenReaderInfo.unmuteButtonStr:this.mediaInfo.screenReaderInfo.muteButtonStr),t.addEventListener("keydown",(e=>{if(this.updatePopOuts(e),void 0!==e.key)switch(e.key){case"Enter":case" ":e.preventDefault(),e.stopPropagation(),this.onVolumeClick()}}))),t.addEventListener("click",(()=>{this.updatePopOuts(),this.onVolumeClick()})),t.addEventListener("keydown",(e=>this.updatePopOuts(e))),this.volumeSliderEnabled&&t.addEventListener("mouseenter",(()=>{this.volumeSlider.classList.add("visible")})),e.appendChild(t)}createVolumeSlider(e){const t=Zd("input","volume-slider");this.volumeSlider=t,t.type="range",t.min="0",t.max="100",t.value=this.videoElement.muted?"0":""+100*this.videoElement.volume,void 0!==this.mediaInfo.screenReaderInfo&&t.setAttribute("aria-label",this.mediaInfo.screenReaderInfo.volumeSliderStr),Jd(t,t.valueAsNumber),t.addEventListener("input",(()=>this.onVolumeSliderInput())),!0===this.mediaControlInfo.stopPropagateMouseDownOnSlider&&t.addEventListener("mousedown",(e=>{e.stopPropagation()})),t.addEventListener("click",(()=>this.updatePopOuts())),t.addEventListener("keydown",(e=>{this.updatePopOuts(e),"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowUp"!==e.key&&"ArrowRight"!==e.key&&"PageDown"!==e.key&&"PageUp"!==e.key||e.stopPropagation()})),t.addEventListener("focusout",(()=>{this.volumeSlider.classList.remove("visible")})),e.appendChild(t)}setVolumeIcon(e,t){const r=this.volumeButton.querySelector("#volume-low-icon"),i=this.volumeButton.querySelector("#volume-medium-icon"),n=this.volumeButton.querySelector("#volume-high-icon"),s=this.volumeButton.querySelector("#volume-muted-icon");if(null===r||null===i||null===n||null===s)return Gd.warn(541882012,"PlayerControls.setVolumeIcon: querySelector returned null, unable to set volume button icon"),void(void 0!==this.mediaCallbacks&&this.mediaCallbacks.logVetoCallback("IncorrectVolumeIndicator"));s.classList.add("invisible"),r.classList.add("invisible"),i.classList.add("invisible"),n.classList.add("invisible"),t?s.classList.remove("invisible"):e<.33?r.classList.remove("invisible"):e<.67?i.classList.remove("invisible"):n.classList.remove("invisible"),void 0!==this.mediaInfo.screenReaderInfo&&this.volumeButton.setAttribute("aria-label",t?this.mediaInfo.screenReaderInfo.unmuteButtonStr:this.mediaInfo.screenReaderInfo.muteButtonStr)}get getTextTracks(){return this.textTracks.length<1&&this.videoElement.textTracks.length>0&&(this.textTracks.length=0,this.textTracks=function(e){const t=[];for(let r=0;r<e.length;r+=1){const i=new Wd;i.language=e[r].language,i.label=e[r].label;const n=e[r].cues;if(null!==n){for(let e=0;e<n.length;e+=1){const t=new VTTCue(n[e].startTime,n[e].endTime,n[e].text);i.cues[e]=t}t[r]=i}}return t}(this.videoElement.textTracks)),this.textTracks}setDefaultCaptionTrack(){if(!this.defaultCaptionsTrackSet&&this.captionsButtonEnabled){if(this.defaultCaptionsTrackSet=!0,void 0!==this.captionsRenderer&&""!==this.captionsRenderer.getDefaultLang)for(let e=0;e<this.getTextTracks.length;e+=1)if(this.getTextTracks[e].language.toLowerCase()===this.captionsRenderer.getDefaultLang)return void this.enableCaptionTrack(e);this.enableCaptionTrack(0)}}disableCaptionTrack(e){e<0||(this.captionsMenu.options[e].ariaChecked="false",0!==e&&(void 0!==this.captionsRenderer?this.captionsRenderer.stopCaptionTrack():this.videoElement.textTracks[e-1].mode="disabled"))}updateCaptionTrack(e){Gd.info(512550666,`PlaybackControls - Captions: Updating selected caption track new selection: ${e}, previous selection: ${this.captionSelection}`),e!==this.captionSelection&&(this.disableCaptionTrack(this.captionSelection),this.enableCaptionTrack(e))}showCaptionsUnderlineIcon(){this.ensureCaptionsButtonIconPosition(),this.captionsButton.children[1].classList.remove("invisible"),this.captionsButton.children[0].classList.add("invisible")}hideCaptionsUnderlineIcon(){this.captionsButton.children[0].classList.remove("invisible"),this.captionsButton.children[1].classList.add("invisible")}isCaptionsMenuVisible(){return"block"===this.captionsMenu.style.display}showCaptionsMenu(e){this.captionsButtonEnabled&&(this.setDefaultCaptionTrack(),Gd.info(512521174,`PlaybackControls - Captions: Showing captions menu, source: ${e.toString()}`),this.hidePlaybackSpeedMenu(),this.ensureMenuPosition(0),this.captionsMenu.style.display="block",this.captionsCheckmark.style.display="block",1===e&&this.showOptionFocus(this.captionsMenu.options[this.captionSelection],0))}hideCaptionsMenu(e){this.captionsButtonEnabled&&(Gd.info(512521173,`PlaybackControls - Captions: Hiding captions menu, source: ${e.toString()}`),this.captionsCheckmark.style.display="none",this.captionsMenu.style.display="none")}toggleCaptionsMenu(e){this.captionsButtonEnabled&&(Date.now()-this.lastToggleTime<=this.captionsMinUIDelay||(Gd.info(512521172,`PlaybackControls - Captions: Toggling captions menu, source: ${e.toString()}`),this.lastToggleTime=Date.now(),this.isCaptionsMenuVisible()?this.hideCaptionsMenu(e):this.showCaptionsMenu(e)))}showOptionFocus(e,t){switch(e.style.backgroundColor="#000000",e.style.background="solid",e.focus(),t){case 0:this.captionFocus=parseInt(e.id,10);break;case 1:this.speedSelection=parseInt(e.id,10)}}hideOptionFocus(e){e.style.background="none"}createCaptionsControls(e){this.captionsButtonVisible&&void 0===this.captionsButton&&(this.captionsButtonEnabled&&(Gd.info(512550661,"PlaybackControls - Captions: Creating captions menu"),this.createCaptionsMenu()),this.createCaptionsButton(),e.appendChild(this.captionsButton),this.captionsButtonEnabled&&this.hideCaptionsMenu(3))}createCaptionsMenu(){const e=Zd("datalist","closed-captions-menu");if(this.captionsMenu=e,e.ariaLabel="Closed captions menu",jd(e,{backgroundColor:"#292827",opacity:".8",position:"absolute",right:"8px",borderRadius:"2px"}),this.container.appendChild(e),this.createMenuCheckmark(0),e.appendChild(this.captionsCheckmark),e.appendChild(this.createOptionElement(0,"Off")),this.captionsButtonEnabled)for(let t=0;t<this.videoElement.textTracks.length;t+=1){const r=this.videoElement.textTracks[t];Gd.info(512550665,`PlaybackControls - Captions: Adding track index: ${t}, label: ${r.label}, language: ${r.language}`),void 0!==this.captionsRenderer&&"hidden"!==this.videoElement.textTracks[t].mode&&(this.videoElement.textTracks[t].mode="hidden");const i=Hd(r.language);i===r.language&&Gd.info(512550664,`PlaybackControls - Captions: Unknown language code: ${r.language}`);const n=`${r.label}${""!==r.label?" ":""}${i}`;e.appendChild(this.createOptionElement(t+1,n))}}createOptionElement(e,t){Gd.info(512550663,`PlaybackControls - Captions: Creating option index: ${e}, label: ${t}`);const r=Zd("option",t);return r.label=t,r.id=`${e}`,r.ariaLabel=t,r.ariaRoleDescription="menuitemradio",r.ariaChecked="false",this.setOptionStyle(r),r.addEventListener("click",(t=>{0===t.button&&(this.updateCaptionTrack(e),this.hideCaptionsMenu(0),t.stopImmediatePropagation())})),r.addEventListener("keydown",(t=>{"Spacebar"!==t.key&&" "!==t.key&&"Enter"!==t.key||(this.updateCaptionTrack(e),this.hideCaptionsMenu(1),t.stopImmediatePropagation())})),r.addEventListener("mouseenter",(()=>{this.showOptionFocus(r,0)})),r.addEventListener("focusin",(()=>{this.showOptionFocus(r,0)})),r.addEventListener("mouseleave",(()=>{this.hideOptionFocus(r)})),r.addEventListener("focusout",(()=>{this.hideOptionFocus(r)})),r}setOptionStyle(e){jd(e,{paddingTop:"9px",paddingBottom:"9px",paddingLeft:"32px",paddingRight:"40px",color:"#F3F2F1",fontFamily:"Segoe UI, sans-serif",fontSize:"14px",textAlign:"left",fillOpacity:".8",background:"none"})}createCaptionsButton(){Gd.info(512550662,"PlaybackControls - Captions: Creating captions button");const e="Closed captions button",t=Zd("button","closed-captions-button");this.captionsButton=t,t.type="button",t.name=e,t.ariaLabel=e,t.ariaHasPopup="menu",t.disabled=!1,t.style.marginLeft="4px",this.addCaptionbuttonIcons(),this.captionsButtonEnabled&&(t.addEventListener("click",(e=>{this.toggleCaptionsMenu(0),e.stopImmediatePropagation()})),t.addEventListener("keydown",(e=>{"Spacebar"!==e.key&&" "!==e.key&&"Enter"!==e.key||(this.toggleCaptionsMenu(1),e.stopImmediatePropagation())})))}addCaptionbuttonIcons(){const e=Vd("captions-icon");this.captionsButtonEnabled||(e.style.opacity=".40"),this.captionsButton.appendChild(e);const t=Vd("captions-active-icon");t.classList.add("invisible"),t.style.position="absolute",this.captionsButton.appendChild(t)}ensureCaptionsButtonIconPosition(){if(""!==this.captionsButton.children[1].style.left)return;const e=this.captionsButton.offsetLeft;this.captionsButton.children[1].style.left=e.toString().concat("px")}ensureMenuPosition(e){if(null!==this.progressBar.offsetParent){const t=this.progressBar.offsetParent;if(null!==t)switch(e){case 0:this.captionsMenu.style.bottom=t.offsetHeight-2+"px";break;case 1:this.speedMenu.style.bottom=t.offsetHeight-2+"px"}}}createMenuCheckmark(e){const t=Vd("checkmark-icon");switch(e){case 0:this.captionsCheckmark=t;break;case 1:this.speedCheckmark=t,this.speedCheckmark.style.display="block"}jd(t,{position:"absolute",left:"10px",zIndex:"5"})}createTimeControl(e){this.currentTime=document.createElement("span"),this.currentTime.classList.add("text-formatting"),this.currentTime.style.marginLeft="4px",this.currentTime.innerText="0:00";const t=document.createElement("span");t.classList.add("text-formatting"),t.textContent=" / ";const r=document.createElement("span");r.classList.add("text-formatting"),r.id="video-end-time";const i=new Date(1e3*this.mediaInfo.max).toISOString(),n="00"===i.substring(11,13)?i.substring(14,19):i.substring(11,19);r.innerText=n,this.currentTime.style.alignSelf="center",t.style.alignSelf="center",r.style.alignSelf="center",e.appendChild(this.currentTime),e.appendChild(t),e.appendChild(r)}onTimeUpdate(){this.videoElement.currentTime<=this.mediaInfo.max?this.currentTime.innerText=function(e){const[t,r,i]=$d(e);return t>0?`${t}:${r<10?"0":""}${r}:${r<10?"0":""}${i}`:`${r}:${i<10?"0":""}${i}`}(this.videoElement.currentTime):this.setPlayPauseIcon(!1);const e=qd(this.mediaInfo.trimStartMs);this.progressBar.value=`${this.videoElement.currentTime}`;const t=this.videoElement.buffered.length>0?(this.videoElement.buffered.end(0)-e)/(this.mediaInfo.max-e)*100:0;Yd(this.progressBar,(this.progressBar.valueAsNumber-e)/(this.mediaInfo.max-e)*100,t)}onPlay(){this.setDefaultCaptionTrack()}createPlaybackSpeedControl(e){this.speedButton=Zd("button","speed"),this.speedButton.type="button",this.speedButton.classList.add("speed","text-formatting"),this.speedButton.innerText=this.mediaInfo.playbackSpeed.toString()+"x",this.speedButton.ariaLabel="Playback speed button",this.speedButton.addEventListener("click",(()=>this.onPlaybackSpeedClick())),this.speedButton.addEventListener("keydown",(e=>{"Spacebar"!==e.key&&" "!==e.key&&"Enter"!==e.key||(this.onPlaybackSpeedClick(),this.speedMenu.classList.contains("invisible")||this.showOptionFocus(this.speedMenu.options[this.speedSelection],1))})),e.appendChild(this.speedButton)}createPlaybackSpeedMenu(e){this.speedMenu=Zd("datalist","speed-menu"),this.speedMenu.classList.add("text-formatting","invisible"),this.speedMenu.style.display="block";for(let e=0;e<Fd.length;e+=1){const t=Zd("option","speed-menu-option");t.classList.add("text-formatting"),t.label=Fd[e].toString()+"x",t.innerText=t.label,t.id=`${e}`,t.ariaLabel=t.label,t.ariaRoleDescription="menuitemradio",t.ariaChecked="false",t.addEventListener("click",(()=>this.setPlaybackSpeed(e))),t.addEventListener("keydown",(t=>{"Spacebar"!==t.key&&" "!==t.key&&"Enter"!==t.key||(this.setPlaybackSpeed(e),t.stopImmediatePropagation())})),t.addEventListener("mouseenter",(()=>{this.showOptionFocus(t,1)})),t.addEventListener("focusin",(()=>{this.showOptionFocus(t,1)})),t.addEventListener("mouseleave",(()=>{this.hideOptionFocus(t)})),t.addEventListener("focusout",(()=>{this.hideOptionFocus(t)})),this.speedMenu.appendChild(t)}e.appendChild(this.speedMenu),this.createMenuCheckmark(1),this.speedCheckmark.classList.add("invisible"),this.speedMenu.appendChild(this.speedCheckmark)}setProgressForScreenReader(){if(void 0!==this.mediaInfo.screenReaderInfo){const e=Xd(this.videoElement.currentTime,this.mediaInfo.screenReaderInfo),t=Xd(this.videoElement.duration,this.mediaInfo.screenReaderInfo),r=this.mediaInfo.screenReaderInfo.progressStr.replace("{0}",e).replace("{1}",t);this.progressBar.setAttribute("aria-valuetext",r)}}}function Yd(e,t,r){e.style.background=`linear-gradient(to right, #FFFFFF ${t}%, #FFFFFFB2 ${t}% ${r}%, #FFFFFF59 ${r}% 100%`}function Jd(e,t){e.style.background=`linear-gradient(to right, #FFFFFF ${t}%, #FFFFFF59 ${t}% 100%`}function Zd(e,t){const r=document.createElement(e);return r.classList.add(t),r}function Qd(e){jd(e,{zIndex:"6",pointerEvents:"all",position:"absolute",objectFit:"fill",height:"100%",width:"100%"})}class ep{constructor(){this.rateChanges=0,this.volumeChanges=0,this.plays=0,this.seeks=0,this.stalls=0,this.totalBufferingTimeMs=0,this.totalPlayingTimeMs=0}}class tp{constructor(e,t,r,i,n){this.perfSummary=new ep,this.shouldUseLocalTelemetry=n,this.pageLoadingTime=Date.now(),this.isDesignerElement=r,this.mediaProperties=i,this.player=this.createLocalPlayer(e,t,r),void 0!==this.shouldUseLocalTelemetry&&this.shouldUseLocalTelemetry&&this.createPerfTelemetry()}logSummary(){return Dt(this,void 0,void 0,(function*(){}))}play(){return Dt(this,void 0,void 0,(function*(){try{yield this.player.play()}catch(e){Gd.info(541882e3,"Error local video play")}Gd.info(520378572,`Local.play: this.player.paused: ${this.player.paused}`)}))}pause(){this.player.pause()}setVisible(){!0===this.isDesignerElement&&(this.player.loop=!0),this.player.style.visibility="visible",this.setFocus()}setHidden(){!0===this.isDesignerElement&&(this.player.loop=!1,this.player.autoplay=!1),this.player.style.pointerEvents="none",this.player.style.visibility="hidden"}stop(){this.player.pause(),this.player.currentTime=0,void 0!==this.shouldUseLocalTelemetry&&this.shouldUseLocalTelemetry&&this.logPerfSummary()}togglePause(){return Dt(this,void 0,void 0,(function*(){if(Gd.info(520378573,`Local.togglePause: Before toggle, this.player.paused: ${this.player.paused}`),this.player.paused)try{yield this.play()}catch(e){Gd.info(541882001,"Error local video play while toggle pause")}else this.pause();Gd.info(520378574,`Local.togglePause: After toggle, this.player.paused: ${this.player.paused}`)}))}getPlayer(){return this.player}getCurrentTime(){}getDuration(){}seekTo(e){}ensureMediaClient(){}setMute(){}setUnMute(){}setVolume(e){}logPerfSummary(){this.updateTotalBufferingTime(),this.updateTotalPlayingTime(),0===this.perfSummary.totalBufferingTimeMs&&0===this.perfSummary.totalPlayingTimeMs&&void 0===this.perfSummary.errorCode||(this.perfSummary.durationMs=Math.round(1e3*this.player.duration),this.perfSummary.width=this.player.videoWidth,this.perfSummary.height=this.player.videoHeight,this.perfSummary.hasControls=this.player.controls,this.perfSummary.isAutoplay=this.player.autoplay,this.perfSummary.isLoop=this.player.loop,this.perfSummary.lastRate=this.player.playbackRate,this.perfSummary.lastVolume=Math.round(100*this.player.volume),this.perfSummary.lastIsMuted=this.player.muted,Gd.info(541882002,`EmbeddedPlayback ${JSON.stringify(this.perfSummary)}`),this.perfSummary.totalBufferingTimeMs=0,this.perfSummary.totalPlayingTimeMs=0,this.perfSummary.errorCode=void 0)}createPerfTelemetry(){this.player.addEventListener("loadstart",(()=>{void 0===this.perfSummary.timeToLoadStartMs&&(this.perfSummary.timeToLoadStartMs=Date.now()-this.pageLoadingTime)})),this.player.addEventListener("canplay",(()=>{void 0===this.perfSummary.timeToInteractivityMs&&(this.perfSummary.timeToInteractivityMs=Date.now()-this.pageLoadingTime)})),this.player.addEventListener("play",(()=>{this.lastPlayTime=Date.now(),this.perfSummary.plays+=1})),this.player.addEventListener("playing",(()=>{this.lastPlayingTime=Date.now(),void 0===this.perfSummary.timeToPlayingMs&&void 0!==this.lastPlayTime&&(this.perfSummary.timeToPlayingMs=this.lastPlayingTime-this.lastPlayTime),this.updateTotalBufferingTime()})),this.player.addEventListener("waiting",(()=>{this.lastWaitingTime=Date.now(),this.updateTotalPlayingTime()})),this.player.addEventListener("pause",(()=>{this.updateTotalBufferingTime(),this.updateTotalPlayingTime()})),this.player.addEventListener("seeking",(()=>{this.perfSummary.seeks+=1})),this.player.addEventListener("stalled",(()=>{this.perfSummary.stalls+=1})),this.player.addEventListener("ended",(()=>{this.perfSummary.isPlayedUntilEnd=!0})),this.player.addEventListener("ratechange",(()=>{this.perfSummary.rateChanges+=1})),this.player.addEventListener("volumechange",(()=>{this.perfSummary.volumeChanges+=1})),this.player.addEventListener("error",(()=>{this.updateTotalBufferingTime(),this.updateTotalPlayingTime(),void 0===this.perfSummary.errorCode&&null!==this.player.error&&(this.perfSummary.errorCode=this.player.error.code)})),this.player.addEventListener("abort",(()=>{this.updateTotalBufferingTime(),this.updateTotalPlayingTime(),this.perfSummary.wasAborted=!0}))}updateTotalBufferingTime(){void 0!==this.lastWaitingTime&&(this.perfSummary.totalBufferingTimeMs+=Date.now()-this.lastWaitingTime,this.lastWaitingTime=void 0)}updateTotalPlayingTime(){void 0!==this.lastPlayingTime&&(this.perfSummary.totalPlayingTimeMs+=Date.now()-this.lastPlayingTime,this.lastPlayingTime=void 0)}setFocus(){void 0!==this.player&&this.player.focus()}seekToTrimStartIfNeeded(){void 0!==this.player&&void 0!==this.mediaProperties.trimmedEndTimeSec&&(this.player.currentTime<this.mediaProperties.trimStartSec||this.player.currentTime>=this.mediaProperties.trimmedEndTimeSec)&&(this.player.currentTime=this.mediaProperties.trimStartSec)}onTimeUpdate(){void 0!==this.player&&void 0!==this.mediaProperties.trimmedEndTimeSec&&this.player.currentTime>=this.mediaProperties.trimmedEndTimeSec&&(this.player.pause(),this.player.currentTime=this.mediaProperties.trimmedEndTimeSec)}isTrimValid(){return void 0!==this.mediaProperties.durationSec&&this.mediaProperties.trimStartSec<=this.mediaProperties.durationSec&&this.mediaProperties.trimEndSec<=this.mediaProperties.durationSec&&this.mediaProperties.trimStartSec+this.mediaProperties.trimEndSec<this.mediaProperties.durationSec}setTrim(e){void 0===e||isNaN(e.duration)||(this.mediaProperties.durationSec=e.duration,this.mediaProperties.trimmedEndTimeSec=this.mediaProperties.durationSec-this.mediaProperties.trimEndSec,this.isTrimValid()?(e.addEventListener("timeupdate",(()=>{this.onTimeUpdate()})),e.addEventListener("play",(()=>{this.seekToTrimStartIfNeeded()}))):(this.mediaProperties.trimStartSec=0,this.mediaProperties.trimEndSec=0,this.mediaProperties.trimmedEndTimeSec=this.mediaProperties.durationSec))}createLocalPlayer(e,t,r){const i=document.createElement("video");return i.controls=!0,i.setAttribute("disablePictureInPicture","true"),i.setAttribute("controlsList","nodownload nofullscreen noremoteplayback"),i.src=t,e.appendChild(i),i.autoplay=!0,i.style.visibility=r?"hidden":"visible",Qd(i),r?(i.loop=!0,i.muted=!0,i.addEventListener("canplay",(()=>{i.style.visibility="visible"}),{once:!0})):this.setFocus(),(this.mediaProperties.trimStartSec>0||this.mediaProperties.trimEndSec>0)&&i.addEventListener("loadedmetadata",(()=>{this.setTrim(i)}),{once:!0}),i}}class rp{constructor(e,t){this.playButton=t,this.parent=e}setPlayButtonVisible(){this.isPlayButtonBiggerThanParent()||(this.playButton.style.display="block",this.playButton.style.pointerEvents="visible")}setPlayButtonHidden(){this.playButton.style.display="none"}updatePlayButtonVisibility(){this.isPlayButtonBiggerThanParent()?this.setPlayButtonHidden():(this.playButton.style.display="block",this.playButton.style.pointerEvents="visible")}onSelectPlayButton(){if(void 0===this.shapeOverlayElement&&this.findShapeSelectionOverlay(),void 0!==this.shapeOverlayElement){const e=parseFloat(this.parent.style.left)+parseFloat(this.parent.style.width)/2-28.3,t=parseFloat(this.parent.style.top)+parseFloat(this.parent.style.height)/2-28.3;this.playButton.style.top=`${t}px`,this.playButton.style.left=`${e}px`,this.shapeOverlayElement.appendChild(this.playButton)}}onDeSelectPlayButton(){this.playButton.style.top="calc(50% - 28.3px)",this.playButton.style.left="calc(50% - 28.3px)",this.parent.appendChild(this.playButton)}findShapeSelectionOverlay(){null!==this.parent.parentElement&&void 0!==this.parent.parentElement.getElementsByClassName("ShapeSelectionOverlay")[0]?this.shapeOverlayElement=this.parent.parentElement.getElementsByClassName("ShapeSelectionOverlay")[0]:this.shapeOverlayElement=void 0}isPlayButtonBiggerThanParent(){return 56.6>parseFloat(this.parent.style.width)||56.6>parseFloat(this.parent.style.height)}}function ip(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}class np{constructor(e,t,r,i,n,s,o,a){this.createNonNative=a,this.appSettings=o,this.isPlaying=!1,this.isNativeVideo=i,this.isDesignerElement=n,this.parent=e,this.url=t,this.hostName=this.isNativeVideo?"":this.getHostname(t),this.videoToolTip=r,this.videoLibraryCallback=s,this.playButton=this.createPlayButton(),this.isSlideShow=!1,this.playButtonHandler=new rp(this.parent,this.playButton),function(e,t,r){let i;return i=r?e.UseNewYoutubePlayer:e.UseNewEditorYoutubePlayer,!(void 0===i||!i||"www.youtube.com"!==t||void 0===window.URLSearchParams)}(this.appSettings,this.hostName,this.isSlideShow)&&!document.querySelector('script[src="https://www.youtube.com/iframe_api"]')&&function(){const e=document.createElement("script");e.setAttribute("type","text/javascript"),e.src="https://www.youtube.com/iframe_api",document.head.appendChild(e)}(),Gd.info(541882006,"Video Element Count"),this.isDesignerElement&&this.startPlaying()}setPlayButtonHidden(){void 0!==this.playButtonHandler&&this.playButtonHandler.setPlayButtonHidden()}updatePlayButtonVisibility(){this.isPlaying||void 0===this.playButtonHandler||this.playButtonHandler.updatePlayButtonVisibility()}setPlayButtonVisible(){this.isPlaying||void 0===this.playButtonHandler||this.playButtonHandler.setPlayButtonVisible()}startPlaying(){if(this.isNativeVideo&&""===this.url)return this.setPlayButtonHidden(),this.isPlaying=!0,void this.videoLibraryCallback.fetchLocalVideoSrc();void 0===this.client?this.createClient(this.url):this.isPlaying||(this.client.setVisible(),this.client.play(),this.setDefaultStyles()),void 0!==this.client&&(this.isPlaying=!0),Gd.info(541882007,"Video Play Count"),this.setPlayButtonHidden()}stopPlaying(){void 0!==this.client&&(this.client.setHidden(),this.isPlaying&&this.client.stop(),this.isPlaying=!1)}hasClient(){return void 0!==this.client}setLocalVideoSrc(e){this.url=e,(this.videoLibraryCallback.isSelected()||this.isDesignerElement)&&this.startPlaying()}onSelectPlayButton(){void 0!==this.playButtonHandler&&this.playButtonHandler.onSelectPlayButton()}onDeSelectPlayButton(){void 0!==this.playButtonHandler&&this.playButtonHandler.onDeSelectPlayButton()}dispose(){null!==this.playButton&&void 0!==this.playButton&&null!==this.playButton.parentNode&&void 0!==this.playButton.parentNode&&this.playButton.parentNode.removeChild(this.playButton)}setDefaultStyles(){if(void 0!==this.client){const e=this.client.getPlayer();void 0!==e&&Qd(e)}}createClient(e){try{if(this.isNativeVideo)this.client=new tp(this.parent,e,this.isDesignerElement,void 0!==this.videoLibraryCallback&&void 0!==(t=this.videoLibraryCallback.getMediaProperties())?{trimStartSec:void 0!==t.trimStartSec?t.trimStartSec:0,trimEndSec:void 0!==t.trimEndSec?t.trimEndSec:0,volume:void 0!==t.volume?t.volume:.8,mute:void 0!==t.mute&&t.mute,repeat:void 0!==t.repeat&&t.repeat,rewind:void 0!==t.rewind&&t.rewind,playAcrossSlides:void 0!==t.playAcrossSlides&&t.playAcrossSlides,hideDuringShow:void 0!==t.hideDuringShow&&t.hideDuringShow,startOption:void 0!==t.startOption?t.startOption:"NYI",trimmedEndTimeSec:void 0,durationSec:void 0}:{trimStartSec:0,trimEndSec:0,volume:.8,mute:!1,repeat:!1,rewind:!1,playAcrossSlides:!1,hideDuringShow:!1,startOption:"NYI",trimmedEndTimeSec:void 0,durationSec:void 0},this.appSettings.useNewLocalTelemetry);else{if(void 0===this.createNonNative)throw new Error("Non native video not supported.");this.client=this.createNonNative(this.appSettings,e,this.hostName,this.parent,this.isSlideShow,(()=>this.onClientReady()))}const r=this.client.getPlayer();void 0!==r&&r.setAttribute("title",this.videoToolTip),Gd.info(541882009,"Success VideoManager")}catch(e){Gd.info(541882008,`Error VideoManager: ${this.hostName}`)}var t}onClientReady(){void 0!==this.client&&this.client.play()}playButtonOnClick(e){void 0!==e&&(e.stopImmediatePropagation(),e.preventDefault()),this.videoLibraryCallback.selectShape(),this.startPlaying()}createPlayButton(){const e=function(){const e=ip("svg");e.setAttribute("viewBox","-1 -1 2 2"),jd(e,{height:"56.6px",width:"56.6px",position:"absolute",zIndex:"6",top:"calc(50% - 28.3px)",left:"calc(50% - 28.3px)",cursor:"pointer",pointerEvents:"all"});const t=ip("circle");t.setAttribute("cx","0"),t.setAttribute("cy","0"),t.setAttribute("r","1"),t.setAttribute("fill","#404040");const r=ip("path");return r.setAttribute("d","M.5 0 L-.25 -.5 L-.25 .5 Z"),r.setAttribute("fill","none"),r.setAttribute("stroke","white"),r.setAttribute("stroke-width",".05"),r.setAttribute("opacity",".5"),e.appendChild(t),e.appendChild(r),e}();return e.addEventListener("click",(e=>this.playButtonOnClick(e)),!1),this.isDesignerElement&&e.setAttribute("visibility","hidden"),this.parent.appendChild(e),e}getHostname(e){return!0===this.appSettings.IsGFXVideoUrlUtilsEnabled?function(e){if(""===e)return"";const t=new RegExp("^[a-z+.-]+://([^/:?&]*)","i").exec(e);return null!=t&&t.length>1?t[1]:""}(e):void 0!==window.URLSearchParams&&""!==e?new URL(e).hostname:""}}class sp extends Md{constructor(e=xd("image")){super(e)}set width(e){this.set("width",`${e}`)}set height(e){this.set("height",`${e}`)}set x(e){this.set("x",`${e}`)}set y(e){this.set("y",`${e}`)}set preserveAspectRatio(e){this.set("preserveAspectRatio",e)}set href(e){this.set("href",e)}}class op extends Md{constructor(e=xd("g")){super(e)}set width(e){this.set("width",`${e}`)}set height(e){this.set("height",`${e}`)}set x(e){this.set("x",`${e}`)}set y(e){this.set("y",`${e}`)}}class ap extends Md{constructor(e=xd("foreignObject")){super(e)}set width(e){this.set("width",`${e}`)}set height(e){this.set("height",`${e}`)}set x(e){this.set("x",`${e}`)}set y(e){this.set("y",`${e}`)}appendChildElement(e){this.element.appendChild(e)}}function lp(e,t){if(void 0===t||!wh(t))return;const{sourceAnchorBounds:r,targetBounds:i,rotation:n,flip:s}=t,{size:o,rot:a,flip:l}=e,c=o.width/r.width(),h=o.height/r.height(),u=i.width()*c,d=i.height()*h,p=i.left*c,f=i.top*h,g=new sp;return g.width=u,g.height=d,g.transform.set({x:p-o.width/2,y:f-o.height/2},{x:l.x!==s.x,y:l.y!==s.y},a-n,e.getCenter()),g.href=t.data,g.preserveAspectRatio="none",g.style.pointerEvents="none",g.element}class cp{}class hp{constructor(){this.type=cp,this.pointerEventNotifiers=c(),this.hitTestSlop=0,this.video=yu("svg"),this.control=document.createElement("div"),this.video.style.overflow="visible",this.video.style.pointerEvents="none",this.control.style.position="absolute",this.control.style.top="0",this.control.style.left="0",this.control.style.pointerEvents="auto"}teardown(){}}function up(e,t){t.root.append(e.video),t.root.append(e.control)}class dp{constructor(e,t,r,i,n){this.viewModel=new hp,this.viewModelUpdated=new l,this.shapeViewModel=new Lu,this.isVideoSelected=!1,this.properties={},this.select=()=>{void 0!==this.editContext&&this.editContext.actionInvoker.invoke(new _l([this.graphic]))},this.fetchSource=()=>{void 0===this.provider&&(0,y._)(0,"Failed to obtain video provider"),this.provider.getSource(this.graphic).then((e=>{this.videoElement.setLocalVideoSrc(e),this.extractHtmlVideo()})).catch((e=>{(0,y._)(0,"Failed to fetch video source")}))},this.onTransformUpdated=()=>{this.stopPlaying(),this.renderVideoToViewModel()},this.onModelUpdated=()=>{this.updateViewModel()},this.stopPlaying=()=>{var e;this.videoElement.stopPlaying(),this.videoElement.updatePlayButtonVisibility(),null===(e=this.controls)||void 0===e||e.hide()},this.onVideoPlaying=()=>{var e;this.fixHtmlVideo(),this.ensureControl(),null===(e=this.controls)||void 0===e||e.show()},this.graphic=e,this.context=t,this.registry=r,this.editContext=i,this.provider=n,this.model=e.model,this.updateViewModel(),this.model.modelUpdated.on(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.on(this.onTransformUpdated),this.context.viewScale.viewTransformChanged.on(this.onTransformUpdated),this.context.viewScale.combinedScaleChanged.on(this.onTransformUpdated)}set isSelected(e){this.isVideoSelected=e,e||(this.stopPlaying(),this.viewModelUpdated.emit())}play(){this.videoElement.startPlaying()}teardown(){this.model.modelUpdated.off(this.onModelUpdated),this.context.anchorPresenter.transformUpdated.off(this.onTransformUpdated),this.context.viewScale.viewTransformChanged.off(this.onTransformUpdated),this.context.viewScale.combinedScaleChanged.off(this.onTransformUpdated),this.teardownControls(),void 0!==this.video&&this.videoElement.dispose()}get videoElement(){return this.video[1]}updateViewModel(){var e,t;void 0!==this.video&&this.videoElement.dispose(),this.properties=null!==(t=null===(e=this.provider)||void 0===e?void 0:e.getProperties(this.graphic))&&void 0!==t?t:{};const r=document.createElement("div"),{source:i,looping:n,altText:s}=this.graphic.model,o=new np(r,i.url,s,i.isNative,n,{isSelected:()=>this.isVideoSelected,selectShape:this.select,fetchLocalVideoSrc:this.fetchSource,getMediaProperties:()=>this.properties},{},void 0);this.teardownControls(),this.video=[r,o],this.renderVideoToViewModel()}renderVideoToViewModel(){var e;let t=this.context.anchorPresenter.transform;const r=this.context.viewScale;r.viewTransform.size.equals(new g(0,0))||(t=r.viewTransform.clone(),t.size.width*=r.zoomFactor,t.size.height*=r.zoomFactor),this.transform=t;const{left:i,right:n,top:s,bottom:o}=null!==(e=this.properties.crop)&&void 0!==e?e:{left:0,right:0,top:0,bottom:0},a=new cs(100*i,100*s,100*n,100*o),{scale:l,offset:c}=ku(t,a),[h,d]=function(e,t,r,i,n){const s=new op,{x:o,y:a}=e.getCenter();s.transform.setTranslate(o,a);const{size:l,flip:c,rot:h}=e,{width:u,height:d}=l,p=new ap;return p.width=u*r.x,p.height=d*r.y,p.transform.set({x:-u/2-i.x,y:-d/2-i.y},c,h,{x:0,y:0}),p.element.appendChild(t),s.element.appendChild(p.element),[s.element,lp(e,n)]}(t,this.video[0],l,c,this.model.fallbackRenderData),p=this.graphic.model.geometry;if(void 0!==p)try{this.shapeViewModel.setGeometry(gu(this.registry.getGeometry(p),t),t);const e=Bd(this.shapeViewModel.paths,t,new u(0,0),new u(1,1),!1);h.setAttribute("mask",`url(#${e.id})`),h.appendChild(e)}catch(e){(0,b.H)(0,0,`Failed to create video crop mask, ${e.message}`)}Td(this.viewModel.video),void 0!==d?this.viewModel.video.append(d,h):this.viewModel.video.append(h),this.viewModelUpdated.emit()}extractHtmlVideo(){const e=this.videoElement.client;this.htmlVideo=e.getPlayer(),this.htmlVideo.addEventListener("play",this.onVideoPlaying),this.fixHtmlVideo()}ensureControl(){var e;if(void 0!==this.controls||void 0===this.htmlVideo)return;const{trimStartSec:t,trimEndSec:r}=this.properties,{size:i,rot:n}=this.transform,{width:s,height:o}=i;this.viewModel.control.style.width="0px",this.viewModel.control.style.height="0px",this.viewModel.control.style.transform=`translate(${s/2}px,${o/2}px)rotate(${n}deg)`;const a={position:{x:-s/2,y:o/2-50},size:{x:s,y:50},trimInfo:{trimStartMs:1e3*t,trimEndMs:1e3*r},zIndex:1e3,cssUrl:null!==(e=this.properties.controlCssUrl)&&void 0!==e?e:"",cssPositionOverride:"relative",stopPropagateMouseDownOnSlider:!0};this.controls=new Kd(this.htmlVideo,a),this.controls.setParent(this.viewModel.control)}teardownControls(){var e,t;null===(e=this.htmlVideo)||void 0===e||e.removeEventListener("play",this.onVideoPlaying),Td(this.viewModel.control),null===(t=this.controls)||void 0===t||t.hide(),this.controls=void 0}fixHtmlVideo(){void 0!==this.htmlVideo&&(this.htmlVideo.style.pointerEvents="none",this.htmlVideo.controls=!1)}}function pp(e,t,r){var i,n,s,o,a,l;(function(e){e.register(Us,cu)})(i=e.anchorPresenterCreatorRegistry),function(e){e.register(va,vd)}(i),e.presenterCreatorRegistry.register(Oo,(l=wd,(e,t,r)=>{const i=e.model;return new md(e,t,l(i,t.anchorPresenter),r)})).register(ya,((e,t)=>new Jh(e,t))).register(Oa,function(e){return t=wa.$,r=function(e){var t;if(e.getGraphicType()===ks.O.Video)return null===(t=e.getVideoData())||void 0===t?void 0:t.getVideoProvider()}(e),(e,i,n)=>new dp(e,i,t,n,r);var t,r}(t)).register(oa,(a=wa.$,(e,t)=>new qu(e,t,a,(()=>new Lu)))).register(Fs,(n=new au,s=e.presenterCreatorRegistry,o=e.anchorPresenterCreatorRegistry,(e,t,r)=>new su(e,s,o,n,t,r))),function(e,t){(function(e,t){e.register(vh,((e,r)=>new Xu(e,r,t)))})(e,(()=>new Ku(document.createElement("img")))),void 0!==t&&void 0!==t.shapeBuilderConfig.glyphStore&&function(e,t,r){e.register(Sh,((e,i)=>new ad(e,t,i,r)))}(e,t.shapeBuilderConfig.glyphStore,t),function(e,t){e.register(xh,((e,r)=>new Qh(e,r,t)))}(e,{getLayout:async()=>Promise.reject(void 0)})}(e.renderDataPresenterCreatorRegistry,r)}class fp{constructor(e,t){this.container=e,this.canvas2D=t}beginRender(){Td(this.container)}endRender(){}hitTest(e){}addViewModel(e){if(function(e){return e.type===Kh}(e)){if(void 0===e.element||null===e.element)return;e.element.setAttribute("x",`${e.position.x}`),e.element.setAttribute("y",`${e.position.y}`),this.container.appendChild(e.element),void 0!==this.canvas2D&&(this.canvas2D.style.display="none")}}beginGroup(e){}endGroup(){}}class gp extends Md{constructor(e=xd("svg")){super(e)}set width(e){this.set("width",`${e}`)}set height(e){this.set("height",`${e}`)}set x(e){this.set("x",`${e}`)}set y(e){this.set("y",`${e}`)}set viewBox(e){this.set("viewBox",e)}set preserveAspectRatio(e){this.set("preserveAspectRatio",e)}}function mp(e,t){var r;const i=e.transform,n=new ap;n.width=i.size.width,n.height=i.size.height;const s=null!==(r=e.imageData)&&void 0!==r?r:"",o=e.transform.size.clone().scale(e.scaleVector.x,e.scaleVector.y),a=document.createElement("img");return a.src=s,a.width=o.width,a.height=o.height,a.style.pointerEvents="none",n.width=i.size.width,n.height=i.size.height,n.element.appendChild(a),t.setViewModel(a,e),n}function yp(e,t,r){var i,n;const s=e.transform.size.clone().scale(e.scaleVector.x,e.scaleVector.y),o=new sp;let a=e.cachedImageData,l=e.imageData;if(r){const{data:t}=e.fallbackRenderData;l=t,a=t}if(o.width=s.width,o.height=s.height,o.x=-e.topLeftOffset.x,o.y=-e.topLeftOffset.y,o.preserveAspectRatio="none",o.opacity=(null!==(i=e.opacity)&&void 0!==i?i:100)/100,o.href=null!==(n=null!=a?a:l)&&void 0!==n?n:"",void 0!==a&&a!==l){const r=new sp;t.appendChild(r.element);const i=null!=l?l:"";r.element.setAttribute("visibility","hidden"),r.element.addEventListener("load",(()=>{o.href=i,e.cachedImageData=i,r.element.remove()}),{once:!0}),r.href=i}return o}function _p(e,t){var r;const i=!0===(null===(r=e.getPlaceHolder())||void 0===r?void 0:r.overlay),n=e.transform,s=new op,{x:o,y:a}=n.getCenter();let l;s.transform.setTranslate(o,a),s.set("pointer-events","painted");const c=e.fallbackRenderData;if(l=void 0===c?function(e,t,r){const i=Hn(e.mimeType)?mp(e,t):yp(e,r,!1),n=e.geometryVM,s=e.transform,{size:o,flip:a,rot:l}=s,{width:c,height:h}=o;i.transform.set({x:-c/2,y:-h/2},a,l,{x:0,y:0});const u=new op;u.element.appendChild(i.element);const d=Id(n.paths);void 0!==d&&u.element.appendChild(d);const p=Bd(n.paths,s,e.topLeftOffset,e.scaleVector,e.inCropMode);if(u.set("mask",`url(#${p.id})`),u.element.appendChild(p),t.setViewModel(i.element,e),void 0!==e.geometryVM.pictureEffects){const t=function(e,t){if(void 0===e&&void 0===t)return;const r=yu("filter");if(r.id=`gc2-filter-${performance.now()}${Math.random()}`,r.setAttribute("color-interpolation-filters","sRGB"),void 0!==e){const t=yu("feColorMatrix");t.setAttribute("type","matrix");const i=Mo(e.brightness,-1,1)/2,n=function(e){const t=Mo(e,-1,1);return t<=0?t+1:1/(1-Math.min(.99999,t))}(e.contrast),s=n,o=(i-.5)*n+i+.5;t.setAttribute("values",`${s} 0 0 0 ${o} 0 ${s} 0 0 ${o} 0 0 ${s} 0 ${o} 0 0 0 1 0`),r.appendChild(t)}if(void 0!==t){const e=yu("feColorMatrix");e.setAttribute("type","saturate"),e.setAttribute("values",""+t.saturationFactor/2),r.appendChild(e)}return r}(e.geometryVM.pictureEffects.brightnessContrast,e.geometryVM.pictureEffects.hueSaturationLuminance);void 0!==t&&(u.element.appendChild(t),i.set("filter",`url(#${t.id})`))}const f=new op(n.group.cloneNode());return f.element.removeAttribute("transform"),f.element.append(...function(e){const t=[];return e.forEach((([e])=>{const r=e.cloneNode();r.setAttribute("fill","none"),t.push(r)})),t}(n.paths)),u.appendChild(f),u}(e,t.hitTestMap,t.svgRoot):function(e,t,r,i){const n=Hn(e.mimeType)?mp(e,t):yp(e,i,!0),s=e.transform,{sourceAnchorBounds:o,targetBounds:a,rotation:l,flip:c}=r,h=s.size.width/o.width(),u=s.size.height/o.height(),d=a.width()*h,f=a.height()*u,g=a.left*h,m=a.top*u,y=s.size.width,_=s.size.height;n.width=d,n.height=f;const v=new p(s.flip.x!==c.x,s.flip.y!==c.y);n.transform.set({x:g-y/2,y:m-_/2},{x:v.x,y:v.y},s.rot-l,{x:0,y:0}),n.style.pointerEvents="none";const b=new op;return b.element.appendChild(n.element),b}(e,t.hitTestMap,c,t.svgRoot),t.hitTestMap.setViewModel(l.element,e),s.appendChild(l),i){const r=function(e,t,r,i){var n,s,o;const a=e.imageData;if(void 0===a)return;const{size:l,flip:c,rot:h}=t,{width:d,height:p}=l,f=new gp,g=new op;g.appendChild(f),g.transform.set({x:-d/2,y:-p/2},c,h,{x:0,y:0}),f.x=0,f.y=0,f.height=p,f.width=d;let m=!1;try{const t=new URL(a);if("image/svg+xml"===jn(t)&&"data:"===t.protocol.toLowerCase()){const t=wc(atob(a.substring("data:image/svg+xml;base64,".length).trim()));f.element.appendChild(t);for(const r of t.children){if(r instanceof SVGGElement)for(const t of r.children)null==i||i.setViewModel(t,e);null==i||i.setViewModel(r,e)}m=!0}}catch(e){(0,b.KE)(0,16003,`SVG Placeholder parsing failed. Exception: ${e.message}`)}if(!m){const t=new sp;t.href=a,t.preserveAspectRatio="none",f.element.appendChild(t.element),null==i||i.setViewModel(t.element,e)}const y=new op;if(y.appendChild(g),null===(n=e.placeholder)||void 0===n?void 0:n.cropToGeometry){let r;e.geometryVM instanceof Lu?r=e.geometryVM:(r=new Lu,r.setGeometry(e.geometry,t));const i=Id(r.paths);void 0!==i&&y.element.appendChild(i);const n=Bd(r.paths,t,null!==(s=e.topLeftOffset)&&void 0!==s?s:new u(0,0),null!==(o=e.scaleVector)&&void 0!==o?o:new u(1,1),!1);y.set("mask",`url(#${n.id})`),y.element.appendChild(n)}return y}(e.placeholderVM,e.transform,0,t.hitTestMap);void 0!==r&&(t.hitTestMap.setViewModel(r.element,e),s.appendChild(r))}t.svgRoot.appendChild(s.element)}class vp{constructor(e){this.renderScope=0,this.inBeginRender=!1,this.inEndRender=!1,this.renderTargetRegistry=e}beginRender(){if(!this.inBeginRender)try{this.inBeginRender=!0,0===this.renderScope&&this.renderTargetRegistry.beginRender(),this.renderScope+=1}finally{this.inBeginRender=!1}}endRender(){if(!this.inEndRender)try{this.inEndRender=!0,this.renderScope-=1,0===this.renderScope&&this.renderTargetRegistry.endRender()}finally{this.inEndRender=!1}}hitTest(e){}addViewModel(e,t){nu(e)&&e.children.forEach((e=>{this.renderTargetRegistry.addViewModel(e,t)}))}beginGroup(e){}endGroup(){}}function bp(e){e.register(ru,new vp(e))}class wp{constructor(e){this.hitTestMap=new So,this.renderers=new Gs.B([]),this.renderScope=0,this.root=e}registerRenderer(e,t){return this.renderers.register(e,t),this}beginRender(){0===this.renderScope&&(Td(this.root),this.hitTestMap.clear()),this.renderScope+=1}addViewModel(e){const t=this.renderers.get(e.type);void 0===t&&(0,y._)(4,`Unregistered VM type: ${e.type}`),t(e,this)}endRender(){this.renderScope-=1}hitTest(e){if(void 0!==e.target&&null!==e.target)return this.hitTestMap.getViewModel(e.target)}beginGroup(){}endGroup(){}}class Tp{constructor(){this.renderers=new Gs.B([])}register(e,t){return this.renderers.register(e,t),this}renderViewModel(e,t){const r=this.renderers.get(e.type);void 0===r&&(0,y._)(4,`Unknown VM type: ${e.type}`),r(e,t)}hitTest(e,t){if(void 0!==e.target&&null!==e.target)return t.hitTestMap.getViewModel(e.target)}}function xp(e,t){for(const r of Object.keys(e)){const i=r,n=e[i];void 0!==n&&t(i,n)}}class Cp extends class{constructor(e,t){this.eventSinks=[],this.inputElement=e,this.options=t}on(e){this.findIndex(e)>-1||(this.eventSinks.push(e),xp(e,((e,t)=>{this.inputElement.addEventListener(e,t,this.options)})))}off(e){const t=this.findIndex(e);-1!==t&&(xp(e,((e,t)=>{this.inputElement.removeEventListener(e,t,this.options)})),this.eventSinks.splice(t,1))}findIndex(e){return this.eventSinks.findIndex((t=>t===e))}}{}class Sp{constructor(e){this.pointerdown=e=>{this.pointerEventNotifierMap.pointerdown.valid&&this.pointerEventNotifierMap.pointerdown.value.emit(e,{isHandled:!1})},this.pointermove=e=>{this.pointerEventNotifierMap.pointermove.valid&&this.pointerEventNotifierMap.pointermove.value.emit(e,{isHandled:!1})},this.pointerup=e=>{this.pointerEventNotifierMap.pointerup.valid&&this.pointerEventNotifierMap.pointerup.value.emit(e,{isHandled:!1})},this.pointercancel=e=>{this.pointerEventNotifierMap.pointercancel.valid&&this.pointerEventNotifierMap.pointercancel.value.emit(e,{isHandled:!1})},this.pointerEventNotifierMap=e}}class Pp{constructor(e,t,r){this.hitTestMap=new So,this.pointerEventNotifiers=c(),this.renderScope=0,this.svgRoot=e,this.svgRenderer=t,void 0!==r&&(this.pointerEventHandler=new Cp(this.svgRoot),this.pointerEventHandler.on(new Sp(this.pointerEventNotifiers)),new Eo({hitTest:e=>this.hitTest(e)},r).addEventListeners(this.pointerEventNotifiers))}beginRender(){0===this.renderScope&&(Td(this.svgRoot),this.svgDefsElement=void 0,this.hitTestMap.clear()),this.renderScope+=1}addViewModel(e){this.svgRenderer.renderViewModel(e,this)}endRender(){this.renderScope-=1}hitTest(e){return this.svgRenderer.hitTest(e,this)}beginGroup(e){}endGroup(){}ensureSvgDefsElement(){return void 0===this.svgDefsElement&&(this.svgDefsElement=yu("defs"),this.svgRoot.appendChild(this.svgDefsElement)),this.svgDefsElement}}class Ep{}function Mp(e,t){for(const r of e.hitTestElements)r.style.pointerEvents="painted",t.hitTestMap.setViewModel(r,e);t.svgRoot.append(...e.elements)}class Rp{renderViewModel(e,t){const r=new w("ImageCanvas2DRenderer.renderViewModel");try{!function(e){e.type!==$u&&(0,y._)(4,`Invalid viewModel type ${e.type}`)}(e);const i=bo(e.sourceAnchorBounds,e.bounds,e.transform,e.scaleFactor,r);wo(e.canvasImageSource,t.canvasElement,i)}finally{r.complete()}}hitTest(e,t){}}function Ap(e,t){const r=new Rp,i=new vo(e,r);t.register($u,i)}function Bp(e,t,r,i,n,s,o,a){e===ks.O.Chart?function(e,t){if(void 0===t.viewDiv)throw new Error("No viewDiv");const r=document.createElement("canvas");t.viewDiv.appendChild(r),Ap(r,e);const i=document.createElement("div");i.id="ChartPlayerViewDiv",t.viewDiv.appendChild(i);const n=new fp(i,r);e.register(Kh,n),bp(e)}(t,r):e===ks.O.Video?function(e,t){if(void 0===t.viewDiv||null===t.viewDiv.parentElement)throw new Error("No viewDiv");t.viewDiv.parentElement.style.zIndex="2";const r=document.createElement("div");r.style.overflow="visible",r.style.pointerEvents="none",t.viewDiv.appendChild(r);const i=new wp(r);i.registerRenderer(cp,up),e.register(cp,i),bp(e)}(t,r):e===ks.O.Picture?function(e,t){if(void 0===t.viewDiv||null===t.viewDiv.parentElement)throw new Error("No viewDiv");const r=yu("svg");r.style.overflow="visible",r.style.pointerEvents="none",t.viewDiv.appendChild(r);const i=new Tp,n=new Pp(r,i);i.register(Wu,_p).register(Ep,Mp),e.register(Wu,n).register(Ep,n),bp(e)}(t,r):function(e,t,r,i,n,s,o){if(void 0===t.viewDiv)throw new Error("No viewDiv");const a=document.createElement("canvas");a.height=0,a.width=0,t.viewDiv.appendChild(a),Ap(a,e),void 0!==r&&(n?function(e,t,r,i,n,s,o){if(void 0===i.viewDiv)throw new Error("No viewDiv");if(void 0===i.editDiv)throw new Error("No editDiv");const a=c();a.pointerdown.value.on(s);const l=new Io(r,i.viewDiv,i.editDiv,e,n,a,o);t.register(Mt,l)}(a,e,r,t,i,s,o):function(e,t,r){const i=new Bo(t),n=new vo(e,i);r.register(Mt,n)}(a,r,e)),bp(e)}(t,r,i,n,s,o,a)}function Ip(){}class Fp{constructor(e,t,r,i,n,s){this.onPointerDown=e=>{ld(e.currentTarget,e),Po(e,this.cursor.drag),this.dragStartPos=hd(e),this.dragStart(e)},this.onPointerMove=e=>{if(void 0===this.dragStartPos)return Po(e,this.cursor.hover),void this.hover(e);Po(e,this.cursor.drag),this.dragMove(...Dp(e,this.dragStartPos))},this.onPointerUp=e=>{Po(e,this.cursor.hover),void 0!==this.dragStartPos&&(this.dragEnd(...Dp(e,this.dragStartPos)),this.dragStartPos=void 0)},this.onPointerCancel=e=>{void 0!==this.dragStartPos&&(this.dragCancel(e),this.dragStartPos=void 0)},this.cursor=e,this.hover=t,this.dragStart=r,this.dragMove=i,this.dragEnd=n,this.dragCancel=s}attach(e){e.pointerdown.value.on(this.onPointerDown),e.pointermove.value.on(this.onPointerMove),e.pointerup.value.on(this.onPointerUp),e.pointercancel.value.on(this.onPointerCancel)}detach(e){e.pointerdown.value.off(this.onPointerDown),e.pointermove.value.off(this.onPointerMove),e.pointerup.value.off(this.onPointerUp),e.pointercancel.value.off(this.onPointerCancel)}}function Dp(e,t){const r=hd(e);return[new u(r.x-t.x,r.y-t.y),e,r]}class Lp{}class kp{constructor(e,t,r={}){this.type=Lp,this.move={allowed:!0,started:!1,previewed:!1,dragging:!1},this.cleanups=[],this.onDragStart=e=>{var t,r;this.move.dragging=!0;const i=!0!==(null===(t=this.graphic.anchor.locks)||void 0===t?void 0:t.select);this.move.allowed=i&&!0!==(null===(r=this.graphic.anchor.locks)||void 0===r?void 0:r.move)&&0===e.button,i&&(e.ctrlKey||e.shiftKey?this.editContext.actionInvoker.invoke(new fl(this.graphic)):this.editContext.actionInvoker.invoke(new _l([this.graphic]))),void 0!==this.options.onPointerDown&&this.options.onPointerDown(e,this.context),this.move.started=!1,this.move.previewed=!1},this.onDragMove=e=>{var t;if(this.move.dragging&&this.move.allowed){if(!this.move.started){const r=null!==(t=this.options.dragSlop)&&void 0!==t?t:.5;(Math.abs(e.x)>r||Math.abs(e.y)>r)&&(this.move.started=!0,void 0!==this.editContext.previewInfo&&(this.editContext.previewInfo.dragEditor.beginEdit(this.editContext.previewInfo,this),this.move.previewed=!0,void 0!==this.previews&&this.editContext.previewInfo.presenter.addPreviewPresenter(...this.previews)))}this.move.previewed&&void 0!==this.editContext.previewInfo&&this.editContext.previewInfo.dragEditor.applyTransform(new Al(e.x,e.y))}},this.onDragEnd=(e,t)=>{if(!this.move.dragging)return;if(this.move.dragging=!1,this.cleanup(),!this.move.started)return void(void 0!==this.options.onPointerUpMoveNotStarted&&this.options.onPointerUpMoveNotStarted(t,this.context));let r=new Al(e.x,e.y);this.move.previewed&&void 0!==this.editContext.previewInfo&&(r=this.editContext.previewInfo.dragEditor.applyTransform(r),this.editContext.previewInfo.dragEditor.endEdit(this.editContext.previewInfo,this)),this.editContext.actionInvoker.invoke(new Xa(r))},this.onDragCancel=()=>{this.move.dragging&&(this.move.dragging=!1,this.cleanup(),this.move.started&&this.move.previewed&&void 0!==this.editContext.previewInfo&&this.editContext.previewInfo.dragEditor.endEdit(this.editContext.previewInfo))},this.context=e,this.graphic=e.graphic,this.editContext=e.editContext,this.tracker=new Fp(t,Ip,this.onDragStart,this.onDragMove,this.onDragEnd,this.onDragCancel),this.options=r}addEventListeners(e){this.tracker.attach(e.pointerEventNotifiers)}removeEventListeners(e){this.cleanups.push((()=>{this.tracker.detach(e.pointerEventNotifiers)})),this.move.dragging||this.cleanup()}setCursor(e){this.tracker.cursor=e}cleanup(){this.cleanups.forEach((e=>{e()})),this.cleanups=[]}}class Op{constructor(e,t,r,i){this.elements=new Map,this.updateElements=()=>{const e=this.elements;this.elements=new Map;for(const t of this.selection.graphic.model){if(this.selection.hasGraphic(t))continue;const[r,i]=this.presenter.getPresenters(t),n=e.get(t);void 0===n||n.presenter!==r?this.elements.set(t,new Up(this.createEditElement({graphic:t,presenter:r,anchorPresenter:i,editContext:this.editContext}),r)):(e.delete(t),this.elements.set(t,n),n.update())}for(const[t,r]of e)r.teardown()},this.selection=e,this.presenter=t,this.editContext=r,this.createEditElement=i,this.updateElements(),this.presenter.viewModelUpdated.on(this.updateElements),this.selection.selectionUpdated.on(this.updateElements)}teardown(){this.selection.selectionUpdated.off(this.updateElements),this.presenter.viewModelUpdated.off(this.updateElements);for(const[e,t]of this.elements)t.teardown()}}class Up{constructor(e,t){this.update=()=>{this.viewModel!==this.presenter.viewModel&&(this.element.removeEventListeners(this.viewModel),this.viewModel=this.presenter.viewModel,this.element.addEventListeners(this.viewModel))},this.element=e,this.presenter=t,this.viewModel=t.viewModel,this.element.addEventListeners(this.viewModel),this.presenter.viewModelUpdated.on(this.update)}teardown(){this.presenter.viewModelUpdated.off(this.update),this.element.removeEventListeners(this.viewModel)}}class Np{constructor(e,t,r,i){this.viewModel=new iu([],{nodeType:"grCollSelR"}),this.viewModelUpdated=new l,this.underlayPresenters=[],this.childPresenters=new Map,this.updateViewModel=()=>{const e=this.childPresenters;this.childPresenters=new Map;const t=[];for(const r of this.selection.selections){if(this.selection.graphic.model.getGraphic(r.graphic.id)!==r.graphic)continue;const i=e.get(r),[n]=this.modelPresenter.getPresenters(r.graphic);if(void 0!==i&&i.modelPresenter===n){e.delete(r),this.childPresenters.set(r,i),i.update(),t.push(i.container);continue}const s=this.createChildSelectionPresenter(r);this.childPresenters.set(r,s),t.push(s.container)}for(const[t,r]of e)r.teardown();this.viewModel.children=[...this.underlayPresenters.map((e=>e.viewModel)),...t],this.viewModelUpdated.emit()},this.selection=e,this.modelPresenter=t.modelPresenter,this.selectionPresenterCreator=t.selectionPresenterCreator,this.context=t,this.editContext=r,this.editElements=new Op(e,this.modelPresenter,r,i),this.updateViewModel(),this.selection.selectionUpdated.on(this.updateViewModel),this.modelPresenter.viewModelUpdated.on(this.updateViewModel)}teardown(){this.editElements.teardown(),this.selection.selectionUpdated.off(this.updateViewModel),this.modelPresenter.viewModelUpdated.off(this.updateViewModel);for(const[e,t]of this.childPresenters)t.teardown();this.childPresenters.clear();for(const e of this.underlayPresenters)e.viewModelUpdated.off(this.updateViewModel),e.teardown()}addUnderlayPresenter(e){this.underlayPresenters.push(e),e.viewModelUpdated.on(this.updateViewModel),this.updateViewModel()}createChildSelectionPresenter(e){const[t,r]=this.modelPresenter.getPresenters(e.graphic),i=Object.assign(Object.assign({},this.context),{anchorPresenter:r,modelPresenter:t}),n=this.selectionPresenterCreator.createSelectionPresenter(e,i,this.editContext);return new Vp(t,n,this)}}class Vp{constructor(e,t,r){this.onViewModelUpdated=()=>{this.update(),this.parent.viewModelUpdated.emit()},this.modelPresenter=e,this.presenter=t,this.container=new iu([t.viewModel]),this.parent=r,this.presenter.viewModelUpdated.on(this.onViewModelUpdated)}update(){this.container.children=[this.presenter.viewModel]}teardown(){this.presenter.viewModelUpdated.off(this.onViewModelUpdated),this.presenter.teardown()}}function Gp(e){return new kp(e,{hover:"move",drag:"move"})}function zp(e=Gp){return(t,r,i)=>new Np(t,r,i,e)}class Hp{constructor(){this.viewModel=new iu,this.viewModelUpdated=new l}teardown(){}}function Wp(){return new Hp}function jp(e){return e/255}function qp(e){return ge.FromRGBA({r:jp(e.r),g:jp(e.g),b:jp(e.b),a:e.a})}function Xp(e,t,r){return new yt([O.CreateFromRect(new E(0,0,t,e))],new Se(r))}function $p(e,t,r){return new yt([O.CreateFromRect(new E(0,0,e,t))],new Se(r))}const Kp=new _e(qp(new ea(255,255,255,1))),Yp=new _e(qp(new ea(128,128,128,1))),Jp=100,Zp=new a((()=>Xp(2,Jp,Yp))),Qp=new a((()=>$p(2,Jp,Yp))),ef=new a((()=>Xp(2,Jp,Kp))),tf=new a((()=>$p(2,Jp,Kp)));function rf(e,t,r,i,n,s,o,a){return[new _t([i],void 0,new P(new x(-50,-e.size.height/2-o),new x((e.size.width+s)/Jp,1),t,r)),new _t([i],void 0,new P(new x(-50,e.size.height/2-a),new x((e.size.width+s)/Jp,1),t,r)),new _t([n],void 0,new P(new x(-e.size.width/2-o,-50),new x(1,(e.size.height+s)/Jp),t,r)),new _t([n],void 0,new P(new x(e.size.width/2-a,-50),new x(1,(e.size.height+s)/Jp),t,r))]}function nf(e){const t=new Rt;return t.addItem(function(e){const t=function(e){return new x(e.pos.x+e.size.width/2,e.pos.y+e.size.height/2)}(e),r=(0,h.Yr)(e.rot),i=function(e,t,r){return rf(e,t,r,Zp.value,Qp.value,4,2,0)}(e,r,t),n=function(e,t,r){return rf(e,t,r,ef.value,tf.value,0,0,2)}(e,r,t);return new _t(i.concat(n))}(e)),t.hitTestSlop=6,t}class sf{constructor(e,t){this.viewModelUpdated=new l,this.refreshSelectionViewModel=()=>{try{this.viewModel=this.createSelectionViewModel(),this.viewModelUpdated.emit()}catch(e){const t=e;void 0!==t&&(0,b.KE)(0,8e3,`Exception: ${t.message}, Stack Trace: ${t.stack}`)}},this.selection=e,this.context=t,this.refreshSelectionViewModel(),this.selection.selectionUpdated.on(this.refreshSelectionViewModel),this.context.modelPresenter.viewModelUpdated.on(this.refreshSelectionViewModel)}teardown(){this.context.modelPresenter.viewModelUpdated.off(this.refreshSelectionViewModel),this.selection.selectionUpdated.off(this.refreshSelectionViewModel)}createSelectionViewModel(){const e=this.context.anchorPresenter.transform,t=this.context.viewScale.viewTransform;let r=1,i=1;0!==t.size.width&&(r=t.size.width/e.size.width),0!==t.size.height&&(i=t.size.height/e.size.height);const n=[],s=this.selection.graphic.model.fallbackRenderData;if(void 0!==this.selection.graphic.model.layout&&void 0!==s&&Eh(s))for(const t of this.selection){const o=this.selection.graphic.model.layout.shapes.find((e=>e.modelId===t.modelId));if(void 0!==o){const t=o.shapeProps.transform.clone();t.size.width*=r,t.size.height*=i,t.pos.x=(t.pos.x+e.pos.x-s.sourceAnchorBounds.left)*r,t.pos.y=(t.pos.y+e.pos.y-s.sourceAnchorBounds.top)*i,n.push(t)}}return new iu(n.map(((e,r)=>{const i=function(e,t){return new iu([nf(e)],{nodeType:"selGraphic",nodeKey:t})}(e,`${r}`);return i.children.forEach((e=>{At(e)&&(e.emuToSourceScale=0,e.scaleFactor=this.context.viewScale.zoomFactor,e.transform=t,e.sourceAnchorBounds=new d(0,0,t.size.width,t.size.height))})),i})))}}function of(e,t){return new sf(e,t)}class af{constructor(e,t){this.viewModel=new iu,this.viewModelUpdated=new l,this.onSelectionUpdated=e=>{0===e&&this.modelPresenter.play()},this.selection=e,this.modelPresenter=t.modelPresenter,this.modelPresenter.isSelected=!0,this.selection.selectionUpdated.on(this.onSelectionUpdated)}teardown(){this.modelPresenter.isSelected=!1,this.selection.selectionUpdated.off(this.onSelectionUpdated)}}function lf(e){switch(e){case ks.O.SmartArt:return"SmartArt";case ks.O.Chart:return"Chart";case ks.O.Video:return"Video";case ks.O.Picture:return"Picture";default:return"Unknown"}}const cf="graphicType";class hf{constructor(e,t){if(this.keyboardEventNotifierMap={keyup:new l,keydown:new l},this.pointerEventNotifierMap=c(),this.hostContext=new Os,this.isSelected=!1,this.onSelectionViewModelUpdated=()=>{this.selection.selections.forEach((e=>{if(Go(e)&&void 0!==this.accessibilityDiv){const t=e.getAriaMessageForSelection(this.ariaStrings);this.accessibilityDiv.innerHTML===t?this.accessibilityDiv.innerText+=" ":this.accessibilityDiv.innerText=t}}))},this.onFrameRendered=e=>{if(void 0!==e&&0!==e.length){no(e,"OnFrameRenderedStartTime");try{this.kpiLogger.logFrameRendered(e)}catch(e){(0,b.KE)(0,55e3,`Exception: ${e.message}`)}}},this.defaultHitTestPointerDownEventHandler=()=>{this.clearChildSelection()},this.invokeActionCallback=e=>{this.host.performAction(e)},this.onSelectionUpdated=()=>{if(!this.isSelected&&this.selection.length>0){const e=this.config.graphicData.getVideoData();null!==e?e.select():(0,b.H)(0,55e3,"Unable to select host")}},this.config=e,void 0===this.config.domRenderTarget.viewDiv)throw new Error("No viewDiv to render to");this.graphic=Na(e.graphicData,this.hostContext),this.pptGraphicType=e.graphicData.getGraphicType(),this.kpiLogger=new Fh(e.brsConfig,t,this.pptGraphicType),void 0!==this.config.domRenderTarget.editDiv&&(this.editDiv=this.config.domRenderTarget.editDiv,this.editDiv.setAttribute("graphicID",this.graphic.id)),void 0!==this.config.domRenderTarget.accessibilityDiv&&null!==this.config.domRenderTarget.accessibilityDiv&&(this.accessibilityDiv=this.config.domRenderTarget.accessibilityDiv,this.accessibilityDiv.style.width="0",this.accessibilityDiv.style.height="0",this.accessibilityDiv.style.overflow="hidden",this.accessibilityDiv.style.zIndex="-1",this.accessibilityDiv.setAttribute("aria-role","marquee"),this.accessibilityDiv.setAttribute("aria-live","assertive"),this.accessibilityDiv.setAttribute("aria-atomic","true"),this.accessibilityDiv.innerHTML+=""),this.ariaStrings=this.config.ariaStrings,this.graphicCollectionModel=new Ds(this.hostContext),this.graphicCollectionModel.addGraphics([this.graphic]),this.host=this.createHost(this.config,t,this.keyboardEventNotifierMap,this.pointerEventNotifierMap,this.config.brsConfig.isGC2WebGLRenderTargetEnabled,e.brsConfig.separateSelectionSceneFromGraphic);const r=this.host.renderTargetRegistry.get(Mt);r instanceof Io&&(this.shapeBuilderMultiplexRenderTarget=r),this.host.frameRendered.on(this.onFrameRendered),this.host.start(this.graphicCollectionModel,new Ns),this.host.selectionPresenter.viewModelUpdated.on(this.onSelectionViewModelUpdated),this.selection=this.host.selection,this.commandContext=new zo(this.selection),this.selection.selectionUpdated.on(this.onSelectionUpdated),this.config.brsConfig.pictureBGREnabled&&this.setup().catch(),(0,b.PN)(0,55e3,"The Gc2 host is enabled.")}async setup(){try{e=Rs,Sn.push(e),await async function(){await Promise.all(Sn.map((e=>e()))),Sn=[]}()}catch(e){(0,b.H)(0,55e3,`Error occurred while initializing AI capabilities for PPTO Pictures. ${e.message}`)}var e}dispose(){this.graphicCollectionModel.removeGraphics([this.graphic]),this.selection.selectionUpdated.off(this.onSelectionUpdated),this.host.selectionPresenter.viewModelUpdated.off(this.onSelectionViewModelUpdated),this.host.frameRendered.off(this.onFrameRendered),this.host.teardown(),this.config.brsConfig.pictureBGREnabled&&this.teardown().catch()}async teardown(){try{e=As,Pn.push(e),await async function(){await Promise.all(Pn.map((e=>e()))),Pn=[]}()}catch(e){(0,b.H)(0,55e3,`Error occurred while tearing down AI capabilities for PPTO Pictures. ${e.message}`)}var e}handleShapeNodeGC2ModelSync(){const e=new po("GC2ModelShapeNodePerf");e.start(),this.graphic.model.modelUpdated.emit(void 0,e)}setRenderData(e,t,r){const i=new w("PowerPointGraphicHost.setRenderData");try{const a=new po("GC2SetRenderDataPerf");a.start(),a.addTimePoint("SetRenderDataStartTime"),r.set(cf,lf(this.pptGraphicType)),this.kpiLogger.logSetRenderData(a,r),i.setProp("x",t.pos.x),i.setProp("y",t.pos.y),i.setProp("width",t.size.width),i.setProp("height",t.size.height);const l=Rh(e,t);if(this.pptGraphicType===ks.O.Picture){const e=this.graphic.model,t=l,i=(n=r.get("imageId"),s=new URL(t.data),o=Sa.getInstance(),new mo(n,s,!0,o,undefined));e.data=i,e.placeholder=void 0}this.graphic.model.fallbackRenderData=l,void 0!==this.shapeBuilderMultiplexRenderTarget&&(e.renderDataType!==Ls.ShapeBuilderJson?(this.shapeBuilderMultiplexRenderTarget.skipPrepareWebGLCanvas=!0,this.shapeBuilderMultiplexRenderTarget.renderTargetMode=0):this.shapeBuilderMultiplexRenderTarget.skipPrepareWebGLCanvas=!1),a.addTimePoint("ModelUpdatedEventEmittedTime"),this.graphic.model.modelUpdated.emit(void 0,a),a.addTimePoint("SetRenderDataEndTime")}finally{i.complete()}var n,s,o}setPosition(e,t){}setZoomFactor(e){const t=new w("PowerPointGraphicHost.setZoomFactor");try{t.setProp("zoomFactor",e),this.host.viewScale.zoomFactor=e*window.devicePixelRatio}finally{t.complete()}}setTransform(e,t){const r=new w("PowerPointGraphicHost.setTransform");try{const i=new po("GC2SetTransformPerf");null!==t&&(t.set(cf,lf(this.pptGraphicType)),void 0!==this.shapeBuilderMultiplexRenderTarget&&t.set("ShapeBuilderRenderTargetMode",0===this.shapeBuilderMultiplexRenderTarget.renderTargetMode?vo.name:Ao.name),i.start(),this.kpiLogger.logSetTransform(i,t)),r.setProp("x",e.pos.x),r.setProp("y",e.pos.y),r.setProp("width",e.size.width),r.setProp("height",e.size.height);const n=function(e){return new m(new f(e.pos.x,e.pos.y),new g(e.size.width,e.size.height),new p(e.flip.x,e.flip.y),e.rot)}(e);if(0!==window.devicePixelRatio){const e=1/window.devicePixelRatio;n.size.width*=e,n.size.height*=e,n.pos.x*=e,n.pos.y*=e}this.host.viewScale.viewTransform=n}finally{r.complete()}}setSelected(e){this.isSelected=e,e?this.selection.addGraphics([this.graphic]):this.selection.removeGraphics([this.graphic])}clearChildSelection(){this.selection.selections.forEach((e=>{Go(e)?e.clear():(0,b.H)(0,55e3,"Selection is not of type SmartArtSelection")}))}handleCommand(e,t){const r=t,i=ma.createAction(e,r,this.commandContext);if(void 0!==i){const r=this.handleQueryCommand(e,t);if(void 0!==r&&r.enabled)return this.host.performAction(i),new Ah(!0)}return new Ah(!1)}handleQueryCommand(e,t){const r=ma.query(e,this.commandContext);return{enabled:void 0!==r&&r.enabled}}processKeyboardEvent(e){const t={isHandled:!1};return"keyup"===e.type?this.keyboardEventNotifierMap.keyup.emit(e,t):"keydown"===e.type&&this.keyboardEventNotifierMap.keydown.emit(e,t),new Bh(t)}processPointerEvent(e){const t={isHandled:!1};return"pointerdown"===e.type?this.pointerEventNotifierMap.pointerdown.value.emit(e,t):"pointerup"===e.type?this.pointerEventNotifierMap.pointerup.value.emit(e,t):"pointermove"===e.type&&this.pointerEventNotifierMap.pointermove.value.emit(e,t),new Bh(t)}createHost(e,t,r,i,n,s){const o=new uo(this.getHostConfig(r));return pp(o,e.graphicData,t),Bp(e.graphicData.getGraphicType(),o.renderTargetRegistry,e.domRenderTarget,t,i,n,this.defaultHitTestPointerDownEventHandler,s),function(e){var t;(function(e){e.registerForType(Fs,(t=>new ul(t,e)))})(t=e.selectionCreatorRegistry),function(e){e.registerForType(Oo,(e=>new Vo(e,new Fo(new ko,Lo(e.model.smartArtData.elementList)))))}(t),function(e){e.registerForType(Oa,(e=>new mh(e)))}(t),function(e){e.registerForType(oa,(e=>new la(e)))}(t),function(e){e.register(hl,zp()).register(No,of).register(gh,((e,t)=>new af(e,t))).register(aa,Wp)}(e.selectionPresenterCreatorRegistry)}(o),function(e){var t;!function(e,t,r,i){const n={dispatcher:new ic,actions:new dl([[pl,Va(Vl)],[gl,Va(zl)],["selectAllGraphics",Va(Gl)],[yl,Va(Hl)],[vl,Ga(Wl)],["replaceGraphic",Ga(jl)],[wl,Ga(ql)],["alignAction",Ga(Fl)],["distributeAction",Ga(Dl)]]),keyboardShortcuts:null!=r?r:new $l([{key:"Delete",modifiers:Xl.None,performer:Ql},{key:"Backspace",modifiers:Xl.None,performer:Ql},{key:"Escape",modifiers:Xl.None,performer:ec},{key:"Arrow",modifiers:Xl.None,performer:Kl(0,0)},{key:"Tab",modifiers:Xl.None,performer:tc},{key:"Tab",modifiers:Xl.Shift,performer:tc},{key:"ArrowUp",modifiers:Xl.None,performer:Kl(0,-1)},{key:"ArrowDown",modifiers:Xl.None,performer:Kl(0,1)},{key:"ArrowLeft",modifiers:Xl.None,performer:Kl(-1,0)},{key:"ArrowRight",modifiers:Xl.None,performer:Kl(1,0)},{key:"ArrowUp",modifiers:Xl.Shift,performer:Yl(1,1.1)},{key:"ArrowDown",modifiers:Xl.Shift,performer:Yl(1,.9090909090909091)},{key:"ArrowLeft",modifiers:Xl.Shift,performer:Yl(.9090909090909091,1)},{key:"ArrowRight",modifiers:Xl.Shift,performer:Yl(1.1,1)},{key:"ArrowUp",modifiers:Xl.CtrlShift,performer:Yl(1,1.01)},{key:"ArrowDown",modifiers:Xl.CtrlShift,performer:Yl(1,.9900990099009901)},{key:"ArrowLeft",modifiers:Xl.CtrlShift,performer:Yl(.9900990099009901,1)},{key:"ArrowRight",modifiers:Xl.CtrlShift,performer:Yl(1.01,1)},{key:"ArrowLeft",modifiers:Xl.Alt,performer:Jl(-15)},{key:"ArrowRight",modifiers:Xl.Alt,performer:Jl(15)},{key:"ArrowLeft",modifiers:Xl.CtrlAlt,performer:Jl(-1)},{key:"ArrowRight",modifiers:Xl.CtrlAlt,performer:Jl(1)},{key:"[",modifiers:Xl.Ctrl,performer:rc(2)},{key:"]",modifiers:Xl.Ctrl,performer:rc(0)},{key:"{",modifiers:Xl.CtrlShift,performer:rc(3)},{key:"}",modifiers:Xl.CtrlShift,performer:rc(1)}])};e.register(hl,n)}(e.editorRegistry,0,new $l([])),function(e){const t={actions:new dl([[gl,Va(rh)],[Yc,Va(ih)],[Zc,Va(nh)],[Wo,Va(sh)],[pa,Va(oh)],[$c,Va(ah)],[eh,Va(lh)]]),keyboardShortcuts:new $l([{key:"Enter",modifiers:Xl.None,performer:hh},{key:"Escape",modifiers:Xl.None,performer:uh},{key:"Tab",modifiers:Xl.None,performer:dh},{key:"Tab",modifiers:Xl.Shift,performer:dh},{key:"a",modifiers:Xl.Ctrl,performer:ch}])};e.register(No,t)}(e.editorRegistry),function(e){const t={dispatcher:new _h,actions:new dl([[ph,yh]]),keyboardShortcuts:new $l([])};e.register(gh,t)}(e.editorRegistry),(t=function(e){const t={dispatcher:new Xc,actions:qc(),keyboardShortcuts:new $l([])};return e.register(aa,t),t}(e.editorRegistry).actions).register(qo,Ha(al)),t.register("smartCropAction",Ha(il)),t.register("superResolutionAction",Ha(ll))}(o),o}getHostConfig(e){return{anchorPresenterCreatorEntries:[],presenterCreatorEntries:[],selectionCreatorRegistrars:[],selectionPresenterCreatorEntries:[],keyboardEventNotifiers:e,actionInvoker:{invoke:this.invokeActionCallback}}}}const uf=new class{constructor(){this._initStatus=r.Uninitialized,Rt.setDefaultScaleFactor(1/window.devicePixelRatio)}createGraphicHost(e){if(this._initStatus===r.Uninitialized)throw new Error("Factory isn't initialized");return new hf(e,this.sbContext)}async init(t){if(this._initStatus!==r.Succeeded){var n;if(this._initStatus=r.Started,(0,b.WD)(new Cn(t.logger)),!0!==t.setGC2KpiLogger?yn(new bn(t.logger)):void 0!==t.health&&yn(new i(t.health)),void 0!==t.health&&(0,vn.C)(new o(t.health)),void 0!==t.augloopSessionManager&&(n=t.augloopSessionManager,e=n),(0,b.PN)(0,55002,"PowerPointGraphicFactory - init started"),void 0!==t.shapeBuilderConfig&&null!==t.shapeBuilderConfig){if(this.sbContext=function(e){return new fn(e)}(t.shapeBuilderConfig),void 0===this.sbContext)return(0,b.KE)(0,55002,"PowerPointGraphicFactory - undefined sbContext"),void(this._initStatus=r.Failed);if(await this.sbContext.setupWebGLContext(),(0,b.PN)(0,55002,`PowerPointGraphicFactory - isRendererReady:${this.sbContext.isRendererReady}`),!this.sbContext.isRendererReady)return void(this._initStatus=r.Failed)}this._initStatus=r.Succeeded,(0,b.PN)(0,55002,`PowerPointGraphicFactory - init ended; initStatus:${this._initStatus}`)}}handleContextLost(){if(this._initStatus===r.Uninitialized)throw new Error("Factory isn't initialized");void 0!==this.sbContext?this.sbContext.handleContextLost():(0,b.PN)(0,55002,"undefined sbContext")}async handleContextRestored(){if(this._initStatus===r.Uninitialized)throw new Error("Factory isn't initialized");void 0!==this.sbContext?await this.sbContext.handleContextRestored():(0,b.PN)(0,55002,"undefined sbContext")}getInitStatus(){return this._initStatus}isShapeBuilderRendererReady(){return void 0!==this.sbContext&&this.sbContext.isRendererReady}}})(),Gc2HostPpt=s})();
//# sourceMappingURL=Gc2HostPpt.js.map